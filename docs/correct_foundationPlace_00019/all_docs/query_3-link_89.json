{
    "id": "correct_foundationPlace_00019_3",
    "rank": 89,
    "data": {
        "url": "https://palant.info/2024/07/15/how-insecure-is-avast-secure-browser/",
        "read_more_link": "",
        "language": "en",
        "title": "How insecure is Avast Secure Browser?",
        "top_image": "https://palant.info/2024/07/15/how-insecure-is-avast-secure-browser/avast.png",
        "meta_img": "https://palant.info/2024/07/15/how-insecure-is-avast-secure-browser/avast.png",
        "images": [
            "https://palant.info/2024/07/15/how-insecure-is-avast-secure-browser/avast.png",
            "https://palant.info/2024/07/15/how-insecure-is-avast-secure-browser/website.png",
            "https://palant.info/2024/07/15/how-insecure-is-avast-secure-browser/browser_advertising.png",
            "https://palant.info/2024/07/15/how-insecure-is-avast-secure-browser/browser_extensions.png",
            "https://palant.info/2024/07/15/how-insecure-is-avast-secure-browser/messaging_extension.png",
            "https://palant.info/2024/07/15/how-insecure-is-avast-secure-browser/nag_screen.png",
            "https://palant.info/icons/cc-by-sa.477d847f9c6c2086d518f53033712141.svg"
        ],
        "movies": [],
        "keywords": [],
        "meta_keywords": [
            ""
        ],
        "tags": null,
        "authors": [
            "Wladimir Palant"
        ],
        "publish_date": "2024-07-15T00:00:00",
        "summary": "",
        "meta_description": "Another look into Avast Secure Browser shows a massive attack surface, with some issues mentioned five years ago only partially addressed, all while new ways to attack the browser have been added.",
        "meta_lang": "en",
        "meta_favicon": "/favicon.ico",
        "meta_site_name": "Almost Secure",
        "canonical_link": "https://palant.info/2024/07/15/how-insecure-is-avast-secure-browser/",
        "text": "A while ago I already looked into Avast Secure Browser. Back then it didnât end well for Avast: I found critical vulnerabilities allowing arbitrary websites to infect userâs computer. Worse yet: much of it was due to neglect of secure coding practices, existing security mechanisms were disabled for no good reason. I didnât finish that investigation because I discovered that the browser was essentially spyware, collecting your browsing history and selling it via Avastâs Jumpshot subsidiary.\n\nBut that was almost five years ago. After an initial phase of denial, Avast decided to apologize and to wind down Jumpshot. It was certainly a mere coincidence that Avast was subsequently sold to NortonLifeLock, called Gen Digital today. Yes, Avast is truly reformed and paying for their crimes in Europe and the US. According to the European decision, Avast is still arguing despite better knowledge that their data collection was fully anonymized and completely privacy-conformant butâ¦ well, old habits are hard to get rid of.\n\nEither way, itâs time to take a look at Avast Secure Browser again. Becauseâ¦ all right, because of the name. That was a truly ingenious idea to name their browser like that, nerd sniping security professionals into giving them free security audits. By now they certainly would have addressed the issues raised in my original article and made everything much more secure, right?\n\nNote: This article does not present any actual security vulnerabilities. Instead, this is a high-level overview of design decisions that put users at risk, artificially inflating the attack surface and putting lots of trust into the many, many companies involved with the Avast webspaces. TL;DR: I wouldnât run Avast Secure Browser on any real operating system, only inside a virtual machine containing no data whatsoever.\n\nContents\n\nSummary of the findings\n\nThe issues raised in my original article about the pre-installed browser extensions are still partially present. Two extensions are relaxing the default protection provided by Content-Security-Policy even though it could have been easily avoided. One extension is requesting massive privileges, even though it doesnât actually need them. At least they switched from jQuery to React, but they still somehow managed to end up with HTML injection vulnerabilities.\n\nIn addition, two extensions will accept messages from any Avast website â or servers pretending to be Avast websites, since HTTPS-encrypted connections arenât being enforced. In the case of the Privacy Guard (sic!) extension, this messaging exposes usersâ entire browsing information to websites willing to listen. Yes, Avast used to collect and sell that information in the past, and this issue could in principle allow them to do it again, this time in a less detectable way.\n\nThe Messaging extension is responsible for the rather invasive âonboardingâ functionality of the browser, allowing an Avast web server to determine almost arbitrary rules to nag the user â or to redirect visited websites. Worse yet, access to internal browser APIs has been exposed to a number of Avast domains. Even if Avast (and all the other numerous companies involved in running these domains) are to be trusted, there is little reason to believe that such a huge attack surface can possibly be secure. So it has to be expected that other websites will also be able to abuse access to these APIs.\n\nWhat is Avast Secure Browser?\n\nAvast Secure Browser is something you get automatically if you donât take care while installing your Avast antivirus product. Or AVG antivirus. Or Avira. Or Norton. Or CCleaner. All these brands belong to Gen Digital now, and all of them will push Avast Secure Browser under different names.\n\nAccording to their web page, there are good reasons to promote this browser:\n\nSo one of the reasons is: this browser is 100% free. And it really is, as in: âyou are the product.â I took the liberty of making a screenshot of the browser and marking the advertising space:\n\nYes, maybe this isnât entirely fair. Iâm still indecisive as to whether the search bar should also be marked. The default search engine is Bing and the browser will nudge you towards keeping it selected. Not because Microsoftâs search engine is so secure and private of course but because they are paying for it.\n\nBut these are quality ads and actually useful! Like that ad for a shop selling food supplements, so that you can lead a healthy life. A quick search reveals that one of the three food supplements shown in the ad is likely useless with the suspicion of being harmful. Another brings up lots of articles by interested parties claiming great scientifically proven benefits but no actual scientific research on the topic. Finally the third one could probably help a lot â if there were any way of getting it into your body in sufficient concentration, which seems completely impossible with oral intake.\n\nNow that we got âfreeâ covered, we can focus on the security and privacy aspects in the subsequent sections.\n\nThe pre-installed extensions\n\nThere are various reasons for browser vendors to pre-package extensions with their browser. Mozilla Firefox uses extensions to distribute experimental features before they become an integral part of the browser. As I learned back in 2011, Google Chrome uses such extensions to promote their web applications and give them an advantage over competition. And as Simon Willison discovered only a few days ago, the Google Hangouts extension built into Google Chrome gives Google domains access to internal browser APIs â quite nifty if one wants better user tracking capabilities.\n\nMy previous article mentioned Avast Secure Browser adding eleven extensions to the ones already built into Google Chrome. This number hasnât changed: I still count eleven extensions, even though their purposes might have changed. At least thatâs eleven extensions for me, differently branded versions of this browser seem to have a different combination of extensions. Only two of these extensions (Coupons and Video Downloader) are normally visible in the list of extensions and can be easily disabled. Three more extensions (Avast Bank Mode, Avast SecureLine VPN, Privacy Guard) become visible when Developer Mode is switched on.\n\nAnd then there are five extensions that arenât visible at all and cannot be disabled by regular means: Anti-Fingerprinting, Messaging, Side Panel, AI Chat, Phishing Protection. Finally, at least the New Tab extension is hardwired into the browser and is impossible to disable.\n\nNow none of this is a concern if these extensions are designed carefully with security and privacy in mind. Are they?\n\nSecurity mechanisms disabled\n\nMy previous article described the Video Downloader extension as a huge âplease hack meâ sign. Its extension manifest requested every permission possible, and it also weakened Content-Security-Policy (CSP) protection by allowing execution of dynamic scripts. Both were completely unnecessary, my proof of concept exploit abused it to get a foothold in the Avast Secure Browser.\n\nLooking at the current Video Downloader manifest, things are somewhat better today:\n\nThe permissions requested by this extension still grant it almost arbitrary access to all websites. But at least the only unused privilege on this list is management which gives it the ability to disable or uninstall other extensions.\n\nAs to CSP, there is still 'unsafe-eval' which allowed this extension to be compromised last time. But now itâs there for a reason: Video Downloader âneedsâ to run some JavaScript code it receives from YouTube in order to extract some video metadata.\n\nI did not test what this code is or what it does, but this grants at the very least the YouTube website the ability to compromise this extension and, via it, the integrity of the entire browser. But thatâs YouTube, it wonât possibly turn evil, right?\n\nFor reference: it is not necessary to use 'unsafe-eval' to run some untrusted code. Itâs always possible to create an <iframe> element and use the sandbox attribute to execute JavaScript code in it without affecting the rest of the extension.\n\nBut there are more extensions. There is the Avast Bank Mode extension for example, and its extension manifest says:\n\nYes, requesting every possible permission and allowing execution of dynamic scripts at the same time, the exact combination that wreaked havoc last time. Why this needs 'unsafe-eval'? Because it uses some ancient webpack version that relies on calling eval() in order to âloadâ JavaScript modules dynamically. Clearly, relaxing security mechanisms was easier than using a better module bundler (like the one used by other Avast extensions).\n\nThe (lack of) ad blocking privacy\n\nThe Privacy Guard extension is responsible for blocking ads and trackers. It is meant by the sentence âblock ads and boost your online privacyâ in the website screenshot above. It is also one of the two extensions containing the following entry in its manifest:\n\nWhat this means: any other extension installed is allowed to send messages to the Privacy Guard extension. That isnât restricted to Avast extensions, any other extension you installed from Avastâs or Googleâs add-on store is allowed to do this as well.\n\nThe same is true for any website under the domains avast.com, securebrowser.com, avastbrowser.com, avgbrowser.com or ccleanerbrowser.com. Note that the rules here donât enforce https:// scheme, unencrypted HTTP connections will be allowed as well. And while avast.com domain seems to be protected by HTTP Strict Transport Security, the other domains are not.\n\nWhy this matters: when your browser requests example.securebrowser.com website over an unencrypted HTTP connection, it cannot be guaranteed that your browser is actually talking to an Avast web server. In fact, any response is guaranteed to come from a malicious web server because to such website exists.\n\nOne way you might get a response from such a malicious web server is connecting to a public WiFi. In principle, anyone connected to the same WiFi could redirect unencrypted web requests to their own malicious web server, inject an invisible request to example.securebrowser.com in a frame (which would also be handled by their malicious server) and gain the ability to message Privacy Guard extension. While not common, this kind of attack did happen in the wild.\n\nAnd what does someone get then? Let me show you:\n\nThis establishes a connection to the extension and logs all incoming messages. One message is received immediately:\n\nThe first part are the Privacy Guard settings, your whitelisted domains, everything. There are also the three hardcoded lists containing blocking exceptions â funny how Avast doesnât seem to mention these anywhere in the user interface or documentation. I mean, it looks like in the default âBalanced Modeâ their ad blocker wonât block any ads on Amazon or eBay among other things. Maybe Avast should be more transparent about that, or people might get the impression that this has something to do with those sponsored bookmarks.\n\nAnd then there is information about all your browsing tabs which I shortened to only one tab here. Itâs pretty much all information produced by the tabs API, enriched with some information on blocked ads. Privacy Guard will not merely send out the current state of your browsing session, it will also send out updates whenever something changes. To any browser extension, to any Avast website and to any web server posing as an Avast website.\n\nDoes Avast abuse this access to collect usersâ browsing data again? Itâs certainly possible. As long as they only do it for a selected subset of users, this would be very hard to detect however. It doesnât help that Avast Secure Browser tracks virtual machine usage among other things, so itâs perfectly plausible that this kind of behavior wonât be enabled for people running one. It may also only be enabled for people who opened the browser a given number of times after installing it, since this is being tracked as well.\n\nCan other browser extensions abuse this to collect usersâ browsing data? Absolutely. An extension can declare minimal privileges, yet it will still be able to collect the entire browsing history thanks to Privacy Guard.\n\nCan a malicious web server abuse this to collect usersâ browsing data beyond a single snapshot of currently open tabs? Thatâs more complicated since this malicious web server would need its web page to stay open permanently somehow. While Avast has the capabilities to do that (more on that below), an arbitrary web server normally doesnât and has to resort to social engineering.\n\nThe messaging interface doesnât merely allow reading data, the data can also be modified almost arbitrarily as well. For example, itâs possible to enable ad blocking without any user interaction. Not that it changes much, the data collection is running whether ad blocking is enabled or not.\n\nThis messaging interface can also be used to add exceptions for arbitrary domains. And while Privacy Guard options page is built using React.js which is normally safe against HTML injections, in one component they chose to use a feature with the apt name dangerouslySetInnerHTML. And that component is used among other things for displaying, you guessed it: domain exceptions.\n\nThis is not a Cross-Site Scripting vulnerability, thanks to CSP protection not being relaxed here. But it allows injecting HTML content, for example CSS code to mess with Privacy Guardâs options page. This way an attacker could ensure that exceptions added cannot be removed any more. Or they could just make Privacy Guard options unusable altogether.\n\nThe onboarding experience\n\nThe other extension that can be messaged by any extension or Avast web server is called Messaging. Interestingly, Avast went as far as disabling Developer Tools for it, making it much harder to inspect its functionality. I donât know why they did it, maybe they were afraid people would freak out when they saw the output it produces while they are browsing?\n\nYou wonder what is going on? This extension processes some rules that it downloaded from https://config.avast.securebrowser.com/engagement?content_type=messaging,messaging_prefs&browser_version=126.0.25496.127 (with some more tracking parameters added). Yes, there is a lot of info here, so let me pick out one entry and explain it:\n\nThe engagement_trigger_all entry lists conditions that have all be true: you have to be on the New Tab page, and your search provider has to be Google. The engagement_trigger_any entry lists conditions where any one is sufficient: this particular rule should not have been triggered before, or it should have been triggered more than 2592000 seconds (30 days) ago. Finally, engagement_trigger_none lists conditions that should prevent this rule from applying. And if these conditions are met, the Messaging extension will inject a frame into the current tab to nag you about switching from Google to Bing:\n\nAnother rule will nag you every 30 days about enabling the Coupons extension, also a cash cow for Avast. There will be a nag to buy the PRO version for users opening a Private Browsing window. And there is more, depending on the parameters sent when downloading these rules probably much more.\n\nAn interesting aspect here is that these rules donât need to limit themselves to information provided to them. They can also call any function of private Avast APIs under the chrome.avast, chrome.avast.licensing and chrome.avast.onboarding namespaces. Some API functions which seem to be called in this way are pretty basic like isPrivateWindow() or isConnectedToUnsafeWifi(), while gatherInfo() for example will produce a whole lot of information on bookmarks, other browsers and Windows shortcuts.\n\nAlso, displaying the message in a frame is only one possible âplacementâ here. The Messaging extension currently provides eight different user interface choices, including straight out redirecting the current page to an address provided in the rule. But donât worry: Avast is unlikely to start redirecting your Google searches to Bing, this would raise too many suspicions.\n\nSuper-powered websites\n\nWhy is the Messaging extension allowing some Avast server to run browser APIs merely a side-note in my article? Thing is: this extension doesnât really give this server anything that it couldnât do all by itself. When it comes to Avast Secure Browser, Avast websites have massive privileges out of the box.\n\nThe browser grants these privileges to any web page under the avast.com, avg.com, avastbrowser.com, avgbrowser.com, ccleanerbrowser.com and securebrowser.com domains. At least here HTTPS connections are enforced, so that posing as an Avast website wonât be possible. But these websites automatically get access to:\n\nchrome.bookmarks API: full read/write access to bookmarks\n\nchrome.management API: complete access to extensions except for the ability to install them\n\nchrome.webstorePrivate API: a private browser API that allows installing extensions.\n\nA selection of private Avast APIs:\n\nchrome.avast\n\nchrome.avast.licensing\n\nchrome.avast.ntp\n\nchrome.avast.onboarding\n\nchrome.avast.ribbon\n\nchrome.avast.safebrowsing\n\nchrome.avast.safesearch\n\nchrome.avast.stats\n\nchrome.avast.themes\n\nNow figuring out what all these private Avast APIs do in detail, what their abuse potential is and whether any of their crashes are exploitable requires more time than I had to spend on this project. I can see that chrome.avast.ntp API allows manipulating the tiles displayed on the new tab page in arbitrary ways, including reverting all your changes so that you only see those sponsored links. chrome.avast.onboarding API seems to allow manipulating the âengagementâ data mentioned above, so that arbitrary content will be injected into tabs matching any given criteria. Various UI elements can be triggered at will. Iâll leave figuring out what else these can do to the readers. If you do this, please let me know whether chrome.avast.browserCall() can merely be used to communicate with Avastâs Security & Privacy Center or exposes Chromiumâs internal messaging.\n\nBut wait, this is Avast we are talking about! We all know that Avast is trustworthy. After all, they promised to the Federal Trade Commission that they wonât do anything bad any more. And as I said above, impersonating an Avast server wonât be possible thanks to HTTPS being enforced. Case closed, no issue here?\n\nNot quite, there are far more parties involved here. Looking only at www.avast.com, there is for example OneTrust who are responsible for the cookie banners. Google, Adobe, hotjar, qualtrics and mpulse are doing analytics (a.k.a. user tracking). A Trustpilot widget is also present. There is some number of web hosting providers involved (definitely Amazon, likely others as well) and at least two content delivery networks (Akamai and Cloudflare).\n\nAnd thatâs only one host. Looking further, there is a number of different websites hosted under these domains. Some are used in production, others are experiments, yet more appear to be abandoned in various states of brokenness. Some of these web services seem to be run by Avast while others are clearly run by third parties. There is for some reason a broken web shop run by a German e-commerce company, same that used to power Aviraâs web shop before Gen Digital bought them.\n\nIf one were to count it all together, I would expect that a high two digit number of companies can put content on the domains mentioned above. I wouldnât be surprised however if that number even went into three digits. Every single one of these companies can potentially abuse internal APIs of the Avast Secure Browser, either because they decide to make some quick buck, are coerced into cooperation by their government or their networks simply get compromised.\n\nAnd not just that. It isnât necessary to permanently compromise one of these web services. A simple and very common Cross-Site Scripting vulnerability in any one of these web services would grant any website on the internet access to these APIs. Did Avast verify the security and integrity of each third-party service they decided to put under these domains? I very much doubt so.\n\nIt would appear that the official reason for providing these privileges to so many websites was aiding the onboarding experience mentioned above. Now one might wonder whether such a flexible and extensive onboarding process is really necessary. But regardless of that, the reasonable way of doing this is limiting the attack surface. If you need to grant privileges to web pages, you grant them to a single host name. You make sure that this single host name doesnât run any more web services than it absolutely needs, and that these web services get a proper security review. And you add as many protection layers as possible, e.g. the Content-Security-Policy mechanism which is severely underused on Avast websites.\n\nIâll conclude by quoting the decision to penalize Avast for their GDPR violations:\n\nAt this point, the Appellate Authority considers it necessary to recall that the Charged Company provides software designed to protect the privacy of its users. As a professional in the information and cyber field, the Charged Company is thereby also expected to be extremely knowledgeable in the field of data protection.\n\nYeah, wellâ¦"
    }
}