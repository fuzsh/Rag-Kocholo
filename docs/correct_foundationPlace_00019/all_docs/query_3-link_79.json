{
    "id": "correct_foundationPlace_00019_3",
    "rank": 79,
    "data": {
        "url": "https://www.sentinelone.com/labs/vulnerabilities-in-avast-and-avg-put-millions-at-risk/",
        "read_more_link": "",
        "language": "en",
        "title": "Vulnerabilities in Avast And AVG Put Millions At Risk",
        "top_image": "https://www.sentinelone.com/wp-content/uploads/2022/05/Vulnerabilities-in-Avast-And-AVG-Put-Millions-At-Risk-1.jpg",
        "meta_img": "https://www.sentinelone.com/wp-content/uploads/2022/05/Vulnerabilities-in-Avast-And-AVG-Put-Millions-At-Risk-1.jpg",
        "images": [
            "https://www.sentinelone.com/wp-content/themes/sentinelone/carbine/assets/svg/search-icon-white.svg",
            "https://www.sentinelone.com/wp-content/themes/sentinelone/carbine/assets/svg/search-icon-white.svg",
            "https://www.sentinelone.com/wp-content/themes/sentinelone/carbine/assets/svg/navigation-close.svg",
            "https://www.sentinelone.com/wp-content/themes/sentinelone/carbine/assets/img/SentinelLabs_Logo_RGB_WhitePurp.png",
            "https://www.sentinelone.com/wp-content/uploads/2022/05/10-Year-Old-Vulnerabilities-in-Avast-And-AVG-Antiviruses-Put-Millions-Of-Users-At-Risk-6.jpg",
            "https://www.sentinelone.com/wp-content/uploads/2022/05/Avast-CVE-2022-26522.jpg",
            "https://www.sentinelone.com/wp-content/uploads/2022/05/S1-Diagram_Dark-1.png",
            "https://www.sentinelone.com/wp-content/uploads/2022/05/Avast-Windows-alert.jpg",
            "https://www.sentinelone.com/wp-content/uploads/2022/05/Avast-send-fetch.jpg",
            "https://secure.gravatar.com/avatar/19d9eb324004c3826ef29330de0eb38e?s=120&d=mm&r=g",
            "https://www.sentinelone.com/wp-content/uploads/2023/11/Decoding-the-Past-Securing-the-Future-Enhancing-Cyber-Defense-with-Historical-Threat-Intelligence-13-300x157.jpg",
            "https://www.sentinelone.com/wp-content/uploads/2023/11/Predator-AI-ChatGPT-Powered-Infostealer-Takes-Aim-at-Cloud-Platforms-3-300x157.jpg",
            "https://www.sentinelone.com/wp-content/uploads/2023/10/11-Ways-to-Tweak-radare2-for-Faster-and-Easier-macOS-Malware-Analysis-3-300x157.jpg",
            "https://www.sentinelone.com/wp-content/uploads/2024/07/FIN7_AvNeuralizer_ftr-150x150.jpg",
            "https://www.sentinelone.com/wp-content/uploads/2024/07/NullBulge-Ransomware-Threat-Actor-Masquerades-as-Hacktivist-Group-Rebelling-Against-AI2-150x150.jpg",
            "https://www.sentinelone.com/wp-content/uploads/2024/06/Capra-Remix-v2-ftr-150x150.jpg",
            "https://www.sentinelone.com/wp-content/uploads/2024/07/FIN7_AvNeuralizer_ftr-150x150.jpg",
            "https://www.sentinelone.com/wp-content/uploads/2024/07/NullBulge-Ransomware-Threat-Actor-Masquerades-as-Hacktivist-Group-Rebelling-Against-AI2-150x150.jpg",
            "https://www.sentinelone.com/wp-content/uploads/2024/06/Capra-Remix-v2-ftr-150x150.jpg",
            "https://px.ads.linkedin.com/collect/?pid=2225260&fmt=gif"
        ],
        "movies": [],
        "keywords": [],
        "meta_keywords": [
            ""
        ],
        "tags": null,
        "authors": [
            "Kasif Dekel",
            "studying operating systems"
        ],
        "publish_date": "2022-05-05T11:00:56+00:00",
        "summary": "",
        "meta_description": "Two high-severity flaws in popular end user security tools allow attackers to elevate privileges and compromise devices.",
        "meta_lang": "en",
        "meta_favicon": "/wp-content/themes/sentinelone/assets/favicon-whyte/apple-touch-icon.png",
        "meta_site_name": "SentinelOne",
        "canonical_link": "https://www.sentinelone.com/labs/vulnerabilities-in-avast-and-avg-put-millions-at-risk/",
        "text": "Executive Summary\n\nSentinelLabs has discovered two high severity flaws in Avast and AVG (acquired by Avast in 2016) that went undiscovered for years affecting dozens of millions of users.\n\nThese vulnerabilities allow attackers to escalate privileges enabling them to disable security products, overwrite system components, corrupt the operating system, or perform malicious operations unimpeded.\n\nSentinelLabs’ findings were proactively reported to Avast during December 2021 and the vulnerabilities are tracked as CVE-2022-26522 and CVE-2022-26523.\n\nAvast has silently released security updates to address these vulnerabilities.\n\nAt this time, SentinelLabs has not discovered evidence of in-the-wild abuse.\n\nIntroduction\n\nAvast’s “Anti Rootkit” driver (also used by AVG) has been found to be vulnerable to two high severity attacks that could potentially lead to privilege escalation by running code in the kernel from a non-administrator user. Avast and AVG are widely deployed products, and these flaws have potentially left many users worldwide vulnerable to cyber attacks.\n\nGiven that these products run as privileged services on Windows devices, such bugs in the very software that is intended to protect users from harm present both an opportunity to attackers and a grave threat to users.\n\nSecurity products such as these run at the highest level of privileges and are consequently highly attractive to attackers, who often use such vulnerabilities to carry out sophisticated attacks. Vulnerabilities such as this and others discovered by SentinelLabs (1, 2, 3) present a risk to organizations and users deploying the affected software.\n\nAs we reported recently, threat actors will exploit such flaws given the opportunity, and it is vital that affected users take appropriate mitigation actions. According to Avast, the vulnerable feature was introduced in Avast 12.1. Given the longevity of this flaw, we estimate that millions of users were likely exposed.\n\nSecurity products ensure device security and are supposed to prevent such attacks from happening, but what if the security product itself introduces a vulnerability? Who’s protecting the protectors?\n\nCVE-2022-26522\n\nThe vulnerable routine resides in a socket connection handler in the kernel driver aswArPot.sys. Since the two reported vulnerabilities are very similar, we will primarily focus on the details of CVE-2022-26522.\n\nCVE-2022-26522 refers to a vulnerability that resides in aswArPot+0xc4a3.\n\nAs can be seen in the image above, the function first attaches the current thread to the target process, and then uses nt!PsGetProcessPeb to obtain a pointer to the current process PEB (red arrow). It then fetches (first time) PPEB->ProcessParameters->CommandLine.Length to allocate a new buffer (yellow arrow). It then copies the user supplied buffer at PPEB->ProcessParameters->CommandLine.Buffer with the size of PPEB->ProcessParameters->CommandLine.Length (orange arrow), which is the first fetch.\n\nDuring this window of opportunity, an attacker could race the kernel thread and modify the Length variable.\n\nLooper thread:\n\nPTEB tebPtr = reinterpret_cast(__readgsqword(reinterpret_cast(&static_cast<NT_TIB*>(nullptr)->Self))); PPEB pebPtr = tebPtr->ProcessEnvironmentBlock; pebPtr->ProcessParameters->CommandLine.Length = 2; while (1) { pebPtr->ProcessParameters->CommandLine.Length ^= 20000; }\n\nAs can be seen from the code snippet above, the code obtains a pointer to the PEB structure and then flips the Length field in the process command line structure.\n\nThe vulnerability can be triggered inside the driver by initiating a socket connection as shown by the following code.\n\nprintf(\"\\nInitialising Winsock...\"); if (WSAStartup(MAKEWORD(2, 2), &wsa) != 0) { printf(\"Failed. Error Code : %d\", WSAGetLastError()); return 1; } printf(\"Initialised.\\n\"); if ((s = socket(AF_INET, SOCK_STREAM, 0)) == INVALID_SOCKET) { printf(\"Could not create socket : %d\", WSAGetLastError()); } printf(\"Socket created.\\n\"); server.sin_addr.s_addr = inet_addr(IP_ADDRESS); server.sin_family = AF_INET; server.sin_port = htons(80); if (connect(s, (struct sockaddr*)&server, sizeof(server)) < 0) { puts(\"connect error\"); return 1; } puts(\"Connected\"); message = (char *)\"GET / HTTP/1.1\\r\\n\\r\\n\"; if (send(s, message, strlen(message), 0) < 0) { puts(\"Send failed\"); return 1; } puts(\"Data Sent!\\n\");\n\nSo the whole flow looks like this:\n\nOnce the vulnerability is triggered, the user sees the following alert from the OS.\n\nCVE-2022-26523\n\nThe second vulnerable function is at aswArPot+0xbb94 and is very similar to the first vulnerability. This function double fetches the Length field from a user controlled pointer, too.\n\nThis vulnerable code is a part of several handlers in the driver and, therefore, can be triggered multiple ways such as via image load callback.\n\nBoth of these vulnerabilities were fixed in version 22.1.\n\nImpact\n\nDue to the nature of these vulnerabilities, they can be triggered from sandboxes and might be exploitable in contexts other than just local privilege escalation. For example, the vulnerabilities could be exploited as part of a second stage browser attack or to perform a sandbox escape, among other possibilities.\n\nAs we have noted with similar flaws in other products recently (1, 2, 3), such vulnerabilities have the potential to allow complete take over of a device, even without privileges, due to the ability to execute code in kernel mode. Among the obvious abuses of such vulnerabilities are that they could be used to bypass security products.\n\nMitigation\n\nThe majority of Avast and AVG users will receive the patch (version 22.1) automatically; however, those using air gapped or on premise installations are advised to apply the patch as soon as possible.\n\nConclusion\n\nThese high severity vulnerabilities, affect millions of users worldwide. As with another vulnerability SentinelLabs disclosed that remained hidden for 12 years, the impact this could have on users and enterprises that fail to patch is far reaching and significant.\n\nWhile we haven’t seen any indicators that these vulnerabilities have been exploited in the wild up till now, with dozens of millions of users affected, it is possible that attackers will seek out those that do not take the appropriate action. Our reason for publishing this research is to not only help our customers but also the community to understand the risk and to take action.\n\nAs part of the commitment of SentinelLabs to advancing industry security, we actively invest in vulnerability research, including advanced threat modeling and vulnerability testing of various platforms and technologies.\n\nWe would like to thank Avast for their approach to our disclosure and for quickly remediating the vulnerabilities.\n\nDisclosure Timeline"
    }
}