{
    "id": "dbpedia_3934_3",
    "rank": 36,
    "data": {
        "url": "https://lists.openembedded.org/g/openembedded-core/message/35029",
        "read_more_link": "",
        "language": "en",
        "title": "1] qmmp: update to 0.6.6 and fix",
        "top_image": "https://lists.openembedded.org/g/openembedded-core/coverphoto",
        "meta_img": "https://lists.openembedded.org/g/openembedded-core/coverphoto",
        "images": [
            "https://lists.openembedded.org/img/org.105/mainlogo.png"
        ],
        "movies": [],
        "keywords": [],
        "meta_keywords": [
            ""
        ],
        "tags": null,
        "authors": [],
        "publish_date": null,
        "summary": "",
        "meta_description": "",
        "meta_lang": "en",
        "meta_favicon": "/img/org.105/favicons/apple-icon-57x57.png",
        "meta_site_name": "",
        "canonical_link": "https://lists.openembedded.org/g/openembedded-core/topic/patch_1_1_qmmp_update_to/72198485",
        "text": "* Update to 0.6.6\n\n* Fix compilation failure due to call to QApplication::commitData()\n\n* Disable /usr/local host paths to avoid compilation warnings\n\n* Force use of the cmake configure instead of qmake as the latter is not\n\ndynamic with Qmmp and doesn't let you disable certain dependencies\n\n(e.g. enca)\n\n* Add libsndfile1 and libsamplerate0 to DEPENDS since their use will be\n\nnon-deterministic otherwise\n\n* Explicitly disable library-requiring options that we don't have\n\navailable in OE-Core so that they don't get used if they happen to be\n\nin the sysroot\n\n* Update LIC_FILES_CHKSUM since there were cosmetic changes to the\n\nlicense file (mostly reformatting and change of references to LGPL\n\nfrom \"Library\" to \"Lesser\".)\n\nFixes [YOCTO #3882].\n\nSigned-off-by: Paul Eggleton <paul.eggleton@...>\n\n---\n\nmeta/recipes-qt/qt-apps/qmmp/no-host-paths.patch | 25 +++++++++++++\n\n.../qt-apps/qmmp/no-sessionmanager.patch | 21 +++++++++++\n\n.../qt-apps/{qmmp_0.6.1.bb => qmmp_0.6.6.bb} | 39 ++++++++++++++++----\n\n3 files changed, 77 insertions(+), 8 deletions(-)\n\ncreate mode 100644 meta/recipes-qt/qt-apps/qmmp/no-host-paths.patch\n\ncreate mode 100644 meta/recipes-qt/qt-apps/qmmp/no-sessionmanager.patch\n\nrename meta/recipes-qt/qt-apps/{qmmp_0.6.1.bb => qmmp_0.6.6.bb} (56%)\n\ndiff --git a/meta/recipes-qt/qt-apps/qmmp/no-host-paths.patch b/meta/recipes-qt/qt-apps/qmmp/no-host-paths.patch\n\nnew file mode 100644\n\nindex 0000000..de17b4e\n\n--- /dev/null\n\n+++ b/meta/recipes-qt/qt-apps/qmmp/no-host-paths.patch\n\n@@ -0,0 +1,25 @@\n\n+Do not include /usr/include host paths\n\n+\n\n+These were added upstream apparently for freebsd support, but trigger\n\n+compiler warnings during the build and could be dangerous, so remove\n\n+them.\n\n+\n\n+Upstream-Status: Inappropriate [cross]\n\n+\n\n+Signed-off-by: Paul Eggleton <paul.eggleton@...>\n\n+\n\n+--- a/CMakeLists.txt\n\n++++ b/CMakeLists.txt\n\n+@@ -1,12 +1,5 @@\n\n+ cmake_minimum_required(VERSION 2.6.0)\n\n+\n\n+-#freebsd support\n\n+-include_directories(SYSTEM /usr/local/include)\n\n+-link_directories(/usr/local/lib)\n\n+-link_directories(/usr/local/lib32)\n\n+-link_directories(/usr/local/lib64)\n\n+-SET(CMAKE_REQUIRED_INCLUDES ${CMAKE_REQUIRED_INCLUDES} /usr/local/include)\n\n+-\n\n+ #extract version from qmmp.h\n\n+ FILE(STRINGS \"${CMAKE_CURRENT_SOURCE_DIR}/src/qmmp/qmmp.h\"\n\n+ QMMP_VERSION_DATA REGEX \"^#define[ \\t]+QMMP_VERSION_[A-Z]+[ \\t]+[0-9]+.*$\")\n\ndiff --git a/meta/recipes-qt/qt-apps/qmmp/no-sessionmanager.patch b/meta/recipes-qt/qt-apps/qmmp/no-sessionmanager.patch\n\nnew file mode 100644\n\nindex 0000000..5e2978b\n\n--- /dev/null\n\n+++ b/meta/recipes-qt/qt-apps/qmmp/no-sessionmanager.patch\n\n@@ -0,0 +1,21 @@\n\n+Don't call session manager function if not enabled\n\n+\n\n+If session management has been disabled we will get a compilation\n\n+failure if we try to call QApplication::commitData() so don't do so if\n\n+it is disabled.\n\n+\n\n+Upstream-Status: Pending\n\n+\n\n+Signed-off-by: Paul Eggleton <paul.eggleton@...>\n\n+\n\n+--- a/src/app/qmmpapplication.cpp\n\n++++ b/src/app/qmmpapplication.cpp\n\n+@@ -29,6 +29,8 @@ void QmmpApplication::commitData(QSessionManager &manager)\n\n+ {\n\n+ if(UiHelper::instance())\n\n+ UiHelper::instance()->exit();\n\n++#ifndef QT_NO_SESSIONMANAGER\n\n+ else\n\n+ QApplication::commitData(manager);\n\n++#endif\n\n+ }\n\ndiff --git a/meta/recipes-qt/qt-apps/qmmp_0.6.1.bb b/meta/recipes-qt/qt-apps/qmmp_0.6.6.bb\n\nsimilarity index 56%\n\nrename from meta/recipes-qt/qt-apps/qmmp_0.6.1.bb\n\nrename to meta/recipes-qt/qt-apps/qmmp_0.6.6.bb\n\nindex ed096e9..2f5e0d5 100644\n\n--- a/meta/recipes-qt/qt-apps/qmmp_0.6.1.bb\n\n+++ b/meta/recipes-qt/qt-apps/qmmp_0.6.6.bb\n\n@@ -2,20 +2,37 @@ DESCRIPTION = \"Qmmp (Qt-based Multimedia Player) is an audio-player, written wit\n\nHOMEPAGE = \"http://qmmp.ylsoftware.com\"\n\nLICENSE = \"GPLv2\"\n\nLICENSE_FLAGS = \"commercial\"\n\n-LIC_FILES_CHKSUM = \"file://COPYING;md5=393a5ca445f6965873eca0259a17f833\"\n\n+LIC_FILES_CHKSUM = \"file://COPYING;md5=b234ee4d69f5fce4486a80fdaf4a4263\"\n\nSECTION = \"multimedia\"\n\n-PR = \"r1\"\n\n+DEPENDS = \"taglib libmad libvorbis libogg alsa-lib libsndfile1 libsamplerate0 curl\"\n\n-DEPENDS = \"taglib libmad libvorbis libogg alsa-lib\"\n\n+SRC_URI = \"http://qmmp.ylsoftware.com/files/${BPN}-${PV}.tar.bz2 \\\n\n+ file://no-host-paths.patch \\\n\n+ file://no-sessionmanager.patch\"\n\n-SRC_URI = \"http://qmmp.ylsoftware.com/files/${BPN}-${PV}.tar.bz2\"\n\n-\n\n-SRC_URI[md5sum] = \"23a1a3aa924da901ebc8327ea76135d4\"\n\n-SRC_URI[sha256sum] = \"b48be8c0e3882088919a77ce7b619cfc99d32af29cc688ba8749a58cbb25fb6f\"\n\n+SRC_URI[md5sum] = \"0131a9bf7b98737c1a6fd6e1a897e2b2\"\n\n+SRC_URI[sha256sum] = \"dfa973cca80c020a85a11bb66701a3804f9fde326440abb179559c98bf3b5b99\"\n\ninherit cmake qt4x11\n\n+QMMP_PLUGIN_OPTIONS ??= \"\\\n\n+ -DUSE_MMS:BOOL=FALSE \\\n\n+ -DUSE_MPC:BOOL=FALSE \\\n\n+ -DUSE_MODPLUG:BOOL=FALSE \\\n\n+ -DUSE_WAVPACK:BOOL=FALSE \\\n\n+ -DUSE_FFMPEG:BOOL=FALSE \\\n\n+ -DUSE_AAC:BOOL=FALSE \\\n\n+ -DUSE_CDA:BOOL=FALSE \\\n\n+ -DUSE_MIDI:BOOL=FALSE \\\n\n+ -DUSE_GME:BOOL=FALSE \\\n\n+ -DUSE_OSS4:BOOL=FALSE \\\n\n+ -DUSE_JACK:BOOL=FALSE \\\n\n+ -DUSE_BS2B:BOOL=FALSE \\\n\n+ -DUSE_PROJECTM:BOOL=FALSE \\\n\n+ -DUSE_ENCA:BOOL=FALSE \\\n\n+ \"\n\n+\n\nexport EXTRA_OECMAKE = \"-DQT_QMAKE_EXECUTABLE=${OE_QMAKE_QMAKE} \\\n\n-DQT_LRELEASE_EXECUTABLE=${OE_QMAKE_LRELEASE} \\\n\n-DQT_MOC_EXECUTABLE=${OE_QMAKE_MOC} \\\n\n@@ -24,9 +41,15 @@ export EXTRA_OECMAKE = \"-DQT_QMAKE_EXECUTABLE=${OE_QMAKE_QMAKE} \\\n\n-DQT_LIBRARY_DIR=${OE_QMAKE_LIBDIR_QT} \\\n\n-DQT_HEADERS_DIR=${OE_QMAKE_INCDIR_QT} \\\n\n-DQT_QTCORE_INCLUDE_DIR=${OE_QMAKE_INCDIR_QT}/QtCore \\\n\n+ ${QMMP_PLUGIN_OPTIONS} \\\n\n\"\n\n-PACKAGES_DYNAMIC += \"^qmmp-plugin-.* \"\n\n+do_configure() {\n\n+ # Ensure we get the cmake configure and not qmake\n\n+ cmake_do_configure\n\n+}\n\n+\n\n+PACKAGES_DYNAMIC += \"^qmmp-plugin-.* \"\n\npython populate_packages_prepend () {\n\nqmmp_libdir = d.expand('${libdir}/qmmp')\n\n--\n\n1.7.10.4"
    }
}