{
    "id": "dbpedia_745_0",
    "rank": 63,
    "data": {
        "url": "https://genomebiology.biomedcentral.com/articles/10.1186/s13059-023-03034-4",
        "read_more_link": "",
        "language": "en",
        "title": "GTM-decon: guided-topic modeling of single-cell transcriptomes enables sub-cell-type and disease-subtype deconvolution of bulk transcriptomes",
        "top_image": "https://static-content.springer.com/image/art%3A10.1186%2Fs13059-023-03034-4/MediaObjects/13059_2023_3034_Fig1_HTML.png",
        "meta_img": "https://static-content.springer.com/image/art%3A10.1186%2Fs13059-023-03034-4/MediaObjects/13059_2023_3034_Fig1_HTML.png",
        "images": [
            "https://pubads.g.doubleclick.net/gampad/ad?iu=/270604982/bmc/genomebiology/articles&sz=728x90,970x90&pos=LB1&doi=10.1186/s13059-023-03034-4&type=article&kwrd=Cell-type deconvolution,Single-cell transcriptome,Topic models,Variational inference,Bayesian modeling,Type 2 diabetes,Cancer transcriptome,Disease biomarkers&pmc=L32030,B12008,L32020,L32010,L15001,L21001&",
            "https://genomebiology.biomedcentral.com/static/images/bmc/logos/logo-bmc-white-flagship-6c54473310.svg",
            "https://genomebiology.biomedcentral.com/static/images/bmc/logos/logo-bmc-white-strapline-sn-f224388d67.svg",
            "https://genomebiology.biomedcentral.com/static/images/bmc/logos/genome-biology-logo-cf72c0ec54.svg",
            "https://media.springernature.com/lw685/springer-static/image/art%3A10.1186%2Fs13059-023-03034-4/MediaObjects/13059_2023_3034_Fig1_HTML.png",
            "https://media.springernature.com/lw685/springer-static/image/art%3A10.1186%2Fs13059-023-03034-4/MediaObjects/13059_2023_3034_Fig2_HTML.png",
            "https://media.springernature.com/lw685/springer-static/image/art%3A10.1186%2Fs13059-023-03034-4/MediaObjects/13059_2023_3034_Fig3_HTML.png",
            "https://media.springernature.com/lw685/springer-static/image/art%3A10.1186%2Fs13059-023-03034-4/MediaObjects/13059_2023_3034_Fig4_HTML.png",
            "https://media.springernature.com/lw685/springer-static/image/art%3A10.1186%2Fs13059-023-03034-4/MediaObjects/13059_2023_3034_Fig5_HTML.png",
            "https://media.springernature.com/lw685/springer-static/image/art%3A10.1186%2Fs13059-023-03034-4/MediaObjects/13059_2023_3034_Fig6_HTML.png",
            "https://pubads.g.doubleclick.net/gampad/ad?iu=/270604982/bmc/genomebiology/articles&sz=300x250&pos=MPU1&doi=10.1186/s13059-023-03034-4&type=article&kwrd=Cell-type deconvolution,Single-cell transcriptome,Topic models,Variational inference,Bayesian modeling,Type 2 diabetes,Cancer transcriptome,Disease biomarkers&pmc=L32030,B12008,L32020,L32010,L15001,L21001&",
            "https://genomebiology.biomedcentral.com/track/article/10.1186/s13059-023-03034-4",
            "https://genomebiology.biomedcentral.com/static/images/logo-springernature-acb40b85fb.svg"
        ],
        "movies": [],
        "keywords": [],
        "meta_keywords": [
            ""
        ],
        "tags": null,
        "authors": [
            "Lakshmipuram Seshadri"
        ],
        "publish_date": "2023-08-18T00:00:00",
        "summary": "",
        "meta_description": "Cell-type composition is an important indicator of health. We present Guided Topic Model for deconvolution (GTM-decon) to automatically infer cell-type-specific gene topic distributions from single-cell RNA-seq data for deconvolving bulk transcriptomes. GTM-decon performs competitively on deconvolving simulated and real bulk data compared with the state-of-the-art methods. Moreover, as demonstrated in deconvolving disease transcriptomes, GTM-decon can infer multiple cell-type-specific gene topic distributions per cell type, which captures sub-cell-type variations. GTM-decon can also use phenotype labels from single-cell or bulk data to infer phenotype-specific gene distributions. In a nested-guided design, GTM-decon identified cell-type-specific differentially expressed genes from bulk breast cancer transcriptomes.",
        "meta_lang": "en",
        "meta_favicon": "/static/img/favicons/bmc/apple-touch-icon-582ef1d0f5.png",
        "meta_site_name": "BioMed Central",
        "canonical_link": "https://genomebiology.biomedcentral.com/articles/10.1186/s13059-023-03034-4",
        "text": "GTM-decon model overview\n\nIn GTM-decon, we have made three methodological contributions. As our first and the main contribution, GTM-decon is a marker-free method and automatically infers the contribution of each gene for each cell type in the form of CTS categorical distributions, which we define as “topics” [25], without using marker gene information. Each CTS topic distribution is related to the transcriptional rate of each gene for each cell type. For instance, B cells have higher transcription rate for CD19 compared to alpha cells, which have relatively high rate for FXYD5. Conceptually, we consider genes as vocabulary and cells as documents whose word tokens (i.e., scRNA-seq reads) are sampled from the vocabulary with the CTS topic probabilities. We incorporate the observed cell-type labels for each cell in the form of topic prior to guide the inference of CTS topic mixture, which reflects the uncertainty of the noisy cell-type label. Specifically, the cell-type mixture for cell \\(m\\) follows a K-dimensional asymmetric Dirichlet distribution, \\({{\\varvec{\\uptheta}}}_{m}\\sim Dir\\left({{\\varvec{\\upalpha}}}_{m}+0.1\\right)\\), with the hyperparameter \\({\\alpha }_{m,k}\\) set to a relatively high value (i.e., 0.9 by default) given the cell-type label \\({y}_{m}=k\\); the rest of the K-1 \\({\\mathrm{\\alpha }}_{m,{\\mathrm{k}}{\\prime}}\\) values, where \\({y}_{m}\\ne {k}{\\prime}\\), are set to a relatively low values (i.e., randomly sampled from a range between 0.1 and 0.01). As a result, each topic is automatically identified with exactly one cell type. This differs from the standard topic model, where topics are not directly associated with any known concept and require post hoc manual inspection based on their top scoring words to interpret them. Given the CTS gene distributions, we can infer the CTS topic mixtures from the bulk transcriptomes, which are the desired cell-type mixing proportion in the context of deconvolution (Fig. 1a).\n\nAs our second contribution, we extend GTM-decon to infer multiple topics per cell type. The rationale is that cells of the same cell type can manifest in different cell states due to the changes of environments or stimuli. As a result, these cells may exhibit expression patterns that are different from the canonical CTS expression pattern. While there are sophisticated hierarchical topic models involving Dirichlet Processes [26], we took a simple and elegant design. Specifically, we extend the basic GTM-decon model to infer sub-cell-type topics by dedicating multiple topics per cell type (Additional file 1: Fig. S1). As our third contribution, we extend GTM-decon to infer phenotype-specific (PTS) topic distributions using the phenotype label (e.g., cancer subtypes or cancer stages) available in the single-cell or bulk transcriptome data as a guide to detect PTS gene expression (Fig. 1b). We then further extend it to a nested-guided topic model to conduct CTS differential expression analysis in the single-cell or bulk patient cohort data (Fig. 1c). To that end, we use the phenotype labels as the level-1 guide and the cell-type labels as the level 2 guide. Through the same guided topic mechanism, GTM-decon updates the CTS topic distributions under each phenotype by fitting the data likelihood of the transcriptomes from either the single-cell or bulk data. The algorithmic details for the 3 contributions were described in “Methods.”\n\nExperimentation of data preprocessing and GTM-decon model configurations\n\nWe experimented gene selection, data normalization, hyperparameter settings, and number of topics per cell type. We find that GTM-decon works the best with raw read count data using all genes (Additional file 1: Figs. S2 and S3), and it is fairly robust to different hyperparameter values for the topic mixture prior (Figs. S4-S6) and the CTS topic prior values (Fig. S7). In general, GTM-decon confers better deconvolution performance using multiple topics per cell type than the baseline GTM-decon with one topic per cell type (Fig. S8). Please refer to Additional file 1 Section S1-S5 for more details.\n\nEvaluation of deconvolution of simulated bulk from scRNA-seq data\n\nTo quantitatively benchmark GTM-decon, we compared it against five existing deconvolution methods, namely Bisque [21], Bseq-sc [17], CIBERSORTx [18], MuSiC [19], and BayesPrism [22] on artificially simulated bulk RNA-seq datasets from the scRNA-seq data (Additional file 1: Table S1). To simulate bulk data, three human scRNA-seq datasets (Pancreas—E-MTAB-5061, Breast Tissue with GEO accession number GSE113197, and Rheumatoid Arthritis (RA) Synovium—SDY998), generated using different technologies (Smart-seq2, 10 × Genomics Chromium, CEL-Seq2) were used. The artificial bulk data for each individual was constructed by summing up the counts for each gene from all cells in that individual [19]. This allowed us to use the cell-type proportions from the single-cell data as the ground-truth proportions. Artificially constructed bulk data from scRNA-seq data appear to be a good surrogate of the real bulk data, as observed from the excellent correlation of the log-transformed artificial counts with the log-transformed counts from real bulk data for each gene (Additional file 1: Fig. S9). We performed leave-one-out cross-validation (LOOCV), to avoid any leakage from training data, and used the single-cell RNA-seq of the left-out individual to simulate the bulk RNA-seq (i.e., the total read counts of each gene for that sample) as the validation data and its cell-type proportions as the ground-truth mixing proportions. GTM-decon performs better than other models on the Pancreas and Breast Tissue datasets in terms of both Spearman Rank-based correlation (Spearman R) and Cross Entropy and conferred comparable performance on the RA Synovium dataset (Additional file 1: Fig. S10). Notably, GTM-decon achieves smaller variance for both the pancreatic and breast tissue datasets. We further ascertained the qualities of the predicted cell-type proportions of each method against the ground-truth cell-type proportions (Fig. S10a) and observed that GTM-decon recapitulates cell-type proportions well for pancreatic (Fig. S10b), breast tissues (Fig. S10c), and RA synovium dataset (Fig. S10d).\n\nEvaluation of deconvolution of real bulk with ground-truth cell-type proportions\n\nWe also benchmarked GTM-decon on 5 real bulk RNA-seq data with known ground-truth cell-type proportions from 3 different tissue types (Additional file 1: Table S1 and S2; “Methods”). We evaluated deconvolution performance using Spearman R and Root Mean Square Error (RMSE), by comparing the inferred proportions for the matching cell types against the ground-truth proportions for each sample. GTM-decon conferred on-par or superior performance compared to the existing methods for all the datasets (Fig. 2a left). In particular, GTM-ALL performed the best for deconvolving PBMC-1 and PBMC-2. For deconvolving whole blood (WB), GTM-HVG performed the best in terms of both metrics and MuSiC is a close second. While deconvolving bulk RNA-seq from the prefrontal brain region from ROSMAP dataset, all methods except Bseq-sc and GTM-HVG performed reasonably well. It is possible that the HVG are the genes having high variance within the cell types, which caused the poor performance of GTM-HVG on this dataset. For the pancreatic dataset with the paired single-cell and bulk RNA-seq data collected from the same individuals, GTM-HVG performs the best with GTM-PP as the runner-up in terms of Spearman R, and RMSE are similar among all methods except MuSiC with notably higher error. In summary, GTM-ALL performed the best in 3 datasets; GTM-HVG performed the best in the other two datasets, where the CTS gene expression might exhibit more distinct inter-cell-type variability. Furthermore, we also evaluated the deconvolution performance for separate cell types in terms of the correlation between ground-truth proportions and predicted proportions for each cell type across samples. Overall, GTM-decon conferred competitive performance with the runner-up method being BayesPrism (Fig. 2a right and b; Additional File 1: Figs. S11-S15). Therefore, the results suggest the general effectiveness of topic modeling in cell-type deconvolution and the additional benefits conferred by GTM-decon due to its algorithmic innovations.\n\nAdditionally, we evaluated the deconvolution accuracy for purified bulk RNA-seq data of immune cells (GEO accession numbers: GSE107011 and GSE64655; Table S2) using two different independent references (HBC and PBMC2; Table S1). Overlapping cell types were used to evaluate the performance on the purified bulk samples, whereby the highest deconvolution proportion was used as the predicted cell-type label for computing the prediction accuracy. GTM-HVG achieved the highest accuracy across all four experiments (Fig. 2c). Moreover, since some cell types present in the bulk are missing in the scRNA-seq reference, a robust model should either find the closest-matched cell types or properly express statistical uncertainty in this situation. To this end, we examined the inferred cell proportions of the purified bulk for those missing cell types. Plasmablast samples are present among the purified PBMC samples (GSE107011) but absent in the HBC reference (Additional file 1: Fig. S16a). GTM-decon assigned Plasmablast samples with high cell-type proportions for B-cell, a cell type that shares Plasmablast cell lineage. The inferred cell-type proportions for Basophils purified samples were split between HSPCs (immune progenitor cells) and neutrophils, which is also classified as granulocyte. Granulocytes are the most common white blood cells, consisting of 3 specific cell types—neutrophils, eosinophils, and basophils. Using PBMC2 as a reference to deconvolve the same purified bulk immune samples led to similar deconvolution patterns for the missing cell types of plasmablast and basophils (Additional file 1: Fig. S16b). Interestingly, neutrophils were absent in the PMBC2 reference and inferred to be monocytes, which are related to the granulocyte family—a class of immune cells that include basophils, eosinophils, and neutrophils [27]. Another missing cell type HSPC (hematopoietic stem and progenitor cells) have their signal spread across all the cell types. These results suggest that when some cell types are missing in the reference, GTM-decon either finds the closest match or appropriately expresses uncertainty.\n\nFinally, we performed benchmarking on the time and memory usage of our GTM-decon software. GTM-decon scales linearly with both the number of topics per cell type and the number of cells (Additional file 1: Section S6; Fig. S17), which is what we expected since its time and space complexity are both \\(O(N\\times G\\times K)\\) for N cells, G genes, and K topics. For large number of cells, we can also perform stochastic variational inference [28] to rapidly update model parameters based on mini-batches of cells with much lower memory overhead. It also compares favorably with BISQUE, BSEQ-sc, and MuSiC in terms of running time and memory usage.\n\nGTM-decon automatically learns CTS gene signatures from scRNA-seq reference\n\nWe evaluated the performance of GTM-decon in recapitulating cell-type-specific information as well as deconvolution using pancreatic tissue as a reference. The pancreas consists of several cell types including exocrine and endocrine. While the former aids digestion by secreting several enzymes, the latter regulates glucose uptake and processing by secreting hormones. With a vast literature documenting the biological roles of several cell types and their behavior in healthy and diseased conditions, such as diabetes and cancer, the pancreatic tissue serves as a good benchmark to assess GTM-decon. We trained GTM-decon on an scRNA-seq reference dataset of pancreatic tissue from Segerstolpe et al. [29], consisting of 2209 cells, corresponding to 14 cell types from 10 individuals. GTM-decon captured distinct sets of CTS gene signatures, as shown by the gene-by-topic probability distributions (i.e., the matrix \\(\\upphi\\)) for the top 20 genes in each topic (Fig. 3a). Indeed, each topic recovers a large number of marker genes for the corresponding cell types based on two databases, namely CellMarker database [30], a manually curated resource of cell markers in human and mouse and the PanglaoDB [31], a database of marker genes generated from scRNA-seq datasets (Fig. 3a). We further ascertained the cell-type coherence of each topic by Gene Set Enrichment Analysis (GSEA), while using the probabilities learnt for each cell type against the CellMarkerDB. For the three cell types with abundant marker genes—acinar, alpha, and beta, each of the 5 topics recovers the exact cell type as the top-most hit in the analysis, with the adjusted p-value ≤ 1 × 10−15 (permutation test) in most cases (Fig. 3b). Furthermore, the enrichment of known marker genes for the main cell types suggested that GTM-decon with 5 topics per cell type best captures the cell-type-specific signatures (Additional file 1: Fig. S18). We also evaluated the effect of different number of cells per cell type. As expected, the topic confidence scores as measured by the average probabilities over the CTS gene distributions increase with the increasing number of cells for that cell type (i.e., evidence) (Additional file 1: Fig. S19).\n\nGTM-decon delineates the variations of cell-type proportions in pancreatic tissues of healthy and T2D subjects\n\nBased on the inferred CTS topic distributions \\({\\varvec{\\upphi}}\\), we used GTM-decon with 5 topics per cell type to infer the cell-type proportions of bulk RNA-seq data from a cohort of 89 human pancreatic islet donors with and without type 2 diabetes (GEO accession number: GSE50244) [32] (Fig. 3c). The dataset consists of 51 individuals with normal glucose tolerance (N), 15 with impaired glucose tolerance (IGT) and 12 with type 2 diabetes (T2D); it also has a good segregation of males (N1 = 54) and females (N2 = 35). As expected, the inferred proportions of most types of cells for these two sets of individuals are similar since they came from the same tissue. However, GTM-decon predicted a significant reduction in beta cells in T2D individuals (Pearson correlation coefficient (PCC) with HbA1c = − 0.4, p-value = 0.00031; t-distribution with n-2 degrees of freedom) (Fig. 3d). IGT and T2D individuals exhibit low Beta cell-type proportions (Fig. 3d), which was supported by the literature [1, 2]. The increase in ductal cells is possibly caused by their regulation of glucose uptake (Fig. 3d). These results are consistent when using a different pancreatic dataset as reference (i.e., the PI-Baron reference dataset, generated via Drop-seq instead of PI-Segerstolpe, generated via Smart-seq) (Fig. 3e, f).\n\nDeconvolving human pancreatic data from mouse pancreas scRNA-seq reference\n\nFor cases where scRNA-seq data were not available for the organism of interest, due to either ethical, technical, or financial challenges, there is a need to leverage scRNA-seq collected from a model organism. To this end, we investigated the possibility of deconvolving bulk RNA-seq data by training GTM-decon on a mouse scRNA-seq data. We separately trained two GTM-decon models on the human and mouse pancreatic datasets. Specifically, the human datasets include the Segerstolpe and Baron datasets (Additional file 1: Table S1), which consist of 2209 cells from 10 individuals and 8569 cells from 4 individuals, respectively; the mouse dataset consists of 1886 cells collected from 2 mice. For comparative analysis, we focused on only the common set of high-confidence orthologous genes between the two species mapped by the Ensembl database [33]. We visualized the cell-type proportions comparing against the ground-truth values (Additional file 1: Fig. S20a). As expected, the cell-type proportions deconvolved using the two human datasets accurately recapitulate the ground-truth proportions (median PCC of 0.94 and 0.97). Interestingly, GTM-decon trained on the non-reference human dataset performed better than the one trained on the reference-matched dataset, which was probably due to the tenfold higher number of cells in the former scRNA-seq dataset. Moreover, GTM-decon trained on the mouse reference dataset also performed quite well in terms of the concordant proportions of the shared cell types (PCC of 0.94).\n\nDeconvolving pancreatic cancer transcriptomes identified tumor cell-type origin\n\nWe next turned to deconvolving pancreatic adenocarcinoma (PAAD) (also known as pancreatic ductal adenocarcinoma or PDAC) tumor bulk samples from TCGA. For this application, we also used GTM-decon with 5 topics per cell type. Since the tumor microenvironment is known to be infiltrated with immune cells [34, 35], we sought to train GTM-decon on a single-cell reference dataset derived from individuals with pancreatic cancer, in order to capture the cell types of both the tissue of interest and the immune cells in its tumor microenvironment. To this end, we trained GTM-decon on an scRNA-seq dataset comprised of the transcriptomic profiles of about 57,000 cells from 24 primary PAAD tumors and 11 healthy control pancreas samples [36] in order to deconvolve the 174 bulk RNA-seq profiles from the TCGA-PAAD tumor samples. Additionally, we also sought to identify possible novel cell types or pathways present in the bulk RNA-seq, which are not represented in the reference profiles. This is achieved by running an unguided topic model (i.e., a standard LDA) on the sparsified bulk RNA-seq data to detect de novo bulk RNA-seq (bulkRS) topics (“Methods”). We empirically chose the number of de novo bulkRS topics based on how well they could explain the variation observed in the clinical phenotypes.\n\nWe observe that the most prevalent cell types are 4 main pancreatic cell types, namely ductal (type 2), acinar, endocrine (alpha and beta cell types), and fibroblasts (Fig. 4a). Notably, the cell type of tumor origin is correctly predicted for the samples: Ductal cells have the highest proportion among the PAAD samples (Fig. 4b; brown rectangle), and acinar for a subset of the PAAD samples (Fig. 4b; blue rectangle). This recapitulates the literature remarkably well, as ductal cells are known to be the site of the tumor origin for most cases of PAAD; however, a subset arises from acinar cells [37]. More significantly, an unknown subtype is predicted to originate from endocrine cells (Fig. 4b; green rectangle). This is supported by the recent literature, which reported these samples as the derivatives of the pancreatic neuroendocrine tumor (PNET) were in fact misclassified as PAAD [38]. PNET are supposed to originate from alpha or beta cells (endocrine cells) [39]. In addition, most of the samples are predicted to have a high proportion of fibroblasts, which are known to be prevalent in pancreatic cancer (Fig. 4b; blue dot) [40,41,42]. Interestingly, deconvolving the pancreatic cancer PAAD dataset using mouse reference dataset also conferred high-quality patient clustering comparable to that of human dataset (Additional file 1: Fig. S20b). Notably, the PAAD “other subtype” was predicted to originate from alpha cells (an endocrine cell), which mirrors the results from human reference data (Fig. S20b; shown in blue rectangles).\n\nInterestingly, the de novo bulkRS topics cluster with the most abundant reference topics inferred from the scRNA-seq reference data (Fig. 4b, blue circles). For example, bulkRS Topic 2 corresponds to the CTS topic for acinar cell type, Topic 10 to the CTS topic for endocrine cell type, Topic 9 to Ductal_type_2, Topic 8 to Fibroblast, and Topic 6 to stellate cells. However, there are a few de novo bulkRS topics, such as bulkRS Topic 1, Topic 4, and Topic 5, capturing distinct distributions for specific subsets of samples (Fig. 4b; red dots). These topics could correspond to either novel cell types or gene pathways in the bulk but not implicated in the scRNA-seq reference.\n\nWe next estimated whether variation in cell-type proportions or bulkRS topics is indicative of survival time. To this end, we performed Cox Regression to regress the number of days patients lived since their cancer diagnosis on their inferred cell-type proportions as well as the de novo bulkRS topics. Overall, the Cox Regression model is statistically significant compared to the bias term (adjusted p-value = 9 × 10−5 based on likelihood ratio test). To explore the marginal effect of individual cell-type proportions on survival, we performed Kaplan–Meier analysis by separating patients into two groups based on K-means clustering (Fig. 4c). We observe that among the cell types, endocrine cell type exhibits a significant hazard ratio, predicting a good survival outcome (Fig. 4d; p-value = 0.0091; log-rank test), which is supported by the literature as PNETs are mostly benign [43]. However, ductal cell type 2 is associated with poor survival outcome, which is expected as pancreatic adeno carcinoma are aggressive (p-value = 0.03; log-rank test). On the other hand, Topic 1 and Topic 5 indicate poorer survival, with hazard ratios of 4 and 40 respectively (Additional file 1: Fig. S21) although their roles are unclear since they do not cluster with any of the CTS topics (Fig. 4b). This reiterates the usefulness of using CTS topics in conjunction with de novo bulkRS topics to enable their interpretation wherever possible.\n\nA similar analysis conducted using a separate scRNA-seq reference from healthy pancreatic subjects only reveals similar results (Additional file 1: Fig. S22). However, in this analysis, only two of the de novo bulkRS topics clearly correspond to CTS topics (acinar and ductal), suggesting that the usage of an appropriate scRNA-seq reference with matched tumor environment is preferred.\n\nDeconvolving breast cancer transcriptomes revealed subtype-specific markers\n\nTo capture specific subtypes of breast tumor samples from the TCGA data, we trained GTM-decon on an scRNA-seq reference data from 26 primary tumors of breast cancer (BRCA) patients with three major clinical subtypes of BRCA, including 11 ER + , 5 HER2 + and 10 TNBC [44]. The data consists of about 1 million cells and covers 7 major cell types and 29 minor cell types. This served as a high-resolution reference for annotating the TCGA-BRCA tumor samples (n = 1212) based on the major subtypes from the scRNA-seq dataset, namely Cancer-Basal, Cancer-Her2, Cancer-LumA, and Cancer-LumB (Additional file 1: Fig. S23a). As expected, significantly higher proportions of endothelial and myoepithelial cell types are found in the normal-like samples, in comparison to the cancer subtypes (Fig. S23a). Furthermore, basal subtype is enriched for cancer-basal cells (Fig. S23b, shown in dotted brown rectangle), and the cancer-associated fibroblasts (CAFs) are enriched in almost all the samples (Fig. S23b, shown in blue rectangles). Similar to the above analyses, some of the de novo bulkRS topics from sparsified samples overlap with the most represented cell types. For example, Topic 6 resembles myofibroblast-like cancer-associated fibroblasts (myCAF-like), and Topic 8 resembles LumA subtype cancer cells.\n\nDeconvolution using the scRNA-seq reference from the healthy individuals also captures the cell type of origin for the different breast cancer subtypes implicated in the bulk samples (Additional file 1: Fig. S24). For this analysis, using highly variable genes is more discriminatory than all genes (Additional file 1: Fig. S25). The inferred CTS topic distributions from normal breast tissue recapitulate several marker genes from CellmarkerDB and PanglaoDB (Fig. S24a). Furthermore, GTM-decon-inferred cell-type proportions clearly distinguish TCGA breast tumor samples from GTEx normal breast tissues (Fig. S24b). Moreover, the basal cell type is predicted to have the highest proportion in the basal subtype defined by the PAM50 classification in comparison to other subtypes (Fig. S24c) [45]. Also, we observed higher predicted proportion for Luminal_2 cell type in both LumA and LumB subtypes as expected [46] (Fig. S24c). Among the de novo bulkRS topics from sparsified samples, Topic 5 is highly enriched in LumB, while Topic 7 and Topic 8 are enriched in basal and LumA subtypes (Fig. S24c). The guided topic score for the basal subtype also correlates with higher proliferation score as expected [45]. Specifically, the basal cell type is enriched in this subtype (Fig. S24d; enclosed in green rectangle), whereas Luminal_2 is depleted (Fig. S24d; enclosed in green dashed rectangle). In contrast, ER + samples appear to be enriched for Luminal_2 cells (Wilcoxon test p-value = 4.5e − 10; Fig. S26), as expected [46, 47]. Furthermore, Topic 7 clearly captures the basal subtype (enclosed in brown rectangle in Fig. S24d), whereas there is no clear topic capturing the ER + phenotype.\n\nGTM-decon learns phenotype-guided gene topics specific to BRCA subtypes\n\nOur guided topic mechanism is not limited to inferring CTS topics, but can be extended to inferring phenotype-specific topics (i.e., topics capturing phenotype-specific gene expression) (Fig. 1b), thereby discovering gene signatures of subtypes or different cancer stages. We applied this approach to study the differences between basal and ER + BRCA subtypes (Fig. 5a–c) and the difference between ductal carcinoma and lobular carcinoma (Fig. 5d–f). We modeled each phenotype using 5 topics each, based on a sparsified matrix of bulk RNA-seq data (“Methods”), resulting in a genes-by-phenotypes matrix \\(\\upphi\\) with 5 topics per phenotype (Fig. 5a). We then ranked genes by the topic scores under each topic. Almost all the genes identified by our approach were also deemed as differentially expressed (DE) genes by DESeq2 differential analysis [48] (Fig. 5a). GSEA of the topics shows differences between the basal and ER + phenotypes, although there is not much difference among the 5 topics for basal (Fig. 5c). Moreover, the trained GTM-decon confers accurate phenotype classification with 97% accuracy for discriminating basal and ER + (Fig. 5b) and 82% for discriminating ductal and lobular subtypes (Fig. 5d), which is comparable to the traditional supervised learning methods namely logistic regression and random forest (Fig. 5f). We also evaluated phenotype classification accuracy as a function of sparsification rate (described in Additional file 1 Section S7 and illustrated in Additional file 1: Fig. S27) suggesting the importance of sparsification for inferring topics from bulk RNA-seq data using GTM-decon. We also trained GTM-decon only on the highly variable genes in the unsparsified bulk RNA-seq samples. This results in lower classification accuracy (76% for ductal-lobular samples as compared to 82%, and 95% for basal-ER + samples as compared to 97%), which might be due to information loss (HVG = 1391 for basal-ER + samples, HVG = 445 for ductal-lobular samples). Training using DE genes between the two phenotypes identified by DESeq2 also results in lower classification accuracy of 83% and 75%, respectively. These experiments suggest that GTM-decon can utilize more informative genes to discriminate the breast cancer subtypes than the traditional differential analysis approach.\n\nNested-guided topic modeling identifies CTS DE genes in breast cancer subtypes\n\nscRNA-seq can facilitate molecular understanding of genes and pathways in specific cell types with respect to phenotypic states. This level of detail is absent in bulk RNA-seq data, which profiles only the averaged gene expression from all cell types in the tissue. However, due to the cost, scRNA-seq profiles at the patient cohort size are rare. To take advantage of both types of data, we sought a way to identify cell-type-specific gene expression differences corresponding to the phenotypes observed for the bulk samples. Briefly, we took a pretrained GTM-decon on a scRNA-seq reference data and then updated its CTS topics based on the corresponding phenotypes from the sparsified bulk data (Fig. 1c). This is equivalent to treating the phenotype as level 1 and cell types as level 2 in a two-stage nested factor design in statistics.\n\nFor the TCGA-BRCA data, in particular, we first initialized the genes-by-topic matrix \\(\\upphi\\) with the pretrained guided topics learned from the scRNA-seq reference for normal breast tissue. We then fine-tuned 5 CTS topics for each phenotype (i.e., ER + or basal) from sparsified bulk data, resulting in a 10-topic model. During the fine-tuning, all CTS topics corresponding to the patient’s phenotype are assigned a prior value of 0.9. Applying this approach to 798 sparsified samples from TCGA-BRCA, corresponding to basal (N1 = 140) and ER + (N2 = 658) led to a new genes-by-topic matrix \\({\\upphi }^{*}\\). First of all, the top genes for the topics corresponding to the same cell type are similar in both phenotypes, as they are expected to capture CTS signatures (Fig. 6a). However, differential analysis of genes between two phenotypes revealed upregulated genes in one phenotype being downregulated in the other (Fig. 6b). These differences between basal and ER + are statistically significant across all genes for all the cell types based on paired Wilcoxon signed-rank tests. Next, we evaluated the ability of the fine-tuned GTM-decon to classify the held-out test set and observed a 97% classification accuracy (Fig. 6c, top panel). These higher-resolution deconvolved CTS breast cancer profiles reveal that ER + samples are enriched for Luminal-2 cell type, whereas the basal subtype is depleted for that cell type (Fig. 6c).\n\nNext, we identified the DE genes per cell type by subtracting the genes-by-topic entries in the \\(\\upphi\\) matrix for phenotype \\(d\\) (e.g., basal) from phenotype \\({d}{\\prime}\\) (e.g., ER +) under the same cell type (e.g., Luminal 2). To evaluate the consistency of our DE genes, we compared them against the DE genes identified by DESeq2 (Fig. 6d). We observe that all upregulated and downregulated DE genes nominated by DESeq2 in ER + versus basal comparison were also deemed upregulated and downregulated by our approach, respectively. We visualize the expression of the 630 statistically significant DE genes (adjusted p-value < 0.05; permutation test) in the BRCA tumor samples (Fig. 6e). We found that most of our DE genes do not only agree with those by DESeq2 but also exhibit CTS patterns. Notably, the most DE genes correspond to the Luminal_2 cell type (Fig. 6e), which exhibit the larger difference between ER + and basal (Additional file 1: Fig. S26). Over representation analysis (ORA) of these CTS DE genes against Hallmark pathways from MSigDb revealed several meaningful pathways. As expected, estrogen response (early) and (late) pathways are highly upregulated in the ER + phenotype, mainly in the Luminal_2 cell type (Fig. 6f). Similarly, most DE genes in the basal phenotype are upregulated for typical pathways involved in cancer, such as G2M checkpoint, E2F targets, and mitotic spindle. This reflects the aggressive nature of basal cell type as the origin for the cancer subtype (Fig. 6f). The contribution of sparse genes (i.e., genes with zero counts due to sparsification) to CTS topics and DE analysis is described in Additional file 1 Section S7 and illustrated in Additional file 1: Fig. S28. We obtained similar results comparing the 2 histological subtypes—ductal carcinoma and lobular carcinoma (Additional file 1: Fig. S29).\n\nTo further demonstrate the phenotype-guided and phenotype + cell-type-guided functionality, we applied GTM-decon to the same scRNA-seq data from breast cancer tumors using phenotypes (i.e., ER + and TNBC) and cell-type labels as the guides and then used the inferred topics to deconvolve the bulk TCGA breast tumor transcriptome data. Detailed analyses are presented in Additional file 1 Section S8 and Fig. S30. This was feasible because we have scRNA-seq references that were collected from similar tissue sites from patients of the same disease phenotypes as the target bulk transcriptomes.\n\nModeling scRNA-seq reference data via topic inference guided by cell-type labels\n\nWe adapted GTM-decon from the MixEHR-Guided (Mixture of Electronic Health Records – Guided) [58] (which was in turn inspired by MixEHR (Mixture of Electronic Health Records) [59] and sureLDA (Surrogate-guided ensemble Latent Dirichlet Allocation) [60]) to model gene expression from scRNA-seq data. We assume that the scRNA-seq data are generated from the following data generative process. Each cell indexed by m ∈ {1, …, M} is a mixture of the K cell types. The cell-type mixture \\({{\\varvec{\\uptheta}}}_{m}\\) is sampled from a K-dimensional Dirichlet distribution \\({{{\\varvec{\\uptheta}}}_{\\mathrm{m}} \\sim \\mathrm{ Dir}({\\varvec{\\upalpha}}}_{m}+0.1)\\) with the hyperparameter \\({{\\varvec{\\upalpha}}}_{m}\\) being specific to the cell. The key assumption here that separates GTM-decon from the standard LDA [25] is the use of noisy cell-type label \\({y}_{m}\\in \\{1,..,K\\}\\) for the cell. The hyperparameter corresponding to the cell-type label \\({y}_{m}=k\\) has higher value (\\({\\alpha }_{m,k}= 0.9\\) by default) in contrast to the rest of the hyperparameters \\({\\alpha }_{m,{k}{\\prime}}\\) for \\({k}{\\prime}\\ne k\\), which are randomly set to small values between 0.01 and 0.1. Note that having non-zero \\({\\alpha }_{m,{k}{\\prime}}\\) allows other cell types to be assigned to the cell (i.e., \\({\\theta }_{m,{k}^{{\\prime} } }\\ge 0\\)) and therefore \\({{\\varvec{\\uptheta}}}_{\\mathrm{m}}\\) reflects the statistical uncertainty of the cell-type label \\({y}_{m}\\), which can be error prone due to various technical and data preprocessing aspects of the scRNA-seq data. To not clutter the notation, we omit the baseline value 0.1 in the following model description and use the more general form of \\({{{\\varvec{\\uptheta}}}_{\\mathrm{m}} \\sim \\mathrm{ Dir}({\\varvec{\\upalpha}}}_{m})\\) instead. Following the above default setting, this is equivalent to setting \\({\\alpha }_{m,k}=1\\) for the observed cell type and \\({\\alpha }_{m,{k}{\\prime}}\\in [0.11, 0.2]\\) for other cell types. For each cell \\(m\\), each scRNA-sequenced read \\(i\\in \\left\\{1,\\dots , {N}_{m}\\right\\}\\) originates from one of the \\(K\\) cell types with the probabilities dictated by its cell-type mixture (\\({{\\varvec{\\uptheta}}}_{\\mathrm{m}}\\)): \\({z}_{i,m}\\sim \\mathrm{Cat}\\left({{\\varvec{\\uptheta}}}_{m}\\right)\\). Given the cell type \\({z}_{i,m}=k\\), the ith read maps to a specific gene indexed by \\({x}_{i,m}\\) with the probabilities dictated by the CTS topic distribution over all genes (\\({{\\varvec{\\upphi}}}_{k}\\)): \\({x}_{i,m} \\sim \\mathrm{Cat}({{\\varvec{\\upphi}}}_{k})\\), where \\({{\\varvec{\\upphi}}}_{k}\\) follows a G-dimensional Dirichlet distribution with a fixed hyperparameter \\(\\beta\\) across all K dimensions: \\({{\\varvec{\\upphi}}}_{k}\\sim \\mathrm{Dir}\\left(\\beta \\right)\\). Since the topic mixture \\({{\\varvec{\\uptheta}}}_{m}\\) are softly clamped to specific cell types via the K-dimensional hyperparameter \\({{\\varvec{\\upalpha}}}_{m}\\), by following the above data generative process, it is straightforward to see that the K sets of topic distributions \\({{\\varvec{\\upphi}}}_{k}\\)‘s are also CTS.\n\nThe posterior distribution for the latent variables \\({{\\varvec{\\uptheta}}}_{m}\\)’s, \\({z}_{i,m}\\)’s and \\({{\\varvec{\\upphi}}}_{k}\\)’s conditioned on the scRNA-seq reference data can be either approximated by Gibbs sampling [61] or by collapsed mean-field variational inference [62]. Specifically, for algorithmic convenience, we can leverage the conjugacy of the Dirichlet to categorical distribution by integrating out \\({{\\varvec{\\uptheta}}}_{\\mathrm{m}}\\) and \\({{\\varvec{\\upphi}}}_{k}\\) resulting in two Dirichlet-Multinomial distributions [63]:\n\n$$p\\left(z\\vert\\alpha\\right)=\\int p\\left(\\theta\\vert\\alpha\\right)p\\left(z\\vert\\theta\\right)d\\theta=\\prod_m\\frac{\\Gamma(\\sum_k\\alpha_{m,k})}{\\prod_k\\Gamma(\\alpha_{m,k})}\\frac{\\prod_k\\Gamma(\\alpha_{m,k}+n_{.,m,k})}{\\Gamma(\\sum_k\\alpha_{m,k}+n_{.,m,k})}$$\n\n$$p\\left(x|z\\right)=\\int p\\left(\\phi |\\beta \\right)p\\left(x|z,\\phi \\right)d\\phi ={\\prod }_{k}\\frac{\\Gamma \\left(G\\beta \\right)}{{\\prod }_{g}\\Gamma \\left(\\beta \\right)}\\frac{{\\prod }_{g}\\Gamma \\left(\\beta +{n}_{g,.,k}\\right)}{\\Gamma (G\\beta +{\\sum }_{g}{n}_{g,.,k})}$$\n\nNote that we can recover the expected values for \\({{\\varvec{\\uptheta}}}_{\\mathrm{m}}\\)’s and \\({{\\varvec{\\upphi}}}_{k}\\)’s given the posterior estimates of \\({z}_{i,m}{\\prime}s\\) as they are proportional to the unnormalized counts \\({n}_{.,m,k}={\\sum }_{i}[{z}_{i,m}=k]\\) and \\({n}_{g,.,k}={\\sum }_{m}\\left[{z}_{i,m}=k,{x}_{i,m}=g\\right]\\), respectively.\n\nThe conditional distribution of the topic assignment for read \\(i\\) and cell \\(m\\) has a closed form expression:\n\n$$p\\left(z_{i,m}=k\\vert{x_{i,m}=g,z}^{-\\left(i,m\\right)},x^{-\\left(i,m\\right)}\\right)\\propto p\\left(z_{i,m}=k,z^{-\\left(i,m\\right)}\\vert\\alpha_{m,k}\\right)p\\left(x_{i,m}=g,x^{-\\left(i,m\\right)}\\vert z_{i,m}=k,z^{-\\left(i,m\\right)}\\right)\\propto\\frac{\\prod_k\\Gamma\\left(\\alpha_{m,k}+n_{.,m,k}\\right)}{\\Gamma(\\sum_k\\alpha_{m,k}+n_{.,m,k})}\\prod_k\\frac{\\prod_g\\Gamma\\left(\\beta+n_{g,.,k}\\right)}{\\Gamma(G\\beta+\\sum_gn_{g,.,k})}\\propto\\prod_{{}_{k'\\neq k}}\\;\\Gamma\\left(\\alpha_{m,k'}+n_{.,m,k'}^{\\left(-i\\right)}\\right)\\Gamma\\left(\\alpha_{m,k}+n_{.,m,k}^{\\left(-i\\right)}+1\\right)\\prod_{{}_{k'\\neq k}}\\;\\frac{\\prod_g\\Gamma\\left(\\beta+n_{g,.,k}^{-\\left(i,m\\right)}\\right)}{\\Gamma(G\\beta+\\sum_gn_{g,.,k}^{-\\left(i,m\\right)})}\\frac{\\Gamma\\left(\\beta+n_{g,.,k}^{-\\left(i,d\\right)}+1\\right)}{\\Gamma(G\\beta+\\sum_gn_{g,.,k}^{-\\left(i,d\\right)}+1)}\\propto\\prod_k\\Gamma\\left(\\alpha_{m,k'}+n_{.,m,k'}^{\\left(-i\\right)}\\right)\\left(\\alpha_{m,k}+n_{.,m,k}^{\\left(-i\\right)}\\right)\\prod_k\\frac{\\prod_g\\Gamma\\left(\\beta+n_{g,.,k}^{-\\left(i,m\\right)}\\right)}{\\Gamma(G\\beta+\\sum_gn_{g,.,k}^{-\\left(i,m\\right)})}\\frac{\\beta+n_{g,.,k}^{-\\left(i,d\\right)}}{G\\beta+\\sum_gn_{g,.,k}^{-\\left(i,d\\right)}}\\propto\\left(\\alpha_{m,k}+n_{.,m,k}^{\\left(-i\\right)}\\right)\\left(\\frac{\\beta+n_{g,.,k}^{-\\left(i,m\\right)}}{G\\beta+\\sum_gn_{g,.,k}^{-\\left(i,m\\right)}}\\right)$$\n\nwhere the second last equality exploits the property of the Gamma function, i.e., \\(\\Gamma \\left(x+1\\right)=\\Gamma \\left(x\\right)x\\). Here \\({n}_{.,m,k}^{(-i)}\\) is the total number of scRNA-seq reads allocated for topic k for cell m without counting the current ith read, and \\({n}_{g,.,k}^{-\\left(i,m\\right)}\\) is the total read counts for gene g under topic k across all of the M cells, without counting the current ith read in the mth cell:\n\n$$n_{.,m,k}^{(-i)}=\\sum_{i'\\neq i}^{N_m}{\\lbrack z}_{i',m}=k\\rbrack$$\n\n$$n_{g,.,k}^{-\\left(i,m\\right)}=\\sum_{{}_{m'\\neq m\\mathrm{or}i'\\neq i}}\\;\\left[z_{i',m'}=k,x_{i',m'}=g\\right]$$\n\nFrom here, the topic inference can be done by collapsed Gibbs sampling from \\(p\\left({z}_{i,m}=k|{z}^{-\\left(i,m\\right)},x\\right)\\), while fixing the topic assignments for all other reads [61]. For a large number of cells in the scRNA-seq data, the collapsed Gibbs sampling approach tends to be slow in reaching an equilibrium state. Therefore, we took a deterministic mean-field variational inference approach, known as the collapsed variational Bayes (CVB) [62]. Specifically, we approximate the posterior distribution of the cell-type assignment \\(p\\left({z}_{i.m}\\right|\\mathbf{x},{{\\varvec{\\upalpha}}}_{m})\\) via the variational categorical distribution \\(q\\left({z}_{i,m} \\right|{ x}_{i,m}=g\\)) = \\(\\prod_{k}{\\gamma }_{i,m,k}^{\\left[{z}_{i,m}=k\\right]}\\), where\n\n$${\\gamma }_{i,m,k }\\propto \\left({\\alpha }_{m,k }+{n}_{.,m,k}^{(-i)} \\right)\\left(\\frac{\\beta + {n}_{g,.,k}^{-\\left(i,m\\right)}}{G{\\beta }+{\\sum }_{g}{n}_{g,.,k}^{-(i,m)}}\\right)$$\n\nUsing the variational parameters for the topic assignments, the above sufficient statistics are replaced by the soft counts:\n\n$$n_{.,m,k}^{\\left(-i\\right)}=\\sum_{i'\\neq i}^{N_m}\\;\\gamma_{i',m,k}$$\n\n$$n_{g,.,k}^{-\\left(i,m\\right)}=\\sum_{m'\\neq m\\mathrm{or}i'\\neq i}\\;\\left[x_{i',m'}=g\\right]\\alpha_{m,k}\\gamma_{i',m',k}$$\n\nHere in updating the global gene distribution in the second equation, we further make use of the CTS prior \\({{\\varvec{\\upalpha}}}_{m}\\) to obtain more interpretable results.\n\nThe above topic inference formulation operates at the level of read. For computational efficiency, our actual implementation of the topic inference was simplified to operate at the level of gene instead of the level of read:\n\n$${\\gamma }_{g,m,k }\\propto \\left({\\alpha }_{m,k }+{n}_{.,m,k}^{(-g)} \\right)\\left(\\frac{\\beta + {n}_{g,.,k}^{(-m)}}{G{\\beta }+\\sum_{g}{n}_{g,.,k}^{(-m)}}\\right)$$\n\nSimilar to the above sufficient statistics, \\({n}_{.,m,k}^{(-g)}= \\sum_{{g}{\\prime}\\ne g}{\\gamma }_{{g}{\\prime},m,k}\\) is the total number of scRNA-seq reads allocated for topic k for cell m, and \\({n}_{g,.,k}^{\\left(-m\\right)}= \\sum_{{m}{\\prime}\\ne m}{{\\alpha }_{m,k}\\gamma }_{{g,m}{\\prime},k}\\) is the total read counts for gene g under topic k across all of the M cells, without counting the gth gene for cell m. This is equivalent to a reasonable assumption that all the reads from the same gene for the same cell are originated from the same cell type, i.e., \\({\\forall }_{i,{i}{\\prime}} {z}_{i,m}={z}_{{i}{\\prime},m}\\) if \\({x}_{i,m}={x}_{{i}{\\prime},m}\\).\n\nTogether, the inference algorithm alternates between two simple steps: (1) for each cell and each gene, perform coordinate ascent by computing \\({\\gamma }_{g,m,k}\\) while fixing the variational parameters \\({\\gamma }_{{g}{\\prime},m,k}\\) for other genes \\({g}{\\prime}\\); (2) update the sufficient statistics. This algorithm maximizes the evidence lower bound \\(ELBO={E}_{q}\\left[\\mathrm{log}p\\left(x|z\\right)\\right]+{E}_{q}[\\mathrm{log}p(z|\\alpha )]-{E}_{q}[\\mathrm{log}q\\left(z|\\gamma \\right)]\\) [62]. The model is deemed converged when ELBO stops improving by a small threshold (1e−6 by default).\n\nUpon convergence, the expected values for \\({\\theta }_{\\mathrm{m},\\mathrm{k}}\\) and \\({\\phi }_{g,k}\\) are:\n\n$${\\mathbb{E}}_{q}\\left[{\\theta }_{m,k}\\right]= \\frac{{{\\alpha }_{m,k}+n}_{.,m,k}}{{\\sum }_{k}{{\\alpha }_{m,k}+n}_{.,m,k}}\\equiv {\\widehat{\\theta }}_{\\mathrm{m},\\mathrm{k}}; {\\mathbb{E}}_{q}\\left[{\\phi }_{\\mathrm{g},\\mathrm{k}}\\right]=\\frac{\\beta +{n}_{g,.,k}}{G\\beta +{\\sum }_{g}{n}_{g,.,k}}\\equiv {\\widehat{\\phi }}_{\\mathrm{g},\\mathrm{k}}$$\n\nwhere \\({n}_{.,m,k}={\\sum }_{i=1}^{{N}_{m}}{\\gamma }_{i,m,k}\\) and \\({n}_{g,.,k}=\\sum_{m=1}^{M}[{x}_{i,m}=g]{\\alpha }_{m,k}{\\gamma }_{i,m,k}\\). Here \\({{\\{\\widehat{\\theta }}_{\\mathrm{m},\\mathrm{k}}\\}}_{M\\times K}=\\widehat{\\Theta }\\) can be used to assess the “purity” of the single cells as a quality control step and \\({{\\{\\widehat{\\phi }}_{\\mathrm{g},\\mathrm{k}}\\}}_{\\mathrm{G}\\times \\mathrm{K}}=\\widehat{{\\varvec{\\Phi}}}\\) probabilities are used as the CTS topics in the subsequent deconvolution step.\n\nInferring multiple topics per cell type\n\nSuppose we use \\(L\\) topics per cell type for \\(K\\) cell types, the hyperparameter \\({{\\varvec{\\upalpha}}}_{m}\\) for cell \\(m\\) can be formulated into a \\(K\\times L\\) matrix. Given that the cell-type label for cell \\(m\\) is \\({y}_{m}=k\\), we set the kth row of \\({{\\varvec{\\upalpha}}}_{m}\\) to relatively high values and the rest of the K-1 rows to relatively low values. For example, suppose we have 5 cell types and 3 sub-topics per cell type. If cell \\(m\\) is labeled with cell type 2, then the topic prior hyperparameter matrix \\({{\\varvec{\\upalpha}}}_{m}\\) can be set to the following values: [0.01, 0.01, 0.01; 0.9, 0.9, 0.9; 0.01, 0.01, 0.01; 0.01, 0.01, 0.01; 0.01, 0.01, 0.01], where comma separates the columns and semicolons separate the rows. Here, the 3 topic prior values in the second row corresponding to cell type 2 are set to 0.9 and the values in the remaining rows are set to 0.01.\n\nThe data generative process is identical to the basic GTM-decon except having \\(K\\times L\\) topics instead of \\(K\\) topics. Specifically, to sample the cell-type mixture \\({{\\varvec{\\uptheta}}}_{\\mathrm{m}}\\), we flatten the \\(K\\times L\\) matrix for \\({{\\varvec{\\upalpha}}}_{m}\\) to have a row vector of \\(1\\times \\left(K\\times L\\right)\\) so that the \\({{\\varvec{\\uptheta}}}_{\\mathrm{m}}\\) will have relatively high expected value for the \\({y}_{m}^{th}\\) consecutive L values that correspond to the labeled cell type and relatively low expected value for the rest of the entries. We experimented modeling each cell type using \\(L\\in \\{2, 3, 4, 5\\}\\) topics per cell type, with the hyperparameters \\({\\alpha }_{m,k}\\) for each cell of cell type \\(k\\) set to 0.45, 0.3, 0.22, and 0.18, respectively. The prior values for the remaining topics were assigned with random values between 0.001 and 0.01. These priors were heuristically chosen based on the hyperparameter of value 0.9 for one topic divided by the number of topics per cell type.\n\nInferring mixing cell-type proportions in bulk transcriptome\n\nWe assume a similar data generative process of the bulk transcriptome as the single-cell transcriptome described above. In particular, each bulk sample \\(j\\in \\{1,..,D\\}\\) is a mixture of \\(K\\) cell types. Its cell-type mixture \\({{\\varvec{\\uptheta}}}_{j}\\) is sampled from a K-dimensional symmetric Dirichlet distribution \\({{\\varvec{\\uptheta}}}_{\\mathrm{j}}\\sim \\mathrm{Dir}({\\varvec{\\upalpha}})\\) with the hyperparameter fixed at a constant value across all K cell types (default: \\({\\alpha }_{k}=0.1\\forall k\\)). The flat hyperparameter value is used here since we typically do not have any prior information about the cell-type mixtures in the bulk RNA-seq data. For \\({N}_{j}\\) total RNA-seq reads of bulk sample j, each read \\(i\\in \\{1,\\dots ,{N}_{j}\\}\\) originates from one of the \\(K\\) cell types with the categorical rates set to be \\({{\\varvec{\\uptheta}}}_{\\mathrm{j}}\\): \\({z}_{i,j}\\sim \\mathrm{Cat}({{\\varvec{\\uptheta}}}_{j})\\), where \\({z}_{i,j}\\in \\{1,\\dots ,K\\}\\), and maps to a specific gene indexed by \\({x}_{i,j}\\in \\{1,\\dots ,G\\}\\) with a known CTS categorical rates \\({\\widehat{{\\varvec{\\upphi}}}}_{{z}_{i,j}}\\): \\({x}_{i,j}\\sim \\mathrm{Cat}({\\widehat{{\\varvec{\\upphi}}}}_{{z}_{i,j}})\\).\n\nPerforming deconvolution on a bulk transcriptome profile is equivalent to inferring the posterior distribution of the CTS topic mixture given its gene expression and the CTS topic distributions: \\({\\mathrm{p}({\\varvec{\\uptheta}}}_{\\mathrm{j}}|{\\mathbf{x}}_{j},\\widehat{\\Phi }\\)). To this end, we used the \\(\\mathrm{G}\\times K\\) genes-by-CTS-topic estimates \\(\\widehat{\\Phi }\\) inferred from the scRNA-seq reference data (described in section “Modeling scRNA-seq reference data via topic inference guided by cell-type labels”) and perform variational inference to infer the cell-type mixture \\({{\\varvec{\\uptheta}}}_{j}\\) for the jth bulk RNA-seq profile. Implementation-wise, similar to the scRNA-seq topic modeling, we also use the simplified topic inference algorithm at the gene level \\(g\\in \\{1,\\dots ,G\\}\\) as opposed to at read level. This involves alternating between the topic assignment inference for \\({\\gamma }_{g,j,k}\\) and computing the sufficient statistics \\({n}_{.,j,k}^{-\\left(g\\right)}\\) while fixing \\(\\widehat{\\Phi }\\). Algorithmically, for each gene, we infer the topic assignments:\n\n$${\\gamma }_{g,j,k }\\propto \\left({\\alpha }+{n}_{.,j,k}^{(-g)} \\right){\\widehat{\\phi }}_{g,k}$$\n\nwhere \\({n}_{.,j,k}^{(-g)}= \\sum_{{g}{\\prime}\\ne g}{\\gamma }_{{g}{\\prime},j,k}\\). Upon convergence, we compute the expected CTS-topic mixture:\n\n$${\\mathbb{E}}_{q}\\left[{\\theta }_{j,k}\\right]= \\frac{{\\alpha +n}_{.,j,k}}{K\\alpha +{\\sum }_{k}{n}_{.,j,k}}$$\n\nThe bulk sample is transformed in the same way as the scRNA-seq reference data as described in the “Preprocessing the reference scRNA-seq data” section.\n\nWe also show that although GTM-decon infers RNA fractions instead of cell-type fractions, the correlation between the RNA fractions and cell-fractions is strong across cell types in multiple datasets, suggesting that RNA fractions per cell type can serve as a good surrogate to the cell fraction per cell type despite the potential differences in cell sizes among cell types (described in Additional file 1: Section S9 and illustrated in Fig. S31).\n\nSparsification of the bulk data to directly infer topic distributions from them\n\nIn order to identify de novo topics that are not present in the reference scRNA-seq data, we applied standard LDA using the CVB implementation from MixEHR [59] to the sparsified bulk RNA-seq data. However, bulk RNA-seq data is a dense matrix with most genes having non-zero entries while topic models excel at modeling sparse matrices (e.g., scRNA-seq data). To make the bulk RNA-seq data amenable to our approach, we sparsified the dense matrix by setting all values below the 75th percentile to 0. This cutoff was derived from scRNA-seq datasets, where on average 25% of genes in a cell have non-zero count values. While sparsifying works well in our applications, as a caveat, we acknowledge that it will lead to information loss. We also experimented with two other approaches to sparsify the matrix: (1) training GTM-decon only using HVG genes in bulk RNA-seq data; (2) training GTM-decon using differentially expressed genes identified between the phenotypes using DESeq2 [64].\n\nNote that the sparsification procedure was done on the bulk data only when we directly inferred gene topic distributions from them, which pertains to the de novo topic inference from bulk samples, phenotype-guided topic inference from the bulk, and nest-guided CTS-phenotype topic inference. All of the deconvolution experiments, where we first inferred topics from a single-cell reference dataset and then applied the inferred topics to deconvolve bulk data, does not involve the sparsification procedure (i.e., deconvolving the original bulk transcriptomes as they are).\n\nIdentifying statistically significant marker genes per cell type\n\nAfter GTM-decon topic inference, marker genes for each cell type were identified using permutation test. Specifically, for gene g under topic k, we computed the difference of its topic score \\({\\phi }_{g,k}\\) from the average topic score over the rest of the K-1 topics \\({\\phi }_{g,{k}{\\prime}\\ne k}\\). For example, for 3 cell types, the test statistic for cell type 1 is calculated as \\({\\phi }_{g,1}-\\left({\\phi }_{g,2}+{\\phi }_{g,3}\\right)/2\\). More generally, for K cell types and T topics per cell topic, the test statistic for cell type k and gene g is\n\n$$\\frac{1}{T}\\left(\\sum_{t=1}{\\phi }_{k,g}^{\\left\\{t\\right\\}}- \\frac{1}{K-1} \\sum_{{k}{\\prime}\\ne k}\\sum_{t=1}{\\phi }_{{k}{\\prime},g}^{\\left\\{t\\right\\}}\\right)$$\n\nThe significance of the observed statistic is compared against the same statistic calculated from 100,000 permutations. The empirical p-value is computed as fraction of permutations, where the test statistic is greater than the observed value.\n\nEvaluation of deconvolution accuracy using simulated and real bulk data\n\nWe evaluated the deconvolution accuracy by comparing the inferred cell-type proportions against the ground truth values for the datasets. First, we simulated bulk RNA-seq data using the scRNA-seq dataset. We summed the gene expression counts of each sample from the scRNA-seq data to represent the bulk data of that sample (artificial bulk transcriptome). The ground-truth cell-type proportions are the fraction of cells for each cell type. To avoid information bias in the evaluation, we performed leave-one-out cross-validation (LOOCV) by inferring topics from scRNA-seq data for N − 1 subjects as the training examples and deconvolving the held-out subject as the validation example. The results are shown in Additional file 1: Fig. S10.\n\nIn addition, we also used real bulk data with known cell-type proportion to benchmark our methods. To conduct different benchmarking and qualitative experiments, we used scRNA-seq datasets from several tissues for training GTM-decon (Additional file 1: Table S1): a human pancreas (E-MTAB-5061, GSE81433) (with 4 type 2 diabetes and 3 healthy subjects) and mouse (GSE81433); b Peripheral blood mononucleocytes (PBMC) of healthy human (GSE132044); c human blood cells (HBC) of healthy humans (GSE149938); d post-mortem brain tissue of frontal cortex from adult human (GSE97930); e Breast tissue from healthy individuals (GSE113197). Apart from healthy individuals, scRNA-seq references from patients with a pancreatic cancer (CRA001160) and b breast cancer (GSE176078) were used to deconvolve cancer bulk RNA-seq datasets.\n\nBulk RNA-seq datasets with known ground truth values were chosen for benchmarking (Additional file 1: Table S2). Datasets with known ground truth proportions from flow cytometry include a whole blood from 12 individuals (obtained from CIBERSORTx webpage), b PBMC from a cohort of 13 individuals (GSE107011), c PBMC from a cohort of 346 individuals (SDY67). For brain tissue, ground truth proportions from immunohistochemistry were available for a cohort of 41 individuals from the Religious Orders Study / Memory and Aging Project (ROSMAP) study (CortexCellDeconv). A unique dataset with both bulk RNA-seq data and scRNA-seq data from pancreas was accessed from E-MTAB-5060 and E-MTAB-5061, respectively, with the cell type proportions from scRNA-seq considered as ground truth values.\n\nFor the 3 immune (SDY67, whole blood, PBMC S13 cohort) and brain prefrontal cortex (ROSMAP) bulk datasets, we used two independent single-cell references with the most closely matched tissues of origin (Additional file 1: Table S1). For the pancreatic dataset (Segerstolpe), paired single-cell and bulk data from the same individuals were used in the LOOCV manner, where we used the cell-type proportions from the single-cell dataset to compare the estimated proportions from the paired bulk data in the same held-out subject.\n\nTo evaluate the concordance between the ground truth \\({\\mathrm{y}}_{m}\\) and our inferred cell-type mixture \\({\\uptheta }_{m}\\) for each test sample m, we computed four common metric scores: (1) Pearson correlation coefficient (PCC), (2) Spearman correlation (SCC), (3) cross entropy (CE), and (4) residual mean squared error (RMSE) (Fig. 2a). Moreover, we also evaluated the deconvolution performance at each cell type using PCC and RMSE across samples (Fig. 2b; Additional file 1: Figs. S11-15).\n\nFor the qualitative analyses on the cancer datasets, the bulk RNA-seq datasets for pancreatic cancer (PAAD) and breast cancer (BRCA) datasets from TCGA were downloaded from the GDC data portal (https://portal.gdc.cancer.gov/). Similarly, bulk RNA-seq data from the pancreas of a cohort of 89 normal and diabetic individuals was obtained from GSE50244.\n\nImplementation of the existing deconvolution methods\n\nWe compared GTM-decon with other state-of-the-art methods, including BSEQ-sc, BISQUE, MuSiC, CIBERSORTx, and BayesPrism. For BSEQ-sc, marker genes were selected from CellmarkerDB for the brain and immune datasets, while the built-in pancreatic marker genes were used for the Segerstolpe dataset. BISQUE requires at least two paired reference bulk and reference single-cell samples, which is the case for the Segerstolpe dataset. When using human blood cell (HBC) scRNA-seq data as a reference, in order to use BISQUE, artificial bulk samples were constructed using single-cell data. For the other 3 bulk datasets, since we used only one scRNA-seq reference, we left out BISQUE from the evaluation. For CIBERSORTx, all genes were provided to the web portal (https://cibersortx.stanford.edu/) for Signature Matrix generation and Cell Fraction imputation. For BayesPrism, all genes were provided to the web portal (https://www.bayesprism.org/) for cell type composition estimation, with the metadata column for tumor status set to 0 for all cells.\n\nPreprocessing the reference scRNA-seq data\n\nThe gene expression profiles of scRNA-seq data were used as training data. Since the performance of GTM-decon may vary depending on how the scRNA-seq count data are processed, we explored different gene selection and transformations of the scRNA-seq data. Specifically, the following gene selection were considered:\n\n(i)\n\nall: all genes without removal of any gene;\n\n(ii)\n\npp: preprocessed genes to remove uninformative genes (frequently expressed genes—found in ≥ 80% of cells, infrequently expressed genes—found in ≤ 5 cells);\n\n(iii)\n\nhvg: highly variable genes identified using the highly_variable_genes (HVG) function of scanpy [65].\n\nFurthermore, for each of these gene sets, the following transformation were considered:\n\n(i)\n\nraw count (all / pp / hvg)—scRNA-seq read counts per gene;\n\n(ii)\n\nnormr (all_normr / pp_normr / hvg_normr)—normalize counts (while excluding highly expressed genes for calculating the normalization factor) as counts divided by the sum of counts per cell multiplied by a scaling factor of 10,000 (a commonly used factor for scRNA-seq data [66]), and round the values to their nearest integer to make the input suitable for topic modeling;\n\n(iii)\n\nnormr_log1p (all_normr_log1p / pp_normr_log1p / hvg_normr_log1p): log-transform normalized counts in (ii), and round the values to their nearest integer to make the input suitable for topic modeling.\n\nGene set enrichment analysis (GSEA)\n\nGSEA was performed using the fgsea package from R, on two different gene sets: (a) gene sets corresponding to specific cell types from CellMarkerDB [30]; (b) gene set corresponding to the HALLMARK pathways from MSigDb using msigdbr [67].\n\nSurvival analysis\n\nFor TCGA datasets, after cell-type proportions are inferred using GTM-decon, survival analysis is performed using the survival and survminer R packages in order to assess if there is any correlation between survival probability of the cancer subjects and cell-type proportions for the cell types. Kaplan–Meier curves were generated for those cell types, where the association is deemed statistically significant at p-value < 0.05 based on log-rank test.\n\nLearning phenotype-specific gene signatures from bulk RNA-seq data\n\nTo identify phenotype-specific genes, we applied GTM-decon to directly infer phenotype-topics from the sparsified bulk RNA-seq data (Fig. 1b). To evaluate phenotype prediction accuracy, we randomly split the bulk RNA-seq samples into training and test datasets in 80:20 ratio. The training dataset is guided in a manner similar to GTM-decon for the scRNA-seq datasets. Briefly, for each subject, the hyperparameter(s) for the topic(s) corresponding to the observed phenotype was (were) set to the prior value of 0.9, and the hyperparameters for the rest of the topics were set to a small value between 0.01 and 0.1. Since a model of 5 topics per cell type worked well for several scRNA-seq datasets, we opted to model each phenotype by 5 topics as well. For the subjects in the 20% test data, we summed up the inferred phenotype mixture \\({\\theta }_{d,k}\\) values for all topics corresponding to the same phenotype. The predicted phenotype was the one with the highest summed up topic score. As a comparison, we also evaluated two other common machine learning methods namely logistic regression and random forest. We used their scikit-learn implementations with the default settings [68].\n\nIdentifying CTS DE genes from bulk transcriptomes from nested-guided topics\n\nIn identifying phenotype-specific differentially expressed genes, we developed a way to leverage the CTS topics inferred from the scRNA-seq reference data by fine-tuning the CTS topics based on gene expression from the sparsified bulk RNA-seq data for different phenotypes (Fig. 1c). Specifically, we initialized the genes-by-topic matrix \\({\\Phi }_{d}\\) for each phenotype d. For example, for \\(D=3\\) phenotypes in a tissue with \\(K=5\\) cell types, we will have 15 topics, comprising of 3 sets of CTS \\({\\Phi }_{\\mathrm{d}}\\) matrices of 5 columns each. These matrices are guided by the phenotype labels during the variational inference.\n\nFor subject j, suppose his/her phenotype label is d \\(d\\in \\{1,..,D\\}\\). The topic hyperparameters \\({\\alpha }_{j,d,k}\\)’s for all the K topics corresponding to the phenotype label d were set to 0.9, and the \\({\\alpha }_{j,{d}{\\prime},k}\\) for the other phenotypes were set to a small value between 0.01 and 0.1. These values were propagated throughout the variational inference, guiding the phenotypic inference appropriately. The inference algorithm is identical to the one described in “Modeling scRNA-seq reference data via topic inference guided by cell-type labels” section for modeling the scRNA-seq data. This approach also works with single-cell transcriptomes from a disease study such as the single-cell breast cancer study, where we not only have the cell type information but also phenotype states of the subjects (i.e., ER + vs TNBC) (Additional file 1: Section S8 and Fig. S30).\n\nFrom the learned matrix, the test statistic of a DE candidate gene g between phenotypes d and \\({d}{\\prime}\\ne d\\) per cell type k were identified by subtracting the \\({\\phi }_{g,d,k}\\) value for phenotype \\(d\\) from the \\({\\phi }_{g,{d}{\\prime},k}\\) value for phenotype \\({d}{\\prime}\\). We identify statistically significant genes with a p-value < 0.05 by permutation test calculated from the 100,000 randomly shuffled \\({\\Phi }_{d}\\) matrices. The p-value is the fraction of times the null statistic from the permutations is greater than the observed test statistic. As a reference, we compared our approach against the DE genes identified from the same samples using DESeq2 [64]. We identified hallmark pathways from MSigDb which were enriched for the DE genes by Over Representation Analysis (ORA) using the ClusterProfiler package from R [69]."
    }
}