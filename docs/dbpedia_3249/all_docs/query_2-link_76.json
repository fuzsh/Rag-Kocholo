{
    "id": "dbpedia_3249_2",
    "rank": 76,
    "data": {
        "url": "https://www.tech-recipes.com/windows/batch-file-programming/batch-file-converting-of-video-files-sagetv-example/",
        "read_more_link": "",
        "language": "en",
        "title": "Batch File Converting of Video Files: SageTV Example",
        "top_image": "https://www.tech-recipes.com/wp-content/uploads/2022/03/logo-v2.png",
        "meta_img": "https://www.tech-recipes.com/wp-content/uploads/2022/03/logo-v2.png",
        "images": [
            "https://www.tech-recipes.com/wp-content/uploads/2024/01/tech-recipes-logo.png",
            "https://www.tech-recipes.com/wp-content/uploads/2024/01/tech-recipes-logo.png",
            "https://www.tech-recipes.com/wp-content/uploads/2024/01/tech-recipes-logo.png",
            "https://secure.gravatar.com/avatar/745dd3615e19da3826a48594f9c54833?s=96&d=mm&r=g",
            "https://secure.gravatar.com/avatar/745dd3615e19da3826a48594f9c54833?s=96&d=mm&r=g",
            "https://secure.gravatar.com/avatar/745dd3615e19da3826a48594f9c54833?s=117&d=mm&r=g",
            "https://secure.gravatar.com/avatar/745dd3615e19da3826a48594f9c54833?s=117&d=mm&r=g",
            "https://www.tech-recipes.com/wp-content/uploads/2024/01/tech-recipes-logo.png",
            "https://www.tech-recipes.com/wp-content/uploads/2024/01/tech-recipes-logo.png",
            "https://images.dmca.com/Badges/dmca-badge-w100-2x1-03.png?ID=1cec11c6-1b53-4289-bfa4-04f61a0ca739",
            "https://images.dmca.com/Badges/dmca-badge-w100-2x1-03.png?ID=1cec11c6-1b53-4289-bfa4-04f61a0ca739"
        ],
        "movies": [
            "%%i.%oFile%"
        ],
        "keywords": [],
        "meta_keywords": [
            ""
        ],
        "tags": null,
        "authors": [
            "Jimmy S"
        ],
        "publish_date": "2006-04-08T19:12:56+00:00",
        "summary": "",
        "meta_description": "I used to run SageTV as my PVR front-end but have later decided to switch to MCE2005 due to its cleanness and integration into XP. Anyway, in that time, I found a For statement batch file I used to create my own script to auto-encode video. After playing with For statements for quite some time, […]",
        "meta_lang": "en",
        "meta_favicon": "https://www.tech-recipes.com/wp-content/uploads/2022/03/logo-v2.png",
        "meta_site_name": "",
        "canonical_link": "https://www.tech-recipes.com/windows/batch-file-programming/batch-file-converting-of-video-files-sagetv-example/",
        "text": "I used to run SageTV as my PVR front-end but have later decided to switch to MCE2005 due to its cleanness and integration into XP. Anyway, in that time, I found a For statement batch file I used to create my own script to auto-encode video. After playing with For statements for quite some time, I realized that it could be used for so much more!\n\nRequirements:\n\n-Windows XP (any flavor) or 98 (I believe the statements will read fine.)\n\n-Basic understanding of .bat files\n\n-Full batch file contents for converting in sagetv (http://forums.sagetv.com/forums/showthread.php?t=10709)\n\nOverview:\n\nThis tech-recipe is another of my sagetv/htpc based ones, but it also can be used for much more! This tutorial will explain how to use a For statement in a way you never thought you could. For statements can allow one to send data to apps via command line (if they support this), move data, create webportals, and more!\n\nAlso, I have included my own date parsing code. It is handy to have and hard to find on the web..\n\nDate Code:\n\nUsage: use in any batch file you need to use the current date in a MMDDYYYY format; can be called in script by %date; place in beginning of script\n\n@REM parses month, day, and year into mm, dd, yyyy formats to create folders\n\nFOR /F “TOKENS=1* DELIMS= ” %%A IN (‘DATE/T’) DO SET CDATE=%%B\n\nFOR /F “TOKENS=1,2 eol=/ DELIMS=/ ” %%A IN (‘DATE/T’) DO SET mm=%%B\n\nFOR /F “TOKENS=1,2 DELIMS=/ eol=/” %%A IN (‘echo %CDATE%’) DO SET dd=%%B\n\nFOR /F “TOKENS=2,3 DELIMS=/ ” %%A IN (‘echo %CDATE%’) DO SET yyyy=%%B\n\nSET date=%mm%%dd%%yyyy%\n\n____________________\n\nHere is a simple example of a For statement that will be used in this tutorial.\n\n@echo on\n\n@REM Seamonkey420's SageTV Batch File - MPG to WMV\n\n@REM created on: 3/14/05\n\n@REM RECOMMENDED TO TEST IN A TEMP DIR FIRST\n\n@REM Setup as is; it will encode mpg to divx, then\n\n@REM clean up the log, txt, ccno and VPrj files\n\n@REM Then moves the avi file to a new folder (odir)\n\n@REM Then finally deletes the original mpg\n\n@REM 3/15/05: Added creation of subfolders with date encoded\n\n@REM and also allows date variable to be globally available\n\n@REM and added in cleanup of orphan files\n\n@REM 3/19/05: Updated date parsing/folder to be more accurate\n\n@REM also added in new functionality to create an embeded webpage\n\n@REM for each movie file created, is created in the same folder as\n\n@REM avi is encoded to!\n\n@REM 3/27/05: Updated batch now to create a log file of any .wmv or the filetype your\n\n@REM encoding your movies to prior to encoding, then checks to see if log file exists, if so,\n\n@REM skips the file so you do not have to waste time re-encoding movies you have already encoded.\n\n@REM 4/5/2005: Added PSP Video 9 integration; Requires PSPvideo9 be set up for auto-converting\n\n@REM Must have Videora installed or this folder created(C:\\Program Files\\Videora)\n\n@REM moves original mpgs to new psp folder defined in pdir variable.\n\n@REM Be sure to put this batch file in the same folder as your Virtualdub.exe/windows media encoder folder\n\n@REM ALSO Be sure to create a .vcf settings file in Virtualdub or .prx profile in windows media encoder\n\n@REM This file then needs to be saved in the same folder as virtualdub.exe/wme and this batch file\n\n@REM And the embedE.txt, embedS.txt, ndexE, indexS, TVindexE, TVindexS text files\n\n@REM need to be created in this same directory/folder\n\n@REM PSPvideo9 can then autoconvert files later in day! Added for my PSP!! moves the movie to a new folder for psp video to look for!\n\n@REM Be sure to setup PSP Video9 with videora (note, you only need the folder for it create and have settings in psp video 9\n\n@REM look for this location: C:\\Program Files\\Videora , just make that folder if you don't want to install videora\n\n@REM parses month, day, and year into mm , dd, yyyy formats to create folders off of!\n\nFOR /F \"TOKENS=1* DELIMS= \" %%A IN ('DATE/T') DO SET CDATE=%%B\n\nFOR /F \"TOKENS=1,2 eol=/ DELIMS=/ \" %%A IN ('DATE/T') DO SET mm=%%B\n\nFOR /F \"TOKENS=1,2 DELIMS=/ eol=/\" %%A IN ('echo %CDATE%') DO SET dd=%%B\n\nFOR /F \"TOKENS=2,3 DELIMS=/ \" %%A IN ('echo %CDATE%') DO SET yyyy=%%B\n\nSET date=%mm%%dd%%yyyy%\n\n@REM SETS SCRIPT VARIABLES, ie folder paths for files to be encoded\n\n@REM idir = the directory that sageTV saves mpg recordings to\n\n@REM odir = folder where wmv files will be saved and webpages\n\n@REM oFile = File extension to be outputted, .wmv by default\n\n@REM ldir = Log file directory\n\n@REM trigger = file to check for to see if programs are done recording/viewed\n\n@REM pdir = Folder where original mpg gets moved if encoded correctly! for use w/\n\n@REM PSP Video 9 and autoconvert feature\n\nset idir=T:\\Recorded Shows\n\nset odir=T:\\Encoded Shows\n\nset oFile=wmv\n\nset profile=psp.prx\n\nset ldir=T:\\Recorded Shows\\Log\n\nset trigger=VPrj\n\nset pdir=T:\\Recorded Shows\\PSP\n\n@REM This line checks for a .VPrj file in the idir location.\n\n@REM If it finds the file, it will first create a folder with todays date using mmddyyyy format\n\n@REM into the odir folder and it will then call virtualdub/cscript (windows media encoder) w/the parameters\n\n@REM and the .vcf/.prx profile and encode the mpg into avi/wmv, (a more streamable format than divx)\n\nfor /f \"tokens=1 delims=.\" %%i in ('dir /s/b \"%idir%\\*-?.%trigger%\"') do if EXIST \"%%i.mpg\" (md \"%odir%\\%date%\") 2>&1\n\n@REM Newly added, creates log files for existing movies in the logdir folder\n\n@REM Then checks for log file, if log file exists, it will not encode the mpg, but if it does, it will.\n\nfor /f \"tokens=4 delims=\\.\" %%i in ('dir /s/b \"%odir%\\*-?.%oFile%\"') do if NOT EXIST \"%ldir%\\*%%i.log\" (echo exists > \"%ldir%\\%%i.log\")\n\nfor /f \"tokens=1 delims=.\" %%i in ('dir /b \"%idir%\\*-?.%trigger%\"') do if NOT EXIST \"%ldir%\\%%i.log\" (cscript.exe wmcmd.vbs -input \"%idir%\\%%i.mpg\" -description \"%%i\" -author \"seamonkey420\" -output \"%idir%\\%%i.%oFile%\" -loadprofile %profile%)\n\n@REM this section cleans up the old files and moves the avi to the odir\\date folder\n\nfor /f \"tokens=1 delims=.\" %%i in ('dir /b \"%idir%\\*-?.%oFile%\"') do if EXIST \"%idir%\\%%i.%oFile%\" (move \"%idir%\\%%i.%oFile%\" \"%odir%\\%date%\\%%i.%oFile%\")\n\nfor /f \"tokens=1 delims=.\" %%i in ('dir /b \"%odir%\\%date%\\*-?.%oFile%\"') do if EXIST \"%odir%\\%date%\\%%i.%oFile%\" (del \"%idir%\\%%i.log\")\n\nfor /f \"tokens=1 delims=.\" %%i in ('dir /b \"%odir%\\%date%\\*-?.%oFile%\"') do if EXIST \"%odir%\\%date%\\%%i.%oFile%\" (del \"%idir%\\%%i.txt\")\n\nfor /f \"tokens=1 delims=.\" %%i in ('dir /b \"%odir%\\%date%\\*-?.%oFile%\"') do if EXIST \"%odir%\\%date%\\%%i.%oFile%\" (del \"%idir%\\%%i.%trigger%\")\n\nfor /f \"tokens=1 delims=.\" %%i in ('dir /b \"%odir%\\%date%\\*-?.%oFile%\"') do if EXIST \"%odir%\\%date%\\%%i.%oFile%\" (del \"%idir%\\%%i.ccno\")\n\n@REM This line move the original mpg movie if the avi/wmv is created and moved successfully to the psp directory for PSP Video 9 to encode!\n\n@REM I would @REM this line when testing! NOTE, do your deleting in sagetv, batch shouldn't re-encode already encoded files!\n\n@REM NEED TO FIX MOVING PART!!\n\nDEL /Q \"%pdir%\\*.*\"\n\nfor /f \"tokens=1 delims=.\" %%i in ('dir /b \"%idir%\\*-?.%trigger%\"') do if NOT EXIST \"%ldir%\\%%i.log\" (COPY \"%idir%\\%%i.mpg\" \"%pdir%\\%%i.mpg\")\n\n@REM Remove the @REM from the line below to delete the movie if its been encoded. Defaulted to not delete.\n\n@REM for /f \"tokens=1 delims=.\" %%i in ('dir /b \"%idir%\\*-?.%trigger%\"') do if NOT EXIST \"%ldir%\\%%i.log\" (DEL /Q \"%idir%\\%%i.mpg\")\n\n@REM These lines create a web page for each movie encoded, embeds into page, play movie from page!\n\n@REM NOTE! this again requires the embedE.txt and the embedS.txt to be located in the same folder\n\n@REM as windows media encoder, this batch file, and the .prx profile (usually, C:\\Program Files\\Windows Media Components\\Encoder )\n\n@REM Also creates an index.html with links to all html embedded pages in the %date% folder (ie 03192005\\index.html)\n\n@REM And finally a shows_index.html in the root of the odir (all pages are linked together, so easy to use for your webserver!)\n\n@REM Files are linked! Test before using, like always!\n\nfor /f \"tokens=1 delims=.\" %%i in ('dir /b \"%odir%\\%date%\\*-?.%oFile%\"') do if EXIST \"%odir%\\%date%\\%%i.%oFile%\" (type embedS.txt > \"%odir%\\%date%\\%%i.html\")\n\nfor /f \"tokens=1 delims=.\" %%i in ('dir /b \"%odir%\\%date%\\*-?.%oFile%\"') do if EXIST \"%odir%\\%date%\\%%i.%oFile%\" (echo ^ >> \"%odir%\\%date%\\%%i.html\")\n\nfor /f \"tokens=1 delims=.\" %%i in ('dir /b \"%odir%\\%date%\\*-?.%oFile%\"') do if EXIST \"%odir%\\%date%\\%%i.%oFile%\" (echo ^^ >> \"%odir%\\%date%\\%%i.html\")\n\nfor /f \"tokens=1 delims=.\" %%i in ('dir /b \"%odir%\\%date%\\*-?.%oFile%\"') do if EXIST \"%odir%\\%date%\\%%i.%oFile%\" (type embedE.txt >> \"%odir%\\%date%\\%%i.html\")\n\nfor /f \"tokens=1 delims=.\" %%i in ('dir /b \"%odir%\\%date%\\*-?.html\"') do if EXIST \"%odir%\\%date%\\%%i.html\" (type TVindexS.txt > \"%odir%\\%date%\\index.html\")\n\nfor /f \"tokens=1 delims=.\" %%i in ('dir /b \"%odir%\\%date%\\*-?.html\"') do if EXIST \"%odir%\\%date%\\%%i.html\" (echo ^%%i^^\n\n>> \"%odir%\\%date%\\index.html\")\n\nfor /f \"tokens=1 delims=.\" %%i in ('dir /b \"%odir%\\%date%\\*-?.html\"') do if EXIST \"%odir%\\%date%\\%%i.html\" (type TVindexE.txt >> \"%odir%\\%date%\\index.html\")\n\n@REM Creates an shows_index.html file, points to the individual tv show indexes created for each date\n\nfor /f \"tokens=1 delims=\" %%i in ('dir /b \"%odir%\\*\"') do if EXIST \"%odir%\\%%i\\index.html\" (del \"%odir%\\shows_index.html\")\n\nfor /f \"tokens=1 delims=\" %%i in ('dir /b/Ad \"%odir%\\*\"') do if EXIST \"%odir%\\%%i\\index.html\" (type indexS.txt > \"%odir%\\shows_index.html\")\n\nfor /f \"tokens=1 delims=\" %%i in ('dir /b/Ad \"%odir%\\*\"') do if EXIST \"%odir%\\%%i\\index.html\" (echo ^\n\n^^%%i - Show Listings^^^\n\n>> \"%odir%\\shows_index.html\")\n\nfor /f \"tokens=1 delims=.\" %%i in ('dir /b \"%odir%\\%date%\\*-?.html\"') do if EXIST \"%odir%\\%date%\\index.html\" (echo ^-%%i^^\n\n>> \"%odir%\\shows_index.html\")\n\nfor /f \"tokens=1 delims=\" %%i in ('dir /b/Ad \"%odir%\\*\"') do if EXIST \"%odir%\\%%i\\index.html\" (type indexE.txt >> \"%odir%\\shows_index.html\")\n\n@REM Cleans up any orphaned files, looks to see if there the mpg exists, if not, deletes the\n\n@REM orphaned files\n\nfor /f \"tokens=1 delims=.\" %%i in ('dir /b \"%idir%\\*-?.txt\"') do if NOT EXIST \"%idir%\\%%i.mpg\" (del \"%idir%\\%%i.log\")\n\nfor /f \"tokens=1 delims=.\" %%i in ('dir /b \"%idir%\\*-?.txt\"') do if NOT EXIST \"%idir%\\%%i.mpg\" (del \"%idir%\\%%i.ccno\")\n\nfor /f \"tokens=1 delims=.\" %%i in ('dir /b \"%idir%\\*-?.txt\"') do if NOT EXIST \"%idir%\\%%i.mpg\" (del \"%idir%\\%%i.VPrj\")\n\nfor /f \"tokens=1 delims=.\" %%i in ('dir /b \"%idir%\\*-?.txt\"') do if NOT EXIST \"%idir%\\%%i.mpg\" (del \"%idir%\\%%i.txt\")\n\n@REM This will then call windows media encoder script to then broadcast all the newly encoded files!\n\n@REM Commented out for now; delete the @REM to use!\n\n@REM for /f \"tokens=1 delims=.\" %%i in ('dir /b \"%bdir%\\*-?.%filetype%\"') do if EXIST \"%bdir%\\%%i.%filetype%\" (cscript.exe wmcmd.vbs -input \"%bdir%\\%%i.%filetype%\" -author seamonkey420 -description %%i -broadcast %port% -loadprofile tvshows.prx)\n\nThis is a crazy-looking batch file, yet its not as complex as it may seem. This file will basically allow one to check a dir for a file, if it exists. It will then run a series of commands on the files: encode to wmv, create a webportal structure with embedded Windows Media Player in them, and also move files and cleanup files.\n\nI have explained each line with a remark. This code heavily uses variables, so that way, you can make changes to it very easily without it breaking. You can change the file type your are using as your source file or the file extension your encoding to and of course folder locations.\n\nI have used the for statement to check for the existence of files. However one could set it up to be run manually or called by windows scheduler.\n\n____\n\nNOTE: the readme I include with the version at sage.tv’s forums boards.\n\nget all of the files for batch file here:\n\nhttp://forums.sagetv.com/forums/showthread.php?t=10709\n\nOverview: Well, it is amazing what a little time, thinking, discussing, and testing can accomplish. I know that currently ajuhawk has created an application to do most of this and more, but I am a fan of the batch file still, so here is the latest of my batch files.\n\nNotes: This DOES NOT handle compression in SageTV. Movies/shows may be encoded more than once if compression is used.\n\nInstallation:\n\nRequired Programs:\n\n-SageTV\n\n-Cayars Ultimate STV installed\n\n-Windows Media Encoder 9 (click to go to download page)\n\n-PSP Video 9 (http://pspvideo9.com)\n\n-Videora (http://videora.com )\n\n_________\n\nWhere to Put Files\n\n-wme.bat put in Windows Media Encoder folder (i.e., C:\\Program Files\\Windows Media Components\\Encoder)\n\n-psp.prx or whatever you call your Windows Media Encoder profile; put in Windows Media Encoder folder (i.e., C:\\Program Files\\Windows Media Components\\Encoder)\n\n-All the .txt files (i.e., embedS.txt, embedE.txt, indexS.txt, etc.) Put this in Windows Media Encoder folder (i.e., C:\\Program Files\\Windows Media Components\\Encoder).\n\n-Put the Encode.cmd into your cayars\\external folder (i.e., C:\\Program Files\\Frey Technologies\\SageTV\\STVs\\OriginalV2\\cayars\\External )\n\n_________\n\nFiles That Need to Be Modified\n\n-wme.bat\n\nYou will need to change the idir and the odir parameters.\n\nThe idir is the location where sagetv saves your TV recordings.\n\nThe odir contains the locations where you want to save your encoded files. (Note: This batch will create a new folder in this directory with the date stamp mmddyyyy format)\n\nHere are the parameters that can be changed/need (with examples) and to what they refer:\n\nset idir=T:\\Recorded Shows (where sagetv saves the mpgs of tv shows)\n\nset odir=T:\\Encoded Shows (where you want to create your encoded tv show webportal)\n\nset oFile=wmv (file type you want to encode to)\n\nset profile=psp.prx (windows media player profile to use)\n\nset ldir=T:\\Recorded Shows\\Log (location of log folder, be sure to create it before running)\n\nset trigger=VPrj (main trigger file )\n\nset pdir=T:\\Recorded Shows\\PSP (location that PSP Video 9 looks for movies to auto-convert)\n\nAlso, if you want to have the batch search for a different file type to trigger the encoding, you can do so here. By default, I have it set to look for a .VPrj file.\n\n-.txt files\n\nModify these files to your liking. I would suggest to run the script/batch first and see how things look. These files are basically templates. I have my batch use to create the webpages and embed the movie into a webpage.\n\n-Encode.cmd (put and located in C:\\Program Files\\Frey Technologies\\SageTV\\STVs\\OriginalV2\\cayars\\External)\n\nEdit this batch so that it points to where the wme.bat is saved (C:\\Program Files\\Windows Media Components\\Encoder\\wme.bat).\n\n-Then once you have all of this done, in Cayars Ultimate STV.\n\nyou can add a menu item to point to this file.\n\n-Right-click in the menu/submenu where you want to add the encoding option.\n\n-Choose Add New Menu Item > External Program.\n\n-Then, for the external program, use cmd.exe.\n\n-For arguments/parameters, use /C “C:\\Program Files\\Frey Technologies\\SageTV\\STVs\\OriginalV2\\cayars\\External\\Encode.cmd”\n\n(You can copy this line, and then use the Paste From Clipboard option.)\n\n-Then enter the menu title/text to show the following: i.e., Encode and Publish\n\n-Then once you are done, right-click again and now Save Menu Definition File.\n\nHopefully, you should now be able to just click the option, and the encoding will start automatically in the background.\n\n________\n\nHere is exactly what the batch does:\n\n1. In sagetv, click the new menu item we added that points to the batch/encode script.\n\n2. This calls our wme.bat script. This script does it all!\n\n3. First, it creates a new folder and is created with the current date mmddyyyy (i.e., 03192005)\n\n4. It then will check for a .VPrj file in the idir.\n\n5. If it finds one, it will then check the log file folder for a log. If not,\n\n6. it will then go and encode all the mpg movies that have a .VPrj file using Windows Media Encoder and the profile we saved in the psp.prx.\n\n7. Once it finishes encoding the .VPrj, it will go back and then create a webpage file .html with the show name/episode (i.e., FamilyGuyFunnyDay-3.html) in the folder that was created (i.e. 03192005/FamilyGuyFunnyDay-3.html).\n\n8. After the embedded webpage is created, it will go back and then create a main index.html file for that folder (i.e., 03192005\\index.html).\n\n9. After the date index is created, another index is then created with links to all of the index.html files that might exist.\n\n10. Finally, once this is done, the batch will go back and clean up all of the files assocated with the newly encoded wmv (i.e., ccno, txt, log, etc.) if it successfully encoded. Also, move the mpg to the psp folder (for psp video to auto-convert later).\n\nHowever, if the encoding of the mpg failed, the original mpg is left alone.\n\n11. Then it will do some quick orphaned file cleanup."
    }
}