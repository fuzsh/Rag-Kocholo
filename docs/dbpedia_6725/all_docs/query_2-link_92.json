{
    "id": "dbpedia_6725_2",
    "rank": 92,
    "data": {
        "url": "https://www.neowin.net/forum/topic/1188511-sonicwall-dmzvpn-between-multiple-locations/",
        "read_more_link": "",
        "language": "en",
        "title": "Sonicwall DMZ/VPN between multiple locations.",
        "top_image": "https://cdn.neowin.com/forum/uploads/monthly_11_2013/post-14624-0-10012800-1384954957.png",
        "meta_img": "https://cdn.neowin.com/forum/uploads/monthly_11_2013/post-14624-0-10012800-1384954957.png",
        "images": [
            "https://www.neowin.net/images/orion/darkside-theme.png",
            "https://www.neowin.net/forum/uploads/monthly_2021_07/13_Veteran.svg",
            "https://www.neowin.net/forum/uploads/monthly_2021_07/13_Veteran.svg",
            "https://cdn.neowin.com/forum/uploads/team_badge-member.png",
            "https://neowin.s3.amazonaws.com/forum/uploads/pip_leet.png",
            "https://www.neowin.net/images/uploaded/2015/08/steve_2008.jpg",
            "https://cdn.neowin.com/forum/uploads/monthly_2017_08/photo-14624.thumb.gif.d9189882c8661f72b1470929035ef8d7.gif",
            "https://www.neowin.net/forum/uploads/monthly_2021_07/14_GrandMaster.svg",
            "https://cdn.neowin.com/forum/uploads/monthly_2017_08/photo-14624.thumb.gif.d9189882c8661f72b1470929035ef8d7.gif",
            "https://www.neowin.net/forum/uploads/monthly_2021_07/14_GrandMaster.svg",
            "https://cdn.neowin.com/forum/uploads/team_badge-mvc.png",
            "https://www.neowin.net/forum/uploads/monthly_2021_07/13_Veteran.svg",
            "https://www.neowin.net/forum/uploads/monthly_2021_07/13_Veteran.svg",
            "https://cdn.neowin.com/forum/uploads/team_badge-member.png",
            "https://cdn.neowin.com/forum/uploads/monthly_2017_08/photo-14624.thumb.gif.d9189882c8661f72b1470929035ef8d7.gif",
            "https://www.neowin.net/forum/uploads/monthly_2021_07/14_GrandMaster.svg",
            "https://cdn.neowin.com/forum/uploads/monthly_2017_08/photo-14624.thumb.gif.d9189882c8661f72b1470929035ef8d7.gif",
            "https://www.neowin.net/forum/uploads/monthly_2021_07/14_GrandMaster.svg",
            "https://cdn.neowin.com/forum/uploads/team_badge-mvc.png",
            "https://cdn.neowin.com/forum/uploads/monthly_11_2013/post-14624-0-82948600-1384863964.png",
            "https://www.neowin.net/forum/uploads/monthly_2021_07/13_Veteran.svg",
            "https://www.neowin.net/forum/uploads/monthly_2021_07/13_Veteran.svg",
            "https://cdn.neowin.com/forum/uploads/team_badge-member.png",
            "https://cdn.neowin.com/forum/uploads/monthly_2017_08/photo-14624.thumb.gif.d9189882c8661f72b1470929035ef8d7.gif",
            "https://www.neowin.net/forum/uploads/monthly_2021_07/14_GrandMaster.svg",
            "https://cdn.neowin.com/forum/uploads/monthly_2017_08/photo-14624.thumb.gif.d9189882c8661f72b1470929035ef8d7.gif",
            "https://www.neowin.net/forum/uploads/monthly_2021_07/14_GrandMaster.svg",
            "https://cdn.neowin.com/forum/uploads/team_badge-mvc.png",
            "https://cdn.neowin.com/forum/uploads/monthly_11_2013/post-14624-0-10012800-1384954957.png",
            "https://www.neowin.net/forum/uploads/monthly_2021_07/13_Veteran.svg",
            "https://www.neowin.net/forum/uploads/monthly_2021_07/13_Veteran.svg",
            "https://cdn.neowin.com/forum/uploads/team_badge-member.png",
            "https://cdn.neowin.com/forum/uploads/monthly_2017_08/photo-14624.thumb.gif.d9189882c8661f72b1470929035ef8d7.gif",
            "https://www.neowin.net/forum/uploads/monthly_2021_07/14_GrandMaster.svg",
            "https://cdn.neowin.com/forum/uploads/monthly_2017_08/photo-14624.thumb.gif.d9189882c8661f72b1470929035ef8d7.gif",
            "https://www.neowin.net/forum/uploads/monthly_2021_07/14_GrandMaster.svg",
            "https://cdn.neowin.com/forum/uploads/team_badge-mvc.png",
            "https://www.neowin.net/forum/uploads/monthly_2021_07/13_Veteran.svg",
            "https://www.neowin.net/forum/uploads/monthly_2021_07/13_Veteran.svg",
            "https://cdn.neowin.com/forum/uploads/team_badge-member.png",
            "https://cdn.neowin.com/forum/uploads/set_resources_79/84c1e40ea0e759e3f1505eb1788ddf3c_default_photo.png"
        ],
        "movies": [],
        "keywords": [],
        "meta_keywords": [
            ""
        ],
        "tags": null,
        "authors": [
            "nicedreams"
        ],
        "publish_date": "2013-11-18T16:06:14+00:00",
        "summary": "",
        "meta_description": "I run a small I.T. shop and I have a client that I'm getting stumped on how to setup. This client runs 4 pizza shops and opened a small central corp office a few months ago. I setup a VPN between the corp office and all 4 stores with a Sonicwall TZ 205 at the corp site and TZ 105's at the remote ...",
        "meta_lang": "en",
        "meta_favicon": "",
        "meta_site_name": "Neowin",
        "canonical_link": "https://www.neowin.net/forum/topic/1188511-sonicwall-dmzvpn-between-multiple-locations/",
        "text": "I run a small I.T. shop and I have a client that I'm getting stumped on how to setup.\n\nThis client runs 4 pizza shops and opened a small central corp office a few months ago. I setup a VPN between the corp office and all 4 stores with a Sonicwall TZ 205 at the corp site and TZ 105's at the remote stores. The VPN and everything is working fine.\n\nThere is now a new online ordering system that needs to go into place. The point of sale company is stating we have to have a server that accepts the onine orders on a DMZ. Then this server on the DMZ needs to talk to the PoS server at each store without breaking PCI compliance.\n\nI'm not understanding how to do this if the PoS server at each store is on the private LAN which is also connected to the coporate VPN. There is only one port open on the DMZ server for communication, but when I call the PoS company to remote in and setup their software, they login to the DMZ server saying they can't see the store PCs on the VPN. I thought the DMZ server is not supposed to be able to see the computers on the private LAN. Wouldn't that break the protection and not pass PCI compliance?\n\nI have attached a short PDF document from the PoS company that explains what needs to be done. After trying and trying to get this working, I can't and asking the Neowin community for support.\n\nEither I just don't understand, but how can I make this work if we have a site-to-site VPN already in place? Do they mean we need 2 VPNs? I have another PDF document I can post if need more information, but it's just a dumbed down version of how to do a DMZ with two Linksys routers.\n\nOn another note with the alt setup, another way to do this is to have a DMZ server at each store location that handles the online orders. Then we use two routers to create a DMZ if you want to call it that. Of course that means the second router is the private LAN at each store and how do I VPN those together if the DMZ computer is the first router at the store with the WAN IP?\n\nFocus on the first part for help. The last paragraph is my last way out if I can figure it out, but thinking I'm going to loose my VPN and then have to purchase more servers. Thanks!\n\nTRAINING-VPNSetupTrainingGuide-291013-0839-190.pdf\n\nI appreciate the reply and effort in helping me. I don't understand how to set the rules in the Sonicwall then or maybe I'm not undestanding properly. A little more on their current setup then to help me understand.\n\n192.168.0.0/24 hqlan\n\n10.1.1.0/24 hqdmz\n\nI have 2 static WAN IPs.\n\nI have one static WAN on x1 for corporate internet (192.168.0.0).\n\nI have another static WAN on x2 setup as DMZ with NAT (10.1.1.0).\n\nI have the online ordering server on the DMZ on x2 at 10.1.1.10.\n\nThis is how you make a DMZ right? The DMZ network gets it's own internal IP via NAT or each host uses it's own static WAN IP? So these are setup like two different subnets that can't pass traffic to each other? Then you have to use port forwarding to access those services like if they were at a different location all together? This is how I'm understanding a DMZ. Two subnets that can't talk to each other directly.\n\nThis is maybe why I'm wrong and confused as how do you get the server on the DMZ to securely talk to the ordering computer within the LAN at each store via the corporate VPN?\n\n192.168.1.0/24 store1 -- vpn to 192.168.0.0\n\n192.168.2.0/24 store2-- vpn to 192.168.0.0\n\n192.168.3.0/24 store3-- vpn to 192.168.0.0\n\n192.168.4.0/24 store4-- vpn to 192.168.0.0\n\n\"Then you have to use port forwarding to access those services\"\n\nWhat? why would you be natting between rfc1918 addresses ?\n\n\"Two subnets that can't talk to each other directly.\"\n\nNo that is not what a dmz is -- a dmz is just firewalled network segment.\n\nHere is their drawing.. So what do you not understand about the rules and routing? I put up some networks so we can discuss.\n\nSo in the hq firewall/router you have rules that dmz can not create traffic into hqlan. But hqlan can create traffic into the dmz.\n\nstores can create traffic into the dmz, and depending since your not letting your stores create traffic into your hqlan you could consider them in the dmz. So your stuff in your hqdmz could create traffic into the stores.\n\nHere is how wiki defines dmz\n\nDMZ or Demilitarized Zone (sometimes referred to as a perimeter network) is a physical or logical subnetwork that contains and exposes an organization's external-facing services to a larger and untrusted network, usually the Internet. The purpose of a DMZ is to add an additional layer of security to an organization's local area network (LAN); an external attacker only has direct access to equipment in the DMZ, rather than any other part of the network. The name is derived from the term \"demilitarized zone\", an area between nation states in which military operation is not permitted.\n\nComes down to its just a network segment that is firewalled off from your normal trusted lan.. So for example you might have 20 different network segments on your lan, but nothing can create taffic into them from the internet. Your webservers sit on different segment 21, and there is firewall between your lan and your dmz.. This is all a dmz is.\n\nYou would not create port forwards between your local segments, there would be no NAT.. there is only nat between your public ip space and your rfc1918 space.\n\nAs to routing - again lost to where you don't understand such a basic setup?? Your Hqfirewall/router would have the routes to these stores networks, and if your wanting to get there he would know what 10.0.0.x address to send it too.\n\nThose store firewall/routers would say oh your coming from the dmz, ok you can talk to X on port Y.. Oh wait your coming from the hqlan - sure ok you can do the same thing.\n\nBuf the hqfirewall/router rules says oh your coming from the store to talk hqlan -- sorry. Oh you want to talk to hqdmz .x and port Y -- sure that is allowed.\n\nThere is no nat, you would only nat when you go from rfc1918 to public space (internet)\n\nThis is great, I think I'm getting somewhere.\n\nI saw you changed the subnet on the DMZ from 10.0.0.0 to 192.168.4.0 I had in the previous post. Are you saying I need to create a VPN on 10.0.0.0 or was that just a representation of the Internet?\n\nI think where I'm not understanding is how do I get the computers on the VPN to talk to the DMZ server?\n\nIf my understanding is correct (maybe I'm wrong and this is where I'm lost) the port forwarding is what gives you protection from connections from the internet. Meaning that I would host a server on a LAN subnet with NAT and all ports closed. Then I would port foward the, lets say FTP:21 port, for example without a DMZ. Then the outside only has access via that port to a service running on the inside. Then you have to rely on the security of the FTP server application to not have security issues while that port is open.\n\nIf this is the correct understanding, when I call Speedline for support after I have setup a DMZ on the Sonicwall, they complain that they can't connect to the store computers from the DMZ server. I'm figuring if I allow access from the DMZ server to a LAN/VPN computer, then I just broke that security since now if the DMZ server gets hacked, that server now has access to the LAN subnet or at least one of the store subnets since it's able to pass traffic around. Am I getting this right?\n\n\"I think where I'm not understanding is how do I get the computers on the VPN to talk to the DMZ server?\n\nWhat? Through your vpn..\"\n\nSounds like you don't have any sort of vpn setup at all. No you don't have to use 10, you can use whatever network you want for your vpn network.\n\nSounds more like your just port forwarding over the public internet or something.\n\nWhat network is your vpn?\n\nWhat is this suppose to mean\n\n192.168.1.0/24 store1 -- vpn to 192.168.0.0\n\n192.168.2.0/24 store2-- vpn to 192.168.0.0\n\n192.168.3.0/24 store3-- vpn to 192.168.0.0\n\n192.168.4.0/24 store4-- vpn to 192.168.0.0\n\nAre you saying you use a vpn network that is the same as the network your on and going too? No wonder your having a hard time understanding then.\n\nNo the 10 network I put on the drawing is not the internet - its just different network than your other network segments. Its a simple vpn transient network.\n\nCan you post the route table from your location with the lan and the dmz??\n\nSee this updated drawing where your vpn connections are on the 10 -- so this is net segment, this is just basic routing dude..\n\nSo you have 3 site to site connections to each store.. You could use all on the 10 network, or you could use all on the different network segments for each site to site vpn.\n\nSo at store 1 192.168.1.0/24 And I want to go to dmz -- what is the store ones route table look look?\n\nTo he has route table entry like this\n\n192.168.0.0/24 - 10.0.0.1\n\n192.168.4.0/24 - 10.0.0.1\n\nNow if he wants to go to other stores - he still has to route through hq router so\n\n192.168.3.0/24 - 10.0.0.1\n\nNow your HQ router would have these routes\n\n192.168.1.0/24 - 10.0.0.2\n\n192.168.2.0/24 - 10.0.0.3\n\n192.168.3.0/24 - 10.0.0.4\n\nNow stores might have routes to 192.168.0.0/24, but the firewall portion of your router/firewall would not allow that traffic. Or it might only allow specific pinholes.. Like to a printer on 192.168.0.14 on port 9100, etc..\n\nKeep in mind that the above is a simplistic version.. Your vpn connections with a site to site would normally be say a /30 so your 3 connections might be\n\n10.0.0.0/30\n\n10.0.0.4/30\n\n10.0.0.8/30\n\nSo you would have\n\n10.0.0.1 - 10.0.0.2\n\n10.0.0.5 - 10.0.0.6\n\n10.0.0.9 - 10.0.0.10\n\nSo each store route to other networks would point to the hq endpoint of the their vpn connection."
    }
}