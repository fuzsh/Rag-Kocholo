{
    "id": "dbpedia_8286_1",
    "rank": 62,
    "data": {
        "url": "https://programminghistorian.org/en/lessons/getting-started-with-mysql-using-r",
        "read_more_link": "",
        "language": "en",
        "title": "Introduction to MySQL with R",
        "top_image": "",
        "meta_img": "",
        "images": [
            "https://programminghistorian.org/gallery/getting-started-with-mysql-using-r.png",
            "https://programminghistorian.org/images/ORCIDiD_iconvector.svg",
            "https://programminghistorian.org/images/doi_icon.jpg",
            "https://programminghistorian.org/images/getting-started-with-mysql-using-r/getting-started-with-mysql-6.png",
            "https://programminghistorian.org/images/getting-started-with-mysql-using-r/getting-started-with-mysql-16.png",
            "https://programminghistorian.org/images/getting-started-with-mysql-using-r/getting-started-with-mysql-7.png",
            "https://programminghistorian.org/images/getting-started-with-mysql-using-r/getting-started-with-mysql-8.png",
            "https://programminghistorian.org/images/getting-started-with-mysql-using-r/getting-started-with-mysql-9.png",
            "https://programminghistorian.org/images/getting-started-with-mysql-using-r/getting-started-with-mysql-10.png",
            "https://programminghistorian.org/images/getting-started-with-mysql-using-r/getting-started-with-mysql-15.png",
            "https://programminghistorian.org/images/getting-started-with-mysql-using-r/getting-started-with-mysql-17.png",
            "https://programminghistorian.org/images/getting-started-with-mysql-using-r/getting-started-with-mysql-18.png",
            "https://programminghistorian.org/images/getting-started-with-mysql-using-r/getting-started-with-mysql-22.png",
            "https://programminghistorian.org/images/getting-started-with-mysql-using-r/getting-started-with-mysql-1.png",
            "https://programminghistorian.org/images/getting-started-with-mysql-using-r/getting-started-with-mysql-25.png",
            "https://programminghistorian.org/images/getting-started-with-mysql-using-r/getting-started-with-mysql-2.png",
            "https://programminghistorian.org/images/getting-started-with-mysql-using-r/getting-started-with-mysql-3.png",
            "https://programminghistorian.org/images/getting-started-with-mysql-using-r/getting-started-with-mysql-4.png",
            "https://programminghistorian.org/images/getting-started-with-mysql-using-r/getting-started-with-mysql-5.png",
            "https://programminghistorian.org/images/ORCIDiD_iconvector.svg"
        ],
        "movies": [],
        "keywords": [],
        "meta_keywords": [
            ""
        ],
        "tags": null,
        "authors": [
            "Jeff Blackadar"
        ],
        "publish_date": null,
        "summary": "",
        "meta_description": "",
        "meta_lang": "en",
        "meta_favicon": "/images/favicons/en_favicon.ico",
        "meta_site_name": "",
        "canonical_link": null,
        "text": "This lesson is for you if you want to store large amounts of data from your digital history projects in a structured manner. We will use a database called MySQL to store data.\n\nR can perform analysis and data storage without the use of a relational database. However, there are times when databases are very useful including:\n\nPlacing the results of an R script on a web site where the data can be interacted with.\n\nHandling more data than R can store in memory alone.\n\nWhen data is stored in a relational database already.\n\nWorking with the data of different entities that are related to one another. An example would be a database of soldiers of two different armies that fought a battle where we wanted to know what squad, platoon, company and brigade each soldier was part of.\n\nA further short discussion of this is on Jason A. French’s blog .\n\nBy the end of this lesson you will be able to install a database system on your computer, create a database table, store information in the table and then query the data. At the conclusion of the lesson we’ll use a query of the database to make a graph.\n\nWe are using the R computer language for the examples, but the techniques can be used with other languages such as Python.\n\nTo do this lesson you will need a computer where you have permission to install software such as R and RStudio, if you are not running that already. In addition to programming in R, we will be installing some components of a database system called MySQL which works on Windows, Mac and Linux.\n\nSome knowledge of installing software as well as organizing data into fields is helpful for this lesson which is of medium difficulty.\n\nContents\n\nIntroduction\n\nRequired Software\n\nR\n\nDownload R\n\nRStudio\n\nDownload RStudio\n\nMySQL\n\nDownloading and Installing MySQL\n\nMySQL Community Server\n\nDownload install file for MySQL Community Server\n\nInstallation of MySQL Community Server\n\nInstallation tips for a PC\n\n1. Choosing a Setup Type\n\n2. Check Requirements\n\n3. Type and Networking\n\n4. Type and Networking\n\n5. Accounts and Roles\n\n6. Windows Service\n\n7. Root password\n\nInstallation tips for a Mac\n\n1. Install MySQL Community Server\n\n2. Write down temporary password\n\n3. Change the root password for the MySQL server\n\nMySQL Workbench downloads\n\nCreate a database\n\nOpen MySQL Workbench\n\nCREATE DATABASE\n\nUSE database\n\nAdd a table\n\nAdd columns to the table\n\nAdd a user to connect to the database\n\nSchema Privileges not displaying\n\nMySQL version 8 and user Authentication Type.\n\nCreate an R Script that connects to the database\n\nConnecting to the database with a password\n\nConnecting to the database with a password stored in a configuration file\n\nCreate the .cnf file to store the MySQL database connection information\n\nStoring data in a table with SQL\n\nExplanation of the INSERT statement\n\nQuerying data in a table with SQL\n\nStoring data in a table with SQL using R\n\nClean up the test data\n\nChange the INSERT statement to use variables\n\nSQL Errors\n\nStoring a comma separated value .csv file into a MySQL database\n\nSelecting data from a table with SQL using R\n\nExplanation of the select and plot data program.\n\nResults of the select and plot data program.\n\nGoing further with MySQL\n\nConclusion\n\nCredits\n\nReferences\n\nEndnotes\n\nIntroduction\n\nMySQL is a relational database used to store and query information. This lesson will use the R language to provide a tutorial and examples to:\n\nSet up and connect to a table in MySQL.\n\nStore records to the table.\n\nQuery the table.\n\nIn this tutorial you will make a database of newspaper stories that contain words from a search of a newspaper archive. The program will store the title, date published and URL of each story in a database. We’ll use another program to query the database and look for historically significant patterns. Sample data will be provided from the Welsh Newspapers Online newspaper archive. We are working toward having a list of stories we can query for information. At the end of the lesson, we will run a query to generate a graph of the number of newspaper stories in the database to see if there is a pattern that is significant.\n\nRequired Software\n\nR, R Studio, MySQL Server and MySQL Workbench are the pieces of software required for this lesson. Notes on installing these software packages are below.\n\nR\n\nIn their lesson Basic Text Processing in R , Taylor Arnold and Lauren Tilton provide an excellent summary of the knowledge of R required for this lesson. Only basic knowledge of R is assumed. Taryn Dewar’s lesson ‘R Basics with Tabular Data’ covers how to install R and become familiar with it.\n\nDownload R\n\nYou can download R from the Comprehensive R Archive Network. Click on the link that matches your computer’s operating system. Select base to install R for the first time. Once downloaded, click on the file to run the installer.\n\nRStudio\n\nExamples in this lesson use RStudio which is software used for writing and running R programs. This lesson was done using Version 1.0.153 of RStudio.\n\nDownload RStudio\n\nDownload and install RStudio from rstudio.com. Since RStudio is open source, you can select the free version of RStudio Desktop then scroll down and click on one of the Installers for Supported Platforms that match your computer’s operating system. Once downloaded, click on the file to run the installer.\n\nMySQL\n\nSQL stands for Structured Query Language which is a set of commands used to store and retrieve information using a relational database. MySQL is a type of relational database and there are many others such as Microsoft SQL Server, IBM DB2 and Microsoft Access. This lesson uses MySQL since it is open-source, used by a large community, has a long track record and has a freely downloadable version.\n\nDownloading and Installing MySQL\n\nIn this section we are going to install MySQL, which is the system that holds the database, as well as MySQL Workbench which is where you will work to set up the structure of the database. To use MySQL, you don’t need MySQL Workbench, you can use typed commands. This lesson uses MySQL Workbench since it is a GUI that facilitates learning about MySQL.\n\nComplete these instructions to install MySQL Community Server and MySQL Workbench on your computer.\n\nMySQL Community Server\n\nThis is the server where the database is stored. It needs to be installed and started for you to connect to it and store data. Below we will download the files, install and start the server. This lesson was done using Version 5.7 of MySQL and 6.3 of MySQL Workbench.\n\nDownload install file for MySQL Community Server\n\nClick on this link: https://dev.mysql.com/downloads/mysql/. Scroll down and click to Select Operating System that matches your computer. If necessary, Select OS Version. Once you have done that click the blue Download button. On the download page, scroll down, you have the option of starting the download by clicking No thanks, just start my download.\n\nInstallation of MySQL Community Server\n\nHere are the MySQL Installation instructions: https://dev.mysql.com/doc/workbench/en/wb-installing.html\n\nBelow are tips on the installation for the PC and Mac:\n\nInstallation tips for a PC\n\nUsing the MySQL Installer for Windows is the recommended way to install the components of MySQL. Once the file is downloaded, double click on the downloaded file to install it. Follow the prompts to accept the licence. After the products are installed, you will be prompted for options:\n\n1. Choosing a Setup Type\n\nSelect: Developer Default. This installs the MySQL Server and the tools required for MySQL application development. This is useful if you intend to develop applications for an existing server. (See below)\n\n2. Check Requirements\n\nClick the Execute button if you have failing requirements listed under Check Requirements. Your list of requirements may be different than what is shown here. Once the execute process installs the missing requirements click the Next button. (See below)\n\n3. Type and Networking\n\nSelect: Standalone MySQL Server (See below)\n\n4. Type and Networking\n\nConfig type: Select: Development Machine Check: TCP/IP. Port number: 3306. (See below)\n\n5. Accounts and Roles\n\n6. Windows Service\n\nSettings here are optional, but I find it easier to set up MySQL as a Windows Service and have it start automatically. A Windows Service is a process that runs on your computer while you are working. You can change your Windows Service settings later to start the MySQL service manually so that it does not start when you don’t need it.\n\nClick the Execute and Next buttons to finish the installation and start the server.\n\n7. Root password\n\nWhen prompted for the root password, enter the root password you wrote down in step 5. Accounts and Roles above. (See below)\n\nLook in the Start menu under MySQL for MySQL Workbench. If it is there, click to launch. If not, click on MySQL Installer - Community to re-run the installation and add MySQL Workbench to the installed products.\n\nInstallation tips for a Mac\n\n1. Install MySQL Community Server\n\nOnce the MySQL Community Server install file is downloaded, double click on the downloaded file to install it. (See below)\n\n2. Write down temporary password\n\nFollow the prompts to accept the licence and installation location. Important: There will be a prompt for a temporary password. Write this down carefully. (See below for an example. Your temporary password will be different than what is shown below.) If you make an error, you can remove the installed server and reinstall it, but that is a minor hassle. One of the lesson reviewers found this StackOverflow answer helpful for this part.\n\nOnce installed, we are going to change the root password for the MySQL server.\n\n3. Change the root password for the MySQL server\n\nThis section of the lesson has caused difficulty for others. Take your time and please note that the MySQL commands end with a semicolon. Watch for them in some of the commands below.\n\n3.1. Open a terminal window\n\n3.2. Add /usr/local/mysql/bin to the PATH per the command below. The PATH is a list of directories the computer looks in when you type a command to run a program. In the next step below, when you run mysql, the PATH searches the directories it has for the mysql program. PATH finds mysql in the directory /usr/local/mysql/bin and runs it. PATH just saves typing the whole path, in this case /usr/local/mysql/bin/mysql, to a program when you want to run it.\n\n3.3. Start the MySQL server.\n\nGo to System Preferences > MySQL icon at bottom > click on “Start MySQL server”\n\n3.4. Start a MySQL session. In the command below after –password enter the password you wrote down in step 2. Write down temporary password.\n\n3.5. Set the root password to a new password. Choose and write down a new password carefully. At the mysql> prompt enter this command, replacing the password inside single quotes in the SET PASSWORD=PASSWORD(‘password’) command with the new password you have written down.\n\n3.6. Restart the machine. After restarting the machine you may need to repeat step 3.3 Start the MySQL server above.\n\nMySQL Workbench downloads\n\nClick on this link: http://dev.mysql.com/downloads/workbench/. Scroll down and click to Select Operating System that matches your computer. If necessary, Select OS Version. Once you have done that click the blue Download button. On the download page, scroll down, you have the option of starting the download by clicking No thanks, just start my download.\n\nOnce the file is downloaded, double click on the downloaded file to install it. Once the installation of MySQL Workbench is done, as per the instructions on the screen, drag the icon to the Applications folder on the left. (See below)\n\nCreate a database\n\nHere we will create a database which serves as a container for the tables we will store our information into. A table is the structure that holds the data we want to store. Tables hold many rows of records. An example record of basic contact information would contain fields for name, phone number and e-mail address. In a table, fields are organized into columns.\n\nHere is a sample table with a row of data that represents a record.\n\nname phone number e-mail address Pat Abraham 613-555-1212 pat@zmail.ca\n\nOpen MySQL Workbench\n\nOpen MySQL Workbench. Double-click on the Local Instance MySQL57. (on a Mac this may appear as Local Instance 3306.) You may be prompted for the root password created in steps above. After opening the Local Instance MySQL57 you should see a screen similar to the picture below. On some Macs, a Query Tab will already be open; if it is not, open a Query Tab by doing File > New Query Tab.\n\nCREATE DATABASE\n\nNow we will create a new database. Using MySQL Workbench perform these steps:\n\nIn the Query window type:\n\nCREATE DATABASE newspaper_search_results;\n\nRun the CREATE DATABASE command. Click on the lightning bolt or using the menu, click Query and then Execute Current Statement.\n\nThe new database newspaper_search_results should be visible under SCHEMAS, on the lower left of the screen. If you don’t already see an item called newspaper_search_results, click the refresh icon. (See screenshot below.)\n\n(See below:)\n\nUSE database\n\nNext, we will enter a USE statement to inform MySQL Workbench which database to use. This becomes more important when you have you have more than one database on your machine.\n\nIn the Query window, delete all of the CREATE DATABASE command and type:\n\nAgain, click on the lightning bolt or using the menu, click Query and then Execute Current Statement. You can also use a keyboard command for this. On Mac it is Command+Return. On a PC use Ctrl+Shift+Enter. From this point on in the lesson, each time you enter a command into the Query Window you will run it this way.\n\n(See below:)\n\nAdd a table\n\nIn MySQL Workbench, look in the left side in the Navigator panel, under SCHEMAS for newspaper_search_results.\n\nRight-click on Tables and click Create Table.\n\nfor Table Name: type tbl_newspaper_search_results\n\nAdd columns to the table\n\nAdd these columns:\n\nid Data type: INT. Click PK (Primary Key), NN (Not Null) and AI (Auto Increment). This id column will be used to relate records in this table to records in other tables.\n\nstory_title Data type: VARCHAR(99). This column will store the title of each article result we gather from the search.\n\nstory_date_published Data type: DATETIME. This column will store the date the newspaper was published.\n\nstory_url Data type: VARCHAR(99). This column will store the URL of each result we gather from the search.\n\nsearch_term_used Data type: VARCHAR(45). This column will store the word we used to search the newspapers. Click the Apply button.\n\nAll of the above steps can be done with a command if you prefer. This command could be run in the Query window to create the table with the columns noted below.\n\nTip: Take your time to think about table design and naming since a well designed database will be easier to work with and understand.\n\nAdd a user to connect to the database\n\nA user is an account that has permission to connect to a database. Below, we are adding a new user so that this account connects only to the new database. Using this user account for one connection to this database limits exposure to other databases in case the password for this user is compromised. Giving a user the least privileges it needs to perform what you need it to do reduces the risk if someone else learns your user’s password. For example, if a user can only read a database, it is less of a risk if the password is cracked than for a user that can also change or delete the database.\n\nIn the MySQL Workbench menu click Server and then Users and Privileges\n\nMac users Some Mac computers, like my testing laptop, don’t display the Schema Privileges panel correctly. See the note below the screenshot if this happens to you.\n\nClick the Add Account button and complete the Details for account newuser dialog box:\n\nLogin Name: newspaper_search_results_user\n\nAuthentication Type: select Standard\n\nLimit to Hosts Matching: localhost\n\nEnter and confirm a password SomethingDifficult\n\nClick on the Administrative Roles tab. Make sure nothing is checked. This account is for accessing the database only.\n\nClick on the Schema Privileges tab and click Add Entry\n\nIn the New Schema Privilege Definition diablog box, click the Selected schema: radio button and select newspaper_search_results.\n\nClick all of the Object Rights: SELECT, INSERT, UPDATE, DELETE, EXECUTE, SHOW VIEW as per the image below. (This user will need to do many things later in the lesson so we are giving it many rights.)\n\nClick the Apply button.\n\nSchema Privileges not displaying\n\nSome Mac computers, like my testing laptop, don’t display the Schema Privileges panel correctly. In that case, you can accomplish the above with a script using the Query Window.\n\nIf you have already created the user above run this command to grant the user privileges:\n\nIf you have not created a user yet run these two commands to create the user and then grant the user privileges:\n\nMySQL version 8 and user Authentication Type.\n\nWhen a user is created in MySQL 8 Workbench the Authentication Type is defaulted to caching_sha2_password. That type of authentication causes an error for the R package we will use to connect to the database later in this lesson. The error is Authentication plugin ‘caching_sha2_password’ cannot be loaded and it is described in Stack Overflow.\n\nTo avoid this error we can change the user’s Authentication Type to Standard. To do this, run this command:\n\nCreate an R Script that connects to the database\n\nOpen RStudio, which you installed earlier in this lesson. See the RStudio section.\n\nWe’ll now use RStudio to make a new R Script and save the script with the name newspaper_search.R. (Sometimes in this lesson I will refer to an R Script as a program.)\n\nGo to File > New File > R Script, then save that new file with the name newspaper_search.R.\n\nWe will use the RMariaDB package to connect to MySQL. (If you’re curious, documentation for the RMariaDB package is here.)\n\nIf you don’t have the library RMariaDB installed (which is likely, if this is the first time you’re using RStudio), install it using the RStudio Console. After opening RStudio, copy and paste the following into the left window at the > prompt, then press enter:\n\nAdd this statement to the newspaper_search.R program\n\nConnecting to the database with a password\n\nWe will connect to the database at first using a password. (Later we’ll use a better way to connect.) For now, we will use a variable to store the password. Each time you start R you’ll need to reset this variable, but that is better than publishing a hardcoded password if you share your programs, like you may do using GitHub.\n\nIn the RStudio console type the command below, replacing SomethingDifficult with the password you created for newspaper_search_results_user in the steps you did above to add a user to connect to the database.\n\nAdd the following R statements to your newspaper_search.R file and save it.\n\nTo run this script, select all the text and click the Run button. (There are other ways to run just a part of an R script or the whole script. If you are curious, look in the menu under Code > Run Region. CTRL+ALT+R will run all of the R code in the script.)\n\nIn the console you should see:\n\nSuccess! you have:\n\nConnected to the database with dbConnect.\n\nListed the table in the database with dbListTables.\n\nDisconnected from the database using dbDisconnect.\n\nConnecting to the database with a password stored in a configuration file\n\nThe above example to connect is one way to make a connection. The connection method described below stores the database connection information in a configuration file so that you do not have to type a password into a variable every time you start a new session in R. I found this to be a finicky process, but it is a more standard and secure way of protecting the credentials used to log into your database. This connection method will be used in the code for the remainder of this tutorial, but it can be subsituted with the simpler connection method above if you prefer.\n\nCreate the .cnf file to store the MySQL database connection information\n\nOpen a text editor, like notepad, nano or TextEdit, and paste in the items below, changing the password to the one you created for newspaper_search_results_user in the steps you did above to add a user to connect to the database.\n\n[newspaper_search_results] user=newspaper_search_results_user password=SomethingDifficult host=127.0.0.1 port=3306 database=newspaper_search_results\n\nSave this file somewhere outside of your R working directory. I saved mine in the same folder as other MySQL settings files. On my PC machine this was: C:\\ProgramData\\MySQL\\MySQL Server 5.7\\ Depending on your operating system and version of MySQL this location may be somewhere else. On a Mac I used /Users/blackadar/Documents/ as the folder. I have tested putting this file in different places, it just needs to be somewhere R can locate it when the program runs. Name the file newspaper_search_results.cnf.\n\nUpdate the newspaper_search.R program above to connect to the database using the configuration file.\n\nRun your script.\n\nIn the console, among other lines, you should see again:\n\nYou have successfully connected to the database using a configuration file.\n\nStoring data in a table with SQL\n\nIn this section of the lesson we’ll create a SQL statement to insert a row of data into the database table about this newspaper story. We’ll insert the record first in MySQL workbench and later we’ll do it in R.\n\nIn MySQL Workbench, click the icon labelled SQL+ to create a new SQL tab for executing queries.\n\nPaste this statement below into the query window. This will insert a record into the table.\n\nINSERT INTO tbl_newspaper_search_results ( story_title, story_date_published, story_url, search_term_used) VALUES('THE LOST LUSITANIA.', '1915-05-21', LEFT(RTRIM('http://newspapers.library.wales/view/4121281/4121288/94/'),99), 'German+Submarine');\n\nClick the lightening bolt icon in the SQL tab to execute the SQL statement.\n\nExplanation of the INSERT statement\n\nSQL Meaning INSERT INTO tbl_newspaper_search_results ( INSERT a record into the table named tbl_newspaper_search_results story_title, name of field to be populated by a value story_date_published, ” story_url, ” search_term_used) ” VALUES(‘THE LOST LUSITANIA.’, The value to be inserted into the story_title field ‘1915-05-21’, story_date_published field LEFT(RTRIM(‘http://newspapers.library.wales/view/4121281/4121288/94/’),99), story_url field. This field is a VARCHAR(99) so it has a maximum length of 99 characters. Inserting a URL longer than 99 characters would cause an error and so two functions are used to control for that. RTRIM() trims trailing spaces to the right of the URL. LEFT(value,99) returns only the leftmost 99 characters of the trimmed URL. This URL is much shorter than that and so these functions are here for an example only. ‘German+Submarine’); search_term_used field\n\nOptional: Modify the INSERT statement above and execute it a few more times. For example\n\nQuerying data in a table with SQL\n\nIn this section of the lesson we’ll create a SQL statement to select a row of data from the database table we just inserted. We’ll select the record first in MySQL workbench and later we’ll do it in R.\n\nPaste this statement below into a query window in MySQL workbench. This will select records from the table.\n\nSELECT story_title FROM tbl_newspaper_search_results;\n\nHighlight the SELECT statement and click the lightening bolt icon in the SQL tab to execute it. You should see the story title “THE LOST LUSITANIA.” in the Result Grid. See below.\n\nOptional: Modify the SELECT statement above by changing the fields selected and run it again. Add more than one field to the SELECT statement and run it:\n\nStoring data in a table with SQL using R\n\nLet’s do this using R! Below is an expanded version of the R Script we used above to connect to the database. For brevity, the first 3 comments we had in the R Script above are removed. We no longer need them.\n\nIn line 4 of the program below, remember to change the path to the rmariadb.settingsfile that matches your computer.\n\nIn the script above we do two steps to insert a record:\n\nDefine the INSERT statement in the line beginning with: query<-“INSERT INTO tbl_newspaper_search_results (\n\nExecute the INSERT statement stored in the query variable with: rsInsert <- dbSendQuery(storiesDb, query)\n\nRun the script above in R Studio and then execute a SELECT in MySQL Workbench. Do you see the new record you added?\n\nClean up the test data\n\nAt this point you likely have more than one record with the story title of “THE LOST LUSITANIA.” which is fine for testing, but we don’t want duplicate data. We will remove the test data and start again. Using the query window in MySQL Workbench run this SQL statement:\n\nIn the Action Output pane of MySQL Workbench you should see:\n\nTo practice what we just did:\n\nRun a SELECT statement again. You should not get any rows back.\n\nRe-run the R program above to insert a record.\n\nPerform the SELECT statement. You should see one row of data.\n\nChange the INSERT statement to use variables\n\nWe will be inserting a lot of data into the table using R, so we will change the INSERT statement to use variables. See the code below the #Assemble the query remark.\n\nLet’s test this program:\n\nRun a SELECT statement and note the rows you have.\n\nRun the R program above to insert another record.\n\nPerform the SELECT statement. You should see an additional row of data.\n\nSQL Errors\n\nLet’s create a simple error in SQL to see what happens.\n\nIn R change\n\nto\n\nand re-run the program.\n\nIn the R Console there is an error:\n\nYou can check with a SELECT statement that there is no record in the table with a story title of THE LOST LUSITANIA’S RUDDER.\n\nSingle apostrophes are part of SQL syntax and they indicate a text value. If they are in the wrong place, it causes an error. We have to handle cases where we have data with apostrophes. SQL accepts two apostrophes in an insert statement to represent an apostrophe in data (‘’).\n\nWe’ll handle apostrophes by using a gsub function to replace a single apostrophe with a double one, as per below.\n\nNow that you have handled the apostrophe in the title of the story, re-run the R program and then check with a SELECT statement in MySQL workbench.\n\nOnce you see your test record, TRUNCATE tbl_newspaper_search_results to remove this test data.\n\nStoring a comma separated value .csv file into a MySQL database\n\nIn the next part of the lesson we’ll query the database table. Our goal is to have enough data in the table to make a graph. To prepare for that let’s load some sample data from comma separated value (.csv) text files.\n\nDownload these .csv files to your R working directory. These files are stored in GitHub so download the Raw version of the files.\n\nsample-data-allotment-garden.csv This is a list of Welsh newspaper stories published during World War I that match the search terms allotment and garden.\n\nsample-data-submarine.csv This is a list of Welsh newspaper stories published during World War I that match the search terms German and submarine.\n\nIn R, execute the following read.csv() function and then see what is in the sampleData data frame.\n\nYou should see a lot of data, including what is below. Check the Environment tab on the right side of RStudio. The sampleGardenData Data Frame should contain “1242 obs. of 4 variables”.\n\nNote that in this sample data, field names are included in the header for convenience: story_title, story_date_published, story_url and search_term_used.\n\nAs noted above, our goal here is to insert the sample data that is now stored in the sampleGardenData data frame into the MySQL table tbl_newspaper_search_results. We can do this a couple different ways, including looping through each row of the data frame and executing an INSERT command like we did above. Here though, we’ll use one command to insert all of the rows in sampleGardenData at one time: dbWriteTable. Don’t run this statement yet, just read it.\n\nFunction Meaning dbWriteTable(storiesDb, Use the MySQL database connection storiesDb. value = sampleGardenData, Write the values in the sampleData data frame to the table. row.names = FALSE, No row names are specified. name = “tbl_newspaper_search_results”, Insert the values from sampleData into the table tbl_newspaper_search_results. append = TRUE ) Append these values to what is in the table already. If this program is run again, all of the rows in sampleData will be appended to the same table again.\n\nWe’re not ready to run dbWriteTable() yet, we need to connect to the database first. Here is the program to do that, as well as load sample-data-submarine.csv too. Read through this and run it.\n\nIf you run this more than once, you will have duplicate records. If that happens, just TRUNCATE the table and run the program again, but only once. You can check that you have the right number of records. In MySQL Workbench run this in the query window:\n\nYou should have a count of 2880 records. 1242 from sampleGardenData and 1638 from sampleSubmarineData.\n\nSelecting data from a table with SQL using R\n\nOur goal here is to use the table of newspaper stories we have imported and make a graph of the number of stories published in Welsh Newspapers during each month of World War I that match the search terms (allotment and garden) and (German and submarine)\n\nThe script below queries the database and produces the line graph plot below. Read through the script to see what is happening. An explanation of script follows it.\n\nExplanation of the select and plot data program.\n\nThe method to connect to the database is explained above.\n\nThis program selects two result sets of data and plots them on a graph. One of the result sets is newspaper stories matching the search German+Submarine. They are queried with this SELECT statement:\n\nSQL Meaning SELECT ( SELECT data matching the condition in the WHERE clause FROM the database table named. COUNT(CONCAT(MONTH(story_date_published),’ ‘,YEAR(story_date_published))) as ‘count’ This provides a count of the number of stories published that share the same month and year publishing date. CONCAT stands for concatenate which creates a single text value from two or more separate text values, in this case the month and the year. FROM tbl_newspaper_search_results This is the database table we’re selecting data from. GROUP BY YEAR(story_date_published),MONTH(story_date_published) This GROUP BY statement is important for the COUNT above. Here the data is grouped by month and year so that we can count all of the records in the group. ORDER BY YEAR(story_date_published),MONTH(story_date_published); This puts the result set in order by date, which is useful since we want to make a graph by date.\n\nThe statements below run the query and puts the result set rs into data frame dbRows\n\nBelow the data frame dbRows is put into a time series with the ts() function so that it can be plotted for each month, starting from August 1914.\n\nBelow, the data in the qts1 time series is plotted on a graph\n\nWhat is different about the part of the program that plots the stories matching the search “Allotment And Garden”? Not very much at all. We just use the lines() function to plot those results on the same plot we made above.\n\nResults of the select and plot data program.\n\nBelow is what the plot should look like:\n\nGoing further with MySQL\n\nIf you wanted to put a database on a website, using MySQL as the database and the PHP language to build the pages of the site is one way to do this. An example of this type of website is one I built to search issues of the Equity newspaper. Larry Ullman’s book PHP and MySQL for Dynamic Web Sites covers how to set up and connect to a database using MySQL and PHP in a hacker resistant way.\n\nFor examples of using SQL to sort and group data as well as perform calculations, see: MySQL by Examples for Beginners or MySQL’s Examples of Common Queries.\n\nConclusion\n\nI hope that you now have the knowledge to set up a database table, connect to it and store records. Although we have only scratched the surface of the different ways to query data, I also hope that you now know the technique of using SELECT statements so that you can use them in your future digital history projects.\n\nCredits\n\nI completed this lesson thanks to the support of the George Garth Graham Undergraduate Digital History Research Fellowship.\n\nThank you to Dr. Amanda Visconti for her guidance and support during the preparation of this lesson.\n\nReferences\n\nUllman, L. 2005. PHP and MySQL for Dynamic Web Sites, 2nd ed. Berkeley, Calif: Peachpit.\n\nEndnotes"
    }
}