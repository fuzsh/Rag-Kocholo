{
    "id": "wrong_mix_domainrange_subsidiary_00147_3",
    "rank": 80,
    "data": {
        "url": "https://bramwolfs.com/category/xenapp/",
        "read_more_link": "",
        "language": "en",
        "title": "BramWolfs.com",
        "top_image": "https://bramwolfs.com/wp-content/uploads/2018/03/cropped-site-icon.png?w=200",
        "meta_img": "https://bramwolfs.com/wp-content/uploads/2018/03/cropped-site-icon.png?w=200",
        "images": [
            "https://bramwolfs.com/wp-content/uploads/2013/07/graphics.jpg?w=150&h=90",
            "https://bramwolfs.com/wp-content/uploads/2016/02/mainscreen1.png?w=676",
            "https://bramwolfs.com/wp-content/uploads/2016/02/change-display-settings-on-the-fly.png?w=676",
            "https://bramwolfs.com/wp-content/uploads/2016/02/change-display-mode-on-the-fly.png?w=676",
            "https://bramwolfs.com/wp-content/uploads/2013/07/graphics.jpg?w=150&h=90",
            "https://bramwolfs.com/wp-content/uploads/2013/07/display-options-in-xd71.png?w=676&h=801",
            "https://bramwolfs.com/wp-content/uploads/2013/07/desktop_composition_graphics_quality.png?w=676",
            "https://bramwolfs.com/wp-content/uploads/2013/07/desktop-composition-redirection-wordpad-example.png?w=676",
            "https://bramwolfs.com/wp-content/uploads/2013/07/adaptive_display_off.png?w=676",
            "https://bramwolfs.com/wp-content/uploads/2013/07/thinwire_advanced__hdx_monitor_policy.png?w=676",
            "https://bramwolfs.com/wp-content/uploads/2013/07/adaptive_display_on_legacy.png?w=676",
            "https://bramwolfs.com/wp-content/uploads/2013/07/shutdown_button_legacy.png?w=676",
            "https://bramwolfs.com/wp-content/uploads/2013/07/vgx_frame_buffer_disabled_hdx_monitor.png?w=676",
            "https://bramwolfs.com/wp-content/uploads/2013/07/vgx.png?w=676",
            "https://bramwolfs.com/wp-content/uploads/2013/07/tp_maximuns_vgpu.png?w=300&h=129",
            "https://bramwolfs.com/wp-content/uploads/2013/05/left-in-the-dark.png?w=676",
            "https://bramwolfs.com/wp-content/uploads/2013/04/safe.jpg?w=676",
            "https://bramwolfs.com/wp-content/uploads/2013/04/timing.png?w=676",
            "https://bramwolfs.com/wp-content/uploads/2013/04/browsing.png?w=676",
            "https://bramwolfs.com/wp-content/uploads/2013/04/office-kat.png?w=676",
            "https://bramwolfs.com/wp-content/uploads/2013/04/run_in_memory.png?w=676",
            "https://bramwolfs.com/wp-content/uploads/2013/04/cmd_content.png?w=676",
            "https://bramwolfs.com/wp-content/uploads/2013/04/regedit.png?w=676",
            "https://bramwolfs.com/wp-content/uploads/2013/05/svchost1.png?w=676",
            "https://bramwolfs.com/wp-content/uploads/2013/05/security.png?w=676",
            "https://bramwolfs.com/wp-content/uploads/2013/04/cmd_edit_content.png?w=676",
            "https://bramwolfs.com/wp-content/uploads/2013/04/cmd_vdisk_cache.png?w=676",
            "https://bramwolfs.com/wp-content/uploads/2012/10/on-off1.jpg?w=150&h=108",
            "https://bramwolfs.com/wp-content/uploads/2012/10/workspace-control-uml.png?w=475&h=1024",
            "https://bramwolfs.com/wp-content/uploads/2012/10/session-guard2.png?w=300&h=276",
            "https://bramwolfs.com/wp-content/uploads/2012/10/receiver_for_web_workspace_control.png?w=300&h=119",
            "https://bramwolfs.com/wp-content/uploads/2012/07/print_button.jpg?w=150&h=99",
            "https://bramwolfs.com/wp-content/uploads/2012/07/follow-me-printing1.jpg?w=676",
            "https://bramwolfs.com/wp-content/uploads/2012/06/ctxvdaieinterceptorbho_xenapp1.png?w=676",
            "https://bramwolfs.com/wp-content/uploads/2012/06/ctxieinterceptorbho_receiver321.png?w=676",
            "https://bramwolfs.com/wp-content/uploads/2012/05/extra_color_compression_default.png?w=676",
            "https://bramwolfs.com/wp-content/uploads/2012/05/lossy_compression_default.png?w=676",
            "https://bramwolfs.com/wp-content/uploads/2012/05/hdx_monitor_overview.png?w=676",
            "https://bramwolfs.com/wp-content/uploads/2012/05/image_compression_not_tuned.png?w=676",
            "https://bramwolfs.com/wp-content/uploads/2012/05/windows7_flag_medium_image_compression.png?w=676",
            "https://bramwolfs.com/wp-content/uploads/2012/05/lossy_compression_custom.png?w=676",
            "https://bramwolfs.com/wp-content/uploads/2012/05/lossy_compression_low1.png?w=676",
            "https://bramwolfs.com/wp-content/uploads/2012/05/popup1.png?w=676",
            "https://1.gravatar.com/avatar/463b44a48a8e059e07df60e27debfc81b3bbb96669e632e7ab3d6867e72d7130?s=128&d=identicon&r=G",
            "https://bramwolfs.com/wp-content/uploads/2018/03/cropped-site-icon.png?w=50",
            "https://bramwolfs.com/wp-content/uploads/2018/03/cropped-site-icon.png?w=50",
            "https://pixel.wp.com/b.gif?v=noscript"
        ],
        "movies": [],
        "keywords": [],
        "meta_keywords": [
            ""
        ],
        "tags": null,
        "authors": [
            "Bram Wolfs"
        ],
        "publish_date": "2016-02-24T10:31:51+01:00",
        "summary": "",
        "meta_description": "Posts about XenApp written by Bram Wolfs",
        "meta_lang": "en",
        "meta_favicon": "https://bramwolfs.com/wp-content/uploads/2018/03/cropped-site-icon.png?w=32",
        "meta_site_name": "BramWolfs.com",
        "canonical_link": "https://bramwolfs.com/category/xenapp/",
        "text": "It’s been a while since I wrote my last blogpost, so I thought it was about time to write a follow up regarding Citrix graphics!\n\nLets get back in time first, my previous 2 blog posts about Citrix display modes are still very relevant and will give you a good overview about :\n\nAdaptive Display (about finetuning legacy graphics mode)\n\nGraphical Deepdive (about new Thinwire graphics mode)\n\nA while ago I started to write part 3 : How to configure, what to configure, when to configure. The main goal for this blog post was to give an understanding about all the display modes and related settings. Lets start with summarizing the available Citrix display modes we know today :\n\nLegacy Graphics mode (this includes the first Adaptive Display generation and the older progressive display technology)\n\nThinwire Graphics mode (this includes the new H.264 video codecs (Pure H.264 and H.264 Optimized for text) and Thinwire plus, the latter is also known as Compatibility mode)\n\nDesktop Composition Redirection (combination of Thinwire graphics and Aero\\DWM remoting to offload DirectX commands to the client)\n\nFramehawk (new graphics mode which is based on predicting technologies to optimize graphics for high latency connections (UDP based))\n\nSo the initial goal of this blogpost was to help understanding all of the policies and settings related to above display modes. When a specific setting applies and when not, etc.\n\nIn the meantime my colleague Barry Schiffer was also busy with this subject and had the idea to give a presentation together at E2EVC about the various display modes. Our goal was to give insight in the consumed resources of every display mode and help you decide which configuration would be the best fit for your environment. This is where the idea was born to develop a tool to show valuable information about the current display mode while running your remote workload in the background. This tool would be targeted to admins and not users.\n\nWhen it comes down to configuring display settings one size doesn’t fit all, so I decided to stop writing the part 3 blog post and instead build out the tool so you can experience every display mode and settings for yourself. I think this tool will make you understand the display modes and its behavior even better then only reading about it!\n\nRemote Display Analyzer\n\nSo this is how the Remote Display Analyzer project has started. The main goal of Remote Display Analyzer is to make the display modes understandable by showing only applicable information for the detected display mode. It helps you decide which configuration fits best in your environment and will help you detect miss configured settings and resource bottlenecks.\n\nImagine to take place behind your old thin client (which for example can’t be replaced because of tight budgets) and detect at which display configuration the user experience is optimal and in balance with the resource allocation. Or to check at which settings your branch office performance best, or just to get a better understanding about the behavior of a given display mode. Sounds great right?\n\nOver time the project evolved in much more then only showing you real-time information that matters, Remote Display Analyzer is also able to show you which settings you can change and change them on the fly!\n\nThis makes it possible to run your remote workload in the background and flip settings to get a deeper understanding of what is happening in real-time without having to logoff and configure different policies by yourself etc. Because the naming of the settings are the same as you find in the policies it’s easy to replicate the optimal settings in your production environment.\n\nBesides live switching through settings, Remote Display Analyzer is also able to switch between display modes. For example you can live switch between Thinwire and Framehawk and from Thinwire to Desktop Composition Redirection(DCR) and vice versa when your client and VDA supports it.\n\nEnough talking try it for yourself, hopefully you like it!\n\nAvailability\n\nRemote Display Analyzer is available in 2 editions :\n\nLite edition, which gives you the ability to view display settings and real-time analytics\n\nSponsored edition, which provides all the functionality of Remote Display Analyzer like changing settings on the fly and advanced settings\n\nOf course I hope to welcome you as sponsor of the project to even add more functionality in the future and to keep Remote Display Analyzer up to date. For more information about sponsoring and downloading Remote Display Analyzer please visit the website : www.rdanalyzer.com.\n\nThanks for reading!\n\nMake sure to also check this blogpost about a very handy tool named Remote Display Analyzer\n\nA graphical deep dive into XenDesktop 7\n\nIntro\n\nA while ago I wrote an article about Adaptive Display and how it can be fine tuned. Well Adaptive Display as we know it hasn’t seen the light for a very long time because a lot has been changed in XenDesktop 7. In this blog post I will describe this changes and dig deeper in the configurable options related to graphics in XenDesktop 7.\n\nAdaptive Display First generation = Legacy Graphics mode\n\nIn a short time frame a lot have changed in the delivery of graphics, users are demanding more media content, higher frame rates and a fluid user experience. While Progressive display did a very good job for a long time, it required a lot of manual tuning to accommodate different use cases, because of this it was often misconfigured resulting in a degraded user experience. To overcome this problem Citrix developed the first generation of Adaptive Display, it was still based on settings around progressive display but it was now auto tuning according to the available bandwidth and the capabilities of the client device. The concept of this first generation was simple : use a different compression algorithm for moving images and still images and tune it on the fly.\n\nAdaptive Display Second generation, the new standard in XenDesktop 7\n\nWell this concept is pretty much the same in the second generation of Adaptive Display but it’s now based on different codecs, the SuperCodec as Citrix calls it can dynamically decide which compression is used for different parts of the screen. The most important codec that is used in the second generation of Adaptive Display is the H.264 deep compression codec which we also know from HDX 3D Pro, together with features like Desktop Composition Redirection it forms the base of Adaptive Display second generation, before I go on let’s summarize the most important new graphics settings in XenDesktop 7 :\n\nPolicy\n\nDefault setting\n\nGoal\n\nLegacy Graphics Mode Off Revert to Adaptive Display first generation Target Frame rate 30 Sets the maximum frames send to the client (now up to 60 FPs can be configured!) Visual Quality Medium Sets the level of compression for the new codecs, besides low, medium and high also build to lossless or always lossless can be selected Desktop Composition Redirection Enabled Render Windows Desktop Manager (WDM) generated graphics on the client Desktop Composition Redirection Quality Medium Sets the default level of compression for Desktop Composition Redirection\n\nI think the above settings are the most important changes in XenDesktop 7 according to graphics, besides that there are a lot of windows media related policies added. There is nothing really arranged what’s current and what’s legacy so it’s easy to get lost if you don’t know where Citrix came from with Adaptive Display first generation and beyond. You can only see on what kind of OS it applies but that’s about it.\n\nI tried every combination of the above policies and made an UML diagram of my findings, the diagram shows the descisions made from the moment the session is launched (click to enlarge) :\n\nH.264 Deep Compression codec\n\nCitrix was the first vendor to use H.264 compression for delivering graphics through their remote display protocol (ICA), it was targeted for a specific use case : 3D modelling and graphics designers. At the beginning the first version of this codec was only available when combined with Nvidia GPU cards that had enough Cuda cores, as the codec was designed to leverage the Cuda cores for compression and encoding.\n\nLater the codec have evolved and Citrix made it also possible to encode completely in CPU. The new version, called the Deep Compression V2 codec, uses even less bandwidth then it’s predecessor and since it’s CPU based it can be used for a lot more use cases. There is one downside though, since it’s CPU based (default setting) the load on the host side increases and can affect the scalability of the total solution, when CPU resources are limited or scalability is a concern in your environment you have the following options in XenDesktop 7 (please note that it’s about finding the right mix between server scalability, bandwidth usage and user experience. What’s best for your environment depends on the use case and of course the amount of $$$ you can spend) :\n\nOption 1 : Leverage the new Desktop Composition Redirection feature to offload the host CPU\n\nCitrix extended the aero redirection feature (known from XD 5) and made it possible to remote Desktop Window Manager (DWM) DirectX commands to the client to be rendered there. This also means that graphics generated from application like Internet Explorer, Office 2010 and other modern applications are offloaded to the client. You will also notice when installing the XenDesktop 7 VDA on Windows 7 that the Aero theme is enabled by default, even when you disable Desktop Composition Redirection the Aero theme can still be used completely rendered on the new WDDM driver on the host side. The quality of Desktop Composition Redirection can be configured in the following policy :\n\nWhile this feature is awesome, since it leverages the clients capabilities and thus lowering the resources needed on the host side, there are some attention points when using Desktop Composition Redirection:\n\n– On the host side you need a Desktop OS (Windows 7 or Windows 8)\n\n– On the client side you need a compatible Windows client with a moderate GPU\n\n– Doesn’t work in legacy graphics mode (Adaptive Display first generation)\n\n– Increased bandwidth when using server rendered video\n\nDesktop Composition redirection together with the new compression codecs forms the base of Adaptive Display second generation. It’s a combination that’s default enabled when connecting from a windows Client. If you use this combination you have to keep them both in mind when fine tuning the user experience. For example you configure the visual quality to always lossless to prevent lossy data send to the client (for medical purposes for example). You will still see lossy artefacts like the below example in Wordpad.\n\nTo get a really lossless experience you have to either disable Desktop Composition Redirection or set the graphics quality of Desktop Composition also to lossless, increased bandwidth consumption needs to be taken into account of course.\n\nOption 2 : Turn on the legacy graphics mode policy\n\nWhen you use the default graphics settings in XenDesktop 7 and you open HDX Monitor, you will see under Graphics – Thinwire that Adaptive Display is disabled (see below screenshot) and that thinwire redirection is disabled by a policy. This means that you are leveraging the new codecs and not using Adaptive Display first generation.\n\nWhen you look at Graphics – Thinwire Advanced you will notice that the Legacy Graphics mode is turned off with the Legacy Graphics mode policy (see below screenshot).\n\nOk so this is the default, now when user density and scalability is more important than the mobile user experience it’s possible to revert back to Adaptive Display first generation by enabling the Legacy graphics mode policy. Please note that you also have to switch off Desktop composition redirection to make this work. When you have done that you can verify that Adaptive Display first generation is back in business again through HDX monitor :\n\nYou will also notice that, when using Windows 7, Aero functionality is switched off when using legacy mode:\n\nFor further fine tuning the legacy graphics mode in XenDesktop 7, read my previous blogpost on Adaptive Display.\n\nOption 3 : Use Graphics Processing Units (GPU)\n\nInstead of rendering and encoding everything in CPU, you can also leverage a GPU to do the heavy lifting, after all this is where a GPU is built for. Moving the graphical load away from the CPU, means you have more resources available for your applications etc making the solution more scalable. In XenDesktop 7 you have the following options :\n\n– Leverage the GPU directly (Either physically or through the Hypervisor (GPU passthrough))\n\n– Leverage the GPU indirectly through GPU virtualization (Available by using Nvidia GRID\\VGX)\n\nLeveraging the GPU directly is available for a while now but since it’s a one-to-one solution (except when using hosted shared desktops, where you can share a GPU with multiple sessions on the same server OS) it’s not very scalable and mostly limited to be used for heavy graphical designers and alike use cases. VGX on the other hand will extend the use cases by delivering a one-to-many solution. Personally I think this is the future because it provides the best combination of scalability, bandwidth and user experience. Let’s dig a bit deeper in VGX.\n\nWhen we open HDX monitor in a XenDesktop 7 session you will see the below message when VGX is not available :\n\nScreen scraping vs Direct frame buffer access\n\nWhen you have a GPU available graphics are first rendered on the GPU before they are (deeply) compressed in CPU and then send down the client, so first the output of the GPU (which would normally be send to the monitor attached to it) needs to be captured and after that compressed and tuned, this process is called screen scraping.\n\nScreen scraping, while better than doing everything in CPU, consumes additional resources and this is where Nvidia VGX (formerly known as Monterey and now called NVIDIA GRID technology) comes to play, they provide an API which allows remote display protocols to access the frame buffer (the dedicated H.264 encoding engine of the GRID card) directly. The below picture shows how the GRID technology is integrated on the Hypervisor level :\n\n(Source Nvidia)\n\nNVIDIA User Selectable Machines (USM) (Now called VGPU Profiles)\n\nUSM is the way Nvidia licenses the GRID technology, you can also translate the USM to use cases. There are 3 configurable USM’s :\n\n– Standard USM (bundled with the NVIDIA GRID card enabling a true PC experience for up to 100 task workers)\n\n– NVS USM (mission-critical professionals who use a variety of productivity and dedicated business applications)\n\n– Quadro USM (designers, artists, and scientists that require interactive 3D graphics and full compatibility)\n\nSo when you want to leverage the GRID virtualization technology you can do this for about 100 “normal” task users on a single GRID card (this can be less or more depending on the type of card and type of users), in this way you can already build a high scalable solution for general use cases. For more heavy graphical demands you need NVS USM or Quadro USM and this will cost additional licenses, good thing is you can mix and match the USM’s on a single GRID card. Of course the limits of the GRID card needs to be taken in to account. For more information about Nvidia GRID and the USM use cases click here.\n\nXenServer will be the first hypervisor supporting GRID GPU virtualization, at this time of writing it’s not yet available but you can already order servers with GRID cards and leverage the onboard kepler GPU’s by using traditional GPU passthrough technology.\n\n** Update **\n\n1 October 2013, Citrix and NVIDIA released the GRID VGPU (Tech Preview) and made some changes in names and numbers :\n\n– USM is now called VGPU Profiles, where K100 profile being the lowest which supports a maximum of 32 VGPU’s per board (K1 Card) and K260Q being the highest, which supports 4 Power Users (designers) on a K2 Card.\n\n– In the following table you will find the maximum VPGU per card.\n\n– Cannot find anything on licensing, it looks like the above hardware limits are the only limitation in the tech preview.\n\nConclusion\n\nIn this blogpost I described the new graphics options and choices you have in XenDesktop 7, remember that you don’t have to configure anything to get an awesome experience out of the box. The CPU based deep compression codec is really a giant leap forward compared to the first generation of Adaptive Display especially when it comes down to mobile user experience and WAN use cases. As more Citrix Receivers supports the new codecs it’s really a fluid experience across a broad range of devices. But keep in mind that you need additional resources on your host side compared to the “legacy display mode”.\n\nPersonally I had the best experience with the visual quaility set to Build to Lossless and disabling the desktop composition redirection feature, of course this depends on the use case, what I primary tested was server rendered video (youtube) and the look and feel of the desktop over a high speed WAN connection. What also amazed me was the look and feel of Windows 8 on the IPAD with receiver 5.8, they really made a big step forward making it a native mobile experience and playing video content really performed very well using the new codecs.\n\nCan we safely say that Adaptive Display first generation and progressive display become absolete?\n\nYes I think so, but for now there is still a valid use case : for example, when you want to get high density numbers and you have primarily LAN users Adaptive Display first generation still gives you the most scalable solution, but as CPU’s become faster and when GPU’s with GRID technology become more mainstream (also for general use cases), I think we can say goodbye to the good old progressive display after all those years.\n\nPlease note that the information in this blog is provided as is without warranty of any kind, it is a mix of own research and information from the following sources :\n\n– Edocs (Optimize graphics and multimedia delivery in XD7)\n\n– Edocs (GPU acceleration for Windows Desktop OS)\n\n– Blogs from Derek Thorslund (reinventing HDX, HDX leaps ahead , GPU sharing and Optimizations for W8\\W2012)\n\n– Nvidia (GRID Technology, GPU Virtualization)\n\n** This post was updated on 13-5-2013 and contains, besides additional information, also statements from RES Software. They responded very quick on the outcome of the security audit and would like to thank them for the nice collaboration **\n\nLately I was involved in a security and penetration scan at a customer servicing in Healthcare, because they store privacy sensitive information they need to apply to certain security regulations which are audited on a regular basis. Based on the results of this scan I will provide some findings and tips that you can use to further enhance the security of your XenApp environment. This tips are primarily focused on XenApp in combination with RES Workspace manager, but elements can also apply to other environments containing other UEM products.\n\nLets begin with a short description about the security scan :\n\nThe scan was performed by a company specialized in IT related security audits, you can also say the scan was performed by a group of legal hackers 😉\n\nThe security scan consisted of 3 parts :\n\n1: Scan from an unauthorized internal perspective (plug in the UTP cable and see how far you can get without any account)\n\n2: Scan from an unauthorized external perspective (try to gain access from outside the corporate network trough external components)\n\n3: Scan from an authorized user perspective (logged in with standard user credentials and see what kind of damage can be done)\n\nPart 1 consisted of multiple scans for weaknesses like missing patches and gathering NTLM hashes to decrypt passwords etc, keypoint here is to consider disabling cached credentials for internal pc’s which doesn’t leave the building or limit the amount of cached credentials (the default is 10 cached credentials on Windows). And of course use strong passwords so when they have access to the hashes the decryption is very time consuming. They use different tools and methods to decrypt hashes, one of them is John the Ripper and pre calculated rainbow tables. When they got access to the password hashes its amazing (and scary) how fast the hash can be decrypted into a plain text password.\n\nPart 2 consisted of a DNS lookup to gather information about external accessible elements of the infrastructure, after they are identified they try to logon using default user names and passwords and scan for other weaknesses. This customer uses Netscaler in DMZ in combination with SMS Passcode authentication, so they didn’t come far on that part. What should be taken into account is webmail\\active-sync traffic (which often doesn’t have 2-factor authentication) in combination with password lockout policies, a hacker can perform a denial of service by trying lots of different usernames and wrong password to intentional block users in AD (especially admin accounts).\n\nPart 3 consisted of tests on the XenApp environment while logged in with a normal user account, the following tips are derrived from findings in this part of the scan.\n\nTip 1: Timing\n\nThe first tip is about timing, if you are like me you want to put all of the user environment settings such as policies, registry and application settings as much as possible in RES Workspace Manager. If you are configuring things outside Workspace Manager, you lose the single point of management and that’s one of the key points the customer invested in RES Workspace Manager.\n\nWell there is absolutely nothing wrong with that, but I will give you an example to think about when security is high on your design checklist.\n\nImagine that the company’s policy is to block the task manager from running in a user session, to do this you can import the CtrlAltDel.admx policy in RES Workspace Manager and disable the Task manager there. This policy backed with the fact you have appguard running in the background to block all unauthorized processes (so also task manager) you should assume it’s absolutely not possible to start the task manager inside the user session, at least I thought so till a saw the security report that proved otherwise…\n\nWhat they did was fairly simple, consider that RES Workspace Manager by design removes all policies at logoff and that it takes some time (seconds) that the policies are applied and before appguard is fully functional when a user logs on. While the workspace composer does its magic, it seems possible to start the task manager through the CTRL-F3 hotkey right after the session is launched (press the hotkey repeatedly after the session is launched). See the following screenshot how this looks like.\n\nAfter Task Manager is launched, RES Workspace manager completes the workspace with all policies and rules so starting any unauthorized processes through task manager isn’t possible, but users can see information you rather want to hide (like performance, who is logged on etc). But besides that when you click on browse in task manager before the Workspace Composer applies the drive restriction settings it is possible to browse the C Drive even when you strictly prohibited this in RES Workspace Manager :\n\nWorkaround :\n\nIf you (or your customer) don’t care about users accessing task manager and local drives, there is absolutely nothing you have to do here, but if the company’s policy is to strictly hide task manager and to hide and prevent access to local drives, you can do the following things to overcome this timing issue :\n\n– Apply the task manager policy through AD, this policy is applied in an earlier stage when a user logs on so passing the hotkey at session creation has no effect\n\n– Consider using desktop viewer, if you use desktop viewer it’s not possible to pass hotkeys\n\n– Modify the default ica file on the Webinterface\\Storefront server and disable hotkeys there (Thanks Kees Baggerman for pointing this one out!)\n\nRES Software statement :\n\nThe timing issue with taskmanager will be fixed in a upcoming service release of RES Workspace Manager, expect a custom executable to test with shortly.\n\nTip 2: Macro security\n\nAnother way to bypass the application guard is to run processes inside memory of other (allowed) processes. This is often done through Office, because most of the time this processes are marked as trusted and malicious code can be easily fired of using macro’s. The Office KAT excel sheet (sources are at the bottom of this post) is an example of a sheet containing such macro’s. When opening Office KAT in a user session with default office settings, the user is prompted to allow the macro’s (message is in Dutch but it says : warning macro’s are turned off, enable content to turn them on) :\n\nWhen the content is enabled, we click on “open command line” and we are prompted with the following message :\n\nAfter clicking OK, the command prompt is started, in the following screenshot you can see that the actual process is Excel.exe, you can also see that we can easily switch to the C drive and browse through the contents of the XenApp server (note that drive restriction policy are ignored) :\n\n(Please note that this user session hasn’t got access to the command prompt and that access to local drives are strictly prohibited).\n\nAnd when we click on “open regedit” from Office KAT, which launches a registry editor under the Excel.exe process, you can see how simple it is to browse the whole registry of the XenApp server :\n\nAfter chatting with Kees Baggerman about this topic, he pointed me to a similar Excel macro from Remko Weijnen, Remko was the first pointing out that there was a way to bypass the application guard by running untrusted processes in memory of authorized processes using a Excel macro. You can read about it here. This was one of the reasons that RES tightened the security rules of the application guard driver, they did this by blocking the svchost process from running other (unauthorized) processes indirectly. This security enhancement is available since Workspace Manager 2011 SR4, the following rule is created (and disabled) by default in new RES Workspace Manager deployments :\n\nNote : Check this rule out if you upgraded your environment till this point, because during upgrade the rule is created and enabled by default, this is done to avoid security warnings thrown at your users after the upgrade, you can run the rule in logging mode for a while to identify what the impact will be in your environment. So if you want to harden your environment you should disable this rule.\n\nAnother way to tighten the security of your RES environment is by restricting a managed application to be only launched by Workspace Manager itself (see below screenshot). This prevents the managed application to be launched through other applications or unmanaged file types. This example video contains Remko’s macro in combination with this setting, you can see that the authorized process (excel.exe in the video example) isn’t started by RES Workspace Manager itself and thereby blocked from launching after this setting is active.\n\nBack to the Office KAT sheet which was used in the security scan, I tested all of this security settings in combination with Office KAT and it happens to be that I could still run the CMD and Regedit instance, I think this is because the macro’s in Office KAT starts a different embedded CMD instance in memory (ReactOS) without reading\\executing anything from disk. I think this is why application guard cannot detect it, and this would probably the moment where the virusscanner should kick in.\n\nDoes it mean that malicious macro’s like Office KAT can put your environment in direct danger? No not really because we still have only user rights and any processes launched from the command prompt will be blocked by appguard. But what might be a risk is that the content of the local drives and the registry is exposed which may contain sensitive information about your infrastructure. Besides that there is another risk in the way how the default file system in Windows is designed, Tip 3 will go further on this subject but first : how can we prevent this kind of Macro’s from running?\n\nWorkaround :\n\n– You can define trusted locations (Office 2010 and above) and run unsigned macro’s from there, when using trusted locations the Trust Center security feature is bypassed, but please note that Office KAT isn’t noticed by this feature so I wouldn’t rely on this feature only\n\n– You can disable all macro’s through a policy or only allow signed macro’s\n\n– Some virus scanners (also windows defender in Windows 8) detects Office KAT as a thread and places the Excel sheet in quarantine, but there are more variants of this macro’s and not all virus scanners detects them, if you want to rely on the virus scanner pick one that’s designed to detect this kind of malicious macro’s. Also be careful with stripping your virusscanner to optimize performance, it maybe you win on performance but on the other hand you might lose on security. You can download Office KAT at the bottom of this post to check if your virusscanner detects it.\n\nRES Software statement :\n\nThis kind of macro’s, which runs malicious code totally in memory (ReactOS in this case), is out of the scope of RES appguard, this type of macro’s should be detected by the virusscanner. (They added to this that there will be an even more tighter security mechanism in the current under development .net version of RES Workspace Manager).\n\nTip 3: File system security\n\nSo in Tip 1 and 2 we found possible ways to get access to the local drives of the XenApp server even when access to them is strictly prohibited through policies. Besides exposing sensitive information, there is another culprit when users have access to local drives : The default ACL’s in Windows allows users to create folders on the local drives and store data in it. See below an example of CMD running under the Excel process, creating a folder and store data in it :\n\nYou can imagine that users (or hackers with user rights) with bad intentions can make a mess of your XenApp server and even worse they can fill up the disk with data till the disk reaches full capacity which can result in a denial of service. The benefit of using provisioned XenApp servers is that they revert to a clean state after each reboot, but the risk stays the same and may be even worse because the write-cache will grow and you can end up with failing XenApp servers because the write-cache location isn’t sized for that. Also when using provsioning in combination with a local disk for the write-cache, the same default file system security applies to this disk. We can for example browse to the D drive and see the cache file :\n\nBy default users can create folders on this disk which will persist after a reboot, when this disk is filled with data the cache file cannot grow any further. This can affect the XenApp server during run time but also after a reboot!\n\nWorkaround :\n\nI think the most recommended way to address this risk is to accept that users in some way can access the local drives of the XenApp server, you can hide them and narrow the risk that they can be accessed through Tip 1 and 2 for example, but it’s hard to totally prevent it. Some applications for instance doesn’t respect the drive restriction policies and can expose access to the local drives. To prevent write access to the local drives you can use the RES Workspace Manager security feature called Read-only blanketing (RoB), this feature transforms the local drives to read-only drives without messing around with the default ACL’s, it’s there in Silver (security) and Gold edition, so if you are not using this feature yet you might consider it!\n\nConclusion :\n\nIn this blog post I showed you some simple tips to further enhance the security of your XenApp environment in combination with RES Workspace Manager. Hopefully this information was helpful for you when security is an important consideration in your environment or design. How tight you need to secure your XenApp environment depends on the kind of company and type of data you are securing. Most of the time the more secure you make it, the more complex it will become. It’s all about eliminating risks, but I think even more important : accepting risks.\n\nWith RES Workspace Manager it becomes a lot easier to harden your environment from a user perspective, use the security features and maybe more important audit this features on ongoing basis.\n\nYou can download Office KAT here, it’s part of the Interactive Kiosk Attack Tools (iKAT) which contains more useful tools to test the security of your environment. Please be careful browsing this pages because it can contains content and material not suitable for work.\n\nPlease note that the information in this blog is provided as is without warranty of any kind.\n\nTable of contents :\n\n1: Introduction\n\n2: The Workspace Control process in UML\n\n3: Workspace Control and Auto launch usability\n\n4: Special note : Using Workspace Control with Receiver for Web\n\n5: Special note : Using Workspace Control with Linux Receiver\n\n6: Special note : Using Workspace Control with Native Receiver and Mobile Receivers\n\n7: Conclusion\n\n1: Introduction :\n\nIn this blog post I will dive a little deeper into the Citrix Workspace Control functionality, I will show you how the Workspace Control process works and what kind of challenges it can bring to the table. For those not familiar with Workspace Control, it’s the mechanism in Webinterface and Storefront that lets users (automatically) reconnect to existing sessions when they are roaming. To start with some basics : Workspace Control can reconnect two types of sessions, Active sessions and Disconnected sessions.\n\nThe Workspace Control process is triggered in the following 2 scenarios :\n\n– The Automatic reconnect process when a user logs on to Webinterface or Storefront\n\n– The Manual reconnect process when a user clicks on the reconnect button in Webinterface or Storefront\n\nWorkspace Control isn’t triggered in the following scenarios :\n\n– When a user clicks on an application or desktop manually\n\n– When Auto launch is enabled\n\n– When you connect straight to a XenApp server, without using Webinterface or Storefront\n\n– When Workspace Control is disabled, either by admin or user\n\n– When points apply that you will find in the following UML flow diagram in the following chapter\n\n2: The Workspace Control process in UML\n\nBelow you will find an UML diagram that will show you the Workspace Control process based on the Automatic and Manual reconnect process. (click to en large)\n\n3: Workspace Control and Auto launch usability\n\nAuto launch is a feature you can configure in Webinterface or Receiver for Web to launch a specific Application or Desktop after a user logs on, this functionality is especially useful when you have only one published desktop. In this way the user doesn’t have to click the desktop icon, but instead it launches directly after the user authenticates. The downside of auto launch however is that it disables the Workspace Control functionality at logon. This isn’t necessarily a problem when using XenDesktop, but for XenApp this can result in multiple sessions being launched by the user and this is something you often want to prevent, it’s getting more worse when you have session limits in place because this can even prevent the user to login when there is already an active session. To overcome this I often use one of the below two methods, please leave a comment when you use other methods to solve this challenge for XenApp.\n\n1: Restrict users to a single session, Enable Workspace Control and Disable Auto launch\n\nIn this scenario the user logs on to Webinterface or Storefront, when there is no active\\disconnected session the user clicks on the Desktop or Application and launches his session. When the user logs on from another device, Workspace Control kicks in and reconnects the session immediately after the user authenticates. The user can also choose to manually disconnect and reconnect the session through Workspace Control. In this scenario Workspace Control in combination with Session limits is used to control the number of sessions on the XenApp farm.\n\n2: Allow multiple sessions, Enable Auto launch and use RES session guard\n\nIf you have RES Workspace Manager in place, you can leverage the RES session guard feature to notify users of already active sessions and let them disconnect them on the fly. If you educate the user how to use this, session guard can be a real handy feature to simulate a Workspace Control alike functionality. Plus you can also define a group of users (through a dummy administrative role) that can login multiple times. This is especially handy when you have shared accounts or a couple of users that needs to logon multiple times concurrently. The only down side of this method is that the user needs to login twice when an active session is detected, one time to disconnect the session and one time to reconnect to the disconnected session. The plus side is that you can enable Auto launch to immediately launch the Desktop after the user authenticates, because RES session guard will control the amount of sessions and you don’t have to use Workspace Control in combination with Session limits anymore.\n\nBelow is a printscreen of the RES Session guard in action when multiple sessions are detected :\n\nSession Guard detects multiple sessions by creating a lock file (guard.lock) inside the homefolder , the above message is displayed when the file is detected, after the user logs off the lock file is removed.\n\n4: Special note : Using Workspace Control with Receiver for Web\n\nFrom Storefront version 1.2 the Auto launch feature is enabled by default in Receiver for Web when there is only one published Desktop available for the user, this also means that Workspace Control is disabled by default, but the most important thing to note is that since the separation of Apps and Desktops in Receiver for Web, the Workspace Control functionality is completely disabled in the Desktops section (see below screenshot for clarification). This makes sense when using XenDesktop, but you may still want to use Workspace control for your published XenApp desktops. To enable Workspace Control for published XenApp desktops, you can put a keyword in the published XenApp desktop description field (KEYWORDS:TreatAsApp) so Receiver for Web will treat it as Application instead of Desktop, thus enabling Workspace Control again.\n\nWorkspace Control (for the Apps section) can be configured by editing the web.config file in the inetpub directory of the Storefront server, this is a little step backwards because with Webinterface you could do this through the GUI.\n\n5: Special note : Using Workspace Control with Linux Receiver\n\nLinux Receivers found in linux based Thinclients often use the PNAgent site to request and launch published applications and desktops, the key component used here is the PNABrowse utility. PNABrowse is often scripted by the Thinclient manufacturer and embedded in the customized Thinclient OS, like the HP ThinPro and HP Smart Client series. PNABrowse uses the –WR parameter to leverage Workspace Control and connect to active and Disconnected sessions. You can control Workspace Control behavoir for this clients by editing this parameter in the following way :\n\n-WR = Connect to Active and Disconnected sessions\n\n-Wr = Connect to Disconnected sessions only\n\n– Remove –WR = don’t use Workspace Control\n\nThere will be a new Linux Receiver released by the end of the year that can connect natively to Storefront without using Legacy PNAgent.\n\n6: Special note : Using Workspace Control with Native Receiver and Mobile Receivers\n\nFor the Windows Native Receiver and Mobile Receivers connecting to Storefront, there is currently no good way to configure Workspace Control, it’s always enabled by default. Native Receivers are a good launch platform for published applications and data, but it lacks the option to fine tune them for different access scenarios like Workspace Control or Auto launch, you have to use the Receiver for Web or Webinterface if you want to control this. Also the native Receivers doesn’t make a difference between applications and desktops yet (only apps and data), so Workspace Control will be enabled for both by default which can be a problem. Hopefully Citrix will add more options to control this behavoir in future releases of Storefront.\n\n7: Conclusion\n\nThe main goal of Workspace Control is to reconnect published applications when users are roaming, but it’s also often used in combination with session limits to control the number of user sessions and optimize the user experience. It’s clear that Citrix is moving away from Workspace Control when using published Desktops and rather use Auto launch instead, but for XenApp this can be a challenge. You can still leverage Workspace Control in newer versions of StoreFront by treating the published XenApp desktop the same as an published application. Maybe the new Flexcast Management Architecture (FMA), which is part of the upcoming Excalibur release, will change the way how we deliver and reconnect to XenApp published desktops so Workspace Control isn’t necessary anymore to control the user sessions, in the mean time you can either use Workspace Control in combination with session limits or RES session guard to optimize the user experience and control the amount of user sessions in your XenApp farm.\n\nPlease note that the information in this blog is provided as is without warranty of any kind.\n\nMake sure to also check this blogpost about a very handy tool named Remote Display Analyzer\n\nIn this blog post I wanted to talk about Adaptive Display, this new HDX feature is now available in both XenDesktop 5.5\\5.6 and XenApp 6.5 (through a hotfix), Adaptive Display is the successor of the highly successful Progressive Display SpeedScreen technology, and it’s switched on by default. It’s an awesome technology because it is auto adopting to changes in the available bandwidth.\n\nThere is not so much information in the Citrix Edocs about fine tuning Adaptive Display, this is mainly because it’s auto-tuning and in various blog posts from Citrix they are saying the following :\n\n“Progressive Display requires creating complex policy configurations to get it right making it a hard to use feature. Adaptive Display eliminates the need for such complex configurations and provides a fantastic out-of-the-box experience, making it zero configurations for Citrix Administrators”\n\nOk that’s fine by me, so we do not have to create complex policies anymore for LAN and WAN use cases, because it will detect the available bandwidth and adjusts accordingly. Super!\n\nBut what is exactly going on inside the Thinwire channel?\n\nBefore I go further, let’s summarize the default settings that are adjustable within Adaptive Display :\n\nAdaptive Display Setting\n\nDefault Value\n\nMax frames per second 24 Target Minimum Frame rate 10 Minimum Image Quality Normal Moving Image Compression On (Enables or Disables Adaptive Display) Extra Color Compression Default Off and enabled when bandwidth is below 8192 KBps Heavyweight Compression Default Off Lossy Compression level Default Medium, the default threshold is unlimited\n\n* Note: At this time, not all Adaptive Display policies can be configured using the XenApp 6.5 AppCenter console. Use Windows Group Policy Editor (gpedit.msc) instead.\n\nOk so now we know what settings are in the game of Adaptive Display, how are this settings come together? To make this more clear I made some drawings and explanations.\n\nLet’s begin with the Extra Color Compression setting, Color Compression takes advantage of the fact that the human eye is less sensitive to color information (Chroma) than luminance (Luma). When images are encoded with less color information, the bandwidth savings are huge yet the human eye still sees a very satisfactory picture. Most of today’s digital cameras use this technique to save on storage space. Extra Color Compression is turned on by Adaptive Display when the default threshold of 8192 KBps is reached, let’s picture this default behavoir :\n\nOk moving on to the Minimum Image Quality setting, this setting sets the JPEG quality floor.\n\nIn other words, this is the minimal acceptable JPEG quality, the following minimum quality levels can be set :\n\nMinimum Image Quality\n\nJPEG Quality\n\nUltra High 80 (highest image quality, lowest Compression) Very High 55 High 30 Normal (Default) 20 Low 15 (Lowest image quality, Highest Compression)\n\nThe Lossy Compression level set’s the starting JPEG Quality, Adaptive Display adjusts the JPEG quality between the starting point to the Minimum Image Quality based on the bandwidth available to try to keep the frame rate from decreasing. The default starting JPEG Quality is 55 (Medium). Ok let’s picture this combination :\n\nNotice that the default Lossy Compression level is set to Medium and the threshold to enable Lossy compression is set to 2147483647 KBps (unlimited), which means that this setting is always on.\n\nThe following Lossy Compression levels can be configured :\n\nLossy Compression Level\n\nStarting JPEG Quality\n\nHigh 25 Medium (Default) 55 Low 80 None 80 (Lossless)\n\nOk now we know what the default settings are and how the frame rate and compression is dynamically adjusted by Adaptive Display. So what about this default settings, should we change it or leave it alone?\n\nAs usual it depends on the use case 🙂 but read on….\n\nThere is a great tool from Citrix called HDX Monitor, this tool lets you see all the HDX aspects in an active ICA session. If you start the HDX Monitor (with the default settings in place) you will see the following screen :\n\nOk looks good, but what’s that big red cross? Let’s find out :\n\nError : Image compression is not tuned to the available bandwidth. An Administrator can improve the user experience by creating a policy that optimizes image compression.\n\nOk so it looks like the HDX monitor engineering team is not happy with the Out-of-the-Box experience settings from the HDX Adaptive Display engineering team 🙂\n\nI think the HDX Monitor engineering team is right, because if we connect through a fast LAN connection the default Medium compression is used and the windows flag background and other images looks like this :\n\nThis is not the best experience you can get with LAN conditions.\n\nWhy did Citrix choose this default Out-of-the-Box settings? I think because of a combination between the following 3 points :\n\n1: User Experience\n\n2: Server Scalability\n\n3: Bandwidth Scalability\n\nThe default settings also improves the performance on the LAN when viewing high resolution photos etc, if you enabled Progressive display in the past your users might already be used to this compression level.\n\nBut we can consider to improve the user experience for LAN scenarios by lowering the Lossy compression level or turning it off. This can be done in 3 ways :\n\n1: Configure a Lossy Compression maximum threshold\n\nThe default threshold for Lossy Compression is set to unlimited, so by default Medium compression is always used. We can change the maximum threshold so we can give it a maximum value in KBps, above that threshold Lossy Compression will be turned off. This looks like this :\n\nAs you can see the Lossy Compression will be turned off when the maximum threshold is reached, for example you can set this threshold on 75% of your LAN speed. The side effect of this one, is that you don’t have any Lossy Compression at all when the Bandwidth is above the maximum Threshold. This can be negatively impact your environment with a lot of LAN users viewing high resolution photos.\n\n2: Set the Default Lossy Compression to Low\n\nIf we want to improve the user experience on the LAN, we can also lower the Lossy Compression to the lowest level. This looks like this.\n\nKeep in mind that Adaptive Display will try to maintain this starting JPEG Quality also for your WAN users.\n\n3: Configure different Adaptive Display policies and filter them on IP address\n\nThis one is a little bit the same as we configured for Progressive Display in the past.\n\nMake a policy which applies a low level of Lossy compression for you LAN users and filter them on internal IP ranges and give it a higher priority then your default policy.\n\nYou can let the default policy (which applies to all users) default or change it with higher compression levels. In this scenario we only give the LAN users a higher starting JPEG quality.\n\nConclusion :\n\nDo we need to fine-tune Adaptive Display?\n\nI think we need to take this into consideration depending on the use case, for example :\n\n– Do your users need to see lossless images on the LAN?\n\n– Is your environment (Network, Servers, Client Devices) fast and scalable enough?\n\nI also think the default Out-of-the-Box configuration is fine for most environments, but as you can see there are possibilities to change the default behavoir of Adaptive Display slightly to fit your needs.\n\nYou can do this by changing the compression levels and telling Adaptive Display what’s the starting JPEG Quality and the Minimum acceptable JPEG Quality.\n\nWhat do you think? Please leave a comment on your thoughts.\n\nPlease note that the information in this blog is provided as is without warranty of any kind, it is a mix of own research and information from the following sources :\n\n– Citrix Edocs “Configuring Adaptive Display” (Contains wrong information about the default Lossy compression level values)\n\n– Citrix Blog “Dynamic Color Compression”\n\n– Citrix Blog “Introducing Adaptive Display”"
    }
}