{
    "id": "dbpedia_539_2",
    "rank": 8,
    "data": {
        "url": "https://forum.image.sc/t/trying-to-use-cooccurencematrix/6338",
        "read_more_link": "",
        "language": "en",
        "title": "Trying to use cooccurencematrix",
        "top_image": "https://global.discourse-cdn.com/business4/uploads/imagej/original/2X/4/4904e8fe196486eabdbe0d9d185e94dfcab74e10.png",
        "meta_img": "https://global.discourse-cdn.com/business4/uploads/imagej/original/2X/4/4904e8fe196486eabdbe0d9d185e94dfcab74e10.png",
        "images": [
            "https://sea1.discourse-cdn.com/business4/user_avatar/forum.image.sc/ilan/48/52578_2.png",
            "https://sea1.discourse-cdn.com/business4/user_avatar/forum.image.sc/ilan/48/52578_2.png",
            "https://sea1.discourse-cdn.com/business4/user_avatar/forum.image.sc/ilan/48/52578_2.png",
            "https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=12",
            "https://sea1.discourse-cdn.com/business4/user_avatar/forum.image.sc/ilan/48/52578_2.png",
            "https://global.discourse-cdn.com/business4/uploads/imagej/original/2X/7/735efcbff131a84442661087e5e7f53d78cbbdeb.png",
            "https://sea1.discourse-cdn.com/business4/user_avatar/forum.image.sc/ilan/60/52578_2.png",
            "https://global.discourse-cdn.com/business4/uploads/imagej/original/2X/d/d00969e6b5d4d9d78554e60def9d431c4fd23358.png"
        ],
        "movies": [],
        "keywords": [],
        "meta_keywords": [
            "imagej",
            "imagej-ops"
        ],
        "tags": null,
        "authors": [
            "stelfrich (Stefan Helfrich)",
            "ilan (ilan tal)",
            "imagejan (Jan Eglinger)",
            "bogovicj (John Bogovic)"
        ],
        "publish_date": "2017-07-31T12:27:11+00:00",
        "summary": "",
        "meta_description": "I am trying to use cooccurencematx and the constructor is empty \n\n coocm = new CooccurrenceMatrix2D();\ncoocm.initialize();\nglcm = coocm.compute(img);\n\nThe program crashes on the constructor. Somehow I need to tell it wha&hellip;",
        "meta_lang": "en",
        "meta_favicon": "https://global.discourse-cdn.com/business4/uploads/imagej/optimized/2X/4/4b3d366e9bd1c4abfb68ca23f7596edd29cb2f4a_2_32x32.png",
        "meta_site_name": "Image.sc Forum",
        "canonical_link": "https://forum.image.sc/t/trying-to-use-cooccurencematrix/6338",
        "text": "I am trying to use cooccurencematx and the constructor is empty\n\ncoocm = new CooccurrenceMatrix2D(); coocm.initialize(); glcm = coocm.compute(img);\n\nThe program crashes on the constructor.\n\nSomehow I need to tell it what orientation to use, presumably in the compute routine, but that has only an iterative image as input. Is there some example code I can use which uses the basic elements of the class?\n\nThanks,\n\nIlan\n\nThanks for the reply Stefan.\n\nI am trying to use this which uses the function directly.\n\nFor example I build an ImageJ ImagePlus which I wrap\n\nImagePlus imp = new ImagePlus(\"radio\", stk1); Img < T > img = ImagePlusAdapter.wrap(imp);\n\nand I can use that to find the min and max.\n\nNot that I really need to min and max, it was just an exercise to see everything is working.\n\nThe cooccurrence matrix crashes on the constructor in some future task run program.\n\nIt is as if I am doing something wrong, but what can one do wrong with an empty contructor?\n\nThanks,\n\nIlan\n\nThanks again for your patience with me. I am obviously doing something stupid, but I don’t know what.\n\nMy code looks like\n\nImagePlus imp = new ImagePlus(\"radio\", stk1); ImageJ ij = IJ.getInstance(); Img < T > img = ImagePlusAdapter.wrap(imp); // glcm = ij.op().img().cooccurrenceMatrix( 0, 0, 0, MatrixOrientation2D.HORIZONTAL); coocm = new CooccurrenceMatrix2D();\n\nFirst, for the error message, it is in FutureTask.java\n\npublic void run() { if (state != NEW || !UNSAFE.compareAndSwapObject(this, runnerOffset, null, Thread.currentThread())) return; try { Callable<V> c = callable; if (c != null && state == NEW) { V result; boolean ran; try { result = c.call(); ran = true; } catch (Throwable ex) { result = null; ran = false; setException(ex); }\n\nI catch it in result = null; It is inside the constructor call.\n\nThe glcm = ij.op()… is commented out because I can’t satisfy any import for op().\n\nIgnore the 3 zeros, as I will fill in something else when op() can be satisfied.\n\nPresumably I need an additonal jar file.\n\nThanks again,\n\nIlan\n\nI’ve made some progress. My code now looks like\n\nImagePlus imp = new ImagePlus(\"radio\", stk1); Img < T > img = ImagePlusAdapter.wrap(imp); IterableInterval<T> it1 = (IterableInterval<T>) img; net.imagej.ImageJ ij = new net.imagej.ImageJ(); glcm = ij.op().image().cooccurrencematrix( it1, COOCCURRENCE_HI, 2, MatrixOrientation2D.HORIZONTAL);\n\nPresumably I still don’t have the ij correct. The compilation is OK but the constructor for the net.imagej.ImageJ crashes with the same FutureTask.java, at the same position.\n\nOne other question while i am at it. I have the distance at 2, as in the example. Does 2 mean nearest neighbor, or should I use 1 for that?\n\nThanks,\n\nIlan\n\nIf your code is executed from within Fiji, then there already is a Context (which is what the net.imagej.ImageJ constructor creates). If you are implementing something as a SciJava Command, you are able to use the @Parameter annotation to directly get hold of an OpService (which is what ij.op() returns). If you want to see what that looks like in code, take a look at one of the examples: OpenScaleSaveImage.java.\n\nYou can also find more information on Commands and Plugins at Developing ImageJ2 Plugins as well as a collection of helpful resources at 2016-04-19 - Writing ImageJ2 Plugins: A Beginner's Perspective.\n\nI’m still stuck on the\n\nnet.imagej.ImageJ ij = new net.imagej.ImageJ();\n\nmissing what context it should have. My project is based upon that classic ImageJ and not upon net.imagej.ImageJ.\n\nI looked at all the links. OpenScaleSaveImage is using net.imagej.ImageJ, which is what I need to create. The context is supposed to be created when the application starts, but I started the classic version.\n\nI can do Object con = IJ.getInstance().getAccessibleContext(); but it isn’t clear that accessible context is what I want. There is also getInputContext(), which probably not what I want.\n\nMy plugin does\n\npublic class Pet_Ct_Viewer implements PlugIn {\n\nI can change that to\n\n@Plugins\n\npublic class Pet_Ct_Viewer {\n\nif that would help anything.\n\nThanks again for the help.\n\nHi @ilan,\n\nAs you’re using an update site for PET-CT Viewer, you do use an ImageJ2 feature already . It should be relatively straightforward to implement your plugin as an org.scijava.Plugin instead of an ij.plugin.PlugIn, and get the @OpService for free as a plugin parameter that lets you use Ops with ease. For combining ImageJ2/SciJava commands with ImageJ1 classes, you can take the mixed-world-command tutorial as an example:\n\nIn general, it would help if you posted the full stack trace here, so others can draw their own conclusions and give better advice.\n\nI noticed you have the source code on github:\n\nbut the latest commits are from eight years ago. It might also help others helping you if you link to complete examples on github, instead of posting code snippets that aren’t self-contained.\n\nThanks Jan,\n\nAs you see a lot of my code is old. I am taking your advice and switching over a couple of plugins to net.imagej.ImageJ.\n\nIn OpenScaleSaveImage there is a convience main:\n\n/* * This main method is for convenience - so you can run this command * directly from Eclipse (or other IDE). * * It will launch ImageJ and then run this command using the CommandService. * This is equivalent to clicking \"Tutorials>Open+Scale+Save Image\" in the UI. */ public static void main(final String... args) throws Exception { // Launch ImageJ as usual. final ImageJ ij = net.imagej.Main.launch(args); // Launch the \"OpenScaleSaveImage\" command. ij.command().run(OpenScaleSaveImage.class, true); }\n\nThis is supposed to be for launching the app from inside the IDE and I would like to exploit it to launch my updated app, but I have no idea what the args should be inside final ImageJ ij = net.imagej.Main.launch(args);.\n\nAn empty string and null fail, so what could be a valid argument?\n\nThere is a lot of work to convert over all my plugins, so I will try it one step at a time.\n\nTo try and get what args are used, I converted over one of my plugins and ran it from Netbeans.\n\nThe idea was I could put a break point at the start of the main and look at the args which was passed in.\n\nThe first line of the main had my breakpoint, which it never reached.\n\nimport net.imagej.ImageJ; import org.scijava.command.Command; import org.scijava.plugin.Plugin; /** * * @author ilan */ @Plugin(type = Command.class, menuPath = \"Plugins>Nuclear Medicine>Avataxer\") public class Ava_taxer implements Command { @Override public void run() { if( Avataxer.instance != null) return; Avataxer dlg = new Avataxer(null, false, \"ava\"); dlg.setVisible(true); } public static void main(final String... args) { // Launch ImageJ as usual. int i = 0; i++; i++; // ImageJ ij = net.imagej.Main.launch(args); // Launch the \"Ava_taxer\" command. // ij.command().run(Ava_taxer.class, true); } }\n\nSince it never reached the first line: int i = 0; I decided to go one step further and comment out the launch.\n\nEven after commenting out the launch, the debug log showed that something tried to use it.\n\ndebug:\n\n[ECLIPSE HELPER] Indexing annotations... Exception in thread \"main\" java.lang.IllegalArgumentException: Invalid service: io.scif.img.cell.cache.MapDBCache at org.scijava.service.ServiceHelper.createExactService(ServiceHelper.java:280) at org.scijava.service.ServiceHelper.loadService(ServiceHelper.java:231) at org.scijava.service.ServiceHelper.loadService(ServiceHelper.java:194) at org.scijava.service.ServiceHelper.loadServices(ServiceHelper.java:166) at org.scijava.Context.<init>(Context.java:277) at org.scijava.Context.<init>(Context.java:234) at org.scijava.Context.<init>(Context.java:174) at org.scijava.Context.<init>(Context.java:160) at net.imagej.ImageJ.<init>(ImageJ.java:79) at net.imagej.Main.launch(Main.java:61) at Ava_taxer.main(Ava_taxer.java:21) Caused by: java.lang.NullPointerException at java.util.ArrayList.addAll(ArrayList.java:472) at org.scijava.util.ClassUtils.getAnnotatedFields(ClassUtils.java:413) at org.scijava.util.ClassUtils.getAnnotatedFields(ClassUtils.java:383) at org.scijava.service.ServiceHelper.createServiceRecursively(ServiceHelper.java:315) at org.scijava.service.ServiceHelper.createExactService(ServiceHelper.java:269) ... 10 more /home/ilan/.cache/netbeans/8.1/executor-snippets/debug.xml:83: Java returned: 1\n\nThe bottom line is I need something, anything at all, which will do the job and give me an\n\nfinal ImageJ ij = net.imagej.Main.launch(args);\n\nIt does have to be launch, a wrapper on the legacy IJ would do just as well.\n\nI do however need SOMETHING.\n\nThanks,\n\nIlan\n\nSorry, I’m not sure why it doesn’t work (@ctrueden or @stelfrich might be able to tell you more), and I’m not using Netbeans. But maybe I should’ve pointed you to a more up-to-date example for an IJ2 command, example-imagej-command. It has a slightly different convenience main() method that should work:\n\nCan you try this? Anyhow, the main() method should not interfere with the functionality of the plugin, as it is merely used to start the plugin from an IDE, but not when run from within ImageJ.\n\nFirst and foremost I would like to sincerely thank everyone for their generous help.\n\nI couldn’t have done it without your help.\n\nMy original question as to the value of args in\n\npublic static void main(final String… args)\n\nis that for Netbeans it is a String array of length zero.\n\nI used Jan’s suggestion and replaced\n\nImageJ ij = net.imagej.Main.launch(args);\n\nby\n\nfinal ImageJ ij = new ImageJ();\n\nIt was simpler and had no args problem.\n\nThe error message was the same so I guessed I was missing some jar files.\n\nInstead of a shotgun approach, I went into the source code to see what the problem might be.\n\nIf you want to run the program from Eclipse or Netbeans, there is a minimum number of jar files which must be present in the libraries tab.\n\nI made a screen shot of my properties window and the ones in red must be included.\n\nThe Pet_Ct_Viewer.jar is obviously just for this application and the ij.jar I need because I use IJ.log() for errors.\n\nThe red ones are the needed glue.\n\nNot that I really have any intention of running the plugin directly from Netbeans, but it was in fact a nice way to start with a simple case before moving on to the real problem. The ImageJ ij = new ImageJ(); was what killed me way back when.\n\nThanks again for all your help,\n\nIlan"
    }
}