{
    "id": "yago_18972_2",
    "rank": 15,
    "data": {
        "url": "https://elifesciences.org/articles/55964",
        "read_more_link": "",
        "language": "en",
        "title": "Automated task training and longitudinal monitoring of mouse mesoscale cortical circuits using home cages",
        "top_image": "https://elifesciences.org/assets/images/social/icon-600x600@1.52e87ee6.png",
        "meta_img": "https://elifesciences.org/assets/images/social/icon-600x600@1.52e87ee6.png",
        "images": [
            "https://elifesciences.org/assets/patterns/img/patterns/organisms/elife-logo-xs@1x.f9b97bde.png",
            "https://elifesciences.org/assets/patterns/img/icons/corresponding-author@1x.075234c5.png",
            "https://iiif.elifesciences.org/lax/55964%2Felife-55964-fig1-v2.tif/full/617,/0/default.jpg",
            "https://iiif.elifesciences.org/lax/55964%2Felife-55964-fig2-v2.tif/full/617,/0/default.jpg",
            "https://iiif.elifesciences.org/lax/55964%2Felife-55964-fig3-v2.tif/full/617,/0/default.jpg",
            "https://iiif.elifesciences.org/lax/55964%2Felife-55964-fig4-v2.tif/full/617,/0/default.jpg",
            "https://iiif.elifesciences.org/lax/55964%2Felife-55964-fig5-v2.tif/full/617,/0/default.jpg",
            "https://iiif.elifesciences.org/lax/55964%2Felife-55964-fig6-v2.tif/full/617,/0/default.jpg",
            "https://iiif.elifesciences.org/lax/55964%2Felife-55964-fig7-v2.tif/full/617,/0/default.jpg",
            "https://iiif.elifesciences.org/lax/55964%2Felife-55964-fig8-v2.tif/full/617,/0/default.jpg",
            "https://iiif.elifesciences.org/lax/55964%2Felife-55964-fig9-v2.tif/full/617,/0/default.jpg",
            "https://iiif.elifesciences.org/lax/55964%2Felife-55964-fig10-v2.tif/full/617,/0/default.jpg",
            "https://elifesciences.org/assets/patterns/img/icons/orcid.e0a7f9de.png",
            "https://elifesciences.org/assets/patterns/img/patterns/organisms/elife-logo-xs@1x.f9b97bde.png",
            "https://elifesciences.org/assets/images/investors/hhmi@1x.739f96c8.png",
            "https://elifesciences.org/assets/images/investors/wellcome@1x.b38198be.png",
            "https://elifesciences.org/assets/images/investors/max@1x.71f18cc3.png",
            "https://elifesciences.org/assets/images/investors/kaw@1x.d11d4f95.png",
            "https://elifesciences.org/assets/patterns/img/patterns/molecules/carbon-neutral.706efe6d.svg"
        ],
        "movies": [],
        "keywords": [],
        "meta_keywords": [
            ""
        ],
        "tags": null,
        "authors": [
            "Timothy H Murphy",
            "Nicholas J Michelson",
            "Jamie D Boyd",
            "Tony Fong",
            "Luis A Bolanos",
            "David Bierbrauer",
            "Teri Siu",
            "Matilde Balbi",
            "Federico Bolanos",
            "Matthieu Vanni"
        ],
        "publish_date": "2020-05-15T00:00:00",
        "summary": "",
        "meta_description": "A new methodology and protocol use automated brain imaging and task training technology to probe links between behavior and mouse cortical circuits.",
        "meta_lang": "en",
        "meta_favicon": "/assets/favicons/apple-touch-icon-57x57.c2b7763c.png",
        "meta_site_name": "eLife",
        "canonical_link": "https://elifesciences.org/articles/55964",
        "text": "We describe results and procedures to build and use a new generation of home cages with emphasis on training for simple headfixed tasks during simultaneous autonomous acquisition of mesoscale brain imaging data (Figure 1A,B for cage scheme and Figure 2 for training). We have tested 44 adult male GCaMP6 transgenic mice (Table 1 and Figure 3) and an additional cohort of 8 female mice that were trained for ~7 h/day that yielded similar levels of participation (Figure 3, Figure 3—figure supplement 1). Mesoscale widefield in vivo imaging maps activation of cortex over a field-of-view that can extend bilaterally from olfactory bulb to visual cortex (Mohajerani et al., 2013). In contrast to single cell imaging needing high resolution in the X-Y plane and in depth, wide field imaging is typically done with larger focal volume (~2–3 mm) to image curved brain surfaces and lower spatial resolution (pixels binned to ~32–49 μm) to sum more photons over a larger area (Lim et al., 2012). Thus, the intrinsically large depth of field and reduced resolution provided by the small lenses employed by compact cameras such as the Raspberry Pi Camera Module (Figure 1B,C) are not expected to degrade signals. While we emphasize single photon mesoscale widefield imaging within these cages, our system would also be suitable for training animals on complex headfixed tasks where imaging could be performed using parallel manual headfixation and advanced two-photon imaging or electrophysiological procedures (Chen et al., 2017; Le Merre et al., 2018; Prsa et al., 2017), as was already elegantly applied by others (Aoki et al., 2017). We include an extensive supplemental guide with full construction illustrations, parts lists (see Supplementary file 1 and Table 2), share files with Python acquisition and analysis code, and various CAD and electronics schematics in Supplementary file 3 or as online resources.\n\nFigure 1\n\nFigure 2\n\nTable 1\n\nTable 2\n\nThe home cage platform captures wide-scale transitions in brain activity from windows of 8.2 × 8.2 mm with video rate temporal resolution (30 Hz) for several months using a double cage system (Figure 1A). Our original system for automatically head fixing mice, while effective (Murphy et al., 2016), did not result in daily durations of head fixation that would rival those in manually head-fixed mice for behavioral training or the integration of behavior with brain imaging of more complex tasks (which are in the order of 15–40 min sessions/day) (Gilad et al., 2018; Guo et al., 2017; Guo et al., 2014; Prsa et al., 2017). We have optimized the original mouse voluntary head fixing system to improve the number of head fixes per day and the total time head fixed for each cage (Table 1). To accomplish this, we have used several strategies: doubling the cage size (tandem cage) to include up to 8–10 animals and improving the mechanical fixation mechanism which made the process more palatable for mice (Figure 1A,B). The initial design (Murphy et al., 2016) employed electromagnetic solenoids. Using this system, it was impossible to control the degree of restraint and it produced a significant audible and vibration stimulus. As an improvement to this, we developed a servo-based system (Hitec HF-645 or HSB-9475SH; use the latter for even less noise and vibration) which allows variable degrees of headfixation with an initial training period where mice were loosely headfixed (achieved by controlling the servo travel) (Figure 1B,C). Loose headfixation allows mice to move significantly and grow accustomed to restraint. This loose fixation period, along with the less jarring mechanics has resulted in significantly higher rates of headfixation than previous work (Murphy et al., 2016). In a total of 5 improved cages that were tested, we observed average of 28+−17 head fixations per day per animal for a subset of animals tested (23/44) that exhibited high rates of headfixation (for supplemental database of all mice see methods and repositories). The time headfixed for these 23 good performers averaged 18+−13 min/day per animal (Table 1, behavioral data from all mice are available in an online database, see methods). In the current cage the cut-off for a poor performer was <20 min of total headfixation time, while good performers averaged 15.8+−19.9 hr (summed time over all daily sessions). A difference over previous work (Murphy et al., 2016) was removing mice from the cage that were poor performers, or insisted on entering the headfixing tube sideways. Assuming a session length of ~40 s, which was the typical range in the previous system (Murphy et al., 2016), taking the top 50% of headfixing mice would result in an average of 6.5+−4 min of daily data acquisition or training per mouse using the initial design. In the improved cages, animals exhibit much longer daily durations of head fixation which leads to more spontaneous brain activity imaging data, but also the possibility to assess mesoscale functional circuits using GCaMP imaging as animal’s train in simple detection or choice tasks. In total we were able to record 34,114 videos of brain activity in headfix sessions, where 29,097 were task related. An additional 5423 sessions were recorded from a cage with 8 female mice during daily lab-based 7 h/day training where 5 advanced to high levels of participation (Figure 3—figure supplement 1). Moreover, the improved cage employs infrared beam breaks (Figure 1C) to determine mouse position for fixation rather than, as in the previous version (Murphy et al., 2016), electrical contact with the fixation bar where buildup of insulating dirt/oil can reduce sensitivity. A capacitance-based lick detector based around the MPR-121 that we employed previously in a mouse tapered beam assay (Ardesch et al., 2017) provides a system to confirm that mice are reaching the water spout and that they can register an output during a licking-based behavioral task. To relate the brain activity to the (currently) more than 7.5 million behavioral events (such as licking) and training circumstances we also implemented a relational database, allowing us to effectively analyze the data by pipelining plots and statistical tests to adaptive queries (see Materials and methods for how to access the database where we share all behavioral data collected).\n\nFor initial training 8–10 post-surgical male mice (2 cages of 10 and 3 cages of 8 mice) with RFID tags (Bolaños et al., 2017) and transcranial windows that were at least 45 days of age (Silasi et al., 2016) were kept in their double training cage for several weeks with ad libitum water from a bottle (Figure 2A, and see protocol steps in Methods). A group of female 8 mice was also trained in a similar manner (Figure 3—figure supplement 1). This ensures that the mice are well acclimated to the double cage (and each other) before headfixed training begins. Training begins by placing the mice within the headfixing cage and removing the water bottle overnight (Figure 2A). Mice were weighed on the subsequent day and this weight is the baseline by which 15% wt loss criteria were determined (for water supplementation). Mice received water from a spout for having their RFID tag read by a tag reader placed on the underside of the imaging chamber (see Materials and methods for details on spout positioning and strategies to prevent sideways entry).\n\nAfter determining that the majority of mice entered the chamber (by reading RFID tags and lick detection) we progressively moved the water spout until it is 7–10 mm from the back wall of the headfixation tube (typically this takes 5–18 days) (Figure 2A). At this point mice are be able to break the infrared beams (Figure 1B,C) with their snouts and trigger blue LED lights used for mesoscale imaging producing what are termed no-fix trials. Once the infrared beams are broken a no-fix trial is initiated the mouse receives up to 5 large water rewards for just getting at the end of the tube. Once most of the remaining mice achieved this level (mice with very low entries were removed from the cage) we start the headfix training. If mice break the beam the servo now travels enough to prevent mice from leaving the tube, but the headbars can still freely move up to 20 mm along the rails of the tube (Figure 2 and protocol steps Materials and methods). This step is termed loose headfixation. Initially we set a 50% probability of loose headfixation. Next, over 7–10 days we gradually tightened the fixation mechanism (increase servo forward travel, fixed setting) until the headbar was tightly pressed against the metal reinforcement at the end of the rails. Additionally, during this period we gradually increased the probability of headfixation until mice were fully headfixed 75–90% of the time for about 19–45 s. Headfixing probability was never set to 100% as a potential safety mechanism allowing animals that for some reason could not un-break the IR beams in time (parameter called skedaddle time in software) to be prevented from re-fixation. A text messaging service was also setup to send automated warnings if a mouse was present in the headfixing tube for longer than 600–800 s. Once mice were fully headfixed we continued using a single entrance reward as well as adding a licking task (Figure 2). Plotting entry rates, time headfixed, and headfixing rates for all mice tested indicated a peak of early entries just after the mice were placed in the cage (Figure 3A). At these early times of training (even in the second day in the cage) mice were actively licking the waterspout (Figure 3B). This was followed by a transition to headfixation which began with a loose restraint and was progressively tightened over 4–7 days to the point where mesoscale imaging data could be acquired with minimal motion artifact (Figure 3C). The records of headfixation for all 44 male mice are displayed over a 45 day period (Figure 3A–D) (note, not all cages were examined for all 45 days and cage 3 was shut down due to a power outage during day 13–17). The graphs illustrated that the mice entered less frequently after the first 10 days of headfixation once they transitioned from entrance rewards to receiving multiple task rewards (Figure 3A) and collectively the mice of the 5 cages could yield up to 4 hr headfixed training or imaging a day (Figure 3D).\n\nTo quantify the observed clustering of headfixation events within and between mice we determined the time between headfixes for individual mice, as well as the time between a single headfixing mouse and any other mouse headfixing. Consistent with previous findings (Murphy et al., 2016) mice headfixed repeatedly over short time intervals (Figure 4A,B, red) with an average median interval of 5.8+- 4.1 s (Figure 4C, red line). Surprisingly, plotting histograms for the time interval between different mice headfixing (Figure 4A,B, black) also showed short interval repetitions with a second different mouse: average median interval of 305+- 575 s indicating linked behaviors between mice. Plotting the median separately for each group (Figure 4C, black line) showed large differences in inter-mouse headfixing times between cages, indicating potential group dynamics, however given the small sample size of cages (n = 5) we did not investigate statistically. Cluster analysis indicated most headfixes occurred in large temporal groups that could involve 1 or several mice (Figure 4C,D,E,F). Plotting headfix events on a 24 hr timescale with each day stacked on the Y-axis (Figure 4D,F) indicated that headfixes are not done randomly, but often form dense clusters of activity and 69+−11% of headfixes were performed at night (n = 5 cages); with the exception of cage 6 tested during the day only. Testing the time interval between headfixes revealed that they were not uniformly or normally distributed across a day (Anderson-Darling test; test statistic 14137, critical value for 1% level is 1.092, indicating a very low probability of normality) consistent with the temporal clusters we observed.\n\nFigure 4\n\nSince headfixation was done in number of relatively short trials, mice were initially anticipating water delivery by vigorous licking following entrance rewards (Figure 5A). These high rates of licking can interfere with using licks within a behavioral task and will lead to brain activity largely reflecting frontal motor areas with the tongue (Guo et al., 2014). Therefore, the first stage of task training is called lick suppression where water is dispensed only when licking is withheld for 0.5–2 s. We added a 0.5 s mean random interval to this time to help ensure mice wait for a cue rather than use internal timing (Figure 5A); see group data on licking counts for all mice (Figure 5B). Licking at an inappropriate time was met with auditory feedback: a tone of 0.3 kHz was given to provide immediate feedback using piezo buzzer (Adafruit product #1739). Once lick suppression training was initiated mice were given a vibratory (Adafruit Vibe motor #1201) cue (500 ms continuous or pulsed 3 × 200 ms, 100 ms duty cycle) to signal that water will be dispensed after the lick suppression period is met. In cages 1 and 2 lick suppression began during headfixation, while in cages 3–5 it was started 2–4 days prior to loose headfixation. Over time the period of lick suppression was increased to 2 s (+- 0.5 s random interval) and water would only be dispensed when a mouse licks within a time window after the cue. As the goal was to extend training to a go and no-go task (Gilad et al., 2018), where mice will need to process and discriminate between two similar vibratory cues, we also added a self-timed delay period after the cue (0.3–1.1 s). Mice should not lick between the cue and the end of the delay period. When using the delay period, water was delivered following go-stimuli if the licking response occurred between the end of the delay period and 1.25 s after that (Figure 5A). For example, with a 1 s delay a mouse must lick between 1 and 2.25 s after the cue to receive a reward which comes 2.25 s from the cue. Initially, mice licked immediately after the cue and these errors were not rewarded and these task outcomes were termed lick early (coded −4) trials and signaled by auditory feedback using the same tone as for lick suppression (Figure 5B). Over time the delay period is increased from 300 ms by ~50–100 ms a day to an eventual 1100 ms. While we have termed these go and no-go trials, the addition of delay period (which in trained mice can be up to 1100 ms) makes the primary response after the vibratory conditioned stimulus (CS) a withholding of licking until after the delay period. Using this design all trials could be considered no-go and they would occur in the context of discriminating rewarded (CS+) and non-rewarded vibratory conditioning stimuli (CS-) that vary in frequency.\n\nFigure 5\n\nTypically, we did not set the probability of head fixing to be 100%. In most cages headfixing probability was initially set low 25–50% and then moved to 70–90%. Having the head fixed probability lower than 100% was thought to aid to some mice which preferred to do the task in non-head fixed manner. Surprisingly, analysis of success rate data for the Go detection task indicated that most mice actually had higher success rates while head-fixed than non-head fixed (RM 2WAY ANOVA, p=0.0026, n = 8) (Figure 5C). All data on task performance presented in Table 1 and used to calculate reported d’ were calculated for fully headfixed trials. We have not investigated the nature of this difference further, although it could suggest that head fixation helps to constrain mouse behaviors similar to that observed in reaching tasks that were not impaired by headfixation (Galiñanes et al., 2018). While the anecdotes of better task performance in headfixed mice are interesting, another explanation is that because there were more headfixed trials than in the non-headfixed state and animals were simply less practiced and not fully engaged during these trials.\n\nHaving longitudinal data also allowed us to assess whether mouse performance differed in the day or night period. In each of the 21 mice that performed the go task for more than 10 days we assessed whether they had a consistent diurnal preference for the licking task resulting in a significant difference in success rate. Overall, the ratio of success rate for day and night was similar across mice (1.03+0.17, t-test: p=0.40, maximum ratios: 0.56 and 1.39, n = 21 mice that performed the go-task under headfixation for more than 10 days). We also assessed whether any individual mouse had a consistent day-night preference (t-test for each mouse using day/night success ratios for each day) and found no instances of a significant bias (p>0.05), except M985 that had a very low success rate (see Table 1) and therefore produced a very inconsistent daily day and night success rate ratio.\n\nIn Figure 6 we show examples of lick detection and training of a single mouse over an early, intermediate, and advanced day of in cage training. The results of training are scored automatically for 6 possible task outcomes (Figure 6A). Mice were first trained on the go detection task and over the first 1–4 days could already pause and lick correctly (Go=+2 code) after the delay period. Even early in training there was relatively little non-rewarded early licking (Go=-4 code for early licking in the go trial (Figure 6B). The proportion of early licks (Go=-4) and ignored cues (Go=-2) was further reduced after 55–68 days of training even with a much longer delay period of up to 1 s (Figure 6C). No-go trials were introduced after 14 days of go-training and initially mice had trouble distinguishing the 2 trial types and would lick after the delay period as in a go-trial leading to a −1 code error (or −3 when licking early during the delay period for a no-go trial). Throughout training, there was marked reduction in licking after the no-go cue as the mice learned to distinguish the two stimuli (No-go trial correct rejection is No-go=+1) (Figure 6).\n\nFigure 6\n\nWhile we appreciate the power of a choice task, the sample sizes for the no-go task were relatively small (n = 10 mice) and only 5 of these mice had a sensitivity index (also called d’) greater than 2 during their best task training days. d’ is a z-transformed measure of the discrimination between go and no-go stimuli (hit rate (correct)z – false alarm (incorrect)z), with a value of 0 corresponding to no discrimination. In the d’ analysis we disregarded failures due to the delay time early lick errors (Figure 6A) to calculate the hit rate and false alarm rate as these nonetheless reflected stimulus detection. The 5 mice that were good performers had a d' that averaged 1.37+−0.53 over their days of testing and they reached a maximal daily d’ that averaged 2.3 +−0.52 and ranged from 1.9 to 3.21 (M252, M423, M026, M098, and M336). The statistic itself can be used as an estimate of how far values are from the hypothetical mean or 0, with 1.37 and 2.3 being in the 92% and 97% tails of the distribution. The other 5 mice performing the go and no-go task had lower average d’=0.2+−0.54 and only reached a mean d’ of 0.98+−1.01 in maximal daily training values.\n\nMesoscale GCaMP signals were collected from the dorsal cortex every time the mouse headfixed and examples are shown in Figure 7A. While the focus of this manuscript is on the construction of cages and the training of mice, we present cortical GCaMP6 imaging examples to illustrate that high-throughput automated mesoscale imaging is possible and can be integrated with behavior. The name of each brain imaging file which contains both the mouse ID and the time stamp can be found in the SQL database (RFIDtag_xxxx_timestamp.raw; see Materials and methods for URL and hosted as a full text file archive on Zenodo (https://doi.org/10.5281/zenodo.3268838) for the 5 cages of male mice and cage 6 female mice https://doi.org/10.5683/SP2/9RFXRP. GCaMP cortical signals allow functional connectivity to be assessed using correlational methods such as seed-pixel analysis of the hindlimb somatosensory cortex (Figure 7B). The location of hindlimb cortex was estimated by overlaying an averaged cortical anatomical parcellation based on the Allen Institute for Brain Science mouse connectivity atlas and the approximate location of the bregma landmark (Vanni et al., 2017). In addition to the brain video showing normalized cortical functional GCaMP6 signals, up to 3 other video cameras were used to obtain behavioral data under infrared illumination (Figure 7C,D,E). Circuity was added to cages 3–5 to turn-off infrared beam breaks once the mouse was headfixed as the infrared beam-breaks interfere with the behavioral cameras. Behavioral videos and GCaMP signals were synchronized using a master TTL switch that controls the infrared and blue LEDs used for GCaMP excitation or hemodynamic correction. As a means of illustrating the potential relationship between moving body parts and cortical mesoscale networks we made maps of the correlation between brain GCaMP signal pixels and normalized behavioral video ROIs for tongue, whiskers, and hindlimbs with a lag time of zero (see example Figure 7F). This analysis indicated a network of areas around limb and facial cortices that extended into frontal motor areas associated with licking (Guo et al., 2014). Plotting movement from the video analysis ROIs alongside licking rates (from the capacitance sensor) and mesoscale GCaMP signal for anterolateral motor cortex indicated that trial-associated licking bouts were accompanied by large scale body movements involving oral-facial, hindlimbs, and whiskers and GCaMP signals on the level of individual trials (Figure 7G,H), for group data analysis see Figure 9.\n\nFigure 7\n\nMesoscale wide-field imaging can inform the areal extent of cortical activation, but the procedure is not without its limitations. Imaging green epifluorescence is sensitive to interference from hemoglobin (both the amount and oxygenation content are factors) (Ma et al., 2017; Ma et al., 2016; Wekselblatt et al., 2016; Xiao et al., 2017). While blood dependent alteration in signals is less of a factor for newer generation GCaMPs with larger change in fluorescence divided by baseline (dF/Fo) (Vanni and Murphy, 2014; Xiao et al., 2017), it can nonetheless be a significant confound. Recent work suggests several correction strategies for green epifluorescence involving reflected light signals that serve as reference wavelengths and are the basis of most corrective schemes (Ma et al., 2017; Ma et al., 2016; Wekselblatt et al., 2016; Xiao et al., 2017). Within this improved home cage system we simultaneously capture a short blue wavelength reflected light (440 nm; near the hemoglobin isosbestic point) signal (into the blue RGB channel of the picam) to estimate these and other artifacts and correct for movements that would have parallel effects on short blue reflected light and green epi- fluorescence. The collection of this reference signal was made possible by using a triple band emission filter (Table 1). These artifacts were evaluated by determining both green epi-fluorescence and short blue reflected light dF/Fo and subtracting equaled scaled short blue reflection changes from the green epi-fluorescence dF/Fo at each pixel and time point studied. We acknowledge that future extensions could tune the weighting of these signals or add additional wavelengths (Ma et al., 2017). Typically, these changes in short blue reflection were <20% of the green GCaMP signal amplitude (Figure 7G) and produced relatively small decreases in reflected light signal apparent during averaged task dependent activity (Figure 8 and Figure 8—figure supplements 1–7). Technical considerations associated with using the Picam and its rolling shutter prevented us from collecting a green reflected light signal in alternating frames. While we acknowledge that a multispectral and model based strategy (Ma et al., 2017) would be an improvement, the procedure we employ nevertheless correlates well with the green reflected light (Xiao et al., 2017) strobing correction as in Wekselblatt et al., 2016 and was simpler to employ in the context of the home cage. To link mesoscale GCaMP activity with particular phases of a behavioral task, we used the lick detector as a means of registering a behavioral output. Signals on the lick detector were thresholded and recorded as binary events and assigned unix timestamps within a text file which accompanied each imaging session. Using Matlab software, we associated these text file time stamps with sequences of brain images also identified by a starting timestamp and confirmed by measuring the timing of the illumination LED on and off signals. To assess spatial extent of single trial signals we made montages of blue reflectance corrected GCaMP dF/F0 images that were binned over 400 ms (Figure 7H). These sequences of dF/F0 images even in single trials indicated remarkable fidelity around the delivery of the stimulus during go-trials and a wide cortical network activated during correctly scored go-trials.\n\nIn a mouse that was trained in the Go and No-go task for 49 and 36 days respectively we created average maps of cortical activity aligned to the presentation of the cue stimulus (Figure 8A); for other individual mouse examples see Figure 8—figure supplements 2 and 3 (mouse 8474 and 0252). In Figure 8 the mouse was trained to suppress licking for a 2 s +- 0.5 s random interval and then was presented with a vibration to its left paw after which it needed to wait for a delay period (self-timed, 900 ms) and then lick to be given a reward 1.25 s later (as described in Figure 2B). Figure 8 shows an example of average cortical maps of task and reward-dependent mesoscale GCaMP functional signal from cortex during rewarded trials (Figure 8A,B and Figure 8—Video 1). We observed quiescence within brain networks during the lick withhold period (pre-cue stimulus) when the animals must suppress licking and then a much larger response in sensori-motor cortex associated with preparation (during the delay period after the cue), execution of licking (Chen et al., 2017; Guo et al., 2014), and collection of the reward. By making averages of the GCaMP data and plotting regions of interest from motor cortex, we also observed changes in GCaMP6 signal before the presentation of the cue. It is possible that some of this brain activity is related to ongoing body movement dynamics associated with the task. To address this, we examined regions of interest from synchronized behavioral cameras directed on the body of the animal. Using the hindlimb behavioral ROI we compared all trials collected to those where hindlimb activity was low for 2 s preceding the stimuli (Figure 8B). This constraint led to the elimination of about 40% of the trials and removed a portion of the pre-trial brain activity from the average (see −2.5 and −2 s images, Fig, 8A/B and Figure 8—figure supplement 1). This finding is consistent with ongoing movements contributing to significant brain activity, a variable which must be addressed in any home cage or head-fixed behavioral task (Musall et al., 2018; Salkoff et al., 2020; Clancy et al., 2019; Stringer et al., 2019). This issue was further addressed in a group data analysis present in Figure 9 where movements before and after the cue strongly correlate with GCaMP dynamics.\n\nFigure 9\n\nThe ability to group trials based on task type and outcome allowed us to assess the difference in brain activation between average go and no-go trials in mouse M423 which exhibited good performance during the task (Figure 8C and Figure 8—Video 2). No-go trials were associated with minimal changes in brain activity and body movements, with most activity around the time of cue processing (1 s after cue presentation) and little activation associated with the advance to licking phase (as they did not lick in correct no-go trials).\n\nIn Figure 8—figure supplement 1 we plot data using the same format as Figure 8 for an earlier timepoint during training (30 days earlier) for the licking task (after 17 and 4 days of training in the go and no-go task respectively) from the same mouse M8423. In this example similar maps and dynamics were observed, but the self-timed delay period over which post-stimulus licking suppression occurred was shorter. In Figure 8—figure supplements 2 and 3 we show examples of averaged (correct) Go and No trial data from 2 additional mice from cage 4 (tags M8474 and M0252) and group average data on 13 mice in Figures 9 and 10 for the Go-detection phase of the task.\n\nFigure 10\n\nUsing the text file tags, we examined various types of licking related error trials, including trials where a mouse failed to respond to a stimulus (Figure 8—figure supplements 4A and 5A for two timepoints in training for mouse M8423 and Figure 8—figure supplements 6A and 7A for M8474 and M0252). These included no-go errors where the mouse was given a no-go cue, responded by licking, but was not rewarded (GO=-1) (Figure 8—figure supplements 4B and 5B for two timepoints in training for mouse M8423 and (Figure 8—figure supplements 6B and 7B for M8474 and M0252, Figure 8—Video 4). Also of interest were trials in which the mouse licked early, during the delay period during a go-trial, and was not rewarded. Analysis of averaged brain images during early response trials (−4 code) indicated that the errors were associated with brain activity during the period prior to the trial, and that this activity was also spilling over into the delay period ((Figure 8—figure supplements 4C and 5C and (Figure 8—Video 3). As expected, in lick too early trials, was a robust early increase in frontal cortical activity associated with tongue motor circuits. While mice were found to perform well in the go detection task, discriminating between go- and no-go stimuli was harder for them in practice and was limited to small number of examples and was not the focus of our study. For example, we found that some mice would lick for both go- and no-go trials in response to cues. These mice apparently did not consider a no-go trial as negative reinforcement (time out was small and no overt punishment applied) and merely licked during these trials in addition to the go-trials. In cases where a mouse licked in a no-go trial there was an initial brain response in limb and motor areas but the mouse would fail to show high rates of licking and associated frontal motor cortex brain activity later in the trial as no reward was given (Figure 8—figure supplements 4B, 5B, 6B and 7B).\n\nIn mouse home cages combined with mesoscale imaging we have attempted two kinds of behavioral tasks. The first is the simple go-trial or detection task where mice after a waiting period will respond to a vibratory cue by licking. We find that home cage mice are quite good at learning this task and that this can potentially report activity in circuits associated with the cue detection, as well as motor output associated with licking. We’ve also employed more advanced training strategies, including a go- and no-go task. In this case we had more variable rates of performance, in particular home cage mice have trouble with suppressing output during no-go trials. We attribute some of the lack of success in no-go training to be due to the nature of home cage training itself. In our home cage task there is no penalty for an animal doing an incorrect trial other than a short time penalty of a few seconds. Because of the potentially aversive nature of the headfixing experience, we decided to not actively punish animals for wrong responses using air-puffs or extended time-outs. A better task for home cage mice to perform would be a discrimination task with two rewarded outcomes, and an animal would specify them by licking from two different water spouts (Guo et al., 2014). Alternatively, a lever or wheel could be used to support the choice of 2 rewarded outcomes (Burgess et al., 2017). Other ways to motivate mice to do a more difficult task would be to make rewards in some ways more palatable, perhaps adding a choice of regular water versus sugar water. Another scheme might be to limit the total number of trials an animal could perform. With limited trials mice might be more motivated to exhibit a higher success rate rather than the lower rate they exhibit with unlimited time.\n\nThe time headfixed for these 23 good male performers averaged 18+−13 min/day (Table 1, behavioral data from all mice is available in an online database, see methods). A difference over previous work (Murphy et al., 2016) was removing mice from the cage that were poor performers, or insisted on entering the headfixing tube sideways. Other gains in performance might be obtained through mouse specific training criteria. In the current version of the cage software (used for cages 1–5) all animals are advanced through the go and no-go task together. While we report individual mouse results, it was not possible to selectively tailor the task to individual mice. For cage 6 (and the software we will supply going forward) there was the option to advance mice at different rates using animal specific task information. In other work we have done using a home cage lever task in non-headfixed mice, we did have the ability to alter task criteria based on individual animal performance (Silasi et al., 2018; Woodard et al., 2017). Here, if mice had difficulty with a phase of training, it was possible to downgrade them and make the task easier, allowing them get back on track rather than left thirsty and requiring supplemental water. The auto-headfixing cage will benefit from such individualized training criteria and it will be instituted in all future cages. While we discuss various improvements in trial design to lead to more complex tasks and even better animal engagement, the current hardware and software is capable of monitoring mesoscale circuits in a behavioral or movement based context. Emphasis in our lab has been around mesoscale imaging, notably the cage is also an ideal platform for mesoscale circuit control using optogenetics as transcranial windows readily support the optical control of targeted brain regions (Guo et al., 2014; Silasi et al., 2013; Silasi et al., 2016).\n\nWhile we have had success automating headfixing and training, it is clear that some mice are not interested in the system as headfixation is voluntary. In our system we have intentionally kept headfixed time short, no more than 45 s so that mice will have an opportunity to leave the device. However, during these short trials we find that most mice will re-headfix at a short interval <30 s, indicating a pattern associated with drinking, or some degree of acceptance of the task. It is anticipated that there could optimization of headfixed duration as other work in mice (Aoki et al., 2017) did use much longer but fewer blocks of restrained training using a latching mechanism. Other optimization could involve smaller reward sizes (Aoki et al., 2017) as we used a ~ 7–10 μl reward and always gave one task-independent entry reward. In this case we would not expect mice to perform more than 120 successful trials to obtain a daily 1 ml total that is typical for mouse training (Guo et al., 2014). In our case short bouts of headfixation led to mice performing about 100–200 licking task trials a day (males 24/7 training averaged 200 trials/day, females ~ 7 h/day 100 trials). While 100–200 trials/day/mouse is a much lower than some non-head-fixed home cage tasks where 500–2000 trials/mouse/day were observed (Bollu et al., 2019; Silasi et al., 2018), one needs to take into consideration that multiple animals are in the same cage and totals can approach 400–800 trials/day when all mice are considered (see Table 1). Furthermore, in our case by combining the task with mesoscale imaging each trial needs to have at least 3 s of data collected before and after the cue given the relatively slow GCaMP kinetics making these trials longer than some motor tasks that were less than 2 s (Silasi et al., 2018) or evaluated reaching trajectories (Bollu et al., 2019).\n\nIn summary, we present an open-source tool that is capable of training group-house mice for simple detection tasks while performed mesoscale imaging. We provide an extensive supplemental cage assembly guide and all documentation for hardware, software, and electronics and encourage users to further customize the cage to their needs.\n\nAnimals were anesthetized with isoflurane and a transcranial window was installed as previously described (Silasi et al., 2016; Vanni and Murphy, 2014) and in an amended and more extensive protocol described below. A sterile field was created by placing a surgical drape over the previously cleaned surgical table, and surgical instruments were sterilized with a hot bead sterilizer for 20 s (Fine Science Tools; Model 18000–45). Mice were anesthetized with isoflurane (2% induction, 1.5% maintenance in air) and then mounted in a stereotactic frame in with the skull level between lambda and bregma. The eyes were treated with eye lubricant (Lacrilube; www.well.ca) to keep the cornea moist, and body temperature was maintained at 37°C using a feedback-regulated heating pad monitored by a rectal probe. Lidocaine (0.1 ml, 0.2%) was injected under the scalp, and mice also received a 0.5 ml subcutaneous injection of a saline solution containing burprenorphine (2 mg/ml), atropine (3 μg/ml), and glucose (20 mM). The fur on the head of the mouse (from cerebellar plate to near the eyes) was removed using a fine battery powered beard trimmer, and the skin was prepared with a triple scrub of 0.1% Betadine in water followed by 70% ethanol. Respiration rate and response to toe pinch was checked every 10–15 min to maintain surgical anesthetic plane.\n\nPrior to starting the surgery, a No. 1 circular cover-glass (Marienfeld, Lauda-Konigshofen, Germany; Cat#:0111520) was cut with a diamond pen (ThorLabs, Newton, NJ, USA; Cat#: S90W) to the size of the final cranial window (~9 mm diameter). A skin flap extending over both hemispheres approximately 8 mm in diameter (3 mm anterior to bregma to posterior end of skull and down lateral to eye level) was cut and removed. A #10 scalpel (curved) and sterile cotton tips were used to gently wipe off any fascia or connective tissue on the skull surface making sure it was completely clear of debris and dry before proceeding. The clear version of C and B-Metabond (Parkell, Edgewood, NY, USA; Product: C and B Metabond) dental cement was prepared by mixing 1 scoop of C and B Metabond powder (Product: S399), 6 drops of C and B Metabond Quick Base (Product: S398) and one drop of C and B Universal catalyst (Product: S371) in a ceramic or glass dish (do not use plastic). Once the mixture reaches a consistency that makes it stick to the end of a wooden stir stick, a titanium fixation bar (22.2 × 2.7×3.2 mm) was placed so that there was a 4 mm posterior space between the bar edge and bregma, by applying a small amount of dental cement and holding it pressed against the skull until the cement partially dried (1–2 min). With the bar in place, a layer of dental adhesive was applied directly on the intact skull. The precut cover glass was gently placed on top of the mixture before it solidifies (within 1 min) taking care to avoid bubble formation. If necessary, extra dental cement was applied around the edge of the cover slip to ensure that all of the exposed bone was covered, and that the incision site was sealed at the edges. The skin naturally tightens itself around the craniotomy and sutures are not necessary. The mixture remains transparent after it solidifies and one should be able to clearly see large surface veins and arteries at the end of the procedure. In the same surgery a small incision was made over the abdomen and an RFID tag (125 kHz glass Sparkfun) was implanted and secured by a suture in a similar manner as described previously (Bolaños et al., 2017). Once the dental cement around the coverslip is completely solidified (up to 20 min), the animal received a second sub-cutaneous injection of saline (0.5 ml) with 20 mM of glucose, and allowed to recover in the home cage with an overhead heat lamp and intermittent monitoring (hourly for the first 4 hr and every 4–8 hr thereafter for activity level). Allow the mouse to rest for approximately 7 days before experimenting with the mouse.\n\nIn initial cages the water spout tip was mounted within 20 mm of the entrance (cages 1 and 2), but we found problems with accurate RFID tag reading since mice would not enter far enough into the imaging chamber to reliably trigger the tag reader. In cages 3–5 the water spout was initially placed 65 mm from the headfixing tube entrance ensuring that animals would come in far enough to have their RFID tag accurately read and that would allow us to confirm that all animals were involved in the initial phases of training and they were able to lick the spout. Because we noticed that some animals would enter the headfixing tube improperly (sideways), we installed removable 3D-printed plastic barriers to prevent an animal with a vertical bar from reaching the water spout if they enter the head fixing tube sideways (see Table 2, i.e. AHF_HeadStraightener_50 mm.stl). Two barriers were used as the water spout position was manually advanced in training. The first barrier was 50 mm long and the water spout was placed 15–25 mm after the end of this barrier. Based on the advancing spout positions, we updated mice to a smaller 25 mm barrier and then completely removed the barrier once the water spout is in the final position and it was unlikely that a mouse entering sideways could still reach the spout at this point.\n\nMice not fully engaged in the task (or continuing to enter the tube sideways) at these early stages of training (first 3 weeks) were removed from the cage. During early phases of training (first 1–3 weeks), we make use of video streaming to continuously monitor the cage and did not require the mice to perform any task to obtain water. By entering the head fixing tube and having RFID tag read, mice received what was termed as an entrance reward. Initially, the volume of rewards would be large (~20 μl) and this amount is gated by the duration of the valve opening (up to 500 ms). Once the mice advance significantly in training, the volume of the entrance rewards can be reduced by shortening the valve opening time (100–400 ms, drop now ~7–10 μl). We then included additional large task water rewards for breaking the infrared beams which would indicate that the animal has entered the head fixing tube far enough to potentially trigger the headfixation mechanism (these are termed no-fix trials, see below). At this initial stage of testing we also monitored animal weight using the parallel weighing cage technology (Noorshams et al., 2017). However, since we individually inspect their health once a day and in the process manually weigh animals, we have relied on manual weights for management of water supplementation for this study. Female mice were trained in automated daily lab-based sessions of ~7 hr duration and lacked auditory feedback for early licking.\n\nWe trained a linear model to predict trial outcome (correct or incorrect GO trials) based on calcium activity recorded during the trial. Incorrect trial outcomes consisted of errors where mice licked during the delay period (before the correct response period) and where they licked after the correct response period (or not at all), hereafter named early and late errors. Calcium activity (454 single trials across 13 mice) from 16 bilateral cortical regions of interest (anterior lateral motor cortex (ALM), secondary motor cortex (M2), primary motor cortex (M1), forelimb area (FL), hindlimb area (HL), barrel cortex (BC), retrosplenial cortex (RS), and primary visual cortex (V1)) was z-scored and then spatially averaged within each region over a 0.7 × 0.7 mm area and across hemispheres. To account for multicollinearity, we used a ridge regression model previously described (Pinto et al., 2019)1. The model was fit with 50 runs of 3-fold cross validation for each frame of calcium activity in the trial. Briefly, the model can be described as:\n\ny=β0+Xβ+λβ\n\nWhere y is a Nx1 vector of outcomes (1 or -1 for correct or incorrect trials respectively) where N is the number of trials, β0 is an offset term, X is a NxR matrix of z-scored ΔF/F0 values where R is the number of ROIs, β is a Rx1 vector of coefficient values, β is the Euclidean norm of the coefficient values, and λ is a penalty term. The optimal value for λ was determined through cross validation (Pinto et al., 2019). Prediction accuracy was determined as the proportion of outcomes from the test set that were correctly classified. To evaluate each region’s contribution to the model’s prediction accuracy, we created reduced models for each predictor (calcium activity from individual cortical region) from the model. Predictors were eliminated by randomly permuting trials of the ΔF/F0 time series from an individual region (1000 iterations). We also compared the models to a randomly permuted model, in which the trial labels (e.g. correct or incorrect) were randomly permuted (1000 iterations). The difference in prediction accuracy between the full model and the reduced model was the unique contribution of that region’s calcium activity to prediction accuracy (Musall et al., 2019; Salkoff et al., 2020).\n\nResults are presented as mean +- standard deviation unless noted otherwise. Experimenters were not blinded during the experiment or the analysis, although automated acquisition and analysis procedures were employed. Some animals were excluded from the results as indicated (based on poor head-fixation performance or health concerns) and no method of randomization was used. Sample size measurements for analysis of imaging data were consistent with previous work (Mohajerani et al., 2013).\n\nBehavioral events were printed within textfiles with timestamp and RFID tag information and then uploaded to an online MySQL relational database. Raw events were further analyzed in Python and processed into detailed summary information about each chamber entry, head-fix session, task driven trial, lick, earned reward and video file. These newly stored tables were further sourced to generate pipelines for daily monitoring of the animals, statistics and figures, allowing their direct update by adjusting the query sent to the database. The database allows the selection and download of data with SQL queries with libraries like e.g. pymysql (Python) or similar SQL connectors and can be setup locally. For data on cages 1–5 see Zenodo https://doi.org/10.5281/zenodo.3268838 and cage 6 female mice see https://doi.org/10.5683/SP2/9RFXRP, Scholars Portal Dataverse.\n\nClustering of the behavior was done using 1D kernel density estimation using the timestamp as the variable. Head-fix start times were substituted by a Gaussian with standard deviation of 50 s, which is the average time a mouse needs for a single head-fixation including entering and exiting the chamber. The signal minima that appear between two head-fixes were thresholded at approximately 5% of the peak amplitude of an isolated head-fixation signal to identify the end of a cluster. This corresponds to 2.4 sigma (99% probability) and results in cluster breaks after 4–5 min without head-fixation.\n\nThe headfixation task-trial software had provisions to allow mice extra time to finish a partial trial. In a small number of cases (less than 5% of trials) when the last task trial occurred beyond the point of specified headfixation duration there were cases where the trial lacked the usual lick withhold time. In these instances a small number of licks would appear in the lick withhold period. We have removed these trials from the lick analysis and they were typically not included in averaged brain imaging GCaMP data as we only included trials where there was 3 s of data after the stimulus and before the brain LED turns off.\n\nAnalysis of brain GCaMP dynamics was performed in Matlab using an analysis pipeline that was similar to that previously reported (Murphy et al., 2016), but with the addition of a 440 nm light reflectance image reference subtraction (Ma et al., 2017; Ma et al., 2016; Wekselblatt et al., 2016; Xiao et al., 2017). Plots in Figure 8, and Figure 8—figure supplements 2–7 include the mean +-SEM. For analysis of behavioral data we employed ROIs over specific body parts and expressed movement as the absolute value of the gradient between two adjacent frames that are scaled according to the max and min value of all the ROIs."
    }
}