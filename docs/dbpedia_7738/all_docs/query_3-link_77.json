{
    "id": "dbpedia_7738_3",
    "rank": 77,
    "data": {
        "url": "https://www.linkedin.com/pulse/open-source-security-powerhouse-integrating-wazuh-you-gonzalez-diaz",
        "read_more_link": "",
        "language": "en",
        "title": "Open Source Security Powerhouse: Integrating Wazuh and ClamAV, you no longer have any excuses to continue being so cyber-dirty.",
        "top_image": "https://media.licdn.com/dms/image/v2/D4D12AQGmxEHIWFcvHg/article-cover_image-shrink_720_1280/article-cover_image-shrink_720_1280/0/1689839442256?e=2147483647&v=beta&t=Lw2wG_RuktilLy4_koKVAkOuwECOY5B8bhKx4t1H1cQ",
        "meta_img": "https://media.licdn.com/dms/image/v2/D4D12AQGmxEHIWFcvHg/article-cover_image-shrink_720_1280/article-cover_image-shrink_720_1280/0/1689839442256?e=2147483647&v=beta&t=Lw2wG_RuktilLy4_koKVAkOuwECOY5B8bhKx4t1H1cQ",
        "images": [
            "https://media.licdn.com/dms/image/v2/D4D12AQGmxEHIWFcvHg/article-cover_image-shrink_720_1280/article-cover_image-shrink_720_1280/0/1689839442256?e=2147483647&v=beta&t=Lw2wG_RuktilLy4_koKVAkOuwECOY5B8bhKx4t1H1cQ"
        ],
        "movies": [],
        "keywords": [],
        "meta_keywords": [
            ""
        ],
        "tags": null,
        "authors": [
            "Asier Gonzalez Diaz"
        ],
        "publish_date": "2023-07-20T08:38:46+00:00",
        "summary": "",
        "meta_description": "Well, first things first, and as almost always, I'll give you a musical recommendation to have a good time..",
        "meta_lang": "en",
        "meta_favicon": "https://static.licdn.com/aero-v1/sc/h/al2o9zrvru7aqj8e1x2rzsrca",
        "meta_site_name": "",
        "canonical_link": "https://www.linkedin.com/pulse/open-source-security-powerhouse-integrating-wazuh-you-gonzalez-diaz",
        "text": "Well, first things first, and as almost always, I'll give you a musical recommendation to have a good time... 'Viva La Vida' by Coldplay, 2008. It's been 15 years already, but how the hell did these years pass by so quickly!...And the worst part is that I've lost the logs from these past 3 lustrums.\n\nClamAV & Wazuh\n\nAs you already know, I love Wazuh. It's an incredible tool that allows you to do many things, well, not make love, but who knows what the future holds... ha, ha, ha! Here are some posts that I wrote about Wazuh. They are mine, so the level is up to my English... ha, ha, ha!...low level, but using good documentation. Referring to oneself in a post is very tacky, It's like talking about yourself in the third person...damn, you sound stupid, but you know what, I don't care, I Love it! → Icona Pop - I Love It (2012), ha,ha,ha, of course, it’s a joke:\n\nDo you want to have an open source Active-Response system capable of acting simultaneously on all your devices? -> Wazuh Active Response...Oh mamma!\n\nUnified XDR and SIEM protection for endpoints and cloud workloads...WAZUH!!!. Flexible, scalable, no vendor lock-in, and no license costs.\n\nFile Integrity Monitoring (FIM), detect malware and active response to malware detection...Again Wazuh TCPLB|YSOYP!!!\n\nDetecting malware with Wazuh...use a public (VirusTotal) or private hashes “database” to identify malicious files.\n\nWazuh's response to malware detection: “Go ahead, make my day”. Dirty Harry's way.\n\nSecurity Monitoring with Wazuh, Elasticsearch, and Nagios Integration. Working with Wazuh and Elasticsearch APIs…\n\nhttps://www.linkedin.com/posts/asier-gonzalez-diaz-848b1413_wazuh-siem-sca-activity-7057219627675697152-z_Kn?utm_source=share&utm_medium=member_desktop\n\nhttps://www.linkedin.com/posts/asier-gonzalez-diaz-848b1413_wazuh-siem-monitor-activity-7068167509014683648-Gcvj?utm_source=share&utm_medium=member_desktop\n\nCome on, AI! Let's see what you can tell me about Wazuh!!!\n\nWazuh is a free and open source security platform that provides threat prevention, detection, and response. It combines the SIEM (security information and event management) and XDR (extended detection and response) capabilities to provide a comprehensive view of your security environment. Wazuh can collect data from a variety of sources, including logs, network devices, and security systems. This data is analyzed for potential threats, and alerts are generated for security analysts. Wazuh can also respond to threats automatically, blocking malicious traffic and removing malicious files.\n\nCome on, AI! Let's see what you can tell me about CalmAV!!!\n\nClamAV is an open-source antivirus engine that is used to scan for viruses, malware, and other malicious software. It is a free and lightweight tool that can be used on a variety of platforms, including Linux, Windows, and macOS.\n\nClamAV has a number of features that make it a valuable tool for protecting your computer from malware. These features include:\n\nSignature-based scanning: ClamAV uses a database of virus signatures to identify known malware. This is the most common method of virus detection.\n\nHeuristic scanning: ClamAV also uses heuristic scanning to identify unknown malware. This type of scanning looks for patterns in files that are indicative of malware.\n\nOn-access scanning: ClamAV can be configured to scan files as they are opened or accessed. This can help to prevent malware from being executed.\n\nClamAV is a powerful and versatile antivirus tool that can be used to protect your computer from malware.\n\nThe integration between ClamAV and Wazuh typically involves setting up ClamAV to scan specific directories or files on the system. When ClamAV detects a potential threat, it generates an alert indicating the presence of malware. However, by integrating ClamAV with Wazuh, these alerts can be seamlessly forwarded to the Wazuh manager for centralized monitoring and analysis.\n\nThe integration benefits from Wazuh's powerful alerting and analysis capabilities, allowing security teams to receive real-time notifications when ClamAV detects malware. Additionally, Wazuh can correlate ClamAV alerts with other security events, providing a more comprehensive view of potential threats within the environment.\n\nFurthermore, Wazuh can leverage its capabilities to trigger automated responses or take remediation actions based on the ClamAV alerts. For instance, it can isolate the infected system from the network or launch a script to automatically quarantine the affected files.\n\nIf you deploy an antivirus and integrate it with Wazuh your cybersecurity posture will be...Macho Man Village People (1978)...\"Macho, macho man (macho man, yeah) \\ I gotta be a macho man (I gotta be a macho man) \\ Macho, macho man (yeah) I gotta be a macho (oowh)\", ha, ha, ha,...I'm laughing my ass off by myself.\n\nThe LAB\n\nHaving said that, let's move on to describing the new laboratory. In this environment, we have Wazuh in an all-in-one configuration and 4 machines where ClamAV has been installed. Additionally, on the machines where the antivirus is running, the Wazuh agent has also been installed. The 4 machines are Linux systems: 1 Debian Bookworm (Debian 12) that serves as the Wazuh all-in-one, a Debian Bookworm virtual machine (Debian 12) where containers are running for the EJBCA CE (Keyfactor - PKI) service, 1 Debian Bookworm workstation (Debian 12), and finally, a Raspberry Pi 4 running Raspbian GNU/Linux 12.\n\nHere are the installation and update guides that I have followed → Wazuh: Offline installation, Wazuh Upgrade: Wazuh central components, Installing ClamAV and Upgrading ClamAV.\n\nHowever, there is an exception to all of this, which is the use of ClamAV (including real-time on-access scanning) on the Raspberry Pi 4:\n\nIn order to make ClamAV on-access prevention work, FANOTIFY_ACCESS_PERMISSIONS must be enabled in the kernel. **The kudos go to yatch**: https://linuxfun.org/en/2020/12/14/clamonacc-onaccessprevention-true-en/\n\nTo carry this out, I will show you the steps I have followed:\n\n1- Building the Kernel (Raspberry Pi OS):\n\nsudo apt install git bc bison flex libssl-dev make git clone --depth=1 https://github.com/raspberrypi/linux\n\nFor Raspberry Pi 4 and 400, and Raspberry Pi Compute Module 4 default 32-bit build configuration:\n\ncd linux KERNEL=kernel7l make bcm2711_defconfig Edit .config: CONFIG_LOCALVERSION=\"-v7l-MY_CUSTOM_KERNEL\"\n\nUse make menuconfig to enable FANOTIFY_ACCESS_PERMISSIONS:\n\nAnd then:\n\nmake -j4 zImage modules dtbs sudo make modules_install sudo cp arch/arm/boot/dts/*.dtb /boot/ sudo cp arch/arm/boot/dts/overlays/*.dtb* /boot/overlays/ sudo cp arch/arm/boot/dts/overlays/README /boot/overlays/ sudo cp arch/arm/boot/zImage /boot/$KERNEL.img\n\nNow, restart the computer and hope that everything goes well...\n\n➜ zcat /proc/config.gz | grep FANOTIFY_ACCESS_PERMISSIONS CONFIG_FANOTIFY_ACCESS_PERMISSIONS=y\n\nGreat, we're the shit!\n\nClamAV Configuration\n\nIt seems like we're on the right path, and if not, I'm sorry, it's fine with me. Perfect, this is an example of the ClamAV configuration (/etc/clamav/clamd.conf) on one of my devices. They are practically all the same, except for the exclusions:\n\nLocalSocket /var/run/clamav/clamd.ctl FixStaleSocket true LocalSocketGroup clamav LocalSocketMode 666 User clamav ScanMail true ScanArchive true ArchiveBlockEncrypted false MaxDirectoryRecursion 15 FollowDirectorySymlinks false FollowFileSymlinks false ReadTimeout 180 MaxThreads 12 MaxConnectionQueueLength 15 LogSyslog false LogRotate true LogFacility LOG_LOCAL6 LogClean false LogVerbose false PreludeEnable no PreludeAnalyzerName ClamAV DatabaseDirectory /var/lib/clamav OfficialDatabaseOnly false SelfCheck 3600 Foreground false Debug false ScanPE true MaxEmbeddedPE 10M ScanOLE2 true ScanPDF true ScanHTML true MaxHTMLNormalize 10M MaxHTMLNoTags 2M MaxScriptNormalize 5M MaxZipTypeRcg 1M ScanSWF true ExitOnOOM false LeaveTemporaryFiles false AlgorithmicDetection true ScanELF true IdleTimeout 30 CrossFilesystems true PhishingSignatures true PhishingScanURLs true PhishingAlwaysBlockSSLMismatch false PhishingAlwaysBlockCloak false PartitionIntersection false DetectPUA false ScanPartialMessages false HeuristicScanPrecedence false StructuredDataDetection false CommandReadTimeout 30 SendBufTimeout 200 MaxQueue 100 ExtendedDetectionInfo true OLE2BlockMacros false AllowAllMatchScan true ForceToDisk false DisableCertCheck false DisableCache false MaxScanTime 120000 MaxScanSize 100M MaxFileSize 25M MaxRecursion 16 MaxFiles 10000 MaxPartitions 50 MaxIconsPE 100 PCREMatchLimit 10000 PCRERecMatchLimit 5000 PCREMaxFileSize 25M ScanXMLDOCS true ScanHWP3 true MaxRecHWP3 16 StreamMaxLength 25M LogFile /var/log/clamav/clamav.log LogTime true LogFileUnlock false LogFileMaxSize 0 Bytecode true BytecodeSecurity TrustSigned BytecodeTimeout 60000 OnAccessMaxFileSize 5M # on access scan OnAccessIncludePath /home/nagios OnAccessExcludePath /home/nagios/.ssh OnAccessExcludePath /home/nagios/.oh-my-zsh OnAccessExcludePath /home/nagios/.config OnAccessExcludePath /home/nagios/.local OnAccessIncludePath /usr/local/nagios/libexec OnAccessIncludePath /usr/local/nagios/etc OnAccessIncludePath /usr/local/nagvis OnAccessExcludeUname root OnAccessExcludeUname clamav OnAccessPrevention yes OnAccessExtraScanning true\n\nWazuh Configuration (ClamAV) ClamAV logs collection\n\nYou can configure ClamAV and collect its logs from Linux and Windows endpoints. To collect ClamAV logs from Linux endpoints, remove the # comment tag before the LogSyslog true statement in /etc/clamav/clamd.conf (I did not do that). Uncommenting this statement forwards ClamAV logs to the Syslog file /var/log/syslog. You don’t need further configuration after this because the Wazuh agent reads the /var/log/syslog file by default.\n\nIf you want to store ClamAV logs in a separate file, you can include it in the Wazuh agent configuration (/var/ossec/etc/ossec.conf).\n\n<localfile> <log_format>syslog</log_format> <location>/var/log/clamav/clamav.log</location> </localfile>\n\nThe truth is, it doesn't matter much if you use on-access scan and if you have the setup the LogSyslog to true. In this case, the on-access scan logs are also written to syslog, even if you have configured them to be written to another file (/var/log/clamav/clamonaccess.log). As a summary, you have clamd logs (/var/log/clamav/clamav.log) and on-access can logs (here → /var/log/clamav/clamonaccess.log and here → /var/log/syslog)\n\n➜ ~ systemctl status clamonaccess.service ● clamonaccess.service - ClamAV On Access Loaded: loaded (/etc/systemd/system/clamonaccess.service; enabled; preset: enabled) Active: active (running) since Wed 2023-07-19 18:56:25 CEST; 1h 22min ago Process: 1578 ExecStartPre=/bin/bash -c while [ ! -S /run/clamav/clamd.ctl ]; do sleep 1; done (code=exited, status=0/SUCCESS) Main PID: 2912 (clamonacc) Tasks: 8 (limit: 4915) CPU: 5.462s CGroup: /system.slice/clamonaccess.service └─2912 /usr/sbin/clamonacc --fdpass -F --verbose --log=/var/log/clamav/clamonaccess.log --move=/home/quarantine\n\nWazuh has decoders for ClamAV logs out-of-the-box. Therefore, you don’t need to create any decoders for these logs. Furthermore, we include rules for ClamAV, which you can find at /var/ossec/ruleset/rules/0320-clam_av_rules.xml on the Wazuh server.\n\nNote: The out-of-the-box decoders only decode ClamAV logs from /var/log/syslog on Linux endpoints.\n\nDetecting viruses centrally\n\nThe time has come to test our tools. To do this, we will download a test virus onto the Raspberry Pi. Once ClamAV detects the virus, it will send a log to the syslog system and move the file to quarantine. Wazuh will analyze the syslog information and generate the corresponding alerts and actions, ¡Te Cagas Por Las Bragas!:\n\n➜ virustest pwd /home/nagios/virustest ➜ virustest ls -lah total 8.0K drwxr-xr-x 2 nagios nagios 4.0K Jul 19 20:58 . drwxr-xr-x 11 nagios nagios 4.0K Jul 19 21:28 .. ➜ virustest ls -lah /home/quarantine total 8.0K drwxr-xr-x 2 root root 4.0K Jul 19 21:25 . drwxr-xr-x 6 root root 4.0K Jul 19 20:45 .. **Virus download -> /home/nagios/virustest** ➜ virustest wget https://secure.eicar.org/eicar.com --2023-07-19 21:28:25-- https://secure.eicar.org/eicar.com Resolving secure.eicar.org (secure.eicar.org)... 89.238.73.97, 2a00:1828:1000:2497::2 Connecting to secure.eicar.org (secure.eicar.org)|89.238.73.97|:443... connected. HTTP request sent, awaiting response... 200 OK Length: 68 Saving to: ‘eicar.com’ eicar.com 100%[======================================================================================================================>] 68 --.-KB/s in 0s 2023-07-19 21:28:25 (23.3 MB/s) - ‘eicar.com’ saved [68/68] **The virus has been moved to quarantine** ➜ virustest ls -lah total 8.0K drwxr-xr-x 2 nagios nagios 4.0K Jul 19 21:28 . drwxr-xr-x 11 nagios nagios 4.0K Jul 19 21:28 .. ➜ virustest ls -lah /home/quarantine total 12K drwxr-xr-x 2 root root 4.0K Jul 19 21:28 . drwxr-xr-x 6 root root 4.0K Jul 19 20:45 .. -rw-r--r-- 1 nagios nagios 68 Jul 1 2020 eicar.com ➜ virustest\n\nLogs generated by the virus detection:\n\n➜ nagios tail -f /var/log/syslog /var/log/clamav/clamav.log /var/log/clamav/clamonaccess.log |grep -E EICAR\\|== ==> /var/log/syslog <== ==> /var/log/clamav/clamav.log <== ==> /var/log/clamav/clamonaccess.log <== ==> /var/log/syslog <== ==> /var/log/clamav/clamonaccess.log <== /home/nagios/virustest/eicar.com: Win.Test.EICAR_HDB-1 FOUND ==> /var/log/clamav/clamav.log <== Wed Jul 19 21:28:25 2023 -> /home/nagios/virustest/eicar.com: Win.Test.EICAR_HDB-1(44d88612fea8a8f36de82e1278abb02f:68) FOUND ==> /var/log/clamav/clamonaccess.log <== ==> /var/log/syslog <== Jul 19 21:28:25 raspberrypi-station-1 clamonacc[23535]: /home/nagios/virustest/eicar.com: Win.Test.EICAR_HDB-1 FOUND Jul 19 21:28:25 raspberrypi-station-1 clamd[23250]: Wed Jul 19 21:28:25 2023 -> /home/nagios/virustest/eicar.com: Win.Test.EICAR_HDB-1(44d88612fea8a8f36de82e1278abb02f:68) FOUND Jul 19 21:28:25 raspberrypi-station-1 clamd[23250]: /home/nagios/virustest/eicar.com: Win.Test.EICAR_HDB-1(44d88612fea8a8f36de82e1278abb02f:68) FOUND ==> /var/log/clamav/clamonaccess.log <== ==> /var/log/syslog <== ==> /var/log/clamav/clamonaccess.log <== ==> /var/log/syslog <==\n\nWazuh Dashboard\n\nThe results of the detection are displayed in the Wazuh Dashboard:\n\nAs you can imagine, any Wazuh agent can report antivirus detections... It's wonderful!\n\nConclusion\n\nUsing Wazuh in combination with ClamAV provides a strong and efficient security solution. Wazuh's centralized monitoring and analysis capabilities, along with ClamAV's reliable antivirus scanning, enhance the detection and response capabilities of any IT infrastructure. This integration allows for timely and effective identification of potential threats, enabling proactive measures to mitigate security risks. Overall, the combination of Wazuh and ClamAV helps organizations maintain a safer and more secure environment for their digital assets and sensitive data.\n\nCome on, it's freaking awesome, and it's open source too. Damn, it must be like kissing Charlize Theron or Brad Pitt.\n\nDocumentation\n\nhttps://wazuh.com/\n\nhttps://documentation.wazuh.com/current/user-manual/capabilities/malware-detection/clam-av-logs-collection.html\n\nhttps://www.clamav.net/\n\nhttps://blog.clamav.net/2019/09/understanding-and-transitioning-to.html\n\nDo you want to have an open source Active-Response system capable of acting simultaneously on all your devices? -> Wazuh Active Response...Oh mamma!\n\nUnified XDR and SIEM protection for endpoints and cloud workloads...WAZUH!!!. Flexible, scalable, no vendor lock-in, and no license costs.\n\nFile Integrity Monitoring (FIM), detect malware and active response to malware detection...Again Wazuh TCPLB|YSOYP!!!\n\nDetecting malware with Wazuh...use a public (VirusTotal) or private hashes “database” to identify malicious files.\n\nWazuh's response to malware detection: “Go ahead, make my day”. Dirty Harry's way.\n\nSecurity Monitoring with Wazuh, Elasticsearch, and Nagios Integration. Working with Wazuh and Elasticsearch APIs…\n\nhttps://www.linkedin.com/posts/asier-gonzalez-diaz-848b1413_wazuh-siem-sca-activity-7057219627675697152-z_Kn?utm_source=share&utm_medium=member_desktop\n\nhttps://www.linkedin.com/posts/asier-gonzalez-diaz-848b1413_wazuh-siem-monitor-activity-7068167509014683648-Gcvj?utm_source=share&utm_medium=member_desktop\n\nhttps://documentation.wazuh.com/current/deployment-options/offline-installation.html\n\nhttps://documentation.wazuh.com/current/upgrade-guide/upgrading-central-components.html\n\nhttps://docs.clamav.net/"
    }
}