{
    "id": "dbpedia_7738_0",
    "rank": 65,
    "data": {
        "url": "https://www.criticaldesign.net/post/how-to-setup-a-suricata-ips",
        "read_more_link": "",
        "language": "en",
        "title": "How to Setup a Suricata IPS: Part 1",
        "top_image": "https://static.wixstatic.com/media/a61146_81b0589d61fc412394bc73a5564450e9~mv2.jpg/v1/fill/w_1000,h_571,al_c,q_85,usm_0.66_1.00_0.01/a61146_81b0589d61fc412394bc73a5564450e9~mv2.jpg",
        "meta_img": "https://static.wixstatic.com/media/a61146_81b0589d61fc412394bc73a5564450e9~mv2.jpg/v1/fill/w_1000,h_571,al_c,q_85,usm_0.66_1.00_0.01/a61146_81b0589d61fc412394bc73a5564450e9~mv2.jpg",
        "images": [
            "https://static.wixstatic.com/media/a61146_7a81030c75104923944721fcfdd8a61b~mv2.png/v1/fill/w_132,h_41,al_c,q_85,usm_0.66_1.00_0.01,enc_auto/CDA%20logo%20WHITE.png",
            "https://static.wixstatic.com/media/a61146_24e7281f06c342d99dcb2898b1d913e7~mv2.png/v1/fill/w_73,h_67,al_c,q_85,usm_0.66_1.00_0.01,blur_2,enc_auto/a61146_24e7281f06c342d99dcb2898b1d913e7~mv2.png",
            "https://static.wixstatic.com/media/a61146_5f0bf3d9f8614fcf97c1888ea64cc18a~mv2.png/v1/fill/w_49,h_8,al_c,q_85,usm_0.66_1.00_0.01,blur_2,enc_auto/a61146_5f0bf3d9f8614fcf97c1888ea64cc18a~mv2.png",
            "https://static.wixstatic.com/media/a61146_9a8fbc7fcc3d4afc85fdef732bd9f70d~mv2.png/v1/fill/w_49,h_10,al_c,q_85,usm_0.66_1.00_0.01,blur_2,enc_auto/a61146_9a8fbc7fcc3d4afc85fdef732bd9f70d~mv2.png",
            "https://static.wixstatic.com/media/a61146_493b99f914fb4b249b1b39b8782798e1~mv2.png/v1/fill/w_49,h_5,al_c,q_85,usm_0.66_1.00_0.01,blur_2,enc_auto/a61146_493b99f914fb4b249b1b39b8782798e1~mv2.png",
            "https://static.wixstatic.com/media/a61146_06fc69b0d26d405b95ede43171457674~mv2.png/v1/fill/w_49,h_15,al_c,q_85,usm_0.66_1.00_0.01,blur_2,enc_auto/a61146_06fc69b0d26d405b95ede43171457674~mv2.png",
            "https://static.wixstatic.com/media/a61146_95a7e69e53ac4761bd33008168d278f0~mv2.png/v1/fill/w_49,h_3,al_c,q_85,usm_0.66_1.00_0.01,blur_2,enc_auto/a61146_95a7e69e53ac4761bd33008168d278f0~mv2.png",
            "https://static.wixstatic.com/media/a61146_49cbd052a5e441728498d0bf09ac9fb9~mv2.png/v1/fill/w_49,h_17,al_c,q_85,usm_0.66_1.00_0.01,blur_2,enc_auto/a61146_49cbd052a5e441728498d0bf09ac9fb9~mv2.png",
            "https://static.wixstatic.com/media/a61146_393b703c64124786b6e56aef2d3795ff~mv2.png/v1/fill/w_49,h_8,al_c,q_85,usm_0.66_1.00_0.01,blur_2,enc_auto/a61146_393b703c64124786b6e56aef2d3795ff~mv2.png",
            "https://static.wixstatic.com/media/a61146_4e3d9ba67e3d4447a60788ae5d154b90~mv2.png/v1/fill/w_49,h_9,al_c,q_85,usm_0.66_1.00_0.01,blur_2,enc_auto/a61146_4e3d9ba67e3d4447a60788ae5d154b90~mv2.png",
            "https://static.wixstatic.com/media/a61146_b631bc667e4f4bfcb7a29ae015371eb6~mv2.png/v1/fill/w_49,h_11,al_c,q_85,usm_0.66_1.00_0.01,blur_2,enc_auto/a61146_b631bc667e4f4bfcb7a29ae015371eb6~mv2.png",
            "https://static.wixstatic.com/media/a61146_626dadc023e04fcdaf9e9dbc42e3718f~mv2.png/v1/fill/w_49,h_8,al_c,q_85,usm_0.66_1.00_0.01,blur_2,enc_auto/a61146_626dadc023e04fcdaf9e9dbc42e3718f~mv2.png",
            "https://static.wixstatic.com/media/a61146_d6fb68cd275f419f9be176a8a40d39ab~mv2.png/v1/fill/w_49,h_11,al_c,q_85,usm_0.66_1.00_0.01,blur_2,enc_auto/a61146_d6fb68cd275f419f9be176a8a40d39ab~mv2.png",
            "https://static.wixstatic.com/media/a61146_7bb51ea65c914835b33d0e9e703c94af~mv2.png/v1/fill/w_49,h_19,al_c,q_85,usm_0.66_1.00_0.01,blur_2,enc_auto/a61146_7bb51ea65c914835b33d0e9e703c94af~mv2.png",
            "https://static.wixstatic.com/media/a61146_7db018d3105d4ba0bd6faef78c2a3c4c~mv2.png/v1/fill/w_49,h_8,al_c,q_85,usm_0.66_1.00_0.01,blur_2,enc_auto/a61146_7db018d3105d4ba0bd6faef78c2a3c4c~mv2.png",
            "https://static.wixstatic.com/media/a61146_78587f9242814da693a0e30255decf73~mv2.png/v1/fill/w_49,h_16,al_c,q_85,usm_0.66_1.00_0.01,blur_2,enc_auto/a61146_78587f9242814da693a0e30255decf73~mv2.png",
            "https://static.wixstatic.com/media/a61146_c862c97b4fba4ecbbe110f98d2963da1~mv2.png/v1/fill/w_49,h_9,al_c,q_85,usm_0.66_1.00_0.01,blur_2,enc_auto/a61146_c862c97b4fba4ecbbe110f98d2963da1~mv2.png",
            "https://static.wixstatic.com/media/a61146_373ec66930fb45619ff3a2d0f622d2ff~mv2.png/v1/fill/w_49,h_14,al_c,q_85,usm_0.66_1.00_0.01,blur_2,enc_auto/a61146_373ec66930fb45619ff3a2d0f622d2ff~mv2.png",
            "https://static.wixstatic.com/media/a61146_9abe0f6a9719404cad21d0c97cdb56fe~mv2.png/v1/fill/w_49,h_5,al_c,q_85,usm_0.66_1.00_0.01,blur_2,enc_auto/a61146_9abe0f6a9719404cad21d0c97cdb56fe~mv2.png",
            "https://static.wixstatic.com/media/a61146_ff898c8f4904452cbba22b622c0921ac~mv2.png/v1/fill/w_49,h_7,al_c,q_85,usm_0.66_1.00_0.01,blur_2,enc_auto/a61146_ff898c8f4904452cbba22b622c0921ac~mv2.png",
            "https://static.wixstatic.com/media/a61146_646045d92dff4c3a8ae4e74b85ba946a~mv2.png/v1/fill/w_49,h_20,al_c,q_85,usm_0.66_1.00_0.01,blur_2,enc_auto/a61146_646045d92dff4c3a8ae4e74b85ba946a~mv2.png",
            "https://static.wixstatic.com/media/a61146_e7561b92f923409fbe3d8f9af376004e~mv2.png/v1/fill/w_49,h_13,al_c,q_85,usm_0.66_1.00_0.01,blur_2,enc_auto/a61146_e7561b92f923409fbe3d8f9af376004e~mv2.png",
            "https://static.wixstatic.com/media/a61146_b1aeb8511057464ea893f915238f6048~mv2.png/v1/fill/w_47,h_16,al_c,q_85,usm_0.66_1.00_0.01,blur_2,enc_auto/a61146_b1aeb8511057464ea893f915238f6048~mv2.png",
            "https://static.wixstatic.com/media/a61146_fc252ab4212843709cf91312bbe2d249~mv2.png/v1/fill/w_49,h_14,al_c,q_85,usm_0.66_1.00_0.01,blur_2,enc_auto/a61146_fc252ab4212843709cf91312bbe2d249~mv2.png",
            "https://static.wixstatic.com/media/a61146_53f11c5f98864843a77d3c319e4d87e8~mv2.png/v1/fill/w_49,h_7,al_c,q_85,usm_0.66_1.00_0.01,blur_2,enc_auto/a61146_53f11c5f98864843a77d3c319e4d87e8~mv2.png",
            "https://static.wixstatic.com/media/a61146_62c8e96a4a134a78a5c15f22e5c447ff~mv2.png/v1/fill/w_49,h_6,al_c,q_85,usm_0.66_1.00_0.01,blur_2,enc_auto/a61146_62c8e96a4a134a78a5c15f22e5c447ff~mv2.png",
            "https://static.wixstatic.com/media/a61146_9cd53641b55f4bd196a47b06cdb0393b~mv2.png/v1/fill/w_49,h_10,al_c,q_85,usm_0.66_1.00_0.01,blur_2,enc_auto/a61146_9cd53641b55f4bd196a47b06cdb0393b~mv2.png",
            "https://static.wixstatic.com/media/a61146_27dae51fe56b490781b3e00477bfb5ea~mv2.png/v1/fill/w_49,h_5,al_c,q_85,usm_0.66_1.00_0.01,blur_2,enc_auto/a61146_27dae51fe56b490781b3e00477bfb5ea~mv2.png",
            "https://static.wixstatic.com/media/a61146_c378eb30f77045c19b373bd4b06c153d~mv2.png/v1/fill/w_49,h_9,al_c,q_85,usm_0.66_1.00_0.01,blur_2,enc_auto/a61146_c378eb30f77045c19b373bd4b06c153d~mv2.png",
            "https://static.wixstatic.com/media/a61146_596890db62f049bdae54480c73ea25ef~mv2.png/v1/fill/w_49,h_7,al_c,q_85,usm_0.66_1.00_0.01,blur_2,enc_auto/a61146_596890db62f049bdae54480c73ea25ef~mv2.png"
        ],
        "movies": [],
        "keywords": [],
        "meta_keywords": [
            ""
        ],
        "tags": null,
        "authors": [
            "Critical Design Associates"
        ],
        "publish_date": "2023-03-20T19:01:27.994000+00:00",
        "summary": "",
        "meta_description": "4,100. That is the number of disclosed data breaches that occurred in 2022 worldwide. Preventing threat actors from gaining access to valuable and confidential data has become highly sought in most organizations. At the end of part-2 of this blog, you will have your own cybersecurity lab that will help you gain essential skills that can be applied in the network security & cybersecurity landscape.",
        "meta_lang": "en",
        "meta_favicon": "https://static.wixstatic.com/media/a61146_8497c27f078e413e9a0d4cf7931e3736%7Emv2.png/v1/fill/w_192%2Ch_192%2Clg_1%2Cusm_0.66_1.00_0.01/a61146_8497c27f078e413e9a0d4cf7931e3736%7Emv2.png",
        "meta_site_name": "Critical Design",
        "canonical_link": "https://www.criticaldesign.net/post/how-to-setup-a-suricata-ips",
        "text": "4,100. That is the number of disclosed data breaches that occurred in 2022 worldwide. The average data breach cost organizations around $4.35 million, a 2.6% rise compared to 2021. Preventing threat actors from gaining access to valuable and confidential data has become highly sought in most organizations. Enterprises are spending thousands of dollars on security tools, software, and hardware to support the confidentiality, availability, and integrity of their data.\n\nA security measure that is widely implemented in enterprises is Intrusion Detection & Prevention Systems. Intrusion Detection & Prevention Systems (IDS/IPS) use defined rules that detect and prevent malicious network activity. An IDS detects network anomalies and sends out alerts. Whereas an IPS actively defends the network by dropping malicious network packets. Detecting and preventing malicious network activity will generate thousands of logs hourly; therefore, there needs to be some type of tool to index logs for event correlation, network analytics, and data visualization. That tool is called a Security Information and Event Management (SIEM) solution.\n\nIn this two-part series, we will be using two open-source tools. One being an IDS/IPS system and the other being a SIEM solution. Suricata will be utilized as our IDS and IPS, while the Elastic Stack will be utilized for visualizing and monitoring the Suricata logs. At the end of part-2 of this blog, you will have your own cybersecurity lab that will help you gain essential skills that can be applied in the network security & cybersecurity landscape.\n\nLab Scope\n\nThis lab is for security professionals and individuals who want to enhance their cybersecurity skill set. Now is the perfect time to start learning cybersecurity skills. The cybersecurity industry is rapidly growing each year, with more organizations in demand for security and network professionals.\n\nNote: For this lab, it is recommended that you have a basic foundation of the following technologies:\n\nNetworking\n\nHypervisors & Virtualization technologies (VMware, XCP-ng/Xen Center, VirtualBox, etc.)\n\nLinux\n\nSecurity concepts\n\nDon’t hesitate to follow along if you don't have much knowledge in one of those areas. This blog will guide you step-by-step and provide links to helpful documentation. It will be up to you to take from what you learned and expand upon what you have gained. I will not be going in depth with each component in this lab.\n\nLab Prerequisites\n\nThe only prerequisite involved with this lab is knowing how to create a virtual machine with an ISO image. I won't be covering this since every virtualization software has different user interfaces and options to create virtual machines. There are plenty of tutorials and guides that provide step-by-step’s on how to create a VM with ISO.\n\nIn this lab, you'll create two Ubuntu 22.04 virtual machines and one Kali Linux virtual machine on your selected virtualization software. I chose to use XCP-ng to manage my virtual machines. Below is the lab topology and the virtual machine specs to help guide you.\n\nLab Design\n\nSuricata Host IDS/IPS\n\nUbuntu 22.04.1 LTS Jammy JellyFish – ISO https://ubuntu.com/download/desktop\n\nWe will be deploying Suricata as a host intrusion detection & prevention system. Suricata by default is installed as a passive IDS to simply scan for suspicious traffic and generate alerts on the host. We will be configuring Suricata to work as an IPS too, so it will have functionality to drop packets and completely block malicious network traffic that matches defined rules.\n\nAuditbeat and Filebeat will be configured on the Suricata virtual machine. - Auditbeat: Collects your Linux audit framework data and monitor the integrity of your files. - Filebeat: A lightweight shipper for forwarding and centralizing log data.\n\nElastic Stack\n\nUbuntu 22.04.1 LTS Jammy JellyFish – ISO https://ubuntu.com/download/desktop\n\nThe Elastic Stack is a free and opensource SIEM solution. The Elastic Stack consists of four components: Elasticsearch, Kibana, Beats & Logstash. We will be configuring Kibana & Elasticsearch on this Ubuntu virtual machine. Elastic has great documentation and user support forums. - Kibana: Provides search and data visualization capabilities for data indexed in Elasticsearch. - Elasticsearch: Is a search and analytics engine for all types of data.\n\nKali Linux\n\nKali Linux 2022.4 – ISO https://www.kali.org/get-kali/#kali-installer-images\n\nThe Kali Linux virtual machine will be used to attack your Suricata virtual machine and test the IDS/IPS.\n\nHardware Requirements\n\nDon’t worry, for this lab your personal computer should be sufficient to power this lab. Utilizing virtualization software such as VMWare, VirtualBox, etc. on your local machine will work fine if you have around 8 GB of RAM and at least 500 GB of local storage on your host. Suricata will be storing thousands of logs that are generated daily, so it is important to have enough storage, so you don’t run into any issues. In summary, it is recommended that the host you are running this lab on has the following requirements:\n\nMinimum of 8 GB of RAM\n\nAt least 500 GB of storage\n\nVirtualization Software\n\nCPU has at least 4 cores\n\nIn my lab, I will be utilizing an Intel NUC as a Type 1 bare-metal hypervisor utilizing XenServer that has the following specs:\n\n64 GB RAM\n\n1TB of storage\n\nCPU: Intel(R) Core(TM) i7-10710U CPU @ 1.10GHz with 6 cores\n\nVirtualization Software: XCP-ng\n\nInstalling Suricata\n\nInstalling Suricata is simple and only takes 3 commands. I will be following exactly from Suricata’s installation guide for Ubuntu.\n\nTo get started, we will add the Open Information Security Foundation’s (OSIF) repository to our Ubuntu machine.\n\n$ sudo add-apt-repository ppa:oisf/suricata-stable\n\nNext, we will update the repository we just added.\n\n$ sudo apt-get update\n\nNow, we can install Suricata by using the following command below.\n\n$ sudo apt-get install suricata\n\nJust like that you now have Suricata installed on your Ubuntu machine. Now, this is where the fun stuff comes into play. The next steps will show how to configure Suricata.\n\nFirst, we will enable the suricata.service to boot when your system starts up. This will allow Suricata to run whenever the machine restarts.\n\n$ sudo systemctl enable suricata.service\n\nRun the following command to verify the Suricata service is running.\n\n$ sudo systemctl status suricata.service\n\nAs you can see Suricata is in IDS (af-packet) mode right now.\n\nConfiguring Suricata\n\nSuricata installed out-of-the-box will be enabled in IDS mode only. This means that Suricata will not drop or block malicious network traffic. It will only provide alerts and logs since it’s originally configured in passive mode. We will be configuring Suricata to be an IPS as well to drop malicious network packets. Also, we will be configuring Suricata to include Community ID in JSON output. This will help when we install the Elastic Stack since the Community ID will make it easier to find event logs. Lastly, we will take a look at Suricata’s rules.\n\nThe first thing we want to do is find the network interface we will be configuring Suricata on. The ifconfig command will show all the available interfaces. I will be working with eth0 and the IP address is 192.168.1.70. We will use this information to configure suricata.yaml file. Note that Suricata by default will inspect traffic on eth0. If your system uses a different default interface, then you will need to change this value.\n\n$ ifconfig\n\nAnother alternative command is to show your default network interface is the following:\n\n$ ip -p -j route show default\n\nAs you can see the default interface is eth0.\n\nNavigate to the Suricata’s configuration file.\n\n$ sudo nano /etc/suricata/suricata.yaml\n\nIn the nano text editor, enter ^W and type “community-id:” This will take you to the line that reads community-id:false. We will change that line to community-id:true.\n\nWhile in the nano text editor enter ^W again type “af-packet” and verify that the interface matches your default interface. If it doesn’t make sure to change it to the correct interface.\n\nNow we will configure live rule reloading, which means you can add, remove, and edit rules without having to restart the Suricata service. You should still be in the nano text editor for suricata.yaml, so now you need to scroll to the last line in the editor (ctrl+v) and type the following:\n\ndetect-engine: - rule-reload: true\n\nAfter adding detect-engine you can save the suricata.yaml file by entering ^X.\n\nNotify the Suricata process to reload its rulesets without restarting the process and restart the Suricata service with the following commands:\n\n$ sudo kill -usr2 $(pidof suricata) $ sudo service suricata restart\n\nSuricata-update is a tool that will fetch rulesets from external providers and update your rules. You can see the full capabilities of suricata-update here. Note that the version of Suricata 6.0.10.\n\n$ sudo suricata-update\n\nYou should see at the end of the output the number of rules that have been loaded.\n\nNext, we will run the command to update all Suricata’s ruleset providers. The no-check-certificate ignores validating for a certificate authority.\n\n$ sudo suricata-update --no-check-certificate update sources\n\nNow we will run the command to list all Suricata’s ruleset providers.\n\n$ sudo suricata-update list-sources\n\nThe rules that have a commercial license will require money to use them. You can specifically use any of these rules by fetching them with the following command below. You can find more information on the Emerging Threats Open Ruleset here. We will fetch the et/open rule.\n\n$ sudo suricata-update enable-source et/open\n\nRun the suricata-update command again to load et/open ruleset and then run the kill command to update the rules without restarting.\n\n$ sudo suricata-update $ sudo kill -usr2 $(pidof suricata)\n\nTest Suricata has zero errors once more.\n\n$ sudo suricata -T -c /etc/suricata/suricata.yaml -v\n\nAt this point, we can test to see if Suricata is running in IDS mode. We can do that by using TestMyNIDS website with the following command:\n\n$ curl http://testmynids.org/uid/index.html\n\nThe output data is designed to trigger an alert pretending to be root user. Now you can check Suricata’s logs for the corresponding alert with the following command:\n\n$ tail /var/log/suricata/fast.log\n\nAs you can see, Suricata is working as it should by logging the GPL ATTACK_RESPONSE alert.\n\nSuricata also logs events in JSON format at /var/log/suricata/eve.log. The JSON format provides the logs in a better readable format. To view logs in this format, we will need to install the jq utility.\n\n$ sudo apt install jq\n\nOnce, you have the jq utility installed, we can search for the specific log above with the following command:\n\n$ jq 'select(.alert .signature==\"GPL ATTACK_RESPONSE id check returned root\")' /var/log/suricata/eve.json\n\nAs you can see, this format is easier to read, and provides more information on what fields are being logged. As I mentioned before, JSON format works better when logs are shipped to the Elastic Stack.\n\nConfiguring Suricata to IPS\n\nIt’s time to configure Suricata to start dropping malicious network traffic. We will need to navigate to the following file:\n\n$ sudo nano /etc/default/suricata\n\nFind the LISTENMODE=af-packet and comment it out with a #. Then add the following line:\n\nLISTENMODE=nfqueue\n\nSave and close the file. Then, restart Suricata by using the following command:\n\n$ sudo service suricata restart\n\nNow check the status of the Suricata service. We will see that Suricata is running in IPS mode now.\n\n$ sudo service suricata status\n\nThe next step is to direct incoming network traffic to Suricata’s NFQUEUE. Open IPv4 rules with the following command:\n\n$ sudo nano /etc/ufw/before.rules\n\nAdd the following lines:\n\n-I INPUT -j NFQUEUE -I OUTPUT -j NFQUEUE\n\nSave and close the file.\n\nEnable the firewall to load the new rules we just configured.\n\n$ sudo ufw enable\n\nNow we will create a custom rule to see if the traffic will get dropped. To do this, we will need to create our own Rules file. You can create your rules file anywhere, but for organization's sake I will create mine in the following directory:\n\n$ sudo nano /var/lib/suricata/rules/local.rules\n\nCreate the following rule – the rule we made will drop any ICMP request to our host.\n\ndrop ICMP any any -> $HOME_NET any (msg: “ICMP Request Blocked”; sid:2; rev:1;)\n\nSave the file.\n\nIf you want to dig deeper on the Suricata’s rules format visit this link here. The documentation explains the signatures, how to read, adjust, and create rules.\n\nMake sure to add your newly created rules to Suricata’s config file.\n\n$ sudo nano /etc/suricata/suricata.yaml\n\n- /var/lib/suricata/rules/local.rules\n\n$ sudo kill -usr2 $(pidof suricata)\n\n$ sudo suricata -T -c /etc/suricata/suricata.yaml -v\n\nOn our Kali machine, we will run a simple ping request to our Suricata host. The following command will send 10 packets to our Suricata host ip address. We should expect every packet to be dropped.\n\n$ ping -c 10 192.168.1.70\n\nSuccess! Suricata is acting as an IPS and dropped all the ping requests. Now let’s take a look at our Suricata logs to see which rules were activated.\n\nHop back over to your Suricata machine and type the following command to see your logs:\n\n$ tail /var/log/suricata/fast.log\n\nAs you can see, the custom rule we created was the rule that blocked our Kali Linux machine for being able to ping our Suricata host. Now, you can use Kali Linux’s hacking tools to put Suricata to the test.\n\nSummary\n\nAt this point of the blog, Suricata is configured as a host IPS & IDS. We also have verified that network logs are being generated by Suricata. Before moving to part 2 of the blog, practice with Kali Linux and try to trigger alerts in Suricata. You can create your own specific Suricata rules that fit your specific lab environment and needs.\n\nPart 2 of this blog will show how to configure the Elastic Stack to store, index, correlate, and visualize the Suricata logs to complete the security lab setup.\n\nStill have questions or want to discuss your Suricata environment Reach out to us at CDA. We’d love to discuss how we can help you with your cybersecurity needs!"
    }
}