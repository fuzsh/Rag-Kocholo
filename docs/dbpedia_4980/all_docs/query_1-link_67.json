{
    "id": "dbpedia_4980_1",
    "rank": 67,
    "data": {
        "url": "https://community.home-assistant.io/t/im-turning-my-dumb-electric-water-heater-into-a-smart-one-is-it-better-to-use-esphomes-bang-bang-controller-or-has-water-heater-integration/409390",
        "read_more_link": "",
        "language": "en",
        "title": "I'm turning my \"dumb\" electric water heater into a smart one. Is it better to use ESPHome's Bang Bang Controller or HA's Water Heater integration?",
        "top_image": "https://community-assets.home-assistant.io/original/4X/8/7/3/873882298c2fe5d1ab97375429525a2c7d4fbb63.jpeg",
        "meta_img": "https://community-assets.home-assistant.io/original/4X/8/7/3/873882298c2fe5d1ab97375429525a2c7d4fbb63.jpeg",
        "images": [
            "https://community-assets.home-assistant.io/original/4X/8/7/3/873882298c2fe5d1ab97375429525a2c7d4fbb63.jpeg",
            "https://community.home-assistant.io/letter_avatar/capttom/48/5_f40856482fe1e45ac8f1605885140a2d.png",
            "https://community.home-assistant.io/letter_avatar/rendyirawan/48/5_f40856482fe1e45ac8f1605885140a2d.png",
            "https://community.home-assistant.io/images/emoji/twitter/shower.png?v=12",
            "https://community.home-assistant.io/user_avatar/community.home-assistant.io/nickrout/48/27020_2.png",
            "https://community.home-assistant.io/images/emoji/twitter/shower.png?v=12",
            "https://community.home-assistant.io/images/emoji/twitter/sweat_drops.png?v=12",
            "https://community.home-assistant.io/images/emoji/twitter/sparkler.png?v=12",
            "https://community.home-assistant.io/user_avatar/community.home-assistant.io/nickrout/48/27020_2.png",
            "https://community.home-assistant.io/user_avatar/community.home-assistant.io/protoncek/48/206966_2.png",
            "https://community.home-assistant.io/images/emoji/twitter/bulb.png?v=12",
            "https://community.home-assistant.io/user_avatar/community.home-assistant.io/orange-assistant/48/460580_2.png",
            "https://community.home-assistant.io/letter_avatar/rendyirawan/48/5_f40856482fe1e45ac8f1605885140a2d.png",
            "https://community.home-assistant.io/images/emoji/twitter/wink.png?v=12",
            "https://community.home-assistant.io/images/emoji/twitter/point_up_2.png?v=12",
            "https://community.home-assistant.io/user_avatar/community.home-assistant.io/orange-assistant/48/460580_2.png",
            "https://community.home-assistant.io/user_avatar/community.home-assistant.io/nickrout/48/27020_2.png",
            "https://community.home-assistant.io/images/emoji/twitter/wink.png?v=12",
            "https://community.home-assistant.io/images/emoji/twitter/bulb.png?v=12",
            "https://community.home-assistant.io/images/emoji/twitter/hourglass.png?v=12",
            "https://community.home-assistant.io/images/emoji/twitter/cold_face.png?v=12",
            "https://community.home-assistant.io/images/emoji/twitter/shower.png?v=12",
            "https://community-assets.home-assistant.io/original/4X/5/6/d/56d50127d18f7dda3b2d04250d8c4f487aafcf25.png",
            "https://community.home-assistant.io/images/emoji/twitter/non-potable_water.png?v=12",
            "https://community.home-assistant.io/user_avatar/community.home-assistant.io/blacky/48/320614_2.png",
            "https://community.home-assistant.io/images/emoji/twitter/tm.png?v=12",
            "https://community.home-assistant.io/user_avatar/community.home-assistant.io/blacky/48/320614_2.png",
            "https://community.home-assistant.io/images/emoji/twitter/man_judge.png?v=12",
            "https://community.home-assistant.io/user_avatar/community.home-assistant.io/blacky/48/320614_2.png",
            "https://community.home-assistant.io/images/emoji/twitter/thinking.png?v=12",
            "https://community.home-assistant.io/images/emoji/twitter/drop_of_blood.png?v=12",
            "https://community.home-assistant.io/user_avatar/community.home-assistant.io/blacky/48/320614_2.png",
            "https://community.home-assistant.io/images/emoji/twitter/droplet.png?v=12",
            "https://community.home-assistant.io/user_avatar/community.home-assistant.io/orange-assistant/48/460580_2.png",
            "https://community.home-assistant.io/user_avatar/community.home-assistant.io/protoncek/48/206966_2.png",
            "https://community.home-assistant.io/user_avatar/community.home-assistant.io/orange-assistant/48/460580_2.png",
            "https://community.home-assistant.io/user_avatar/community.home-assistant.io/orange-assistant/48/460580_2.png",
            "https://community.home-assistant.io/user_avatar/community.home-assistant.io/blacky/48/320614_2.png",
            "https://community.home-assistant.io/user_avatar/community.home-assistant.io/orange-assistant/48/460580_2.png",
            "https://community.home-assistant.io/user_avatar/community.home-assistant.io/nickrout/48/27020_2.png",
            "https://community.home-assistant.io/user_avatar/community.home-assistant.io/orange-assistant/48/460580_2.png",
            "https://community.home-assistant.io/letter_avatar/heyimalex/48/5_f40856482fe1e45ac8f1605885140a2d.png"
        ],
        "movies": [],
        "keywords": [],
        "meta_keywords": [
            ""
        ],
        "tags": null,
        "authors": [
            "Protoncek (Pavel)",
            "RendyIrawan (Rendy Irawan)",
            "nickrout (Nick Rout)",
            "dgomes (Diogo Gomes)",
            "HeyImAlex (Alex)",
            "Mahko_Mahko (Mahko Mahko)",
            "CaptTom (Tom)"
        ],
        "publish_date": "2022-04-07T16:41:30+00:00",
        "summary": "",
        "meta_description": "I have an electric water heater with a manual thermostat dial that you turn to set the temperature of the water. I’m looking to turn it into a “smart” water heater so I could set the temperature from HA to save electrici&hellip;",
        "meta_lang": "en",
        "meta_favicon": "https://community-assets.home-assistant.io/optimized/4X/0/a/2/0a20e9d372791856e50ccb2ed7e95d7a33d515e6_2_32x32.png",
        "meta_site_name": "Home Assistant Community",
        "canonical_link": "https://community.home-assistant.io/t/im-turning-my-dumb-electric-water-heater-into-a-smart-one-is-it-better-to-use-esphomes-bang-bang-controller-or-has-water-heater-integration/409390",
        "text": "I have an electric water heater with a manual thermostat dial that you turn to set the temperature of the water. I’m looking to turn it into a “smart” water heater so I could set the temperature from HA to save electricity when it’s a warmer day and I wouldn’t need as much hot water. That way, during cold days when I would need more hot water it wouldn’t run out so quickly when I shower, and during hot days it wouldn’t need to heat the water that much.\n\nAfter very carefully opening up the water heater, I found the thermostat to be very rudimentary which means that turning it “smart” would be pretty easy to do safely. It’s an enclosed unit with a temperature sensor and a thermostat dial that just sticks to the tank to detect temperature and then switches on and off the 220V to the heating element according to temperature set by the dial.\n\nThe thermostat looks like this (I googled the photo):\n\nI figured I would stick a Dallas DS18B20 to the tank for “Hot Water Temperature” and another Dallas DS18B20 to the input valve for “Cold Water Temperature”. I would then run the 220V going to the heating element through a relay. That way, I’m not bypassing the internal thermostat because the maximum temperature would still be regulated by the internal thermostat. So I’m not risking any damage from overheating the water beyond the designed specification.\n\nDuring operation, I would set the thermostat dial to maximum and let ESPHome and/or Home Assistant switch on and off the heating element if the target temperature is below the maximum temperature possibly achieved by the water heater. So let’s say the water heater goes up to 60⁰C, and it’s a hot day so I set the target temperature to 45⁰C, then the relay would would turn on and off the heating element to maintain that 45⁰C. The internal thermostat would “think” that it’s heating to the maximum temperature because it supplies power to the heating element, but since power to the heating element is fed through a relay, in reality the heating element is maintaining the 45⁰C as regulated by ESPHome/HA. But let’s say it’s a cold day and the water heater could only go up to only 55⁰C, then the relay would stay closed all the time and the heating element would behave according to the internal thermostat.\n\nThe truly “smart” feature that I plan to build is the ability to automatically adjust the target temperature according to the temperature of the \"Cold Water Temperature”. During cold days, the \"Cold Water Temperature” would be lower so the target temperature would be set to a hotter temperature. But if it’s a hot day, the \"Cold Water Temperature” would be higher so the target temperature would be set lower temperature.\n\nI plan to use ESPHome on a Wemos D1 Mini. Now, I’m still not sure how I should proceed with programming the thermostat. I don’t know if it’s better to use ESPHome’s Bang Bang Controller or Home Assisant’s Water Heater Integration. I usually would prefer the thermostat to be programmed directly to ESPHome so it still works in case my HA goes offline, but I figured HA’s water heater integration would be more suited since it’s an actual water heater controller as opposed to a generic thermostat. Or is it just the same? I did try out HA’s Water Heater integration using the demo platform, but I found no difference compared to if I had used ESPHome’s Bang Bang Controller.\n\nSorry for the long post, I figured this is all necessary to properly give you all an idea of what I’m trying to accomplish. Thanks fellas!\n\nETA: Various minor wording corrections to make the explanation more coherent.\n\nSome water heaters have two elements, one near the top and one near the bottom. That would complicate the logic a bit. I’m assuming you only have one, but for anyone else considering this, make sure you check.\n\nThere really isn’t a lot to be gained by adjusting the temperature in the tank based on outside water temperature. As already mentioned, there is a lower limit you don’t want to go below without some very serious health risks. So the range you’d be adjusting is relatively small. Thus the standby losses would be very similar with or without your adjustment. Additional insulation may be a better investment.\n\nFinally, understand that the thermostat is a binary device. Setting it higher doesn’t cause the temperature to rise any faster. The heating element will put exactly the same heat energy into the water any time it’s powered. If the water coming in is colder, it just takes longer to heat up.\n\nThat said, what you’re proposing is technically feasible. You take the thermostat (logically) out of the circuit by turning it all the way up, and put your relay in series with it. Now your relay controls when the element is heating. In fact, the thermostat will act as an overheat detector, and cut the power if your relay stays energized beyond the desired setpoint for some reason.\n\nOne benefit to your solution is that you have built-in energy monitoring. If you know how long the element has been powered on, and you know it’s power draw, you can calculate how much electricity you’ve used.\n\nI’m showering with esphome for years. But actually using the home assistant generic thermostat integration still. Why? Because I actually have two different esphome nodes, one controlling the relay (and do power metering, a sonoff pow r2) and on the other end there is a d1 mini with a dallas ds18b20 probe temperature sensor in the water tank.\n\nI actually want to change the system to have temperature sensor and relay on the same esp and I can benefit having the logic directly in esphome. It will be more robust and would even work if the wifi is jammed or the ha server is crashing/restarting/on fire etc.\n\nIt was not to long ago I set the thermostat (ha) to heat and it activated the relay over wifi on the esphome node. But when ha was sending the off signal to the relay the esphome node was (for whatever reason) not reachable this very second and the thermostat in ha was off (indiciating all good) but the heater continued for hours wasting power before some one realized the warm water temperature was up to the sky (actually stopped by the internal thermostat like you describe it @RendyIrawan)\n\nPer se it’s not dangerous to shower with legionella in the water, even drinking doesn’t harm the human body. The danger lies in inhaling them and accumulate critical colonies of them in your lungs. Best thing some one can do (specially when traveling!) is to avoid those misty (fine) shower heads and rather shower with the hose only Also better keep a safe distance from sprinklers\n\nOne can also try to keep it at a max around 25°C because then there will also be no growth. Also growing mainly happens when the water “stands”, so if you more or less permanently use your water and have a proper sized tank you also minimizing the risk of growing to much colonies.\n\nLast thing to keep in mind (specially if you don’t permanently have legionella unfriendly temperatures in your hot water tank) is to do a regular “cleaning”. Typically heating the show up to a level that you can supply all pipes and faucets with 70°C for a minimum of 180 seconds.\n\nLast but not least: Most “danger” of inhaling critical high amounts of legionella is typically in the very beginning of the shower act when the “old”/“still” water is released. So wasting a bit of water at the start of the shower could be advisable for some locations.\n\nSo do I.\n\nUhm, no. Here’s what the laws in my country (France) say about this. I would expect that most industrialized countries do have similar laws regarding this. Legionellosis is a serious public heath concern.\n\n(Google translated)\n\nThese obligations are defined by the decree of November 30, 2005, known as the “temperature decree”, which deals with both legionella and the risk of burns. This imposes for tanks of more than 400 liters:\n\na water storage temperature above 55°C at the outlet of this equipment\n\nor a daily rise in tank temperature\n\n2 minutes at a temperature > 70°C\n\n4 minutes at a temperature > 65°C\n\n1 hour at a temperature > 60°C.\n\nIt also imposes a temperature of more than 50°C at any point of the network with the exception of the terminal antennas; the volume of the latter must not exceed 3 litres.\n\nOf course if you live alone and are the only person using your water, you’re free to do what you want and assume the health risks. But as soon as others come into play, and you DIY your water heating and distribution, you are legally liable if you do not follow code and someone gets hurt because of your modifications. Someone like your family.\n\nThis whole thing is not worth it anyway. Modern water heaters are very well insulated. There are many other ways to save energy in your home that do not risk the health of its inhabitants. Most of them are not technological btw. Like better insulation."
    }
}