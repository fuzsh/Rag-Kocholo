{
    "id": "correct_subsidiary_00030_3",
    "rank": 86,
    "data": {
        "url": "https://community.sap.com/t5/technology-blogs-by-members/control-your-sap-runtime-with-azure-logic-apps-using-email-no-code/ba-p/13463306",
        "read_more_link": "",
        "language": "en",
        "title": "Control your SAP runtime with Azure Logic Apps usi...",
        "top_image": "https://groups.community.sap.com/html/assets/SAP_R_grad_200x200.png",
        "meta_img": "https://groups.community.sap.com/html/assets/SAP_R_grad_200x200.png",
        "images": [
            "https://avatars.profile.sap.com/former_member_small.jpeg",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/234234234234234.jpg",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/computer_evolution_image.jpg",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/bean.jpg",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/mainscreen.jpg",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/11231231231.jpg",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/main2.jpg",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/blank-1.jpg",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/meme21-1.gif",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/SAP-and-Logic-app-shutdown-flow-Amit-LAL-_.jpg",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/step1-1.jpg",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/2-1.gif",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/3.gif",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/4.gif",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/5.gif",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/7.1.gif",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/7.gif",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/8.gif",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/10.gif",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/11.gif",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/12.gif",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/13.gif",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/14.1.gif",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/14-2.gif",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/16.gif",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/CC2h-1.gif",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/17.1.gif",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/18.gif",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/19-1.jpg",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/20-1.jpg",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/31.jpg",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/21-1.jpg",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/2817_shibcorn-1.png",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/22.jpg",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/23.jpg",
            "https://emojis.slackmojis.com/emojis/images/1578512858/7452/danceydoge.gif?1578512858",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/24.jpg",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/25sapshut.jpg",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/26.jpg",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2021/02/30.jpg",
            "https://community.sap.com/legacyfs/online/storage/blog_attachments/2020/10/7-14.jpg",
            "https://community.sap.com/html/assets/img_tile-default.png",
            "https://avatars.profile.sap.com/former_member_small.jpeg",
            "https://community.sap.com/html/assets/img_tile-default.png",
            "https://avatars.profile.sap.com/f/a/idfa6c70916ad58d838d99a48f67d4419c79207f4cff11d4ee7e855a0cb144903b_small.jpeg",
            "https://community.sap.com/html/assets/img_tile-default.png",
            "https://avatars.profile.sap.com/d/0/idd0f56656dda1f2283a46d9bdf801f12cbfd021bcb726434a060e0127ea52847b_small.jpeg",
            "https://avatars.profile.sap.com/e/f/ideff15d2172bde4bf68fd20b14e0c54fc1016114e60abe8ef97a9cea39e2f743b_small.jpeg",
            "https://avatars.profile.sap.com/e/3/ide3e30891b6a09c74bc5159725d8a37c52374d3177903f1a527d658a26b42892f_small.jpeg",
            "https://avatars.profile.sap.com/f/2/idf28bed10fb0cdcfb85f6994ce37b37e2877627385a7cb16624bdb857a1247372_small.jpeg",
            "https://avatars.profile.sap.com/1/b/id1bb308344914e54b137863fd929c9665953db4ef1376b1c6759bb18d92448b0e_small.jpeg",
            "https://avatars.profile.sap.com/1/5/id15869c51fdf8b954dce407f4bab8176a83c8fb57a615bd36df36c63a1312cf5c_small.jpeg",
            "https://avatars.profile.sap.com/a/4/ida402185a2dbc840ae38c209b91c64a0dc103cc0112d46c5f49df890c1ee77835_small.jpeg",
            "https://avatars.profile.sap.com/5/d/id5d0e018f65bd368cf777fb9bb55730fe9d6da1dd6d6bff5d907dec7d2f3b6ac3_small.jpeg",
            "https://avatars.profile.sap.com/8/8/id888d68df994363762536017fbf6f69087a6a6a17a04bd8f86a1ca4ae04f07f74_small.jpeg",
            "https://avatars.profile.sap.com/6/7/id677f624df4f67fa55aef9b803484fd38cfa389573f663b9623d9dc410597c931_small.jpeg",
            "https://avatars.profile.sap.com/former_member_small.jpeg"
        ],
        "movies": [],
        "keywords": [],
        "meta_keywords": [
            ""
        ],
        "tags": null,
        "authors": [
            "community.sap.com",
            "user-id"
        ],
        "publish_date": "2021-02-11T23:13:05+00:00",
        "summary": "",
        "meta_description": "“Everything is going to be connected to cloud and data… All of this will be mediated by software.” Satya Nadella, CEO, Microsoft Source: Bing Do you remember how",
        "meta_lang": "en",
        "meta_favicon": "https://community.sap.com/html/@28E64AF715869863C9097AAA9C123156/assets/favicon.ico",
        "meta_site_name": "SAP Community",
        "canonical_link": "https://community.sap.com/t5/technology-blogs-by-members/control-your-sap-runtime-with-azure-logic-apps-using-email-no-code/ba-p/13463306",
        "text": "4,623\n\n“Everything is going to be connected to cloud and data…\n\nAll of this will be mediated by software.”\n\n✨Satya Nadella, CEO, Microsoft✨\n\nSource: Bing\n\nDo you remember how communication activities were handled in Email software in the early 2000s? With smartphone arrivals, things got totally changed. And, who would have imagined 30 years ago that we would carry the internet in pockets, homes would become our offices, IVR/bots will be answering your queries before connecting to your bank and other businesses, or simply paying using a smartphone as a credit card, or good part - getting our favorite food order by using a smartphone app only.\n\nA similar important and significant shift is happening in Serverless space! It is getting more focus on business logic and code, not underneath servers or infrastructure. This isn’t the first time we’ve seen a massive shift in how technology affects our working lives, and it certainly won’t be the last, indeed.\n\nWhile COVID-19 continues to make face-to-face collaboration an impossibility, cloud-based applications and workloads provide a well-defined method for remote development and project deployment, and Serverless applications already started playing an important role. Today this article will show you a good example of SAP and Serverless engine integration using Logic apps.\n\nServerless offerings, like Azure Logic Apps and Azure Functions, take this to the next level while allowing us, as developers, to focus only on our application functionality and not the backing infrastructure or uptime of servers. Also, here Azure Logic Apps and Azure Functions are big entry gates for non-coders and may finally be making the coveted 'citizen developers' idea a reality. Since the last decade, there has been the expectation that 'citizen developers' => non-coders and non-technical staff will be able to leverage the power of connectors and APIs through a range of visual design tools and drag and drop connectors. And I guess all Cloud providers are working on a similar goal! With the latest SAP and Azure integrations tools and processes, the focus is on getting on business logic built, not your servers.\n\nLet's explore and run a 'hands-on' session on this topic!\n\nSource: Bing\n\nGet Started!\n\nWe are going to build an Azure Logic App to save cloud resources cost running SAP Application. Here Logic App plays with the SAP system to automate shutdown (SAP and VMs both) using an Email handler. It is a convenient tool for Basis managers/Leads who want to control SAP resources and IT budgets on the Cloud. I decided to build Logic Apps for SAP Infrastructure controlling purposes to integrate with SAP Application and VM altogether.\n\nWith Logic Apps, Basis folks of any organization can take complete control of shutting/starting the Sandbox/Development/Training/QA -SAP system not being heavily used after business hours or over the weekends. Along with this idea, Basis Manager/Leader will receive a list of logged-in users directly in an e-mail before pressing the 'Shutdown' button that too from e-mail only. Sounds interesting!!!\n\nIn General, to build the Logic Apps, you can use one of the already existing templates. It’s a terrific way to learn and understand how the workflows are designed, and I highly recommend spending some time reviewing them. Hence before we jump into the main topic, I suggest you play around with Logic apps to see many outstanding features. My reaction to it until now has been none less than wow! You can do so many things using this Azure Service for SAP workloads. Awesome!!\n\nCreating Sample Logic Apps - Quick look for beginners!\n\nGo to Azure Portal and enter the Logic Application pane to create your first workflow and click +Add. Fill out the form with the app name, resource group, and location. Confirm by clicking Create. To build the Logic Apps, you can use one of the already existing templates on the dashboard. There are more than 40+ ready-to-deploy templates available and including the SAP Connector template too.\n\nSee below sample Architecture for Idoc flow from SAP to external documents. To run this similar scenario, you can refer to this article as well created by db8ac33b71d34a778adf273b064c4883\n\n<Sample Architecture>\n\n(Source: Microsoft Learning)\n\nThis solution aims to facilitate a controlled shutdown/startup of SAP on Azure systems, a common request from customers who want to save costs by shutting down environments that are not in use, as I explained earlier. This custom scenario doesn’t have a predefined template, so I chose to create a Blank Logic App to build everything from scratch.\n\n(Source: Microsoft Learning)\n\nSource Bing\n\nCurtain-raiser on our Architecture scenario\n\nLet's understand the architecture workflow before we build and run the scenario. I'd like to spend a moment explaining how the workflow works here. Just imagine for a second and consider Logic App a giant mothership controlling all flying saucers, aka. SAP, workflow, JSON/XML, Azure VMs, and required human intervention sitting on the ground (using outlook throttle!) to decide the ultimate action.\n\nOk, cool, so how does this map to the cloud flow? What tools are required, Huh? Let's see!\n\nList of prerequisites in order:\n\nAccess to Azure VM running SAP application\n\nAccess to SAP Application (ECC, S/4HANA, NetWeaver)\n\nAccess to Azure Account with Subscription\n\nAn email account from a service that's supported by Logic Apps (such as Office 365 Outlook or Outlook.com), other Emails like Gmail are supported as well. (I haven't tested yet)\n\nSteps\n\nCreated Azure Logic App with Blank name\n\nSAP_Auto_mail_shut_Controller_App_amit <your-Logic-app-name>, click on Azure Logic App Designer under the Development tools panel, as shown below.\n\n2. Create a first HTTP trigger to run a Logic app\n\nSearch for workflow \"request\" and select \"When an HTTP request is received.\" And you will get an automated URL generated by workflow after you save the Logic apps. This URL can be triggered through the POSTMAN utility using POST as well, or you can create a scheduler with a specific time for triggers on a daily or weekly basis, for example, 6pm every day or 5pm every Friday, it's highly flexible to schedule.\n\n3. Setup an SAP Connection and select the SAP Table to fetch details.\n\nThis step is crucial from a workflow perspective, here we will connect SAP to fetch the list of active users logged in SAP during that point in time when workflow triggers. This will help Basis decide to shut or keep running the SAP system based on the number of users count, including their usernames and terminal details. Follow -\n\nClick on + sign under HTTP Request, search for SAP and select \"Send a message to SAP.\"\n\nClick on the SAP Action folder icon and pickup RFC_READ_TABLE\n\nInsert XML details into \"Input Message\" shown below. We are fetching a list of users from SAP Table USR41. Additionally, you can add the batch table to see active batches running in the system if required. (I'm just covering the user list for now!)\n\n<RFC_READ_TABLE xmlns=\"http://Microsoft.LobServices.Sap/2007/03/Rfc/\">\n\n<QUERY_TABLE>USR41</QUERY_TABLE>\n\n</RFC_READ_TABLE>\n\nSAP API Connection Details to fill, I did not activate SNC connection, SAP recommends activating for production connectivity. This is the main API connection screen!\n\n⚠️Note, please don't proceed unless you see the successful connection here.⚠️\n\n4. Data Operations - Compose stage\n\nAt this step, search for \"Data Operations\" and select \"Compose,\" as shown below.\n\nUnder compose, add Expression in FX box, show shown below\n\nIt converts SAP table output to JSON readable format.\n\njson(xml(body('Send_message_to_SAP')))\n\n5. Parse JSON to fetch the relevant data using JSON schema\n\nHere we will parse JSON output to get relevant array/objects in the JSON file underneath.\n\nSelect Content - \"Outputs\" from the list\n\nAdd JSON Schema using sample payload to generate the schema.\n\nYou can generate JSON schema using http://jsonschema.net/ or Use sample payload to generate it.\n\n6. Initialize the Variable and append it to an array variable.\n\nThis task is part of initializing array and append array variables for loading data.\n\nCompose the output as well,\n\nfirst(variables('test'))['RFC_READ_TABLEResponse']['DATA']['TAB512']['WA']\n\n7. Setup the Outlook with options\n\nCreate workflow - \"Outlook with options\" and insert User Options - YES - Shutdown, No -Shutdown, Add Subject and Body with {outputs}, as shown in the screen. You can manipulate the Email body using HTML code as well.\n\nIf you see \"Show HTML confirmation dialog,\" I opt yes here since I want the workflow to open a new browser session to get my final confirmation for my decision!\n\n8. Apply conditional check with the selected output from the previous email\n\nHere we have a condition workflow to re-direct Logic app flow based on the user's prior selection on email.\n\nIf the Email outcome is YES selected by an Admin/Basis user, then the logic app condition goes to the True side and follows the following workflow.\n\nIf the Email outcome is No selected by an Admin/Basis user, logic apps will check the VM's status and close the loop.\n\n9. SFTP-SSH workflow Action now\n\nOnce the workflow is True, compose data operations workflows got the SelectedOption = Yes. We select the \"SFTP-SSH\" action workflow to directly create a new file under /tmp directory in SAP VM. This will create a custom \"python program\" to stop/start, and cleanup commands simple script.\n\nPlease ensure python3 is installed on SAP VM. (Link to download), I created this sap stop program in python 3.6 since it's one of my favorite ones. Feel free to write in PowerShell or bash scripting, no restrictions here since the logic app flow will be the same at the end. You can change it to use the sapcontrol tool since STOPSAP & STARTSAP are old tools now.\n\n10. Next workflow triggers \"delay\" and deletes python file ⚠️\n\nSince it required 4-5min. to stop the SAP app and DB along with CLEANIPC commands. Once Python shutdown SAP, that file will be automatically deleted from /tmp directory to manually safeguard accidental shutdown. An extra technical step to ensure no trouble by human intervention or so. After SAP is down, another delay of a few min. (I took ~30min. your call to reduce it to 1min.) to trigger VM shutdown.\n\nOptional - You can add another Outlook trigger after SAP and VM graceful shutdown to send the notification back to Basis Manager as well.\n\n<**End of configuration, save your logic apps designer before you close the session**>\n\nTime to Trigger the Button on Logic Apps\n\nSource: Gifer\n\nGo and save your logic apps and press the 'Run' button; before you do that, please ensure SAP is up and running and at least one user is active. Otherwise, you miss the fun! ⚠️\n\nYou will see Logic App, start here with HTTP request, and connect to SAP, and collect the data and parsed it for view. Now, Logic App triggers send Email on Outlook account and wait for following user action here.\n\nNow, I see a fresh e-mail in my Outlook mailbox, Logic apps requesting your input/action.\n\nOpen e-mail, and check the users logged actively. I see just one user now, and that's mine only.\n\nOptional -Now, SAP Basis Operations can send an e-mail requesting further to that user list asking to save the work and log out immediately or simply go ahead with the shutdown. Again, it's an operational and admin call!!\n\nNow I'm going to press the blue button => \"YES - Shutdown\" shown below on Outlook e-mail.\n\nIt will pop up the Logic App URL asking for a final decision here. Since I enabled in e-mail setting above in step#7.\n\nAgain, I pressed Confirm \"YES-Shutdown.\" (You can disable that as well; it will ask directly by e-mail.)\n\nReceive the confirmation screen below!\n\nGoing back to the Portal workflow logic screen, it moves to the next level and creates a new python file that will further shut down SAP Application and DB.\n\nPython file created successfully based on our Logic App workflow, and SAP graceful shutdown triggered as well.\n\nWell! No surprises...This is rocking!\n\nAt this stage, Logic App design flow will delete this *py python file and wait for VM Shutdown now.\n\nAfter 30min. delay scheduler completed, VM Shutdown triggered successfully, and VM is stopped here. Another rocking moment and thumbs up here!\n\nAzure Admin Team can check run history in Logic Apps on a daily/weekly basis for monitoring purposes and keep an eye on the overall functionality.\n\nConclusion\n\nCool! That was quite the ride through some no-code process to trigger graceful shutting of SAP and VM and demonstrates how your SAP system uses automation tools and Azure APIs altogether. I would suggest you go ahead and try this scenario and share your SAP integration experience with Logic Apps, especially Dev, Training, and Sandbox systems that can be powered-off to save resources until they are needed again and highly recommended for pay-as-you-go customers. This will help reduce the IT overheads linked, which can be avoided for this simple automation. You can consider it for your SAP systems running on Azure today or planning for future workloads.\n\nIn the following article or so, I can provide you with insights on how the SAP start functionality can work. It will be reversed Logic apps and can be configured easily.\n\n✨✨✨✨✨✨✨✨✨✨✨✨✨✨✨✨✨✨✨✨\n\nYour questions/comments are always welcome\n\n✨✨✨✨✨✨✨✨✨✨✨✨✨✨✨✨✨✨✨✨\n\n💻💻💻Happy Reading, Happy Learning! 💻💻💻\n\nBelow are links to my selective technical and personal insight articles published on SCN on diverse topics.\n\n✨SAP Sales Forecast using Automated Machine Learning {Azure AutoML No-code}\n\n✨Integrating SAP Data in Snowflake using Azure Data Factory\n\n✨Running SAP HANA on Azure Container Instance {ACI} from Cloud shell.\n\n✨The Three E-Elephants: EAI, ETL, and EII in Enterprise world\n\n✨Power BI Vs. SAC - One-page reference\n\n\"Reading brings us unknown friends” – Honoré de Balzac.\"\n\nDisclaimer\n\nThese are my individual opinions and thoughts. This does not represent any formal opinions, POVs, inputs, product roadmaps, etc., from my current or past employers or partners or/and any Clients.\n\nSAP Managed Tags:\n\nCloud"
    }
}