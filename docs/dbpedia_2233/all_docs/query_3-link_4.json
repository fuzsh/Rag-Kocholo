{
    "id": "dbpedia_2233_3",
    "rank": 4,
    "data": {
        "url": "https://groups.google.com/g/copasi-user-forum/c/I1B5uKi2LiQ",
        "read_more_link": "",
        "language": "en",
        "title": "Looking for advice: Copasi, steady state, eigenvalues, Jacobian",
        "top_image": "https://www.gstatic.com/images/branding/product/1x/groups_32dp.png",
        "meta_img": "https://www.gstatic.com/images/branding/product/1x/groups_32dp.png",
        "images": [
            "https://fonts.gstatic.com/s/i/productlogos/groups/v9/web-48dp/logo_groups_color_1x_web_48dp.png",
            "https://lh3.googleusercontent.com/a-/ALV-UjVSCCo8sKy1oGXHstpTiKw37JNbCzpx2WkGla0pVerR0fVNbqc=s40-c",
            "https://lh3.googleusercontent.com/a-/ALV-UjWegRgbT-tkqj0gqunJubPa0sTIuWAHWR_L8kP91TZ8OfWKc6y79A=s40-c",
            "https://lh3.googleusercontent.com/a-/ALV-UjWx806lMrx4FyeZQy3otpDa5QLx2P7fFMCNpQ_CfLSV0A4-Nn0=s40-c",
            "https://lh3.googleusercontent.com/a-/ALV-UjVl5n9LAuVn7RBY5S7eML09VDDWwTJScJSKyr8wkDwff2uT7MY=s40-c",
            "https://lh3.googleusercontent.com/a-/ALV-UjVs0717CGVst3_Vq0jkWjtueeMnos3x0a15W4-z8FqWZ06LKCV2=s40-c",
            "https://lh3.googleusercontent.com/a-/ALV-UjVl5n9LAuVn7RBY5S7eML09VDDWwTJScJSKyr8wkDwff2uT7MY=s40-c",
            "https://lh3.googleusercontent.com/a-/ALV-UjVSCCo8sKy1oGXHstpTiKw37JNbCzpx2WkGla0pVerR0fVNbqc=s40-c",
            "https://lh3.googleusercontent.com/a-/ALV-UjWx806lMrx4FyeZQy3otpDa5QLx2P7fFMCNpQ_CfLSV0A4-Nn0=s40-c",
            "https://lh3.googleusercontent.com/a-/ALV-UjVSCCo8sKy1oGXHstpTiKw37JNbCzpx2WkGla0pVerR0fVNbqc=s40-c",
            "https://lh3.googleusercontent.com/a-/ALV-UjWx806lMrx4FyeZQy3otpDa5QLx2P7fFMCNpQ_CfLSV0A4-Nn0=s40-c",
            "https://lh3.googleusercontent.com/a-/ALV-UjVs0717CGVst3_Vq0jkWjtueeMnos3x0a15W4-z8FqWZ06LKCV2=s40-c"
        ],
        "movies": [],
        "keywords": [],
        "meta_keywords": [
            ""
        ],
        "tags": null,
        "authors": [],
        "publish_date": null,
        "summary": "",
        "meta_description": "",
        "meta_lang": "en",
        "meta_favicon": "//www.gstatic.com/images/branding/product/1x/groups_32dp.png",
        "meta_site_name": "",
        "canonical_link": "https://groups.google.com/g/copasi-user-forum/c/I1B5uKi2LiQ",
        "text": "I am looking for some advice in using Copasi for calculating steady state and examining the results, including eigenvalues and the Jacobian.\n\nIn Copasi, steady state succeeds if I set Resolution to 1e-5, but the results are not completely convincing, because some species show a (final) concentration different from what I see in the time course. I also have some eigenvalues of 0.\n\n-> How can I find out which reactions are responsible for the zero eigenvalues?\n\nAs far as I can tell, the Jacobian looks OK (all diagonal values are negative).\n\n-> Is there more information that I am overlooking?\n\nWhen I run a time course, it looks like everything has settled into a steady state by a time of 2e+5. However, if I try to run the time course to 1e20, it fails at about 2e+19, even though the plot and the results look OK. In comparison, when I run this in AMICI, the time course fails at about 3e+199 and steady state fails completely.\n\nCopasi error running time course to 1e20:\n\n>EXCEPTION 2021-05-24T16:12:18<\n\nCTrajectoryMethod (6): Deterministic integration failed. LSODA reported:\n\nDLSODA- At T (=R1) and step size H (=R2), the\n\ncorrector convergence failed repeatedly\n\nor with ABS(H) = HMIN\n\nIn above message, R1 = '2.06262e+19', R2 = '7.92357e+08'\n\nPlease see result for indications of numerical instability.\n\nAMICI error tying to run steady state:\n\n[Warning] AMICI:CVODES:CVode:OTHER: AMICI ERROR: in module CVODES in function CVode : At t = 3.18384e+199, the right-hand side routine failed in an unrecoverable manner.\n\n[Warning] AMICI:simulation: AMICI simulation failed:\n\nSteady state computation failed. First run of Newton solver failed: No convergence was achieved. Simulation to steady state failed. Second run of Newton solver failed: No convergence was achieved.\n\nError occurred in:\n\nstacktrace not available on windows platforms\n\nI think it would help to get some more information:\n\n* what is the acceptance criterium for the steady state (we added a simple 'rate' criterium in recent versions, that looks at the rate of changes for accepting steady states. This can be combined with the distance criterium and with both active, we hardly see false positives anymore).\n\n* it would be interesting to see the result in the protocol tab\n\n* instead of looking at the time course concentration results and the particle number plots, i think it would be helpful to also look at the rates of changes plot / report values. (in the output assistant they are created with (\"Concentration Rates, Volume Rates, and Global Quantity Rates\" / \"Time, Concentration Rates, Volume Rates, and Global Quantity Rates\")\n\nbest\n\nFrank\n\n\n\nHello Thomas,\n\nwhile Steady States are a simple concept, they are surprisingly difficult from a numerical point of view since there are several issues that can go wrong independently.\n\nThe most problematic point is often (as Frank mentioned) the criterium that COPASI uses to decide if a Steady state was found. On the other hand the error message wrt the integration is difficult to interprete without knowing the model.\n\nWhen you say that you have Eigenvalues of 0, is that in the reduced or the full jacobian? Some 0 Eigenvalues are the result of the structure of the model (rather than the specific kinetics) and COPASI should be able to deal with them, in this case the 0 Eigenvalues should not be present in the \"reduced\" Jacobian.\n\nIn any case, if you would send the model (or a version of it that shows the problem) to me or Frank (we would obviously treat it confidentially) we could help much better.\n\nbest,\n\nSven\n\n\n\nThomas,\n\nit is legitimate for dynamical systems to have zero eigenvalues; when this happens the system is described as \"marginally stable\". Perturbations to that steady state do not grow (ie it is not unstable) but also do not decay back to the original steady state, but rather end up in a nearby steady state. The most well known system with this property is the Lotka-Volterra model.\n\nThis is not to say that those zero eigenvalues are necessarily correct, as Sven noted, you get zero eigenvalues in the full Jacobian matrix if you have mass conservation relations. However in the reduced Jacobian (ie the one where mass conservation was removed) if there is a zero, it is either a very small number that appears to be zero or a true zero (there is not much difference between these, a tiny eigenvalue is a system that takes a very very long time to decay back to the original steady state, so effectively almost the same as marginal stability)\n\nThe one thing that I find interesting in your post is that you say that COPASI finds the steady state when you set the tolerance to 1e-5. Does it not find it if you have it set to 1e-6 ? In that case it may be not a true steady state, but just a very very slow transient state. But the criterion used (distance, rate, or both) is also important here.\n\nPedro\n\n\n\n\n\n--\n\nYou received this message because you are subscribed to the Google Groups \"COPASI User Forum\" group.\n\nTo unsubscribe from this group and stop receiving emails from it, send an email to copasi-user-fo...@googlegroups.com.\n\nTo view this discussion on the web visit https://groups.google.com/d/msgid/copasi-user-forum/7dc456e3-643c-490a-ab93-7db54588dde7n%40googlegroups.com.\n\n-- Pedro Mendes, PhD Professor and Director, Richard D. Berlin Center for Cell Analysis and Modeling University of Connecticut School of Medicine group website: http://www.comp-sys-bio.org\n\nDear Upi,\n\nSteady state is surprisingly difficult to properly define numerically. Since version 4.28 (build 226) we have added a the option for the user to select among three different criteria for steady state convergence: \"distance\", \"rate\" and \"distance and rate\". The default criterion is the most strict one \"distance and rate\" in order to avoid false positives. However this sometimes misses states that could be considered steady states. So I would advise you to try changing the criterion and try again. Of course the \"Resolution\" is also important and the smallest this value is the hardest it is to find a steady state.\n\nCOPASI's manual page includes a description of how it calculates the steady state: http://copasi.org/Support/User_Manual/Methods/Steady_State_Calculation/\n\nHowever, unfortunately, we have not yet added the convergence criteria to COPASI's manual, but it should come shortly. These are:\n\nCriterion \"Rate\": the largest of all the right-hand side of the ODEs needs to be smaller than the Resolution specified (in concentration units)\n\nCriterion \"Distance\": the Newton method increment needs to be smaller than the Resolution specified\n\nCriterion \"Distance and rate\": both of the above need to be satisfied\n\nBy the way, there is a new version available with a few bug fixes (4.31).\n\nPedro\n\n\n\n\n\nTo view this discussion on the web visit https://groups.google.com/d/msgid/copasi-user-forum/cdf8abdf-f552-4dc1-99b2-74e1c878a9a9n%40googlegroups.com.\n\n\n\nDear Pedro,\n\nthanks again for the help. Now I have a steady state, but there is still an integration error.\n\nWhen I run Steady State and set Target Criterion to Rate, it runs to completion quickly and shows very plausible results. In addition, all eigenvalues are negative (no zeros). When I look at Result / Species, I can see that the Transition Time starts at about 6e-6, with many values around 1e+5 and a maximum of 6e+7 (except for two!). This seems plausible. However, two species have Transition Times of 6e+19 and 3.7e+20. Let's look at just this last one:\n\nThis species (PTEN) is a protein, used as a modifier in a separate reaction, which shouldn't affect this time. It is produced by a constant production, and degraded by a standard degradation reaction. If I set the initial concentration to zero, the time course looks exactly like what I expect, beginning with a linear growth, then leveling off. After about 2e5 seconds, it reaches almost a maximum of about 6.5e5 and continues to grow asymptotically.\n\nWhen I run a Time Course to a time of 1e+20, it terminates with an integration error at 1e+18 or 1e+19:\n\n>EXCEPTION 2021-06-02T09:07:59<\n\nCTrajectoryMethod (6): Deterministic integration failed. LSODA reported:\n\nDLSODA- At T (=R1) and step size H (=R2), the\n\ncorrector convergence failed repeatedly\n\nor with ABS(H) = HMIN\n\nIn above message, R1 = '7.89558e+18', R2 = '1.15365e+09'\n\nPlease see result for indications of numerical instability.\n\nWhen I run the time course in AMICI, it has an integration error at around 1e+199.\n\nThese integration errors are the problem that I am currently trying to solve, because they interfere with PETab/pyPESTO/AMICI.\n\nIn summary, the integration error is a problem, but the error doesn't tell me anything about which species or reaction in causing it. The very large transition time reported by Copasi Steady State looks like a very useful hint. Now, I don't understand why this species should have such a high transition time, and I don't see if or why this species is causing an integration error. Looking at the plots of all concentrations, all rates, or PTEN alone hasn't uncovered the problem yet.\n\n\n\nDear all,\n\nhaving looked at the model with simulations of moderate dureation (e.g. 1e5), it seems the model cannot be in a steady state because degraded_protein is produced but never consumed. It seems to grow forever. The rate of production is indeed smalll (in the order of 1e-9) so that you can force COPASI to \"find\" a \"steady state\" by relaxing the resolution of the steady state criterium. Actually all the other species have a much smaller rate of change than \"degraded_protein\" (by many orders of magnitude; so I think the model is in a steady state except this one species. If I set the degraded_protein to \"fixed\" I can find a steady state with reasonable resolution.\n\nAs for the simulation, I cannot just now reproduce the problem since my computer is quite slow and it would need to run a long time to reach near 1e20s. However, I would not be surprised if the integration eventually fails if you simulate a model where most of the variables reach a steady state quickly but one variable keeps rising infinitely for an astronomical time scale. At some point the ratio between the growing variable and the rest would overwhelm the computers floating point accuracy (or confuse the tolerance adjustment of the integrator).\n\nIn any case, for \"debugging\" or analsing a situation like this I would usually simulate for a reasonable long (but not astronomical) time, and then look the the actual rates of the concentration changes, rather than the transition times. This allows you to find out which variables might be the problem for finding a steady state. If simulation for extremely long times is necessary to settle the model in steady state, it indicates that something with the time scales of the model is off.\n\nHope this helps,\n\nSven\n\n"
    }
}