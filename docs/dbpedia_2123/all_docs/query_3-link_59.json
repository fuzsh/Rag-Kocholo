{
    "id": "dbpedia_2123_3",
    "rank": 59,
    "data": {
        "url": "https://community.cisco.com/t5/ip-telephony-and-phones/multiple-device-pools-single-sip-trunk/td-p/2626381",
        "read_more_link": "",
        "language": "en",
        "title": "Solved: Multiple Device Pools, Single SIP Trunk",
        "top_image": "https://community.cisco.com/html/assets/ciscooglogo.png",
        "meta_img": "https://community.cisco.com/html/assets/ciscooglogo.png",
        "images": [
            "https://community.cisco.com/t5/image/serverpage/avatar-name/default_icon/avatar-theme/candy/avatar-collection/Cisco_Default/avatar-display-size/profile/version/2?xdesc=1.0",
            "https://community.cisco.com/html/@E1D9E5099E7D8FD73DECA4D3FF50F455/rank_icons/rank-1.png",
            "https://community.cisco.com/legacyfs/online/photo/vcard_image.jpg",
            "https://community.cisco.com/html/@6B9987C79AC75D031A1DADB7914148F7/rank_icons/rank-4.png",
            "https://community.cisco.com/legacyfs/online/photo/vcard_image.jpg",
            "https://community.cisco.com/html/@6B9987C79AC75D031A1DADB7914148F7/rank_icons/rank-4.png",
            "https://community.cisco.com/t5/image/serverpage/avatar-name/default_icon/avatar-theme/candy/avatar-collection/Cisco_Default/avatar-display-size/profile/version/2?xdesc=1.0",
            "https://community.cisco.com/html/@E1D9E5099E7D8FD73DECA4D3FF50F455/rank_icons/rank-1.png",
            "https://community.cisco.com/legacyfs/online/photo/vcard_image.jpg",
            "https://community.cisco.com/html/@6B9987C79AC75D031A1DADB7914148F7/rank_icons/rank-4.png",
            "https://community.cisco.com/t5/image/serverpage/avatar-name/default_icon/avatar-theme/candy/avatar-collection/Cisco_Default/avatar-display-size/profile/version/2?xdesc=1.0",
            "https://community.cisco.com/html/@E1D9E5099E7D8FD73DECA4D3FF50F455/rank_icons/rank-1.png",
            "https://community.cisco.com/legacyfs/online/photo/vcard_image.jpg",
            "https://community.cisco.com/html/@6B9987C79AC75D031A1DADB7914148F7/rank_icons/rank-4.png",
            "https://community.cisco.com/t5/image/serverpage/avatar-name/default_icon/avatar-theme/candy/avatar-collection/Cisco_Default/avatar-display-size/profile/version/2?xdesc=1.0",
            "https://community.cisco.com/html/@E1D9E5099E7D8FD73DECA4D3FF50F455/rank_icons/rank-1.png",
            "https://community.cisco.com/legacyfs/online/photo/vcard_image.jpg",
            "https://community.cisco.com/html/@6B9987C79AC75D031A1DADB7914148F7/rank_icons/rank-4.png",
            "https://community.cisco.com/t5/image/serverpage/avatar-name/default_icon/avatar-theme/candy/avatar-collection/Cisco_Default/avatar-display-size/profile/version/2?xdesc=1.0",
            "https://community.cisco.com/html/@E1D9E5099E7D8FD73DECA4D3FF50F455/rank_icons/rank-1.png",
            "https://community.cisco.com/legacyfs/online/photo/vcard_image.jpg",
            "https://community.cisco.com/html/@6B9987C79AC75D031A1DADB7914148F7/rank_icons/rank-4.png",
            "https://community.cisco.com/t5/image/serverpage/avatar-name/default_icon/avatar-theme/candy/avatar-collection/Cisco_Default/avatar-display-size/profile/version/2?xdesc=1.0",
            "https://community.cisco.com/html/@E1D9E5099E7D8FD73DECA4D3FF50F455/rank_icons/rank-1.png",
            "https://community.cisco.com/legacyfs/online/photo/vcard_image.jpg",
            "https://community.cisco.com/html/@6B9987C79AC75D031A1DADB7914148F7/rank_icons/rank-4.png",
            "https://community.cisco.com/t5/image/serverpage/avatar-name/default_icon/avatar-theme/candy/avatar-collection/Cisco_Default/avatar-display-size/profile/version/2?xdesc=1.0",
            "https://community.cisco.com/html/@E1D9E5099E7D8FD73DECA4D3FF50F455/rank_icons/rank-1.png",
            "https://community.cisco.com/legacyfs/online/photo/vcard_image.jpg",
            "https://community.cisco.com/html/@6B9987C79AC75D031A1DADB7914148F7/rank_icons/rank-4.png",
            "https://community.cisco.com/t5/image/serverpage/avatar-name/default_icon/avatar-theme/candy/avatar-collection/Cisco_Default/avatar-display-size/profile/version/2?xdesc=1.0",
            "https://community.cisco.com/html/@E1D9E5099E7D8FD73DECA4D3FF50F455/rank_icons/rank-1.png",
            "https://community.cisco.com/skins/images/C6E73CA754EB18478C61054680A57D7F/responsive_peak/images/icon_anonymous_message.png"
        ],
        "movies": [],
        "keywords": [],
        "meta_keywords": [
            ""
        ],
        "tags": null,
        "authors": [
            "community.cisco.com",
            "user-id"
        ],
        "publish_date": "2015-04-21T13:47:59+00:00",
        "summary": "",
        "meta_description": "Solved: Hi, I was hoping someone can shed some light on this. I am not an IPT engineer. We are putting in a new CUCM 10 but the person who started this is no longer here and am just trying to pick up the pieces left behind. Thank you in advance.",
        "meta_lang": "en",
        "meta_favicon": "https://community.cisco.com/html/@D17C385B8A505F8125C5E271F02ACC75/rank_icons/ciscologo-square_16x16.png",
        "meta_site_name": "",
        "canonical_link": "https://community.cisco.com/t5/ip-telephony-and-phones/multiple-device-pools-single-sip-trunk/td-p/2626381",
        "text": "Hi, I was hoping someone can shed some light on this. I am not an IPT engineer. We are putting in a new CUCM 10 but the person who started this is no longer here and am just trying to pick up the pieces left behind. Thank you in advance.\n\nQuestion -\n\nIgnoring for now any E.911 stuff... Can 2 device pools make outbound calling against a single SIP trunk (1 IP address)? Office1 has a pub/sub and a single SIP trunk. Office2 has neither. We wanted two separate device pools. But the SIP trunk (found under Device | Trunk) can only be associated with a single DP.\n\nWe use an MPLS network dedicated to voice. The service provider is able to force inbound calls for both area codes to that SIP trunk. I guess my problem is on the outbound.\n\nIf it is possible, how do we make this happen? If not, does that imply that both offices must be in the same DP?\n\nThanks.\n\nNot sure why MTP is checked as on...Is your CUCM SIP trunked directly to the provider or do you have a gateway that the CUCM sends traffic to then to the provider? You really don't want to be invoking MTPs if you don't need to, and in your environment so far, I don't see a reason to be using them unless something else is going on. Also, yes it will drop all calls upon a Trunk reset, I would do this after hours and then test the phones.\n\nLet me think a bit on this and get back to you. I got a feeling if I were sitting in front of the system I would have had this solved yesterday.\n\nEdit: What device pool is the SIP trunk in?\n\nBrandon:\n\nThank you. If I was an IPT engineer, it might make better sense but I take your explanation as correct. :-) What did you mean by \"If that is the case (that is, if I'm using Std Local RG), whatever is first in that route group will take precedence...\" I think I am using Std Local RG (see below) but I don't see how the presence of this causes all outbound voice traffic to go out the SIP trunk. The only top/down list I see is within a route list, but the Std Local Route Group is listed second.\n\nUnder Route Group\n\nI have a single RG1 listed and the properties of it show my SIP trunk added as the only available device and and only RG member.\n\nLocal Route Group Names\n\nI see we do have a Standard Local RG.\n\nRoute List\n\nI see something he created called RL-SLRG. Within that definition, My RG1 is on top and RL-SLRG is listed second.\n\nRoute Pattern\n\nWhen I view the ones of interest, I see that the Gateway/Route List is specified as the RL-SLRG. For example, if you dial 9,1,area+number, use the RL-SLRG it says. How does this even work to know that RL-SLRG is to use my service provider's SIP trunk for outbound? I don't see thru anything on the web admin interface that defines this.\n\nI don't think the forum was intended to get a complete set of steps on how to implement so I won't bug you like that. If you can kindly give me some guidance on the above, the significance of a SLRG, etc., we can try to take it from there. Thank you again.\n\nHi Brandon, sorry I hit \"Report\" by accident instead of Reply. I did an Unreport. :-)\n\nWithin both Device Pools I see \"Local Route Group Settings\" and the Standard Local Route Group is set to < None > on both.\n\nSorry, hopefully last set of questions and will mark this as answered/correct.\n\n1. Given the Device Pools show < None > for the above, does this mean, while the guy defined some SLRG, that I'm not actually using them for Device Pools?\n\n2. Given that my Route List shows my RG1 as the top, does that mean it gets processed first (before the SLRG)? If so, does that effectively mean I'm not really using SLRG?\n\n3. But my Route Pattern shows that outbound calls should go thru the SLRG.\n\nSorry, very confused. I wish this were an ASA or something. Just easier for me...\n\nThank you.\n\n1. Two different locations both connected via private point-to-point.\n\n2. DP2 phones (office2) can register into CUCM in office1.\n\n3. Outbound to outside numbers have never worked out of DP2/office2. Interoffice works. Inbound works as well. The provider is able to have both area codes come in thru that single circuit in the main location.\n\n4. Yes, both DP have \"none\" for SLRG.\n\n5. Mix, strangely. Most are SIP. A few stragglers on SCCP.\n\n6. No known restrictions under CSS/Partitions that I can see.\n\nWill try to run the RTMT. Brandon, you are way cool. Let me try this and get back to you. If not tonight, tomorrow.\n\nI ran RTMT and assuming I did it correctly, I saw the failed test call and it says \"( 47 ) Resource, unavailable, unspecified. Explanation: A resource unavailable event occurred and no other cause in the resource unavailable class applies\".\n\nRE: your other post, when I look at Regions, the only mention is the Max Audio Bit Rate which shows 64 kbps (G.722, G.711). This is consistent across both regions. The preferred codec is to use the system default of Factory default low loss.\n\nNot sure about media resources. I don't understand the naming convention of appending _2 or _4 after each resource but I see a pair for:\n\nANN\n\nCFB\n\nMTP\n\nMOH.\n\nFor each resource,\n\n\"Resource_2\" is homed to DP2\n\n\"Resource_4\" is homed to DP1.\n\n\"Resource_2\" shows the IP of the publisher.\n\n\"Resource_4\" shows the IP of the sub. But both are registered against the sub, if that makes sense.\n\nThere is an MRG for each DP. For example:\n\nMRG_ANN_DP2 (with resource ANN_4)\n\nMRG_ANN_DP2 (with ANN_2).\n\nEtc.\n\nThen there are 2 MRGL's - one for each DP. Each MRGL though contains all the MRGs.\n\nIs my problem a media resource issue?\n\nI knew it, media resources are hosing you up. When you make a call from office2, what is the path? If you are G.711 all the way across you don't need transcoding but something else is hosing you up.\n\nANN is annunciator which is responsible for call progress tones, the \"Cannot complete this call as dialed\", etc.\n\nCFB is Conferences on the CUCM, can be either hardware or software, software is what comes with CUCM and is capable of g.711u/a and wideband codecs\n\nMTPs are your hold/resume abilities in which CUCM can hold the call, transfer it, etc. Hardware MTPs can also be used beyond what the CUCM can handle. MTPs basically are the bridge that allow media streams to be setup and taken down separately.\n\nMOH is just music on hold\n\nCause code 47 is definitely a media resource issue. So you checked every region and nothing noted G.729 anywhere? There is something called a Dialed number analyzer in CUCM as will show the call path from the perspective of a phone. When you log into CUCM\n\nUpper right corner is a dropdown go to Servicability\n\nTools --> Dialed Number Analyzer\n\nAnalysis --> Phones\n\nfind a phone at site 2 and select a line on that phone once you click the phone\n\nType in a valid PSTN number that the phone can dial(permissions allowing of course)\n\nSee what the call flow looks like just to verify the path it is taking is correct\n\nOther than that, I would need to know the topology and how everything is laid out with the DNA tool and Regions. My next question is, under the System--> Locations, you don't have anything setup for the sites there do you? If you do, are those put on any of the phones? Default is Hub_None and Phantom which I doubt he changed if that is all that is on there.\n\nI bet if you completely removed all MRGs, MRGLs, and their assignments the call would complete assuming G.711 is truely what is being used. In the RTMT logs for the call, on a SIP phone, what is the SDP sending the initial INVITE with assuming you are using early offer? SDP is Session Description Protocol which looks like this:\n\nInitial SIP INVITE message for call setup:\n\nINVITE sip:13@10.10.1.13 SIP/2.0\n\nVia: SIP/2.0/UDP 10.10.1.99:5060;branch=z9hG4bK343bf628;rport\n\nFrom: \"Test 15\" <sip:15@10.10.1.99>;tag=as58f4201b\n\nTo: <sip:13@10.10.1.13>\n\nContact: <sip:15@10.10.1.99>\n\nCall-ID: 326371826c80e17e6cf6c29861eb2933@10.10.1.99\n\nCSeq: 102 INVITE\n\nUser-Agent: Asterisk PBX\n\nMax-Forwards: 70\n\nDate: Wed, 06 Dec 2009 14:12:45 GMT\n\nAllow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,\n\nSUBSCRIBE, NOTIFY\n\nSupported: replaces\n\nContent-Type: application/sdp\n\nContent-Length: 258\n\nThen the SDP:\n\nv=0\n\no=root 1821 1821 IN IP4 10.10.1.99\n\ns=session\n\nc=IN IP4 10.10.1.99\n\nt=0 0\n\nm=audio 11424 RTP/AVP 0 8 101\n\na=rtpmap:0 PCMU/8000\n\na=rtpmap:8 PCMA/8000\n\na=rtpmap:101 telephone-event/8000\n\na=fmtp:101 0-16\n\na=silenceSupp:off - - - -\n\na=ptime:20\n\na=sendrecv\n\nNote the PCMU/8000, in the US we generally use PCMU for everything. If you arn't offering this and there isn't anything in there when site 2 calls, that is part of the issue, but I suspect this isn't a SIP trunking issue and again, purely a media resource problem. Once I get a better picture of your topology, we can go from there. I have a feeling if you set the MRGL on a phone from Site 2 to an MRGL of Site 1, you call would complete.\n\nThank you for the primer on the various media resources. It was very good information for me. Sorry lengthy post but you had a bunch of good questions.\n\nCall Path\n\nWhen I make a call from office2 (NJ), the call traverses our 100 Mbps point-to-point into office1 (NY). Point-to-point util is no greater than 10% (peak over 6 weeks) and average util of about 3%. NY has the pub/sub and voice circuit. The NJ call is supposed to go out that way. Pretty vanilla. When office2 is on its own DP, it fails. But if set to the office1 DP, it works well.\n\nDNA Tool\n\nI ran the tool twice. First using a working phone from office1. I then compared that to the results of using a non-working phone from office2. The results are an identical match.\n\nUnder Call Flow, the first section is the Translation Pattern section and it doesn't show much but appears OK. Just some stuff about transformations and such.\n\nRoute Pattern looks like it just says it matches the 9.1[2-0]XX[2-9]XXXXXX.\n\nRout List shows 2 Route Groups. First one just says RG1 and to use the End Device Name NY_SIP. The second one says SLRG is the route group name but nothing more really listed there other than some transformation information.\n\nNext, confirming I only have 2 regions (corresponding to offices 1 and 2) and neither have G.729 in them.\n\nTopology:\n\nBasically office1 is NY. It has a pub/sub and the provider's SIP. This is MPLS network dedicated to our voice only. Provider can take both 212 (NY) and 201 (NJ) area codes and permit inbound on that SIP and do outbound as well for both area codes.\n\nOffice2 is NJ but currently has no voice infrastructure. Just need to get these 7965 phones working thru the NY infrastructure for now until we get the other equipment and circuits ordered for NJ.\n\nOffices 1 and 2 connected for data via a 100 Mbps point-to-point circuit.\n\nSystem > Locations:\n\nTwo locations setup - one for NY and one for NJ. Both setup identically.\n\nNY has NJ as its adjacent location. In there it shows NJ having a weight of 50, audio b/w 48, video b/w 384, immersive b/s 384.\n\nUnder Advanced, audio, video and immersive have Unlimited chosen.\n\nLocation RSVP settings show both NJ and Phantom with no reservations.\n\nNJ setup identically but in reverse. That is, it just shows NY as the adjacent partner.\n\nThere is no Hub_None. The other 2 locations are Phantom and Shadow. Neither of these have any adjacent locations listed.\n\nSystem > Regions:\n\n2 regions - 1 for each office.\n\nLooks as if they are all using a system default. Codec preference factory default low loss.\n\nMax audio bit rate 64 kbps (G.722, G.711)\n\nMax session bit rate for video 384 kbps\n\nMax session bit rate for immersive 2147483647 kbps\n\nUnder modify relationship to other regions - all settings are set to keep current settings.\n\nThe RTMT thing from yesterday that had that 47 Resource unavailable lengthy error. When I double-click it, it shows a call flow diagram of:\n\nInvite\n\n100 trying\n\n183 Session Progress\n\nCANCEL\n\n200 OK\n\n487 Request Cancelled\n\nACK\n\nThe next tab of Message Details\\Detailed SIP\\Log File just shows that request was canceled and reason same as yesterday of Q.850; cause=47.\n\nThank you."
    }
}