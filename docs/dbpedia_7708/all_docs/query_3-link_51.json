{
    "id": "dbpedia_7708_3",
    "rank": 51,
    "data": {
        "url": "https://documentation.meraki.com/MX/Site-to-site_VPN/Site-to-Site_VPN_Settings",
        "read_more_link": "",
        "language": "en",
        "title": "Site-to-Site VPN Settings",
        "top_image": "https://a.mtstatic.com/@public/production/site_13505/1603418441-social-share.png",
        "meta_img": "https://a.mtstatic.com/@public/production/site_13505/1603418441-social-share.png",
        "images": [
            "https://documentation.meraki.com/@api/deki/site/logo?default=https%3A%2F%2Fdocumentation.meraki.com%2F%40cdn%2F%40style%2Fcommon-legacy%2Fimages%2Flogo.png",
            "https://a.mtstatic.com/@public/production/site_13505/1603418436-logo.png",
            "https://documentation.meraki.com/@api/deki/files/25279/Screenshot_2024-03-26_102818.png?revision=1",
            "https://documentation.meraki.com/@api/deki/files/25285/Screenshot_2024-03-26_111720.png?revision=1",
            "https://documentation.meraki.com/@api/deki/files/25278/Screenshot_2024-03-26_102117.png?revision=2",
            "https://documentation.meraki.com/@api/deki/files/25280/clipboard_ec19694c2ffd01634367d4f23dce81bd4.png?revision=1",
            "https://documentation.meraki.com/@api/deki/files/25282/clipboard_e7c4a6c504e78720a1289a72d9f72a2b9.png?revision=1",
            "https://documentation.meraki.com/@api/deki/files/25283/clipboard_ea4899d0eef056ccc77c7724db7503a77.png?revision=1",
            "https://documentation.meraki.com/@api/deki/files/25284/clipboard_e8b4260c0ccc31dbdbbdc8ba4c8949784.png?revision=1",
            "https://documentation.meraki.com/@api/deki/site/logo?default=https%3A%2F%2Fdocumentation.meraki.com%2F%40cdn%2F%40style%2Fcommon-legacy%2Fimages%2Flogo.png"
        ],
        "movies": [],
        "keywords": [],
        "meta_keywords": [
            ""
        ],
        "tags": null,
        "authors": [],
        "publish_date": "2020-10-05T18:13:13+00:00",
        "summary": "",
        "meta_description": "This article explains site-to-site VPN settings and different setups for either Auto VPN or non-Meraki VPN, it also discusses Phase 1 and Phase 2 parameters, FQDN and IKEv2",
        "meta_lang": "en",
        "meta_favicon": "https://a.mtstatic.com/@public/production/site_13505/1704402897-apple-touch-icon.png",
        "meta_site_name": "Cisco Meraki Documentation",
        "canonical_link": "https://documentation.meraki.com/MX/Site-to-site_VPN/Site-to-Site_VPN_Settings",
        "text": "Save as PDF\n\nSite-to-site VPN\n\nMeraki Auto VPN technology is a unique solution that allows site-to-site VPN tunnel creation with a single mouse click. When enabled through the dashboard, each participating MX and Z Series appliances automatically does the following:\n\nAdvertises its local subnets that are participating in the VPN.\n\nAdvertises its WAN IP addresses on Internet 1 and Internet 2 ports.\n\nDownloads the global VPN route table from the dashboard (automatically generated by the dashboard, based on each MX's advertised WAN IP/local subnet in the VPN network).\n\nDownloads the preshared key for establishing the VPN tunnel and traffic encryption.\n\nThe net result is an automatic mesh site-to-site VPN solution that is configured with a single click.\n\nSetting up site-to-site VPN\n\nSite-to-site VPN settings are accessible through the Security & SD-WAN > Configure > Site-to-site VPN page.\n\nType\n\nThere are three options for configuring the MX-Z's role in the Auto VPN topology:\n\nOff: The MX-Z device will not participate in site-to-site VPN.\n\nHub (Mesh): The MX-Z device will establish VPN tunnels to all remote Meraki VPN peers that are also configured in Hub (Mesh) mode. The device will also establish VPN tunnels to other MX-Z appliances in hub-and-spoke mode, where the other MX-Z device configured as a hub.\n\nSpoke: This MX-Z device (spoke) will establish direct tunnels only to the specified remote MX-Z devices (hubs). Other spokes will be reachable via their respective hubs unless blocked by site-to-site firewall rules.\n\nHub Type\n\nExit Hubs\n\nThis option is only available if the MX-Z device is configured as a Hub. This option lets you designate the remote MX-Z device that is to receive all network traffic from the local MX-Z device. This creates a full tunnel configuration where all traffic destined for a default route is sent to the specified MX.\n\nSecurity features over full-tunnel VPN\n\nIn a full tunnel topology, all security and content filtering must be performed on the full tunnel client. The Exit hub will not apply content filtering, Intrusion Prevention System (IPS) blocking, or malware scanning to traffic coming in over the VPN. However, Intrusion Detection System (IDS) scanning will be performed for this traffic.\n\nSpoke Type\n\nHubs\n\nWhen an appliance is configured as a spoke, multiple VPN hubs can be configured for that appliance. In this configuration, the spoke MX-Z device will send all site-to-site traffic to its configured VPN hubs.\n\nDefault Route\n\nWhen configuring hubs for a spoke, there is an option to select a hub as a Default route. If this option is selected, then that hub will be configured as a default route for the spoke (0.0.0.0/0). Any traffic that is not sent to a configured VPN peer network, a static route or local network will be sent to the default route. This routing will apply to any traffic originating from subnets set to, \"In VPN\" or that have VPN mode \"Enabled.\" Subnets that have VPN mode \"Disabled\" will not adhere to the VPN routing tables. Multiple hubs can be selected as default routes. Hubs marked as default routes take priority in descending order (first priority at the top).\n\nConfiguring Multiple VPN Hubs\n\nTo add additional hubs, click the Add a hub button just below the existing hub that is selected. Only appliances in Mesh VPN mode can be hubs, so the number of Mesh VPN appliances in your dashboard organization represents the maximum number of hubs that can be configured for any given appliance.\n\nThe order in which hubs are configured on this page is the hub priority. Hub priority is used to determine which hub to use if more than one VPN hub is advertising the same subnet. The uppermost hub that meets the following criteria will be used to reach that subnet.\n\nA) Advertises the subnet\n\nB) Currently reachable via VPN\n\nHubs can be deleted by clicking on the grey X to the right of the relevant hub under the Actions column. The hub priority list can be reordered by clicking and dragging the grey four-point arrow icon to the right of any hub in the list to move that hub up or down.\n\nConcentrator priority\n\nThe concentrator priority determines how appliances in Hub (Mesh) mode will reach subnets that are advertised from more than one Meraki VPN peer. Similarly to hub priorities, the uppermost concentrator in the list that meets the following criteria will be used for such a subnet.\n\nA) Advertises the subnet\n\nB) Currently reachable via VPN\n\nIt is important to note that concentrator priorities are used only by appliances in Meshmode. An appliance in hub-and-spoke mode will ignore the concentrator priorities and will use its hub priorities instead.\n\nNAT Traversal\n\nIf the MX-Z device is behind a firewall or other Network Address Translation (NAT) device, there are two options for establishing the VPN tunnel:\n\nAutomatic: In the vast majority of cases, the MX-Z device can automatically establish site-to-site VPN connectivity to remote Meraki VPN peers even through a firewall or NAT device using a technique known as \"UDP hole punching\". This is the recommended (and default) option.\n\nManual: Port forwarding: If the Automatic option does not work, you can use this option. When Manual: Port forwarding is enabled, Meraki VPN peers contact the MX-Z device using the specified public IP address and UDP port number. You will need to configure the upstream firewall to forward all incoming traffic on that UDP port to the IP address of the MX-Z device.\n\nMake sure the port number you have chosen is not already used by another service. For example, do not use port 500 or 4500 as these are used for Client VPN and 3rd party VPN peer communication.\n\nLocal Networks\n\nIf you have multiple LAN subnets, you have the option to specify which VLANs and static routes participate in the VPN.\n\nThe same subnet can only be advertised from more than one appliance if all appliances advertising that subnet are in Passthrough or VPN Concentrator mode. All subnets advertised from an appliance in Routed mode must be unique within the Auto VPN topology.\n\nSubnets to which the MX-Z device has Static LAN routes can also be advertised over the VPN. If you choose to advertise a statically routed subnet over the VPN, ensure that the gateway device for each subnet is configured to route traffic for remote VPN subnets to the MX-Z device, in order to keep your routing symmetrical.\n\nIn full tunnel configurations when specifying a prefix to be part of a VPN, everything covered by that prefix will be allowed in the VPN. Therefore, subnets that overlap will cause traffic in a more specific subnet to be sent through the VPN, even if it is not configured to be included in the VPN. For example, if 10.0.0.0/16 is configured to be included in the VPN but 10.0.1.0/24 is not, traffic sourced from 10.0.1.50 will still be sent over the VPN.\n\nVPN Subnet Translation\n\nThis feature is not enabled by default, please contact Meraki support to enable it.\n\nMoreover, this feature is only supported for Auto VPN and is not intended to work with non-Meraki VPN peers.\n\nIn large distributed networks, multiple networks may have identical subnet scopes (for example, overlapping subnets). Site-to-site VPN communication requires each site to have distinct and non-overlapping local subnets. In the event that multiple locations have the same local subnet, enable VPN subnet translation to translate the local subnet to a new subnet with the same number of addresses. For more information, refer to the Using Site-to-site VPN Translation article.\n\nSubnet Translation Example\n\nBranch 1 local subnet: 192.168.31.0/24\n\nBranch 2 local subnet: 192.168.31.0/24 (identical!)\n\nBranch 1 translated subnet: 10.0.1.0/24\n\nBranch 2 translated subnet: 10.0.2.0/24\n\nIn the example above, even though both networks have identical local subnets, they can communicate over the VPN using their translated VPN subnet. Branch 1 is accessible as 10.0.1.0/24 and Branch 2 is accessible as 10.0.2.0/24 over the VPN tunnel.\n\nOpen Shortest Path First (OSPF) Route Advertisement\n\nNote: As part of MX 18.1 firmware updates we are introducing a new Routing page, more details found in the \"OSPF Configuration\" section of the IPv6 Support on MX Security & SD-WAN Platforms - Routing article.\n\nWhile the MX Security Appliance does not currently support full OSPF routing, OSPF can be used to advertise remote VPN subnets to a core switch or other routing device, avoiding the need to create static routes to those subnets. OSPF advertisement is supported in VPN Concentrator mode or in Routed mode on MX 13.4+ firmware with VLANs disabled.\n\nAdvertise remote routes: If this is set to Enabled, OSPF will be used to advertise remote VPN subnets as reachable via this MX.\n\nRouter ID: The OSPF Router ID that this MX will use to identify itself to neighbors.\n\nArea ID: The OSPF Area ID that this MX will use when sending route advertisements.\n\nCost: The route cost attached to all OSPF routes advertised from this MX.\n\nHello timer: How frequently the MX will send OSPF Hello packets. This should be the same across all devices in your OSPF topology.\n\nDead timer: How long the MX will wait to see Hello packets from a particular OSPF neighbor before considering that neighbor inactive.\n\nMD5 Authentication: If this is enabled, MD5 hashing will be used to authenticate potential OSPF neighbors. This ensures that no unauthorized devices are injecting OSPF routes into the network.\n\nAuthentication Key: The Message Digest Algorithm 5 (MD5) key number and passphrase. Both of these values must match between any devices that you wish to form an OSPF adjacency.\n\nWAN appliances in Routed mode only support OSPF when using the \"Single LAN\" LAN setting. This can be set on Addressing & VLANs page.\n\nNon-Meraki VPN Peers\n\nYou can create Site-to-site VPN tunnels between a Security Appliance or a Teleworker Gateway and a Non-Meraki VPN endpoint device under the Non-Meraki VPN peers section on the Security & SD-WAN > Configure > Site-to-site VPN page. Simply click Add a peer and enter the following information:\n\nA name for the remote device or VPN tunnel.\n\nWhat Internet Key Exchange (IKE) version to use (IKEv1 or IKEv2)*\n\nThe public IP address of the remote device (NOTE: if the peer device is part of a high availability peer (HA), you will need to enter the HA's virtual IP).\n\nLocal ID of this MX. This is an optional configuration and is what the remote peer will receive as the remote ID of this MX.\n\nIf left blank (default) it is the uplink IP of the MX, not the public IP. Some peers may expect this to match the public IP of the MX, a User FQDN (for example, user@domain.com), or FQDN (for example, www.example.com) based on their configuration.\n\nThe Remote ID of the remote peer. This is an optional configuration and can be configured to the remote peer’s User FQDN, FQDN, or IPv4 address as needed.\n\nWhich of these values you use is dependent upon your remote device. Please consult its documentation to learn what values it is capable of specifying as its remote ID, and how to configure them (for example, Determining an ID Method for ISAKMP Peers for ASA firewalls).\n\nThe subnets behind the third-party device that you wish to connect to over the VPN. 0.0.0.0/0 can also be specified to define a default route to this peer.\n\nNote that if an MX-Z device is configured with a default route (0.0.0.0/0) to a non-Meraki VPN peer, traffic will not fail over to the WAN, even if the connection goes down.\n\nThe IPsec policy to use.\n\nThe preshared secret key (PSK).\n\nAvailability settings to determine which appliances in your dashboard organization will connect to the peer.\n\nMinimum Firmware Requirements:\n\n- IKEv2 requires firmware version 15.12 or greater.\n\n- IPv6 peering requires firmware version 18.2 or greater.\n\nWhen setting up Non-Meraki VPN connections between two MXs in different organizations, make sure to populate the Remote ID field of the Non-Meraki VPN peer with the private IP address of the remote MX if all of the following conditions are met:\n\nThe MXs are running firmware version MX 15 or higher.\n\nThey do not use a User FQDN.\n\nThey are connected behind an upstream NAT device.\n\nLimitations:\n\nNon-Meraki VPN peers cannot use MX/Z appliances as an \"exit hub\" as they do not interpret a default route (0.0.0.0/0) as a valid traffic selector.\n\nNon-Meraki VPN connections are only established over the active WAN uplink, and cannot be established across multiple WAN uplinks.\n\nMaking changes to Non-Meraki VPN settings under Security & SD-WAN > Configure > Site-to-site VPN, might result in existing Non-Meraki VPN tunnels bouncing. We recommend that you make changes during a maintenance window to minimize the impact of Non-Meraki VPN tunnels bouncing.\n\nNon-Meraki VPN Peering with FQDN\n\nThis feature enables the use of FQDN instead of an IP address while configuring a Non-Meraki VPN peer. Using IP addresses can be tedious because with a dynamic IP address, a customer has to manually modify the Non-Meraki VPN settings on the Site-to-Site VPN page when there is an IP address change. With FQDN configuration, the hostname of the remote peer would automatically get resolved each time a connection is initiated.\n\n“FQDN” differs from “User FQDN.” The MX resolves the FQDN to an IP address of the remote peer, whereas, “User FQDN” is used in conjunction with the IP address of the remote peer. “FQDN” identifies the remote peer and is configured in the “Public IP/Hostname” field. “User FQDN” identifies the local peer and is configured in the “Local ID” field.\n\nSupported Products:\n\nMX running firmware 18.1 or higher\n\nRequires IKEv2\n\nConfiguration\n\nThe FQDN of the Non-Meraki VPN peer can be configured in the Public IP/Hostname field when IKEv2 is the selected IKE version.\n\nThe default behavior of the MX is to set remote_id to FQDN if it is not explicitly added in the dashboard Non-Meraki VPN peers settings. Please note, the remote id on one peer needs to match the local id on the other peer for the tunnel to be established.\n\nIf the configured FQDN fails to resolve, an event will be reported in Network-wide > Monitor > Event log on dashboard\n\nNOTE For IKEv2\n\nMeraki appliances build IPsec tunnels by sending out a request with a single traffic selector payload that contains all of the expected local and remote subnets. Certain vendors may not support allowing more than one local and remote selector in a given IPsec tunnel. For such cases, please use IKEv1 instead.\n\nAn MX-Z device will not try to form a VPN tunnel to a non-Meraki peer if it does not have any local networks advertised.\n\nIPsec Policies\n\nThere are three preset IPsec policies available.\n\nDefault: Uses the Meraki default IPsec settings for connection to a non-Meraki device\n\nAWS: Uses default settings for connecting to an Amazon Virtual Private Cloud (VPC)\n\nAzure: Uses default settings for connecting to a Microsoft Azure instance\n\nIf none of these presets are appropriate, the Custom option allows you to manually configure the IPsec policy parameters. These parameters are divided into Phase 1 and Phase 2.\n\nPhase 1\n\nEncryption: Select between AES-128, AES-192, AES-256, and 3DES encryption\n\nAuthentication: Select MD5, SHA1 or SHA256* authentication\n\nDiffie-Hellman group: Select between Diffie-Hellman (DH) groups 1, 2, 5 or 14*\n\nLifetime (seconds): Enter the phase 1 lifetime in seconds\n\n* These settings require firmware version 15.12 or greater\n\nPhase 2\n\nEncryption: Select between AES-128, AES-192, AES-256, and 3DES encryption (multiple options can be selected)\n\nAuthentication: Select between MD5, SHA1 and SHA256 authentication (both options can be selected)\n\nPFS group: Select the Off option to disable Perfect Forward Secrecy (PFS). Select group 1, 2, 5 or 14 to enable PFS using that Diffie-Hellman group.\n\nLifetime (seconds): Enter the phase 2 lifetime in seconds\n\nOn May 8th 2018, changes were introduced to deprecate DES for encryption. Refer to the Deprecation of DES Encryption Algorithm article for more information.\n\nNOTE: Please ensure the phase 2 lifetimes are equal on both ends of the tunnel whenever possible. While MX's can sometimes honor a shorter phase 2 lifetime if they're acting in response to build a tunnel, they cannot while serving as the initiator of the tunnel.\n\nNon-Meraki VPN Failover\n\nFor non-Meraki VPN the MX will fail over the IPSec tunnel from the MX Primary to Secondary internet link when the link is marked as failed. The primary link can be set under Security & SD-WAN > Configure > SD-WAN & Traffic Shaping page.\n\nPeer Availability\n\nBy default, a non-Meraki peer configuration applies to all MX-Z appliances in your dashboard organization. Since it is not always desirable for every appliance you control to form tunnels to a particular non-Meraki peer, the Availability column allows you to control which appliances within your Organization will connect to each peer. This control is based on network tags, which are labels you can apply to your dashboard networks.\n\nWhen All networks is selected for a peer, all MX-Z appliances in the organization will connect to that peer. When a specific network tag or set of tags is selected, only networks that have one or more of the specified tags will connect to that peer.\n\nMore information on network tags can be found in the Organization Overview article.\n\nVPN Firewall Rules\n\nYou can add firewall rules to control what traffic is allowed to pass through the VPN tunnel. These rules will apply to outbound VPN traffic to/from from all MX-Z appliances in the Organization that participate in site-to-site VPN. Configuration steps for the rules can be found in the Site-to-site VPN Firewall Rule Behavior article.\n\nNote: VPN Firewall rules will not apply to inbound traffic or to traffic that is not passing through the VPN.\n\nMonitoring Site-to-site VPN\n\nYou can monitor the status of the site-to-site VPN tunnels between your Meraki devices by clicking Security & SD-WAN > Monitor > VPN Status. This page provides real-time status for the configured Meraki site-to-site VPN tunnels. It lists the subnet(s) being exported over the VPN, connectivity information between the MX-Z appliance and the Meraki VPN registry, NAT Traversal information, and the encryption type being used for all tunnels. For more information regarding this page, refer to the VPN Status Page article.\n\nTroubleshooting\n\nIf the VPN tunnel is not coming up upon following the set-up guidelines listed above, you may need to generate interesting traffic first. This can be done by initiating a ping to an IP address in the remote subnet.\n\nFor other common issues and troubleshooting steps, please refer to Site-to-site VPN Troubleshooting."
    }
}