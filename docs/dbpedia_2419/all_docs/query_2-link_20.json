{
    "id": "dbpedia_2419_2",
    "rank": 20,
    "data": {
        "url": "https://www.microsoft.com/en-us/security/blog/2023/08/24/flax-typhoon-using-legitimate-software-to-quietly-access-taiwanese-organizations/",
        "read_more_link": "",
        "language": "en",
        "title": "Flax Typhoon using legitimate software to quietly access Taiwanese organizations",
        "top_image": "https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2023/08/Twitter-card-Flax-Typhoon-1.png",
        "meta_img": "https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2023/08/Twitter-card-Flax-Typhoon-1.png",
        "images": [
            "https://img-prod-cms-rt-microsoft-com.akamaized.net/cms/api/am/imageFileData/RE1Mu3b?ver=5c31",
            "https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2023/08/Flax-Typhoon-featured-image-1024x683.jpg",
            "https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2023/08/Figure-1.-Flax-Typhoon-attack-chain-diagram-1024x336.webp",
            "https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2023/08/Figure-2.-Flax-Typhoon-command-disabling-NLA-1024x79.webp",
            "https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2023/08/Figure-3.-Flax-Typhoon-command-altering-Sticky-Keys-behavior-1024x95.webp",
            "https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2023/08/Figure-4.-Flax-Typhoon-command-downloading-a-SoftEther-VPN-executable-1024x94.webp",
            "https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2023/08/Figure-5.-Flax-Typhoon-command-creating-a-service-to-launch-the-VPN-connection-1024x121.webp",
            "https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2024/07/509a683c-bc41-4ac4-9c2b-eb639f50903a-336x189.jpg",
            "https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2023/07/Storm-0558-336x189.webp",
            "https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2023/05/Volt-Typhoon-featured-336x189.webp",
            "https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2023/07/Storm-0978-336x189.webp",
            "https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2022/07/IIS-backdoors-featured.png",
            "https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2021/06/Security_Blog-banner_900x360.png"
        ],
        "movies": [],
        "keywords": [],
        "meta_keywords": [
            ""
        ],
        "tags": null,
        "authors": [
            "Microsoft Threat Intelligence"
        ],
        "publish_date": "2023-08-24T00:00:00",
        "summary": "",
        "meta_description": "Microsoft has identified the nation-state activity group Flax Typhoon is targeting organizations in Taiwan, likely to perform espionage.",
        "meta_lang": "en",
        "meta_favicon": "https://c.s-microsoft.com/favicon.ico?v2",
        "meta_site_name": "Microsoft Security Blog",
        "canonical_link": "https://www.microsoft.com/en-us/security/blog/2023/08/24/flax-typhoon-using-legitimate-software-to-quietly-access-taiwanese-organizations/",
        "text": "Summary\n\nMicrosoft has identified a nation-state activity group tracked as Flax Typhoon, based in China, that is targeting dozens of organizations in Taiwan with the likely intention of performing espionage. Flax Typhoon gains and maintains long-term access to Taiwanese organizations’ networks with minimal use of malware, relying on tools built into the operating system, along with some normally benign software to quietly remain in these networks. Microsoft has not observed Flax Typhoon using this access to conduct additional actions. This blog aims to raise awareness of the techniques used by this threat actor and inform better defenses to protect against future attacks.\n\nMicrosoft has observed a distinctive pattern of malicious activity almost exclusively affecting organizations in Taiwan using techniques that could be easily reused in other operations outside the region and would benefit from broader industry visibility. Microsoft attributes this campaign to Flax Typhoon (overlaps with ETHEREAL PANDA), a nation-state actor based out of China. Flax Typhoon’s observed behavior suggests that the threat actor intends to perform espionage and maintain access to organizations across a broad range of industries for as long as possible. However, Microsoft has not observed Flax Typhoon act on final objectives in this campaign. Microsoft is choosing to highlight this Flax Typhoon activity at this time because of our significant concern around the potential for further impact to our customers. Although our visibility into these threats has given us the ability to deploy detections to our customers, the lack of visibility into other parts of the actor’s activity compelled us to drive broader community awareness to further investigations and protections across the security ecosystem.\n\nIn this blog post, we share information on Flax Typhoon, the current campaign targeting Taiwan, and the actor’s tactics for achieving and maintaining unauthorized access to target networks. Because this activity relies on valid accounts and living-off-the-land binaries (LOLBins), detecting and mitigating this attack could be challenging. Compromised accounts must be closed or changed. Compromised systems must be isolated and investigated. At the end of this blog post, we share more mitigation steps and best practices, as well as provide details on how Microsoft 365 Defender detects malicious and suspicious activity to protect organizations from such stealthy attacks.\n\nWho is Flax Typhoon?\n\nFlax Typhoon has been active since mid-2021 and has targeted government agencies and education, critical manufacturing, and information technology organizations in Taiwan. Some victims have also been observed elsewhere in Southeast Asia, as well as in North America and Africa. Flax Typhoon focuses on persistence, lateral movement, and credential access. As with any observed nation-state actor activity, Microsoft has directly notified targeted or compromised customers, providing them with important information needed to secure their environments.\n\nFlax Typhoon is known to use the China Chopper web shell, Metasploit, Juicy Potato privilege escalation tool, Mimikatz, and SoftEther virtual private network (VPN) client. However, Flax Typhoon primarily relies on living-off-the-land techniques and hands-on-keyboard activity. Flax Typhoon achieves initial access by exploiting known vulnerabilities in public-facing servers and deploying web shells like China Chopper. Following initial access, Flax Typhoon uses command-line tools to first establish persistent access over the remote desktop protocol, then deploy a VPN connection to actor-controlled network infrastructure, and finally collect credentials from compromised systems. Flax Typhoon further uses this VPN access to scan for vulnerabilities on targeted systems and organizations from the compromised systems.\n\nAnalysis of current campaign\n\nInitial access\n\nFlax Typhoon achieves initial access by exploiting known vulnerabilities in public-facing servers. The services targeted vary, but include VPN, web, Java, and SQL applications. The payload in these exploits is a web shell, such as China Chopper, which allows for remote code execution on the compromised server.\n\nPrivilege escalation\n\nIn cases where the process compromised via web shell does not have local administrator privileges, Flax Typhoon downloads and runs a piece of malware that exploits one or more known vulnerabilities to obtain local system privileges. Microsoft has observed the actor use Juicy Potato, BadPotato, and other open-source tools to exploit these vulnerabilities.\n\nPersistence\n\nOnce Flax Typhoon can access Windows Management Instrumentation command-line (WMIC), PowerShell, or the Windows Terminal with local administrator privileges, the actor establishes a long-term method of accessing the compromised system using the remote desktop protocol (RDP). To accomplish this, the actor disables network-level authentication (NLA) for RDP, replaces the Sticky Keys binary, and establishes a VPN connection.\n\nWhen using RDP, NLA requires the connecting user to authenticate to the remote system before a full remote session is established and the Windows sign-in screen is displayed. When NLA is disabled, any user attempting to access the remote system can interact with the Windows sign-in screen before authenticating, which can expose the remote system to malicious actions by the connecting user. Flax Typhoon changes a registry key to disable NLA, allowing them to access the Windows sign-in screen without authenticating, whereupon the actor will use the Sticky Keys shortcut.\n\nSticky Keys is an accessibility feature in Windows that allows users to press modifier keys (such as Shift, Ctrl, Alt) one at a time instead of simultaneously. It includes a shortcut where the user can press the Shift key five times in succession to launch sethc.exe, the program that manages Sticky Keys. The user can invoke this shortcut at any time, including at the sign-in screen. To take advantage of this feature, Flax Typhoon changes a registry key that specifies the location of sethc.exe. The actor adds arguments that cause the Windows Task Manager to be launched as a debugger for sethc.exe. As a result, when the actor uses the Sticky Keys shortcut on the Windows sign-in screen, Task Manager launches with local system privileges.\n\nAt this stage, Flax Typhoon can access the compromised system via RDP, use the Sticky Keys shortcut at the sign-in screen, and access Task Manager with local system privileges. From there, the actor can launch the Terminal, create memory dumps, and take nearly any other action on the compromised system. The only issue the actor faces with this persistence method is that RDP is most likely running on an internal-facing network interface. Flax Typhoon’s solution is to install a legitimate VPN bridge to automatically connect to actor-controlled network infrastructure.\n\nCommand and control\n\nTo deploy the VPN connection, Flax Typhoon downloads an executable file for SoftEther VPN from their network infrastructure. The actor downloads the tool using one of several LOLBins, such as the PowerShell Invoke-WebRequest utility, certutil, or bitsadmin. Flax Typhoon then uses the Service Control Manager (SCM) to create a Windows service that launches the VPN connection automatically when the system starts. This could allow the actor to monitor the availability of the compromised system and establish an RDP connection.\n\nFlax Typhoon takes several precautions with their VPN connection to make it harder to identify. First, the actor uses a legitimate VPN application that could be found in enterprise environments. As a result, the file itself is almost certain to go undetected by antivirus products. Second, the actor almost always renames the executable file from vpnbridge.exe to conhost.exe or dllhost.exe. These names imitate the legitimate Windows components Console Window Host Process and Component Object Model Surrogate respectively. Third, the actor uses SoftEther’s VPN-over-HTTPS operation mode, which uses protocol tunneling to encapsulate Ethernet packets into compliant HTTPS packets and transmit them to TCP port 443. This makes the VPN connection very difficult to differentiate from legitimate HTTPS traffic, which most network security appliances would not block.\n\nIn cases where Flax Typhoon needs to move laterally to access other systems on the compromised network, the actor uses LOLBins, including Windows Remote Management (WinRM) and WMIC.\n\nMicrosoft has observed Flax Typhoon routing network traffic to other targeted systems through the SoftEther VPN bridge installed on compromised systems. This network traffic includes network scanning, vulnerability scanning, and exploitation attempts.\n\nCredential access\n\nOnce Flax Typhoon becomes established on the target system, Microsoft observes the actor conducting credential access activities using common tools and techniques. Most commonly, Flax Typhoon targets the Local Security Authority Subsystem Service (LSASS) process memory and Security Account Manager (SAM) registry hive. Both stores contain hashed passwords for users signed into the local system. Flax Typhoon frequently deploys Mimikatz, a publicly available malware that can automatically dump these stores when improperly secured. The resulting password hashes can be cracked offline or used in pass-the-hash (PtH) attacks to access other resources on the compromised network.\n\nFlax Typhoon also enumerates restore points used by System Restore. Restore points contain data about the Windows operating system that the system owner can use to revert changes to the system if it becomes inoperable, rather than a backup of user data. Flax Typhoon could use this information to better understand the compromised system or as a template for removing indicators of malicious activity.\n\nThis pattern of activity is unusual in that minimal activity occurs after the actor establishes persistence. Flax Typhoon’s discovery and credential access activities do not appear to enable further data-collection and exfiltration objectives. While the actor’s observed behavior suggests Flax Typhoon intents to perform espionage and maintain their network footholds, Microsoft has not observed Flax Typhoon act on final objectives in this campaign.\n\nMitigation and protection guidance\n\nDefending against techniques used by Flax Typhoon begins with vulnerability and patch management, particularly on systems and services exposed to the public internet. The credential access techniques used can also be mitigated with proper system hardening.\n\nWhat to do now if you’re affected\n\nAffected organizations need to assess the scale of Flax Typhoon activity in their network, remove malicious tools and C2 infrastructure, and check logs for signs of compromised accounts that may have been used for malicious purposes.\n\nInvestigating Suspected compromised accounts or affected systems\n\nFind LSASS and SAM dumping to identify affected accounts.\n\nExamine the activity of compromised accounts for any malicious actions or exposed data.\n\nClose or change credentials for all compromised accounts. Depending on the level of activity, many accounts may be affected.\n\nAffected systems should be isolated and forensically examined for artifacts of malicious activity.\n\nBecause Flax Typhoon alters the configuration of the operating system to produce malicious behavior, affected systems may need to be decommissioned or restored to a known-good configuration.\n\nDefending against Flax Typhoon attacks\n\nKeep public-facing servers up to date to defend against malicious activity. As prime targets for threat actors, public-facing servers need additional monitoring and security. User input validation, file integrity monitoring, behavioral monitoring, and web application firewalls can all help to better secure these servers.\n\nMonitor the Windows registry for unauthorized changes. The Audit Registry feature allows administrators to generate events when specific registry keys are modified. Such policies can detect registry changes that undermine the security of a system, like those made by Flax Typhoon.\n\nUse network monitoring and intrusion detection systems to identify unusual or unauthorized network traffic. If an organization does not use RDP for a specific business purpose, any RDP traffic should be considered unauthorized and generate alerts.\n\nEnsure that Windows systems are kept updated with the latest security patches, including MS16-075.\n\nMitigate the risk of compromised valid accounts by enforcing strong multifactor authentication (MFA) policies using hardware security keys or Microsoft Authenticator. Passwordless sign-in methods (for example, Windows Hello, FIDO2 security keys, or Microsoft Authenticator), password expiration rules, and deactivating unused accounts can also help mitigate risk from this access method.\n\nRandomize Local Administrator passwords with a tool like Local Administrator Password Solution (LAPS) to prevent lateral movement using local accounts with shared passwords.\n\nReduce the attack surface. Microsoft customers can turn on the following attack surface reduction rules to block or audit some observed activity associated with this threat:\n\nBlock credential stealing from the Windows local security authority subsystem (lsass.exe).\n\nBlock process creations originating from PSExec and WMI commands. Some organizations may experience compatibility issues with this rule on certain server systems but should deploy it to other systems to prevent lateral movement originating from PsExec and WMI.\n\nHarden the LSASS process by enabling Protective Process Light (PPL) for LSASS on Windows 11 devices. New, enterprise-joined Windows 11 (22H2 update) installs have this feature enabled by default. In addition, enable Windows Defender Credential Guard, which is also turned on by default for organizations using the Enterprise edition of Windows 11, as well as Memory integrity (also referred to as hypervisor-protected code integrity or HVCI) for stronger protections on Windows.\n\nSet the WDigest UseLogonCredential registry value via Group Policy Object to reduce the risk of successful LSASS process memory dumping.\n\nTurn on cloud-delivered protection in Microsoft Defender Antivirus to cover rapidly evolving attacker tools, techniques, and behaviors such as those exhibited by Flax Typhoon.\n\nRun endpoint detection and response (EDR) in block mode so that Microsoft Defender for Endpoint can block malicious artifacts, even when your non-Microsoft antivirus does not detect the threat, or when Microsoft Defender Antivirus is running in passive mode. EDR in block mode works behind the scenes to remediate malicious artifacts that are detected post-compromise.\n\nDetection details and hunting queries\n\nMicrosoft 365 Defender detections\n\nMicrosoft 365 Defender is becoming Microsoft Defender XDR. Learn more.\n\nMicrosoft Defender Antivirus\n\nMicrosoft Defender Antivirus detects threat components as the following malware:\n\nHackTool:Win32/Mimikatz\n\nTrojan:Win32/Swrort\n\nHackTool:Win32/Badcastle\n\nBehavior:Win32/CobaltStrike\n\nBackdoor:ASP/Chopper\n\nMicrosoft Defender for Endpoint\n\nThe following alerts might indicate threat activity related to this threat. Note, however, that these alerts can also be triggered by unrelated threat activity.\n\nMalicious credential theft tool execution detected\n\nSuspicious access to LSASS service\n\nUse of LOLBin to run malicious code\n\nSystem file masquerade\n\nHunting queries\n\nMicrosoft 365 Defender\n\nMicrosoft 365 Defender customers can run the following queries to find related activity in their networks:\n\nNetwork activity with Flax Typhoon network infrastructure\n\nSoftEther VPN bridge launched by SQL Server process\n\nSoftEther VPN bridge renamed to “conhost.exe” or “dllhost.exe”\n\nCertutil launched by SQL Server process\n\nFile downloaded by MSSQLSERVER account using certutil\n\nFile renamed to “conhost.exe” or “dllhost.exe”, downloaded using certutil\n\nNetwork connection made by SoftEther VPN bridge renamed to “conhost.exe” or “dllhost.exe”\n\nNetwork connection made by MSSQLSERVER account, using SoftEther VPN bridge\n\nMicrosoft Sentinel\n\nMicrosoft Sentinel customers can use the TI Mapping analytics (a series of analytics all prefixed with ‘TI map’) to automatically match the malicious domain indicators mentioned in this blog post with data in their workspace. If the TI Map analytics are not currently deployed, customers can install the Threat Intelligence solution from the Microsoft Sentinel Content Hub to have the analytics rule deployed in their Sentinel workspace. More details on the Content Hub can be found here: https://learn.microsoft.com/azure/sentinel/sentinel-solutions-deploy.\n\nMicrosoft Sentinel also has a range of detection and threat hunting content that customers can use to detect the post exploitation activity detailed in this blog in addition to Microsoft 365 Defender detections list above.\n\nPossible web shell drop\n\nWeb shell activity\n\nPotential local privilege escalation\n\nAnomalous RDP activity\n\nAccessibility features modification\n\nCertutil-LOLBins\n\nBitsadmin activity\n\nSuspected LSASS dump\n\nCredential dumping service installation\n\nIndicators of compromise\n\nIn addition to compromised SOHO devices and compromised devices used for traffic proxying, Flax Typhoon maintains actor-controlled network infrastructure, including virtual private servers (VPS). Over the course of the campaign, the IP addresses listed in the table below were used during the corresponding timeframes.\n\nFlax Typhoon hosts its SofEther VPN servers on its own network infrastructure. Because the servers use the HTTPS protocol to disguise network traffic, they must present TLS certificates. Flax Typhoon used the certificates listed in the table below on these VPN servers.\n\nReferences\n\nhttps://attack.mitre.org/techniques/T1190\n\nhttps://attack.mitre.org/techniques/T1505/003/\n\nhttps://attack.mitre.org/software/S0020/\n\nhttps://github.com/ohpe/juicy-potato\n\nhttps://github.com/BeichenDream/BadPotato\n\nhttps://attack.mitre.org/techniques/T1059\n\nhttps://attack.mitre.org/techniques/T1546/008/\n\nhttps://attack.mitre.org/techniques/T1105/\n\nhttps://github.com/SoftEtherVPN/SoftEtherVPN_Stable\n\nhttps://attack.mitre.org/techniques/T1543/003\n\nhttps://attack.mitre.org/techniques/T1036/005/\n\nhttps://github.com/SoftEtherVPN/SoftEtherVPN_Stable/blob/master/WARNING.TXT\n\nhttps://attack.mitre.org/techniques/T1572/\n\nhttps://attack.mitre.org/techniques/T1003/001/\n\nhttps://attack.mitre.org/techniques/T1003/002/\n\nhttps://attack.mitre.org/techniques/T1550/002/\n\nFurther reading\n\nFor the latest security research from the Microsoft Threat Intelligence community, check out the Microsoft Threat Intelligence Blog: https://aka.ms/threatintelblog."
    }
}