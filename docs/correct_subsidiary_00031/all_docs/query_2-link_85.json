{
    "id": "correct_subsidiary_00031_2",
    "rank": 85,
    "data": {
        "url": "https://forum.proxmox.com/threads/infiniband-configuration-questions.14320/",
        "read_more_link": "",
        "language": "en",
        "title": "infiniband configuration questions",
        "top_image": "https://forum.proxmox.com/styles/uix/images/Proxmox-logo-stacked-white-background-1200.png",
        "meta_img": "https://forum.proxmox.com/styles/uix/images/Proxmox-logo-stacked-white-background-1200.png",
        "images": [
            "https://forum.proxmox.com/styles/uix/images/Proxmox-logo-500px.png",
            "https://forum.proxmox.com/styles/uix/images/Proxmox-logo-black-800.png",
            "https://forum.proxmox.com/styles/uix/images/Proxmox-logo-500px.png",
            "https://forum.proxmox.com/styles/uix/images/Proxmox-logo-black-800.png"
        ],
        "movies": [],
        "keywords": [],
        "meta_keywords": [
            ""
        ],
        "tags": null,
        "authors": [
            "Ohio ulbuilder.wordpress.com"
        ],
        "publish_date": "2013-06-29T05:09:23+02:00",
        "summary": "",
        "meta_description": "we're following http://pve.proxmox.com/wiki/Infiniband#Without_Bonding  . \n\non a pair  machines   used  in pve as nfs storage , \n\nafter bring up the...",
        "meta_lang": "",
        "meta_favicon": "/data/assets/logo/proxmox-logo-symbol-192x192.png",
        "meta_site_name": "Proxmox Support Forum",
        "canonical_link": "https://forum.proxmox.com/threads/infiniband-configuration-questions.14320/",
        "text": "Re: infiniband : \"enabling connected mode will cause multicast packet drops\"\n\nConnected mode is much faster with IPoIB, if I remember right without connected mode I only got about 1Gbit throughput.\n\nLarger MTU is also much faster than MTU of 1500\n\nIf the only multicast application you have on the Infiniband network is Proxmox itself, then do not worry about the warning:\n\nCode:\n\n[ 9685.082542] ib0: mtu > 2044 will cause multicast packet drops.\n\nReason is totem has its own MTU setting that defaults to 1500 which works fine in connected mode IPoIB.\n\nIf you are worried about it, see my notes here:\n\nhttp://pve.proxmox.com/wiki/Multicast_notes#Multicast_with_Infiniband\n\nAs mentioned there, it is still untested as I have never seen a need to change the netmtu for totem.\n\nI currently have 20 nodes in a single Proxmox cluster using IPoIB in connected mode.\n\nProxmox is using the IPoIB network for its multicast clustering communications.\n\n16 of those nodes are also replicating data using DRBD on the IPoIB network.\n\nWorks perfectly fine for me.\n\nIn a little over one year we have only had one problem with Infiniband.\n\nThe master subnet manager on one of our four switches stopped allowing topology changes for some odd reason.\n\nSince we had bonded connections to redundant switches on every server I decided to just power cycle the bad switch, problem went away and the bonded connections failed over to the other switch just fine with no disruption.\n\nRe: infiniband : \"enabling connected mode will cause multicast packet drops\"\n\ne100- thank you for your help so far... IB would have been impossible to get done without your help.\n\nWe have a topspin 120 and 6 systems attached. ping and ssh works using the infiniband [ ib ] IP addresses.\n\nI've a couple of questions.\n\n1- we've another topspin 120 on order from ebay. . How do you connect them together? I had assumed just connect a cable to each switch, but the hardware manual says to use a 'Infiniband cable inter-switch link (ISL) .\n\n2- to connect to lan and wan do you use the IB network and routing, or just use ethernet nics and network on pve hosts?\n\nanyone else who knows about Topspin / Infiniband in a pve set up please chime in.\n\nHi Rob, always glad to help especially when I can share knowledge on a subject that few others have dealt with. You will be helping someone in the future and all of our knowledge will grow.\n\nWish I had more free time to post here, been far too busy lately and Proxmox has been running flawless so nothing to complain about. ;-)\n\nI turned on the subnet manager on all switches then just connect them with same cables you use for servers. They will elect a master and just work, wish Ethernet was this easy!\n\nUse two or more cables for redundancy no setup required just plug it in.\n\nWe have four switches, two per cabinet.\n\nSwitch A and B in one cabinet\n\nSwitch C and D in other\n\nList of every connection between them:\n\n2 links A - B\n\n2 links C - D\n\n1 link A - C\n\n1 link A - D\n\n1 link B - C\n\n1 link B - D\n\nEvery node has dual IB ports with each port connected to a different switch.\n\nSwitch failures, link failures it just keeps on working.\n\nWe had the master subnet manager get in some weird state once, power cycled that switch and not even a blip in connectivity.\n\nIt is the subnet manager that makes it all work detecting redundant paths and such.\n\nIB can be more complex like using multiple subnets assigning ports to subnets and such, use a single subnet and it is super simple.\n\nMy IB network is isolated doing only proxmox cluster and drbd data. Because these are EOL and will not get any software updates it could be risky to make them Internet accessible.\n\nI use bonded gig Ethernet to connect to everything else.\n\nDid you get the latest firmware on your switch? All of mine came with older firmware.\n\nThere are also some java based utilities that you might find handy.\n\nHere is the config from one of my switches, they are all the same other than ip addresses/names:\n\nCode:\n\nTopspin-120 #1> show config ! TopspinOS-2.9.0/build170 ! Sat Aug 3 00:11:14 2013 enable config terminal ! boot-config primary-image-source TopspinOS-2.9.0/build170 ! ib sm subnet-prefix fe:80:00:00:00:00:00:00 priority 0 ! interface mgmt-ethernet ip address x.x.x.x 255.255.255.0 gateway x.x.x.x no shutdown ! location \"Cabinet #2\" ! ntp server-one x.x.x.x ntp server-two x.x.x.x ! username admin password 7 xxxxxxx username admin community-string xxxxxxx username guest password 7 xxxxxxx username guest community-string xxxxxx username super password 7 xxxxxxxx username super community-string xxxxxxx ! ! snmp-server contact \"x@x.com\" hostname \"Topspin-120 #1\" !\n\nLooking for the master subnet manager is not as simple as it seems, the command outputs different data depending on if the node you run it on is master or standby.\n\nFrom a standby you will only see the master:\n\nCode:\n\nTopspin-120 #2> show ib sm sm-info subnet-prefix fe:80:00:00:00:00:00:00 ================================================================================ Discovered Subnet Managers in Fabric ================================================================================ subnet-prefix : fe:80:00:00:00:00:00:00 port-guid : 00:05:ad:00:00:02:xx:xx priority : 0 sm-state : master sm-key : 00:00:00:00:00:00:00:00 act-count : 1091199584\n\nFrom a master you only see the standbys:\n\nCode:\n\nTopspin-120 #1# show ib sm sm-info subnet-prefix fe:80:00:00:00:00:00:00 ================================================================================ Discovered Subnet Managers in Fabric ================================================================================ subnet-prefix : fe:80:00:00:00:00:00:00 port-guid : 00:05:ad:00:00:02:xx:xx priority : 0 sm-state : standby sm-key : 00:00:00:00:00:00:00:00 act-count : 40572476 subnet-prefix : fe:80:00:00:00:00:00:00 port-guid : 00:05:ad:00:00:02:xx:xx priority : 0 sm-state : standby sm-key : 00:00:00:00:00:00:00:00 act-count : 27459063 subnet-prefix : fe:80:00:00:00:00:00:00 port-guid : 00:05:ad:00:00:02:xx:xx priority : 0 sm-state : standby sm-key : 00:00:00:00:00:00:00:00 act-count : 25564059\n\nAs you can see this is really simple to configure once you know how to do it.\n\nThat ISO also has some utilities, those can be useful in understanding how it all works, they connect to the switches using SNMP so you will need to set the community strings like I have in my config above."
    }
}