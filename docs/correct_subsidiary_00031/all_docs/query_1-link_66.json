{
    "id": "correct_subsidiary_00031_1",
    "rank": 66,
    "data": {
        "url": "https://forums.developer.nvidia.com/t/new-to-infiniband-cant-get-a-working-connection/208159",
        "read_more_link": "",
        "language": "en",
        "title": "New to infiniband, can't get a working connection.",
        "top_image": "https://global.discourse-cdn.com/nvidia/original/3X/e/4/e41d27491ee72562cf68c340597ca95f587879bd.png",
        "meta_img": "https://global.discourse-cdn.com/nvidia/original/3X/e/4/e41d27491ee72562cf68c340597ca95f587879bd.png",
        "images": [],
        "movies": [],
        "keywords": [],
        "meta_keywords": [
            ""
        ],
        "tags": null,
        "authors": [],
        "publish_date": "2013-07-08T20:17:13+00:00",
        "summary": "",
        "meta_description": "I have 4x mellanox infinihost III cards, 1x mellanox connectx card that was new out of a sealed box, and a cisco topspin 120. I cannot get a single infinband link light on the switch to light up. I can go into the topspi&hellip;",
        "meta_lang": "en",
        "meta_favicon": "https://global.discourse-cdn.com/nvidia/optimized/2X/0/0372ccc95874f71d7fbff64bbbff6f8c69dd850b_2_32x32.png",
        "meta_site_name": "NVIDIA Developer Forums",
        "canonical_link": "https://forums.developer.nvidia.com/t/new-to-infiniband-cant-get-a-working-connection/208159",
        "text": "I have 4x mellanox infinihost III cards, 1x mellanox connectx card that was new out of a sealed box, and a cisco topspin 120. I cannot get a single infinband link light on the switch to light up. I can go into the topspin interface and they are all enabled, but show no link light when plugged in. If I plug the cards into eachother, no link lights either. I have 8x SDR cables and I get the same result from each of them. I also had a qlogic silverstorm switch before that showed the same problem, so now i’m forced to consider one or more of the following:\n\nI have had 2 bad switches in a row.\n\nI have 8x bad infiniband cables\n\nI have 5x bad mellanox cards\n\nI’m a moron and should switch to fibre channel.\n\nIs there anything I might be missing? I’m sick of sending back switches that might not be bad.\n\nregarding the combination Win Server 2012 + HCA FW - there is a dependency there. you have to be on the latest FW for ConnectX in order for the link to come up.\n\nfor ConnectX/2 you need to be around 2.9.1000 or higher. for ConnectX3 you should be on 2.11.XXXX or 2.30.XXXX\n\nNo worries. I was wondering what happened.\n\nI’m kind of wondering if the subnet manager in the Cisco/Topspin box is too ancient to properly recognise your cards.\n\nAre you able to get another Linux box up and running temporarily? If so, it would be interesting to see what happens if you turn off the subnet manager in the Cisco/Topspin box, instead running your own (OpenSM) on another box connected to the switch.\n\nNo idea if that’s practical for you to try out though…\n\nSorry for the lateness, i’ve been busy. I’m running 1 vmware host, 2 windows hosts and a linux san host. the linux box is running software called “esos” which busybox linux with all the SCST software pre-installed. It’s frustrating because the software shows the HCA no problem. Plug it into another card, lights up, no problem. Plug it into a cisco topspin…no light. I have to check with the software vendor as since ESOS runs busybox I don’t have a mstflint or lspci on it, this is what’s taking me some time.\n\nNo worries. Which OS are you using?\n\nIs there any chance you could do stuff on CentOS/RHEL 6.4?\n\nAsking that because it’s what I’m super familiar with.\n\nIf you’re ok with that, please install the CentOS/RHEL provided IB software, and also pciutils:\n\n$ sudo yum groupinstall “Infiniband Support”\n\n$ sudo yum install mstflint pciutils\n\n$ sudo chkconfig rdma on\n\n$ sudo service rdma start\n\nThen let’s do some basic info gathering so we know what we’re dealing with.\n\nRun lspci -Qvvs on the ConnectX card, and at least one of the Infinihost III’s, then post the results here\n\nAlso query the firmware of both using mstflint\n\nExample from a ConnectX card here. First I find out it’s PCI address in the box:\n\n$ sudo lspci |grep Mell\n\n01:00.0 InfiniBand: Mellanox Technologies MT25418 [ConnectX VPI PCIe 2.0 2.5GT/s - IB DDR / 10GigE] (rev a0)\n\nThen use lspci -Qvvs on that address, to retrieve all of the potentially useful info:\n\n$ sudo lspci -Qvvs 01:00.0\n\n01:00.0 InfiniBand: Mellanox Technologies MT25418 [ConnectX VPI PCIe 2.0 2.5GT/s - IB DDR / 10GigE] (rev a0)\n\nSubsystem: Mellanox Technologies Device 0006\n\nControl: I/O- Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- FastB2B- DisINTx+\n\nStatus: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast >TAbort- <TAbort- SERR- <PERR- INTx-\n\nLatency: 0, Cache Line Size: 64 bytes\n\nInterrupt: pin A routed to IRQ 16\n\nRegion 0: Memory at f7c00000 (64-bit, non-prefetchable) [size=1M]\n\nRegion 2: Memory at f0000000 (64-bit, prefetchable) [size=8M]\n\nCapabilities: [40] Power Management version 3\n\nFlags: PMEClk- DSI- D1- D2- AuxCurrent=0mA PME(D0-,D1-,D2-,D3hot-,D3cold-)\n\nStatus: D0 NoSoftRst- PME-Enable- DSel=0 DScale=0 PME-\n\nCapabilities: [48] Vital Product Data\n\nProduct Name: Eagle DDR\n\nRead-only fields:\n\n[PN] Part number: 375-3549-01\n\n[EC] Engineering changes: 51\n\n[SN] Serial number: 1388FMH-0905400010\n\n[V0] Vendor specific: PCIe x8\n\n[RV] Reserved: checksum good, 0 byte(s) reserved\n\nRead/write fields:\n\n[V1] Vendor specific: N/A\n\n[YA] Asset tag: N/A\n\n[RW] Read-write area: 111 byte(s) free\n\nEnd\n\nCapabilities: [9c] MSI-X: Enable+ Count=128 Masked-\n\nVector table: BAR=0 offset=0007c000\n\nPBA: BAR=0 offset=0007d000\n\nCapabilities: [60] Express (v2) Endpoint, MSI 00\n\nDevCap: MaxPayload 256 bytes, PhantFunc 0, Latency L0s <64ns, L1 unlimited\n\nExtTag- AttnBtn- AttnInd- PwrInd- RBE+ FLReset+\n\nDevCtl: Report errors: Correctable- Non-Fatal- Fatal- Unsupported-\n\nRlxdOrd- ExtTag- PhantFunc- AuxPwr- NoSnoop- FLReset-\n\nMaxPayload 256 bytes, MaxReadReq 512 bytes\n\nDevSta: CorrErr- UncorrErr- FatalErr- UnsuppReq- AuxPwr- TransPend-\n\nLnkCap: Port #8, Speed 2.5GT/s, Width x8, ASPM L0s, Latency L0 unlimited, L1 unlimited\n\nClockPM- Surprise- LLActRep- BwNot-\n\nLnkCtl: ASPM Disabled; RCB 64 bytes Disabled- Retrain- CommClk-\n\nExtSynch- ClockPM- AutWidDis- BWInt- AutBWInt-\n\nLnkSta: Speed 2.5GT/s, Width x8, TrErr- Train- SlotClk- DLActive- BWMgmt- ABWMgmt-\n\nDevCap2: Completion Timeout: Range ABCD, TimeoutDis+, LTR-, OBFF Not Supported\n\nDevCtl2: Completion Timeout: 50us to 50ms, TimeoutDis-, LTR-, OBFF Disabled\n\nLnkCtl2: Target Link Speed: 2.5GT/s, EnterCompliance- SpeedDis-\n\nTransmit Margin: Normal Operating Range, EnterModifiedCompliance- ComplianceSOS-\n\nCompliance De-emphasis: -6dB\n\nLnkSta2: Current De-emphasis Level: -6dB, EqualizationComplete-, EqualizationPhase1-\n\nEqualizationPhase2-, EqualizationPhase3-, LinkEqualizationRequest-\n\nCapabilities: [100 v1] Alternative Routing-ID Interpretation (ARI)\n\nARICap: MFVC- ACS-, Next Function: 1\n\nARICtl: MFVC- ACS-, Function Group: 0\n\nKernel driver in use: mlx4_core\n\nKernel modules: mlx4_core\n\nNote the blue highlighted bits. For ConnectX cards this stuff is useful. For my card, it’s showing a Sun part number, as it was originally a Sun badged card (now reflashed to stock firmware). The PCI link is in x8 state too, which is useful (if it wasn’t, it would indicate a problem).\n\nAnd the mstflint output example:\n\n$ sudo mstflint -d 01:00.0 q\n\nImage type: ConnectX\n\nFW Version: 2.9.1000\n\nDevice ID: 25418\n\nDescription: Node Port1 Port2 Sys image\n\nGUIDs: 0003ba000100edb8 0003ba000100edb9 0003ba000100edba 0003ba000100edbb\n\nMACs: 0003ba00edb9 0003ba00edba\n\nBoard ID: (MT_04A0120002)\n\nVSD:\n\nPSID: MT_04A0120002\n\nThat tells us the firmware version on the card. Useful to know, as it might need upgrading (very easy to do).\n\nAfter you’ve pasted that info here, we can start figuring out if there’s anything wrong with the basics first and fix them. Then we can move onto the next stuff.\n\n(note - edited for typo fixes)\n\nyes, still having problems. since original post, i’m now on my 3rd switch, and the second topspin 120 and i’m having the exact same issue. While I can plug in two of the infinihost IIIs together and get a link light, when I plug them into the switch, I get no link light. I also cannot plug the connectx card into either and get it to work, but i’m starting to suspect that it’s just a bad card. I just can’t believe one person can have this much trouble with this stuff.\n\nInteresting. That shows you’ve tested the cables, and they’re ok, so it’s not that.\n\nI wonder if the switch(es) themselves have been configured by their last owner to some non-standard settings?\n\nMaybe some kind of weird/unusual port speed combination or similar.\n\nThree thoughts at this point:\n\nWould you be ok to paste the output of mstflint query command, so we can see any PSID and/or firmware info for one of the cards?\n\nIf you haven’t already, look for a way to reset the switch itself to “factory defaults”. May or may not exist. No idea, but worth a shot just in case it really is “strange settings have been applied”.\n\nTry forcing the cards to very slow port speeds. Something equivalent to 10Gb/s, and see if that works. Actually, I’d probably try manually forcing the cards to all of the port speeds, one at a time, and see if any of them link up through the switch. Again, just in case the switch isn’t negotiating properly for some reason.\n\nSide note - I’m on holiday this week, so likely only limited help from me at this time."
    }
}