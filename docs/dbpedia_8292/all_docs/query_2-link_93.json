{
    "id": "dbpedia_8292_2",
    "rank": 93,
    "data": {
        "url": "https://rmprepusb.com/tutorials/089-automated-windows-partition-backuprestore-boot-menu-using-clonezilla/",
        "read_more_link": "",
        "language": "en",
        "title": "089 – AUTOMATED WINDOWS PARTITION BACKUP\\RESTORE BOOT MENU USING CLONEZILLA – RMPrepUSB",
        "top_image": "https://rmprepusb.com/wp-content/uploads/2021/02/cropped-usb-logo-input-1773302-32x32.jpg",
        "meta_img": "https://rmprepusb.com/wp-content/uploads/2021/02/cropped-usb-logo-input-1773302-32x32.jpg",
        "images": [
            "https://rmprepusb.com/wp-content/uploads/2022/10/rm_prep_468x60_7_transparent-1.jpg",
            "https://rmprepusb.com/wp-content/uploads/2022/10/rm_prep_468x60_7_transparent-1.jpg",
            "https://rmprepusb.com/rmprep/clonezilla/6113c3fa084c3b16b7cceda76de5a2b9.jpg",
            "https://rmprepusb.com/rmprep/clonezilla/73f214065157a51ab8d335a4601a17c5.jpg",
            "https://rmprepusb.com/rmprep/clonezilla/de5fd40b4f561a01f01e7061f1e0e386.jpg",
            "https://rmprepusb.com/wp-content/uploads/2022/02/forgot_password_use_konboot.png",
            "https://in.getclicky.com/101350702ns.gif"
        ],
        "movies": [
            "https://www.youtube.com/embed/KD9ugWNLCTw?feature=oembed",
            "https://www.youtube.com/embed/cEE_vn8E0Kk?feature=oembed"
        ],
        "keywords": [],
        "meta_keywords": [
            ""
        ],
        "tags": null,
        "authors": [],
        "publish_date": null,
        "summary": "",
        "meta_description": "",
        "meta_lang": "en",
        "meta_favicon": "https://rmprepusb.com/wp-content/uploads/2021/02/cropped-usb-logo-input-1773302-32x32.jpg",
        "meta_site_name": "",
        "canonical_link": "https://rmprepusb.com/tutorials/089-automated-windows-partition-backuprestore-boot-menu-using-clonezilla/",
        "text": "Note: For a simple F11 to restore free solution, try Aomei One Key Recovery (free).\n\nFor a Tutorial for Windows UEFI systems see Tutorial 142\n\nRMPrepUSB Blog – please leave a comment or feedback on RMPrepUSB or this Tutorial (please mention Tutorial number).\n\nIf you want to make a bootable external USB Hard disk so that you can create or restore backups, see Tutorial 118.\n\nINTRODUCTION\n\nThis tutorial allows you to add some boot menu options to create a partition backup and restore option for your existing Windows hard disk. You do not have to re-format and re-install Windows to add a recovery partition. This tutorial assumes your disk has MBR partitions not GPT (UEFI).\n\nNote: This system is not compatible with UEFI and GPT-partitioned disk!\n\nOnce set up, all the user has to do is press F4 for an automatic restore (with just one confirmation prompt only – but this can be removed if you prefer a fully automatic restore).\n\nIt uses CloneZilla and is based on a version posted by ndog37 on reboot.pro. With this tutorial, you can quickly backup your copy of Windows at any time and then later restore any of the previous backup images. An XP backup takes approximately 5 minutes. Restoring an XP image takes approximately 1 to 5 minutes. Windows 7/8/10/11 will obviously take longer!.\n\nThe backup is made on the hard disk, so it is not suitable for off-line backups. The backup and restore options can also be fully automated so even your granny could restore Windows if it went wrong! If the hard disk no longer boots, you can always boot to Clonezilla from a USB drive and restore/repair the disk.\n\nThis tutorial assumes that your Windows OS is installed onto the first hard disk in your system, is the only copy of Windows on that hard disk and you have a backup partition on the first hard disk that has some free space to store the backup images in. If you have more than one partition containing Windows (e.g. dual-boot), then this tutorial will not work correctly and you will need to modify the menu.lst file substantially.\n\nYou can find out more about CloneZilla here. Boot parameters are here.\n\nBecause this method installs grub4dos, you will need to ensure your computer boots from the Master Boot Record.\n\nIf your Windows 7-11 system uses UEFI booting, you will need to change the BIOS to CSM/MBR mode or follow the UEFI version of this tutorial.\n\nCLONEZILLA REFERENCES\n\nLive Doc\n\nBoot parameters\n\nFAQ\n\nRestore options\n\nList of options and switches\n\nManual backup/restore instructions\n\nHISTORY\n\nv1 2012-10-24 – First release – no Auto-Backup\\Restore option\n\nv2 2012-10-25 – 2nd version – added Auto-Backup\\Restore option, split up long command line using grub4dos environment variables for easier editing\\viewing, suppress keymap menu\n\nv3 2012-11-01 – Added hotkey to menu, F4 for Restore from any Image, F6 for Auto-Restore\n\nOUTLINE\n\nWhat we are going to do is to place a copy of Clonezilla on a spare backup partition on your hard disk, add some files and then install the grub4dos bootloader onto your hard disk.\n\nAfter this has been done, your system will boot to a new grub4dos menu, as shown below (in this example we have a Windows XP system, so the menu shows Windows XP).\n\nThe menu.lst will automatically work out what partition is your Windows partition and what partition is the backup partition. When the menu is displayed, you will see which partition has been picked by the menu because the names listed in the menu will be changed automatically – e.g. sda1, sda2, etc. Thus it does not matter what partition arrangement you have as long as both the Windows and Clonezilla partitions are on the first disk (i.e. they can be in any order).\n\nLinux disk notation:\n\nsda1 = First hard disk (a), first partition (1)\n\nsda2 = First hard disk (a), second partition (2)\n\nsdb5 = Second hard disk (b), first Logical partition (5) – 1 to 4 are the primary partitions.\n\nThis is the grub4dos boot menu – after a 10 seconds countdown it will boot to Windows unless a key is pressed.\n\nThe Auto-xxxx options use a backup image name of ‘IMG’. The other options allow you to define the backup image name yourself and you can make multiple backup images.\n\nMETHOD\n\n1. First we need to ensure that you have a spare partition on your hard disk that we can use to store the backup files and CloneZilla. This will appear on your system as D: and you will need to ensure that you have at least several gigabytes of spare space available on it. If you do not have a 2nd partition or you need to create a larger partition then you can use Windows Disk Manager to delete, extend or shrink partitions. The Backup partition can be NTFS (high;y recommended) or FAT32 (max 32GB) and it can be a primary basic partition or a logical partition.\n\nIf you have a XP Windows system with no ‘shrink’ option in Disk Manager, you can download and use the free utility EaSeus Partition Master Home Edition.\n\n>>> Before you proceed, check that the target system is a standard Windows system with two or more MBR partitions\n\nand check that the backup partition (e.g. D:) has lots of spare space.\n\nPLEASE NOTE: The menu.lst will only detect the BACKUP partition if it is on the first, second, third or fourth internal hard drive (partitions 1-7).\n\nYou can edit the menu.lst if it does not detect the backup drive.\n\nGPT disks: Clonezilla may not recognise or like GPT partitions. If your disk previously contained GPT partitions, CloneZilla may not work even though you delete all partitions and create new MBR partitions using Windows Setup. For this reason, it is highly recommended to use Windows DiskPart from a command shell to wipe the disk before you install a fresh copy of Windows. Typical commands are: SELECT DISK 0 – CLEAN – CONVERT MBR. Thanks to ‘James’ for this tip! See also ‘GPT Partition Fix’ below to save having to re-install Windows.\n\n2. We need some tools, so on any Windows system (it does not need to be the target system), download the zip file CloneZillaBackup.zip from the bottom of this page and extract the contents to a new folder on your hard disk (I will call this new folder c:\\xxx).\n\n3. Download the CloneZilla ISO file from here – I used clonezilla-live-20120620-precise.iso. Use 7Zip or some other utility to extract the \\live folder from inside the iso and copy it to the C:\\xxx\\clonezilla folder. Only three files are actually needed but you can copy the whole live folder if you like.\n\n4. You should now have a folder structure like this (where xxx can be any name you choose):\n\nC:\\xxx\\menu.lst\n\nC:\\xxx\\grldr\n\nC:\\xxx\\Hide.cmd\n\nC:\\xxx\\UnHide.cmd\n\nC:\\xxx\\clonezilla\\auroraxx.bmp.gz (two 80×600 compressed .bmp files)\n\nC:\\xxx\\clonezilla\\grubinst.exe\n\nC:\\xxx\\clonezilla\\hotkey\n\nC:\\xxx\\clonezilla\\InstallGrub4dos.cmd\n\nC:\\xxx\\clonezilla\\live\\filesystem.sqashfs\n\nC:\\xxx\\clonezilla\\live\\vmlinuz\n\nC:\\xxx\\clonezilla\\live\\initrd.img\n\nC:\\xxx\\clonezilla\\images\\ (folder)\n\nInstalling the CloneZilla files onto a target system:\n\n5. Now copy the the xxx folder contents(via a USB drive or via the network) to the backup partition (D: usually) of your target system – you should now have this folder structure (assuming D: is your backup volume)\n\nD:\\menu.lst\n\nD:\\grldr\n\nD:\\Hide.cmd\n\nD:\\UnHide.cmd\n\nD:\\clonezilla\\auroraxx.bmp.gz (two 80×600 compressed .bmp files)\n\nD:\\clonezilla\\grubinst.exe\n\nD:\\clonezilla\\hotkey\n\nD:\\clonezilla\\InstallGrub4dos.cmd\n\nD:\\clonezilla\\live\\filesystem.sqashfs\n\nD:\\clonezilla\\live\\vmlinuz\n\nD:\\clonezilla\\live\\initrd.img\n\n6. To install grub4dos onto your target internal hard disk, right-click on the file D:\\clonezilla\\InstallGrub4dos.cmd and run as Administrator – If you receive no error message then press Y and hit the <Enter> key. If you see an error message, check that your disk is an MBR disk and not a GPT (UEFI) disk (e.g. using DISKPART – LIST DISK)!\n\nNote: Check that the file C:\\bootmgr exists before rebooting. If it does not exist then add the line in bold to the menu.lst file and delete the other two as shown below:\n\ntitle Windows\\nBoot to Windows find --set-root --devices=h /bootmgr && chainloader /bootmgr find --set-root --devices=h /ntldr && chainloader /ntldr find --set-root --devices=h /boot/BCD && chainloader /bootmgr boot If your system contains multiple Windows installations, you may need to use the above menu or write a new 'tag' file to mark the correct boot partition - e.g. \\clzboot.tag: title Windows\\nBoot to Windows find --set-root --devices=h /clzboot.tag && chainloader /bootmgr boot\n\n7. It is time to reboot your system and check that you get the new menu and that you can still boot to Windows.\n\nFIRST REMOVE ALL USB DRIVES in case they contain a copy of /bootmgr – otherwise the menu.lst may boot to a different drive when the ‘Boot to Windows’ option is chosen.\n\nRestart Windows and you should see the new boot menu, if you wait 10 seconds, it should then boot to Windows as normal. You can simply hit <Enter> to avoid the 10 second wait.\n\nNote: If you are just dropped to a grub> command prompt, then try typing the following commands:\n\nfind --set-root /menu.lst\n\nconfigfile /menu.lst\n\nIf you need to type this on every boot, then copy the menu.lst file from the backup D:\\ drive to the root of the C:\\ drive. Note: If, in future, you change this C:\\menu.lst file, remember to save a copy of it on your backup drive D: also, in case the C: copy gets deleted.\n\nIf your system does not show the menu (no change is seen) then it may be that the system is set up for UEFI booting. In which case you will need are using the wrong tutorial – use the UEFI tutorial instead!\n\nIf you cannot boot to Windows from the menu, then press the c key to get to the grub4dos console. Then type various ls commands to find the bootmgr file:\n\nfind /bootmgr ls (hd0,0)/ ls (hd0,1)/ ls (hd0,2)/ ls (hd0,3)/ find /BOOT/bootmgr etc. etc.\n\nWhen you find the file, type chainloader <path> where <path> is the full path – e.g. chainloader /BOOT/bootmgr and then type boot. Once Windows loads, edit the menu.lst menu entry so that the correct path for bootmgr is used (see section 6 above).\n\n8. When the system has rebooted to Windows, double-click on the file D:\\Hide.cmd to hide the \\clonezilla folder and a few of the grub4dos files – only the D:\\UnHide.cmd file should now be visible in Windows Explorer (unless you have changed the Folder View default options in Windows Explorer).\n\nCreate a Windows Backup Image\n\n9. Finally, we need to create a Windows Backup Image – reboot the Windows system and when you see the grub4dos boot menu, choose ‘2 Create Backup Image‘ (press 2 and the <Enter> or use the Down or Right cursor keys). You will see a blank screen with a flashing cursor for a few seconds and then some linux boot progress text. The current menu does not allow you to select a keymap, if you delete the preseed option (see below) then you will then see a ‘Configuring console-data’ screen heading and be able to choose a keyboard type.\n\nThis menu is only seen if you delete live_keymap=”NONE” in the menu.lst file.\n\nIf all is well, you should eventually now be offered a file name to use for the backup that you are about to make – e.g. 2012-20-23-12-img – you can change this name if you like and then click on OK to continue.\n\nClonezilla should then automatically backup your Windows volume (usually sda1) and then reboot.\n\nIf you want to have a simple single-backup option, use the 4 Auto-Backup menu – this is fully automated and always backs up to the file IMG.\n\nRestore from a Backup Image\n\nTo restore a previous Windows backup image, reboot and select the ‘1 Restore Backup Image’ option. You will be able to select one of any of the previous backups that you have made and restore that image. When complete Clonezilla will reboot the system automatically.\n\nTip: to quickly check that the image backup/restore is working, make a backup and then change your Desktop wallpaper and then reboot and restore the original image – your wallpaper should now be changed back again.\n\nThe 3 F6 Auto-Restore menu is fully automated and will restore the backup (IMG) made by Auto-Backup (option 4). This means you could remove all other menu options and just leave the F6 menu so that the user could restore the IMG image. If you also deleted the -c option from the menu, the image restore would be completely automatic with no user prompts whatsoever (and all new user data would be lost!). Note that if no IMG backup already exists, it will report an error and reboot.\n\nTROUBLESHOOTING\n\nIf Clonezilla does not boot on your system – try the x64 version here.\n\nIf you are stuck at a grub4dos prompt and you get no menu and it won’t boot to Windows, to boot to Windows, type:\n\nchainloader (bd)1+1\n\nboot\n\nGPT Partition fix\n\nIf a backup does not run, then when you get to the backup name entry field, press ENTER and then press CTRL+S to stop the screen scrolling and CTRL+Q to start it again. Then you can see the error messages. If you see GPT related messages you probably have a GPT partition on the disk somewhere!\n\nYou can remove the GPT partition under linux as follows (select cmd to get to the command shell)\n\nsudo gdisk /dev/sda (press 1 to select MBR)\n\nPress ‘x’ and enter to reach the eXpert mode\n\nNow press ‘z’ to delete the gpt\n\nIMPORTANT: At this step be careful, you will get an option to blank out your MBR,\n\nPress N for NO Press Ctrl + C when ever you need to exit from gdisk.\n\nType exit to reboot (don’t make a backup until you have checked it boots correctly).\n\nIf you have blanked out the MBR (LBA0) accidentally, LBA 1 should still contain a backup. You can use dd to copy LBA1 to LBA0 (check it’s contents first!).\n\nBoot issues\n\nIf something goes wrong and you can no longer boot to grub4dos or Windows, boot from an Windows Repair DVD (or ISO on a USB drive), drop to the command console (Repair – troubleshooting – Command Prompt) and type bootrec /fixboot and bootrec /fixmbr. If these commands don’t work, try bootsect /nt60 c:.\n\nOnce it is booting to Windows again, re-run the InstallGrub4dos.cmd batch file again.\n\nP.S. Don’t forget to re-make your backups so that the new boot code, etc. is backed up\n\nTWEAKING THE SYSTEM\n\nThe text file menu.lst controls the menu appearance and the backup/restore optons:\n\n1. If you want to change the background image, use an 800×600 24-bit or 32-bit colour bitmap and change the name in the menu.lst file (see ‘How it Works’ below).\n\n2. If you don’t see a nice bitmap background on the boot menu, it is probably because your system does not support 800x600x32 graphics mode. Please refer to the grub4dos tutorial for information about high-resolution background images and how to make it work for your system.\n\nUse the UnHide.cmd batch file to unhide all the files on the D: volume so that you can easily alter them.\n\nTypically you will need to run vbeprobe inside the grub4dos console shell (press c in the boot menu) to see what graphics modes you have available, then find a suitable bitmap of matching resolution (e.g. 1024x768x24 colours) and then edit the menu.lst file to change to the correct graphics mode and display the correct bitmap. e.g. graphicsmode -1 1024. You will also need to replace the graphics image file – e.g. splashimage /clonezilla/mynew1024x800.bmp\n\n# look for 800x600 modes cat --locate=\", 800x600x16\" (md)0x220+5 > nul && set GM=800_16 && echo 800x600x16 supported cat --locate=\", 800x600x32\" (md)0x220+5 > nul && set GM=800_32 && echo 800x600x32 supported cat --locate=\", 800x600x24\" (md)0x220+5 > nul && set GM=800_32 && echo 800x600x32 supported # wait 1 second so the user can see the modes supported by the BIOS pause --wait=1 # now change to the highest resolution supported and load the matching bitmap if \"%GM%\"==\"800_32\" graphicsmode -1 800 100:1000 24:32 && splashimage /clonezilla/aurora24.bmp.gz if \"%GM%\"==\"800_16\" graphicsmode -1 800 100:1000 16 && splashimage /clonezilla/aurora256.bmp.gz graphicsmode -1 1024 splashimage /clonezilla/mynew1024x800.bmp\n\n3. The current menu will not prompt the user to select a keymap, this can be added if you delete the text ocs_live_keymap=”NONE” from the kernel parameter list in the menu entries.\n\n4. You can delete the ‘Auto-Backup’ and ‘Auto-Restore’ menus (starting at title) or you can delete the ‘Restore Backup’ and ‘Create Backup’ options or the manual menu, as you wish. Simply edit the menu.lst file using Notepad.\n\n5. To not prompt the user before an auto-backup or auto-restore is actually performed (i.e. fully automated backup/restore), remove the -c option from the middle of the RUN1 parameters in the menu.lst file.\n\n6. The latest version has the hotkey grub4dos utility added. This allows the user to press a function key to execute a menu item. You can change the function key number by editing the menu. See Tutorial 57 for more details.\n\n7. If you want to protect a menu with a password to prevent unauthorised use, add a single new line immediately below the each title line to set a password like this:\n\ntitle xxxxxxx\n\npassword fred\n\nHOW IT WORKS\n\nOnce grub4dos is installed the boot sequence is as follows:\n\nBIOS boots from first sector of Hard Disk 0 -> grub4dos code runs and looks for a grldr file on any partition on hd0 -> grldr loads and looks for a menu.lst on the same partition that grldr was found -> menu is displayed to the user.\n\nThe menu.lst file is shown below with extra comments preceded by a # sign (note: some long lines may be wrapped over onto the next line!):\n\n# next line loads the hotkey utility so the menu will respond to hotkeys\n\n/clonezilla/hotkey\n\n# allow vbeprobe command to output text\n\ndebug 1\n\n# list all available BIOS modes\n\nvbeprobe > (md)0x220+5\n\n# turn off text output from future commands\n\ndebug 0\n\n# clear the display to keep it clean!\n\nclear\n\n# look for 800×600 modes\n\n#This text tries to detect what graphics mode are available and sets a GM variable\n\ncat –locate=”, 800x600x16″ (md)0x220+5 > nul && set GM=800_16 && echo 800x600x16 supported\n\ncat –locate=”, 800x600x32″ (md)0x220+5 > nul && set GM=800_32 && echo 800x600x32 supported\n\n# wait 1 second so the user can see the modes supported by the BIOS\n\npause –wait=1\n\n# now change to the highest resolution supported and load the matching bitmap\n\n#This sets the graphics mode and then loads the correct bitmap\n\nif “%GM%”==”800_32” graphicsmode -1 800 100:1000 24:32 && splashimage /clonezilla/aurora24.bmp.gz\n\nif “%GM%”==”800_16” graphicsmode -1 800 100:1000 16 && splashimage /clonezilla/aurora256.bmp.gz\n\n#This text finds the Windows partition and the Backup partition\n\n# find source volume for Windows and our backup volume – use hda instead of sda if IDE HDD\n\nif exist (hd0,0)/windows/explorer.exe set WDRV=sda1\n\nif exist (hd0,1)/windows/explorer.exe set WDRV=sda2\n\nif exist (hd0,2)/windows/explorer.exe set WDRV=sda3\n\nif exist (hd0,3)/windows/explorer.exe set WDRV=sda4\n\nif exist (hd0,0)/clonezilla/live/vmlinuz set BAKDRV=sda1\n\nif exist (hd0,1)/clonezilla/live/vmlinuz set BAKDRV=sda2\n\nif exist (hd0,2)/clonezilla/live/vmlinuz set BAKDRV=sda3\n\nif exist (hd0,3)/clonezilla/live/vmlinuz set BAKDRV=sda4\n\nif exist (hd0,4)/clonezilla/live/vmlinuz set BAKDRV=sda5\n\nif exist (hd0,5)/clonezilla/live/vmlinuz set BAKDRV=sda6\n\nif exist (hd0,6)/clonezilla/live/vmlinuz set BAKDRV=sda7\n\nif exist (hd1,0)/clonezilla/live/vmlinuz set BAKDRV=sdb1\n\nif exist (hd1,1)/clonezilla/live/vmlinuz set BAKDRV=sdb2\n\nif exist (hd1,2)/clonezilla/live/vmlinuz set BAKDRV=sdb3\n\nif exist (hd1,3)/clonezilla/live/vmlinuz set BAKDRV=sdb4\n\nif exist (hd1,4)/clonezilla/live/vmlinuz set BAKDRV=sdb5\n\nif exist (hd1,5)/clonezilla/live/vmlinuz set BAKDRV=sdb6\n\nif exist (hd1,6)/clonezilla/live/vmlinuz set BAKDRV=sdb7\n\nif exist (hd2,0)/clonezilla/live/vmlinuz set BAKDRV=sdc1\n\nif exist (hd2,1)/clonezilla/live/vmlinuz set BAKDRV=sdc2\n\nif exist (hd2,2)/clonezilla/live/vmlinuz set BAKDRV=sdc3\n\nif exist (hd2,3)/clonezilla/live/vmlinuz set BAKDRV=sdc4\n\nif exist (hd2,4)/clonezilla/live/vmlinuz set BAKDRV=sdc5\n\nif exist (hd2,5)/clonezilla/live/vmlinuz set BAKDRV=sdc6\n\nif exist (hd2,6)/clonezilla/live/vmlinuz set BAKDRV=sdc7\n\nif exist (hd3,0)/clonezilla/live/vmlinuz set BAKDRV=sdd1\n\nif exist (hd3,1)/clonezilla/live/vmlinuz set BAKDRV=sdd2\n\nif exist (hd3,2)/clonezilla/live/vmlinuz set BAKDRV=sdd3\n\nif exist (hd3,3)/clonezilla/live/vmlinuz set BAKDRV=sdd4\n\nif exist (hd3,4)/clonezilla/live/vmlinuz set BAKDRV=sdd5\n\nif exist (hd3,5)/clonezilla/live/vmlinuz set BAKDRV=sdd6\n\nif exist (hd3,6)/clonezilla/live/vmlinuz set BAKDRV=sdd7\n\n#The timeout 10 statement determines the number of seconds before the default menu option (default 0) is automatically launched.\n\ntimeout 10\n\ndefault 0\n\n# set menu colors – white normal menu text, purple highlighted, green heading, white console text, black menu border\n\ncolor normal=31 highlight=0x75 helptext=0x1D heading=0x0A standard=0x0F border=0x00\n\nwrite (md)0x220+1 !BAT\\necho -n -P:0000 $[0133] — CLONEZILLA BACKUP\\\\RESTORE MENU — \\necho -n -P:2300 www.rmprepusb.com\\0\n\ninitscript (md)0x220+1\n\n# autonumber menu entries\n\nwrite –bytes=2 0x8274 0x2001\n\ntitle Windows\\nBoot to Windows\n\nfind –set-root –devices=h /bootmgr && chainloader /bootmgr\n\nfind –set-root –devices=h /ntldr && chainloader /ntldr\n\nboot\n\n# To set a Function hotkey use ^ and then the key you would like to use – e.g. ^Ctrl+F1, or use [R] to get a keypress of R to work\n\n# See Tutorial 57 on www.rmprepusb for more details\n\ntitle ^F6 F6 Restore Backup Image to %WDRV% (from images in %BAKDRV% \\\\images folder)\\nOverwrites your current Windows installation and all files\n\nfind –set-root /clonezilla/live/vmlinuz\n\nset BOPT=boot=live quiet live-config noswap nolocales edd=on nomodeset ip=frommedia ocs_live_keymap=”NONE”\n\nset RUN=ocs_live_run=”ocs-live-general” keyboard-layouts=”NONE” locales=”en_US.UTF-8″ live-media-path=/clonezilla/live bootfrom=/dev/%BAKDRV% toram=filesystem.squashfs ocs_live_batch=”yes”\n\nset PRERUN=ocs_prerun=”mount /dev/%BAKDRV% /mnt” ocs_prerun1=”mount –bind /mnt/clonezilla/images /home/partimag/”\n\nset RUN1=ocs_live_run=”ocs-sr –batch -g auto -e1 auto -e2 -j2 -k -p reboot restoreparts ask_user %WDRV%”\n\n#echo kernel /clonezilla/live/vmlinuz %BOPT% %RUN% %PRERUN% %RUN1%\n\n#pause\n\nkernel /clonezilla/live/vmlinuz %BOPT% %RUN% %PRERUN% %RUN1%\n\ninitrd /clonezilla/live/initrd.img\n\ntitle Create Backup Image of %WDRV% (in %BAKDRV% \\\\images folder)\\nMakes an image backup of your current Windows installation\n\nfind –set-root /clonezilla/live/vmlinuz\n\nset BOPT=boot=live quiet live-config noswap nolocales edd=on nomodeset ip=frommedia ocs_live_keymap=”NONE”\n\nset RUN=ocs_live_run=”ocs-live-general” keyboard-layouts=”NONE” locales=”en_US.UTF-8″ live-media-path=/clonezilla/live bootfrom=/dev/%BAKDRV% toram=filesystem.squashfs ocs_live_batch=”yes”\n\nset PRERUN=ocs_prerun=”mount /dev/%BAKDRV% /mnt” ocs_prerun1=”mount –bind /mnt/clonezilla/images /home/partimag/”\n\nset RUN1=ocs_live_run=”ocs-sr -q2 –batch -j2 -z1 -i 2000 -sc -rm-win-swap-hib -p reboot saveparts ask_user %WDRV%”\n\n#echo kernel /clonezilla/live/vmlinuz %BOPT% %RUN% %PRERUN% %RUN1%\n\n#pause\n\nkernel /clonezilla/live/vmlinuz %BOPT% %RUN% %PRERUN% %RUN1%\n\ninitrd /clonezilla/live/initrd.img\n\n# Alternative Menu for a single automated backup/restore – remove -c if you want a fully automated operation\n\ntitle ^F4 F4 Auto-Restore Windows\\nRestore Windows from IMG\n\nfind –set-root /clonezilla/live/vmlinuz\n\nset BOPT=boot=live quiet live-config noswap nolocales edd=on nomodeset ip=frommedia ocs_live_keymap=”NONE”\n\nset RUN=ocs_live_run=”ocs-live-general” keyboard-layouts=”NONE” ocs_lang=”en_US.UTF-8″ live-media-path=/clonezilla/live bootfrom=/dev/%BAKDRV% toram=filesystem.squashfs ocs_live_batch=”yes”\n\nset PRERUN=ocs_prerun=”mount /dev/%BAKDRV% /mnt” ocs_prerun1=”mount –bind /mnt/clonezilla/images /home/partimag/”\n\nset RUN1=ocs_live_run=”ocs-sr -c –batch -e1 auto -e2 -j2 -k -p reboot restoreparts IMG %WDRV%”\n\n#echo kernel /clonezilla/live/vmlinuz %BOPT% %RUN% %PRERUN% %RUN1%\n\n#pause\n\nkernel /clonezilla/live/vmlinuz %BOPT% %RUN% %PRERUN% %RUN1%\n\ninitrd /clonezilla/live/initrd.img\n\ntitle Auto-Backup Windows\\nBackup Windows to IMG\n\nfind –set-root /clonezilla/live/vmlinuz\n\nset BOPT=boot=live quiet live-config noswap nolocales edd=on nomodeset ip=frommedia ocs_live_keymap=”NONE”\n\nset RUN=ocs_live_run=”ocs-live-general” keyboard-layouts=”NONE” ocs_lang=”en_US.UTF-8″ live-media-path=/clonezilla/live bootfrom=/dev/%BAKDRV% toram=filesystem.squashfs ocs_live_batch=”yes”\n\nset PRERUN=ocs_prerun=”mount /dev/%BAKDRV% /mnt” ocs_prerun1=”mount –bind /mnt/clonezilla/images /home/partimag/”\n\nset RUN1=ocs_live_run=”ocs-sr -q2 -sc -rm-win-swap-hib -c –batch -j2 -z1 -i 2000 -p reboot saveparts IMG %WDRV%”\n\n#echo kernel /clonezilla/live/vmlinuz %BOPT% %RUN% %PRERUN% %RUN1%\n\n#pause\n\nkernel /clonezilla/live/vmlinuz %BOPT% %RUN% %PRERUN% %RUN1%\n\ninitrd /clonezilla/live/initrd.img\n\ntitle Clonezilla (manual)\\nRun backup/restore program manually (experts only)\n\nfind –set-root /clonezilla/live/vmlinuz\n\nkernel /clonezilla/live/vmlinuz boot=live live-config noswap nolocales edd=on nomodeset ocs_live_run=”ocs-live-general” ocs_live_extra_param=”” keyboard-layouts=”” locales=”” ip=frommedia nosplash live-media-path=/clonezilla/live bootfrom=/dev/%BAKDRV% toram=filesystem.squashfs ocs_live_batch=”no”\n\ninitrd /clonezilla/live/initrd.img\n\n# Preseed codes (ocs = Opensource Clone System)\n\n# video=uvesafb:mode_option=1024×768-32\n\n# vga=788 – use video mode 788 (800-600) or 791=1024×768, 785=640×480, vga=normal (no frame buffer)\n\n# nosplash – does not show splash screen\n\n# quiet – reduce amount of boot messages\n\n# keyboard-layouts=”uk” – set linux keyboard layout to uk\n\n# noprompt – does not ask to eject CD\n\n#\n\n# ocs_live_keymap=”NONE” – suppresses the keyboard user selection menu in clonezilla\n\n# ocs_live_keymap=”/usr/share/keymaps/i386/azerty/fr-latin9.kmap.gz” (French keyboard)\n\n# ocs_lang=”en_US.UTF-8″ – sets language for clonezilla\n\n# choices are de_DE.UTF-8, en_US.UTF-8, es_ES.UTF-8, fr_FR.UTF-8, it_IT.UTF-8, ja_JP.UTF-8, pt_BR.UTF-8, ru_RU.UTF-8, zh_CN.UTF-8, zh_TW.UTF-8\n\n#\n\n# ocs_live_run ocs-sr parameters:\n\n# –batch – automate run\n\n# -c check – asks user before completing action – Are you sure you want to continue ? (y/n)\n\n# -e1 auto – Automatically adjust filesystem geometry for a NTFS boot partition if exists\n\n# -t – Client does not restore the MBR (Master Boot Record)\n\n# -g auto – Reinstall grub in client disk MBR (only if grub config exists)\n\n# -e1 auto – Automatically adjust filesystem geometry for a NTFS boot partition if exists\n\n# -e2 – sfdisk uses CHS of hard drive from EDD (for non-grub boot loader)\n\n# -u – Asks the user for the image name (could be set in config too).\n\n# restoredisk or savedisk – Which mode to run, store, restore, partition or hard-drive\n\n# ask_user – requests name from user.\n\n# sdax – Which hard-drive should be written or read.\n\n# -q2 – Use “partclone”.\n\n# -z1p – Use gzip-compression (with multicore)\n\n# -i 2048 – Split filesize in megabyte (Split every 2GB a new file for the backup – use if FAT32 backup ptn.)\n\n# -p poweroff – power off after successfully running the script.\n\n# -rm-win-swap-hib Removes the page and hibernation files in Win if exists\n\n# -sc – suppress verify check after backup\n\nSETTING A PRE-BOOT SILENT SPLASH SCREEN\n\nIf you want the user to see a splash screen but no menu at all, the user will then have no idea that the backup/restore menu exists. After 10 seconds the splash screen will disappear and the system will boot to Windows as normal. However, if the user hits a function key, the appropriate menu will be activated. This can be accomplished by adding the 8 lines of text below to the top of the menu.lst file:\n\nfind –set-root /clonezilla/menusetting.gz\n\n# display the heading and cover up grub4dos version text\n\nwrite (md)0x220+1 !BAT\\necho -n -P:0000 $[0133] \\0\n\ninitscript (md)0x220+1\n\n#set black text on black background so user will not see countdown timer or menu text\n\ncolor black/black\n\n# The command parameters 0 0 0 0 0 0 0 0 sets a 0 size border (i.e. no border around menu)\n\n/clonezilla/menusetting.gz 0 0 0 0 0 0 0 0\n\nTo remove the various grub4dos start-up boot messages that appear before grub4dos loads the menu, download the grub4dos patch file PatchMe. Copy it to the D:\\clonezilla folder. Boot to the grub4dos menu and press c to get to the command console. Then type:\n\nfind –set-root /grldr\n\n/clonezilla/patchme\n\nThis will patch the boot code and grldr file. Once patched, the PatchMe file is no longer required and can be deleted if you wish.\n\nThe user will just see the wallpaper image with no text or highlight line at all – if he presses F4 or F6 then the menu entry chosen will be executed immediately.\n\nTo shorten the timeout – just change the text ‘timeout 10’ to ‘timeout 1’ for a 1 seconds timeout.\n\nADDING AUDIO/VIDEO AIDS FOR THE PARTIALLY SIGHTED\n\nIf you need a beep to know when to press the function key, you can add the following line of code to the top of the menu.lst file:\n\ncolor standard 0xF1 && clear && call Fn.2 7 && call Fn.2 7 && call Fn.2 7 && color standard 0xf && clear\n\nThis sets blue text on a white background – clears the screen so it is all white – beeps 3 times using Fn.2 7 (if your hardware supports it) – sets white text on a black background – then clears the screen so it is all black. Once the beeps have finished you can press a function key within the specified timeout period.\n\nIf in graphics mode, you will need to use the bios grub4dos utility to beep the speaker once – e.g.\n\ncall /bios int=0x10 eax=0xe07 > nul\n\nREMOVING THE GRUB4DOS BOOTLOADER\n\nIf you want to return to a normal booting system and remove the grub4dos bootloader and menu system, run RMPrepUSB hit Ctrl+F5, select the HDD and then hit Ctrl+B.\n\nThis changes the Settings to ALL DRIVES mode, so that the hard disk will appear in the drive list and then installs a standard bootloader using the Bootloaders – Install STD Mbr option.\n\nYou can then delete the menu.lst files and the backups and files on drive D: if you wish.\n\nADD A MEMORY TEST OPTION\n\nDownload PassMark memtest86 Free Edition ISO file and copy the \\ISOLINUX\\MEMTEST file to the clonezilla folder.\n\nAdd the following menu entry to your menu.lst file\n\ntitle ^M Passmark Memtest86 [M] \\n Test Memory\\n http://www.memtest86.com/\n\nfind --set-root /clonezilla/MEMTEST\n\nkernel /clonezilla/MEMTEST\n\nboot\n\nPressing the hotkey M will run the memory test.\n\nAUTOMATIC REMOTE BACKUP\\RESTORE\n\nIf you install TeamViewer onto the target system, you can set it up to allow remote control by logging in using the Windows Username and Password (even at the Windows login screen).\n\nThis allows you to connect to the Windows system as long as it is switched on and has booted to the Windows login screen (a Windows password must be set for TeamViewer to work).\n\nIn this scheme, the backup image called ‘IMG’ is either made\\overwritten or restored.\n\nWe can modify the menu.lst so that it will allow us to make an unattended backup or unattended restore:\n\nBackup\n\n1. Use TeamViewer to remotely log in and get to the Windows Desktop\n\n2. Run D:\\clonezilla\\_StartRemoteBackup.cmd as Administrator\n\n3. Reboot the system – C: will be backed up to IMG and then the system will reboot back to Windows\n\nRestore\n\n1. Use TeamViewer to remotely log in and get to the Windows Desktop\n\n2. Run D:\\clonezilla\\_StartRemoteRestore.cmd as Administrator\n\n3. Reboot the system – the IMG backup will be used to restore C: and then the system will reboot back to Windows\n\nNotes:\n\nThe menu.lst assumes that Windows C: is at (hd0,1) (the second primary partition)\n\nThe menu.lst has been modified so that the manual backup and restore menu entries have been commented out with # (i.e. #title xxxx)\n\nYou must use a recent 2017 version of grub4dos (grldr) which can write to small NTFS files (included in the download)\n\nThere is no user interaction. Once a reboot has started, a backup or restore is unattended and the system will then reboot back to Windows\n\nOnly the Windows (C:) partition is backed up or restored. Do not attempt to backup\\restore the clonezilla partition.\n\nYou can create an extra partition (e.g. for data/files, etc.) and add this to the backup\\restore parameters if you wish.\n\nThe backup\\restore menu entry items still require user interaction, remove the -c parameter if you don’t want them to prompt the operator.\n\nCloneZillaBackupAutoUSER.zip allows for two backups, IMG for a ‘factory’ backup and IMGUSER for a ‘User’ backup. Both can be triggered remotely. Also, the Windows partition can be on any of several different partitions.\n\nDownload and use CloneZillaBackupAuto.zip to obtain these files and functions."
    }
}