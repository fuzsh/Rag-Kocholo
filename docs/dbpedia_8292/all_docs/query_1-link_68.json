{
    "id": "dbpedia_8292_1",
    "rank": 68,
    "data": {
        "url": "https://superuser.com/questions/332808/force-cloned-hard-disk-image-upon-a-smaller-hard-disk",
        "read_more_link": "",
        "language": "en",
        "title": "Force cloned hard-disk image upon a smaller hard-disk",
        "top_image": "https://cdn.sstatic.net/Sites/superuser/Img/apple-touch-icon@2.png?v=e869e4459439",
        "meta_img": "https://cdn.sstatic.net/Sites/superuser/Img/apple-touch-icon@2.png?v=e869e4459439",
        "images": [
            "https://cdn.sstatic.net/Sites/superuser/Img/logo.svg?v=4bc8a703ebac",
            "https://www.gravatar.com/avatar/5d326564acee958563c90144aa3bee5e?s=64&d=identicon&r=PG",
            "https://www.gravatar.com/avatar/35ab0b187735b8d4969a647dd96083f8?s=64&d=identicon&r=PG",
            "https://www.gravatar.com/avatar/19dceeaf16c1836d83997a6d10ad6e9d?s=64&d=identicon&r=PG",
            "https://www.gravatar.com/avatar/03f74eea6534066655f0cbf6e8b87a5d?s=64&d=identicon&r=PG",
            "https://www.gravatar.com/avatar/922dcdfb9c9b7e8a37edb17df0f844de?s=64&d=identicon&r=PG",
            "https://www.gravatar.com/avatar/fba22217f82d79421c884fcfdb525c4c?s=64&d=identicon&r=PG",
            "https://www.gravatar.com/avatar/a007be5a61f6aa8f3e85ae2fc18dd66e?s=64&d=identicon&r=PG",
            "https://i.sstatic.net/Mu8ap.gif?s=64",
            "https://i.sstatic.net/Z8orf.jpg?s=64",
            "https://www.gravatar.com/avatar/2dbb6e0081dd4b0e008ccdd0e49ee2c4?s=64&d=identicon&r=PG&f=y&so-version=2",
            "https://superuser.com/posts/332808/ivc/0c39?prg=1d5239e6-ecc0-481f-a224-0b7ea8548a32"
        ],
        "movies": [],
        "keywords": [],
        "meta_keywords": [
            ""
        ],
        "tags": null,
        "authors": [],
        "publish_date": "2011-09-07T09:18:38",
        "summary": "",
        "meta_description": "I have a image which was taken with Clonezilla as SAVEDISK on a 160GB harddrive.\nNow a newer version of the PC released with a 120GB harddrive, the space in use is just 20GB\n\nIs there a way I can f...",
        "meta_lang": "en",
        "meta_favicon": "https://cdn.sstatic.net/Sites/superuser/Img/favicon.ico?v=4852d6fb3f5d",
        "meta_site_name": "Super User",
        "canonical_link": "https://superuser.com/questions/332808/force-cloned-hard-disk-image-upon-a-smaller-hard-disk",
        "text": "Clonezilla relies on Partclone to save and restore filesystems. Although it's useful, even if you use the -icds option, that alone isn't enough. When restoring the original filesystem on the smaller disk, Partclone will encounter a seek error trying to write beyond the disk boundary. So this is a limitation of not only Clonezilla, but the underlying tools it uses.\n\nWhat you can do however, is to restore the image temporarily on a 160GB disk, use a filesystem resize tool such as ntfsresize (for NTFS) or resize2fs (for ext3/4) to shrink the filesystem, say to 25GB. Resizing the partition table, which GParted does, isn't necessary. Use Clonezilla again to create a new image using the \"savedisk\" option.\n\nWhen restoring the image on the smaller disk, use the -icds option to skip Clonezilla checking if the disk is the same or larger than the original disk. Since you shrunk the filesystem, Partclone won't encounter a seek error and your data will be restored on your smaller disk.\n\nIf you used the option to restore the partition table proportionally (-k1), Clonezilla will create a proper partition table and resize (expand) the original filesystem so that all the free space on the new disk becomes available.\n\nEDIT: The -icds option isn't passed to ocs-expand-mbr-pt, so this step currently fails. A bug report has been filed about this with the project. The bug has been fixed.\n\nI solved it with a Windows 10 image as follows\n\nTemporarly move some files if your source drive is nearly full.\n\nA drefragmented drive leaves more space for shrinking, so defrag c:\\ through right clicking on the drive -> tools\n\nshrink c:\\ through windows disk management as small as possible\n\nstart Clonezilla, expert, device-device, local, select -icds and finally the -k1 option\n\nswitch off and disconnect old drive\n\nrestart with the new drive and hold shift on windows login, select restart -> troubleshooting -> startup repair\n\nIn the past the 4th step failed, but since 2015 clonezilla supports GPT with the -k1 option so I think this is the reason why this works, now:\n\nhttp://clonezilla.org/downloads/stable/changelog.php\n\nClonezilla live 2.4.2-38 ... Proportition GPT partition layout could be created by the option -k1.\n\nThe 6th step is needed because Windows does not recognize the boot drive in the optimization tool (SSD trim) and will try to repair the drive randomly so something seems to be wrong in the boot sector/partition table but startup repair will fix it.\n\nEDIT: I uploaded a video of the the complete process (German):\n\nhttps://www.youtube.com/watch?v=GJ2LVY5ja-o\n\nMy situation:\n\nClonezilla image (of Windows 7) based on 128GB drive (100MB system partition + 117GB \"C\"),\n\nnew 120GB drive.\n\nFollowing suggestions (like https://superuser.com/a/592283/229908) did not solve the problem for me.\n\nWhat worked for me was:\n\nrestore the image to another (larger) drive,\n\ndefragment that drive (because it seems Clonezilla restores the data as was structured on the original drive, so possibly there won't be enough free space to shrink the partition to target size),\n\nshrink the partition (in my case, the 117GB \"C\") to the size of the target drive/partition (in my case 111GB) or, more safely, to a smaller size,\n\ninstall Windows 7 on the target drive (and have it create its system partition by using advanced options),\n\nuse Clonezilla to restore each partition (with restorepart command) from the resized drive to the corresponding partition on the target drive.\n\nThe main trick why this worked was creating partition table (in my case done automatically by installing the Windows) that corresponds to the target drive, then just copying contents (via restorepart) which wouldn't touch the partitions configuration. So, even if the source partition that is being restored was smaller than the target, as partition table is not touched by restorepart, there is no need to \"extend\" the target partition after the operation.\n\nIn my case -icds alone has not solved the problem. I don't know if the problem is exactly the same as mine. But I left here my cent.\n\nI have tried a disc to disc clone from a 930GiB HDD (source drive) with a GPT partition table to 890GiB SSD (destination). Please note I am a Linux user and I have a dual boot with windows 10. I have tried to left unchanged all the partitions and to reduce slightly the size of my data partition only.\n\nWith gparted, I resized the bigger data partition in order to have an overall size that fits the destination SSD, and moved all free space at the end\n\nI used clonezilla-Live from USB pen, with advanced mode and -icds enabled.\n\nIt failed. It looks like Clonezilla fails, at start, to clone the partition table to the destination disk because it wrongly uses sfdisk utility that is for older partition types instead of sgdisk utils. My solution:\n\nThe same as previous (overall size must fit)\n\nI manually copied the partition from one drive to another, using Clonezilla shell with this command (only for GPT partitions!):\n\nsgdisk /dev/sdSourceDeviceName -R /dev/sdDestinationDeviceName\n\nPerformed Clonezilla disc-to-disc clone, selecting the option -icds and the option to NOT CREATE a partition table on destination disk, option -k. (In this case Clonezilla uses the destination partitions as they are, and resizes partitions when sizes are smaller, in order to fit, it perform a good \"best effort\").\n\nIt worked. I obtained all the partitions the same size as source (Yes I only reduced the bigger partition a bit). Dual boot with windows keeps working well. Regards\n\nthis one helped me:\n\nexpert mode => disc to disc => etc. => enable -iscd => then: use the partition table from the source disk\n\ncreate the partition table proportinally (-k1) worked for me on three UEFI GPT computer 1 tb hdd's to ssd's clones. i think clonezilla ignored -k1 there.\n\non one very old computer with MBR, 512 gb hdd, max 4 gb ram, 64-bit but more junk than useable pc newest windows 10 (20H1) i had to choose -k and not -k1 although i shrunked the hdd partitions to hell and -k1 never worked.\n\nthe ssd's had 120 gb.\n\ni think it's the same for uefi gpt that i could use -k there too instead of -k1\n\ni use gpt everywhere i can even for drives lower than 2 tb. gpt is future.\n\nclonezilla told me something with calcuated size of is < 0 ! and the ratio target size to original disk size.\n\nnever forget: a shrunken device shrunked with gparted has to get force fsck'd or chkdsk'd by windows 10\n\nenter image description here\n\nhttps://www.isunshare.com/images/article/windows-10/solved-usb-drive-keeps-disconnecting-and-reconnecting-on-windows-10/click-scan-and-repair-drive.png\n\nclick on scan and repair drive (must be FORCED) and then something like restart now. wait until chkdsk became 100 % needs 2 restarts then until windows 10 is usable again, go back to clonezilla."
    }
}