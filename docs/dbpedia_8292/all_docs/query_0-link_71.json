{
    "id": "dbpedia_8292_0",
    "rank": 71,
    "data": {
        "url": "https://discussion.fedoraproject.org/t/using-dd-to-clone-fedora-34-to-new-disk-with-nvme/78774",
        "read_more_link": "",
        "language": "en",
        "title": "Using DD to clone Fedora 34 to new disk with NVME",
        "top_image": "https://redhat.discourse-cdn.com/fedoraproject/original/2X/4/4701afb8ed62770e56cfd748606abe1c0d616b84.png",
        "meta_img": "https://redhat.discourse-cdn.com/fedoraproject/original/2X/4/4701afb8ed62770e56cfd748606abe1c0d616b84.png",
        "images": [
            "https://sea1.discourse-cdn.com/fedoraproject/user_avatar/discussion.fedoraproject.org/happy/48/18310_2.png",
            "https://sea1.discourse-cdn.com/fedoraproject/user_avatar/discussion.fedoraproject.org/happy/48/18310_2.png",
            "https://sea1.discourse-cdn.com/fedoraproject/user_avatar/discussion.fedoraproject.org/happy/48/18310_2.png",
            "https://redhat.discourse-cdn.com/fedoraproject/original/3X/1/a/1a67d133f8421c9115098993c009847564391550.gif",
            "https://sea1.discourse-cdn.com/fedoraproject/user_avatar/discussion.fedoraproject.org/happy/48/18310_2.png",
            "https://sea1.discourse-cdn.com/fedoraproject/user_avatar/discussion.fedoraproject.org/happy/48/18310_2.png",
            "https://redhat.discourse-cdn.com/fedoraproject/optimized/3X/9/2/9294c09a6f214f069fe6f974d2d474b193e327be_2_690x367.png",
            "https://sea1.discourse-cdn.com/fedoraproject/user_avatar/discussion.fedoraproject.org/happy/48/18310_2.png",
            "https://redhat.discourse-cdn.com/fedoraproject/optimized/3X/f/2/f2f2f5789f85464f23725e94e9d38c2082b1c974_2_690x279.png",
            "https://sea1.discourse-cdn.com/fedoraproject/user_avatar/discussion.fedoraproject.org/happy/48/18310_2.png",
            "https://sea1.discourse-cdn.com/fedoraproject/user_avatar/discussion.fedoraproject.org/ozeszty/48/2100_2.png",
            "https://sea1.discourse-cdn.com/fedoraproject/user_avatar/discussion.fedoraproject.org/ozeszty/48/2100_2.png",
            "https://sea1.discourse-cdn.com/fedoraproject/user_avatar/discussion.fedoraproject.org/ozeszty/48/2100_2.png",
            "https://sea1.discourse-cdn.com/fedoraproject/user_avatar/discussion.fedoraproject.org/happy/48/18310_2.png"
        ],
        "movies": [],
        "keywords": [],
        "meta_keywords": [
            "f34"
        ],
        "tags": null,
        "authors": [
            "happy (Happy M)",
            "computersavvy (Jeff V)",
            "ozeszty (ozeszty)",
            "vekruse (Villy Kruse)"
        ],
        "publish_date": "2023-01-10T11:41:59+00:00",
        "summary": "",
        "meta_description": "I’m attempting to clone my current 500gb disk to a 2TB disk. The disk has a dual boot windows/fedora 34 setup. The new 2TB disk is connected via a USB caddy. Both disk are SSD M.2. NVMe. \nOn my first attempt, I used clonezilla to clone the disk. This worked to some extent… the grub menu loads, I can&hellip;",
        "meta_lang": "en",
        "meta_favicon": "https://redhat.discourse-cdn.com/fedoraproject/optimized/2X/4/4a936c14d6cd5d29d6b7baf2511e406eeabed12c_2_32x32.png",
        "meta_site_name": "Fedora Discussion",
        "canonical_link": "https://discussion.fedoraproject.org/t/using-dd-to-clone-fedora-34-to-new-disk-with-nvme/78774",
        "text": "I’m attempting to clone my current 500gb disk to a 2TB disk. The disk has a dual boot windows/fedora 34 setup. The new 2TB disk is connected via a USB caddy. Both disk are SSD M.2. NVMe.\n\nOn my first attempt, I used clonezilla to clone the disk. This worked to some extent… the grub menu loads, I can select Windows or Fedora… Windows boots fine… Fedora gets to the loading graphic and then hangs, terminal shows it hangs on “basic system”. After doing some research I can see the locations (/dev/mapper/fedora-root, etc) do not exist on the cloned disk. I read I can update the /etc/fstab to the correct UUID, but there is no /etc/fstab on the new system. Also read I can run dracut -f but rebuild but I’d need a new live disk for that, the shell I’m in says command not found.\n\nSo with the above in mind, I’ve decided to try to clone the disk again but this time use DD. In the tutorial here it says I need to use lsblk to get the disk name (/dev/sdb or whatever) for the dd command… but the lsblk command doesn’t show me the disks, it shows me the nvme volumes, and I’m not sure how to proceed.\n\n#lsblk: (on my old disk, booted into fedora normally)\n\nnvme0n1 259:0 0 476.9G 0 disk\n\n├─nvme0n1p1 259:1 0 500M 0 part /boot/efi\n\n├─nvme0n1p2 259:2 0 128M 0 part\n\n├─nvme0n1p3 259:3 0 317.9G 0 part\n\n├─nvme0n1p4 259:4 0 609M 0 part\n\n├─nvme0n1p5 259:5 0 1G 0 part /boot\n\n├─nvme0n1p6 259:6 0 145.5G 0 part\n\n│ ├─fedora-root 253:0 0 55G 0 lvm /\n\n│ ├─fedora-swap 253:1 0 7.8G 0 lvm [SWAP]\n\n│ └─fedora-home 253:2 0 82.6G 0 lvm /home\n\n├─nvme0n1p7 259:7 0 9.8G 0 part\n\n└─nvme0n1p8 259:8 0 1.1G 0 part\n\nAny advice on either using dd, or any other method, is greatly appreciated.\n\nI always use gparted for cloning partitions and resizing them and changing UUIDs, etc.\n\nBut I don’t think using clonezilla is likely to be the source of your problem. Maybe you did something else that you didn’t mention, such as change the UUIDs of the destination. Or maybe there was something very strange in your original etc/fstab or your grub.cfg.\n\nI assume you mean when you reach the terminal in the incorrectly booted system, you don’t have the root partition mounted, so you don’t have access to /etc/fstab\n\nWorking from the old system, I assume you can examine/fix the copy. You can use gparted (or other tools if you choose) to change the UUIDs (if you hadn’t already). Once those are changed, you can mount the new partitions while booted in the old. Then you can examine the files that need UUIDs fixed: EFI/fedora/grub.cfg , grub2/grub.cfg and etc/fstab. Those will be in three different partitions on the new drive (the third in the / subpartition of the lvm)\n\nThanks everyone.\n\n@john2fx, I’ve not ran the dd command yet, so if I can rescue the clone I have then perfect, especially seeing as you are suggesting dd may give me the same issue I have had with clonezilla. I really didn’t do anything other than clone disk to disk in clonezilla… the target being the ssd in a usb caddy. And yes I still have the source up and running.\n\nYou, and several other posts I’ve read, mention updating the UUID, but I can’t find a guide on doing that.\n\nRegarding my fstab missing… yes I’m referring to the target disk… when I put the disk in my machine and boot to it I get to a sh shell that lets me see /etc/ … I have other files such as /etc/fstab.empty (which is empty) and /etc/mtab … just no fstab…\n\nThis is the contents of my fstab on the working source machine:\n\n#\n\n# /etc/fstab\n\n# Created by anaconda on Wed Jun 21 18:02:51 2017\n\n#\n\n# Accessible filesystems, by reference, are maintained under ‘/dev/disk’\n\n# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info\n\n#\n\n/dev/mapper/fedora-root / ext4 defaults 1 1\n\nUUID=828862a9-3cb8-4c04-beac-42f98e99e6a7 /boot ext4 defaults\n\n1 2\n\nUUID=9A2D-13D2 /boot/efi vfat umask=0077,shortname=winnt 0 2\n\n/dev/mapper/fedora-home /home ext4 defaults 1 2\n\n/dev/mapper/fedora-swap swap swap defaults 0 0\n\nHow complex is updating my uuids? Do you know of any easy to follow guides?\n\nThanks\n\nIt is a simple right-click option for any unmounted partition in gparted. There are lots of other ways, but that is the one I know.\n\nFirst, am I correct in understanding that while booted in the old system, you can connect the new drive by USB? It is important that all mounting of partitions on the old drive have happened before you connect the new drive.\n\nBTW, that suddenly gives me a good theory of your basic problem: The old drive was still connected when you tried to boot the new one? That can’t work unless/until the UUIDs are fixed. But you should have been able to disconnect the old drive and use the new one without changed UUIDs, if you wanted to.\n\nAnyway, never mount a partition (or have boot auto mount it) when another partition with a cloned UUID is physically connected. But you can boot and/or mount one without the other connected and then connect (via USB or other hot connection method).\n\nOnce hot connected with UUIDs you expect to conflict, first verify everything is as expected. I like the command:\n\nlsblk -o NAME,FSTYPE,SIZE,LABEL,FSSIZE,FSUSE%,MOUNTPOINTS,UUID\n\nto get a clear picture of what is where.\n\nThen use gparted to fix UUIDs, if needed. Then use the above command again to see the new UUIDs. Then mount the partitions containing the three files I mentioned earlier and fix the UUIds in those three files. Then it should be possible to boot the new system even while the old drive is physically connected.\n\nThe live usb of gparted would only be needed if you didn’t have the USB connection for the new drive (if you needed to connect before booting).\n\ngparted is an ordinary program that can be run in your old system and can modify any unmounted but physically connected partitions. If it isn’t installed (such as if you are using the kde spin of Fedora) then you can use sudo dnf install gparted. It is a nice utility to have. (In the old days of tiny hard drives and/or tiny ram, using the gnome version of utilities in kde wasted space. But it works perfectly and the space it wastes is trivial now.)\n\nBut since you had disconnected the old drive, I’m back to no good theory of what went wrong. If you never wanted to use both drives in the same machine after cloning, then fixing UUIDs should not be necessary.\n\nBut lacking a good theory of what went wrong, you want to take a good look at what you have. That is best done while booted in your old system, and involves changing those UUIDs and mounting the new partitions to examine from the old system. Simply changing the UUIDs (and making the corresponding fix in those three files) can’t fix the problem if the problem was NOT the presence of the old drive. But it is still a step toward understanding.\n\nIf it is somehow too messed up to fix, I think dd is a worse way of retrying.\n\nIn that case, I think you do want gparted in some live form. I’ve never tried the live usb of gparted. I had and was used to using the live kde spin of fedora. You can install programs while that is running. They go away on reboot, of course. But for one time use, I found installing gparted while booted in live fedora gave be an environment I was more used to.\n\nI used the copy/paste of partitions choice in gparted to copy my partitions one at a time to my new drive, then changed their UUIDs and edited those files.\n\nDid you run clonezilla with the source drive running or was the system off and the only thing running the clonezilla.\n\nYou should never try to clone a device that is in use since it will be in constant flux as the system is running. What is recommended when cloning from drive to drive is to boot to a bootable live clonezilla usb and use that to copy one device to the other. Neither device should be mounted or in use in any way.\n\nIt sounds as if something may have interfered with a proper completion of the clone. My suggestion would be to repeat the process from a bootable clonezilla usb and ensure the process has 100% completed before doing anything else.\n\nOnce that is done then the suggestions about the UUID are 100% mandatory if both devices are intended to be in the same machine. If not then the new device probably would have no issues if it were the only drive.\n\nYou can use almost any live media usb to boot and change the UUIDs in the files mentioned, and use gparted to change the UUID on the device from that same live media.\n\nYou can, as already noted, use gparted to copy (clone) one partition at a time from one device and paste it into another device (similar to the way you can copy and paste files). Gparted is also available as a bootable image, or you can boot live fedora media, install gparted, then work on 2 different drives while in the live environment with the source and destination devices unmounted.\n\nAs far as the UUIDs are concerned. the entries in /boot/grub2/grub.cfg, /boot/efi/EFI/fedora/grub.cfg can easily be fixed in a chroot environment while booted to live media, and the /etc/fstab entries that use UUID can be repaired the same way.\n\nOnce the drive has been cloned and you are ready to do the UUID updates to avoid the conflicts I can assist with those steps.\n\nSomething else. You are really moving them.\n\nYou need to start with n1p8 (the one with lots of unallocated space directly after it).\n\nRight click and select Resize/Move then slide it to its new position or change the numbers. If you also want a new size you can do that at the same time.\n\nThen click the Resize/Move button to queue the operation up.\n\nYou might need to apply that operation (have it actually occur) before moving on the physically previous partition.\n\nYou are moving each into (or all the way across) the unallocated space to the right of it. So each must be done before the one to its left.\n\nNo, moving all those other partitions is more copying. But I don’t think that should be a decision factor.\n\nMaybe there is something I’m misunderstanding about bitlocker specifically. But I think having GPT partitioning (rather than old style MBR) eliminates most concerns from having Linux move/resize Windows partitions.\n\nThat is a valid goal and reason to move n1p8 then 7 then 6 …\n\nI’m not entirely sure. I don’t know whether that copy got the original UUID (the copy/paste I’ve done with gparted works that way). The normal way of identifying partitions in Linux is by UUID, so the fact that it is in a different place on the hard drive doesn’t matter and the fact that it is pointed to by a different entry in the GPT probably doesn’t matter to linux.\n\nWindows more likely knows about it by which entry in the GPT points to it. Copying it such that it has the same GPT entry is different (the easiest way would be to delete it first then copy it again from the original partition on the old drive). I’m 90% sure that would reuse the gpt entry from the deleted partition.\n\nIf it does change gpt entry position, I’m not sure whether that affects Windows nor what to fix if it does.\n\nMoving everything from n1p8 down avoids that whole issue."
    }
}