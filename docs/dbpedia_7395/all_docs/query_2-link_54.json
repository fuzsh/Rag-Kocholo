{
    "id": "dbpedia_7395_2",
    "rank": 54,
    "data": {
        "url": "https://www.dropboxforum.com/t5/Dropbox-tips-tricks/How-to-fix-being-stuck-on-Indexing-forever-loop-of-death-on/td-p/575798",
        "read_more_link": "",
        "language": "en",
        "title": "How to fix being stuck on Indexing forever loop of death on multi million file DBs after db crash",
        "top_image": "https://www.dropboxforum.com/t5/image/serverpage/image-id/27494iD7DE4657A8507A86?v=v2",
        "meta_img": "https://www.dropboxforum.com/t5/image/serverpage/image-id/27494iD7DE4657A8507A86?v=v2",
        "images": [
            "https://www.dropboxforum.com/t5/image/serverpage/image-id/14543i4C930D870ADEFFF7/image-dimensions/60x60/constrain-image/false?v=v2",
            "https://www.dropboxforum.com/t5/image/serverpage/image-id/14543i4C930D870ADEFFF7/image-dimensions/60x60/constrain-image/false?v=v2",
            "https://www.dropboxforum.com/t5/image/serverpage/image-id/14543i4C930D870ADEFFF7/image-dimensions/60x60/constrain-image/false?v=v2",
            "https://www.dropboxforum.com/t5/image/serverpage/image-id/27494iD7DE4657A8507A86/image-size/large?v=v2&px=999",
            "https://www.dropboxforum.com/t5/image/serverpage/avatar-name/09/avatar-theme/candy/avatar-collection/Dropbox/avatar-display-size/message/version/2?xdesc=1.0",
            "https://www.dropboxforum.com/t5/image/serverpage/avatar-name/04/avatar-theme/candy/avatar-collection/Dropbox/avatar-display-size/message/version/2?xdesc=1.0",
            "https://dropboxforum.com/t5/image/serverpage/avatar-name/smile/avatar-theme/candy/avatar-collection/Faces/avatar-display-size/unspecified/version/2?xdesc=1.0",
            "https://www.dropboxforum.com/t5/image/serverpage/image-id/23988i1A6A7CE02070A650/image-dimensions/60x60/constrain-image/false?v=v2",
            "https://www.dropboxforum.com/html/@C0329A6C28203425D9D95A39B646EE9C/assets/dropbox.png",
            "https://www.dropboxforum.com/i/smilies/16x16_heart.png",
            "https://www.dropboxforum.com/html/@A869A9F19F2B14A53B4A2F5F10243528/images/emoticons/1f504.png",
            "https://www.dropboxforum.com/html/@4EFCFC0F3380A335B7354351147128E6/images/emoticons/1f4cc.png",
            "https://www.dropboxforum.com/html/@A869A9F19F2B14A53B4A2F5F10243528/images/emoticons/1f504.png",
            "https://www.dropboxforum.com/t5/image/serverpage/avatar-name/smile/avatar-theme/candy/avatar-collection/Faces/avatar-display-size/message/version/2?xdesc=1.0",
            "https://dropboxforum.com/t5/image/serverpage/avatar-name/smile/avatar-theme/candy/avatar-collection/Faces/avatar-display-size/unspecified/version/2?xdesc=1.0",
            "https://www.dropboxforum.com/t5/image/serverpage/avatar-name/avatar29/avatar-theme/candy/avatar-collection/Smileys/avatar-display-size/message/version/2?xdesc=1.0",
            "https://www.dropboxforum.com/t5/image/serverpage/image-id/44218iFA781D2AC7F133E7/image-dimensions/150x150/image-coordinates/0%2C0%2C178%2C178?v=v2",
            "https://www.dropboxforum.com/t5/image/serverpage/image-id/14543i4C930D870ADEFFF7/image-dimensions/150x150/image-coordinates/3%2C0%2C215%2C212?v=v2",
            "https://www.dropboxforum.com/t5/image/serverpage/avatar-name/01/avatar-theme/candy/avatar-collection/Dropbox/avatar-display-size/profile/version/2?xdesc=1.0",
            "https://www.dropboxforum.com/t5/image/serverpage/avatar-name/avatar29/avatar-theme/candy/avatar-collection/Smileys/avatar-display-size/profile/version/2?xdesc=1.0",
            "https://dropboxforum.com/t5/image/serverpage/avatar-name/smile/avatar-theme/candy/avatar-collection/Faces/avatar-display-size/unspecified/version/2?xdesc=1.0"
        ],
        "movies": [],
        "keywords": [],
        "meta_keywords": [
            ""
        ],
        "tags": null,
        "authors": [
            "www.dropboxforum.com",
            "user-id"
        ],
        "publish_date": "2022-02-06T07:16:56.285000+00:00",
        "summary": "",
        "meta_description": "Ok so I've used Dropbox for almost as long as its existed and recently due to frustration with the never finishing indexing bug I was forced to find out why this kept",
        "meta_lang": "en",
        "meta_favicon": "https://www.dropboxforum.com/html/@44C25F34BD156BCA757B4594AC35A95B/assets/favicon2.ico",
        "meta_site_name": "dropboxforum.com",
        "canonical_link": "https://www.dropboxforum.com/t5/Dropbox-tips-tricks/How-to-fix-being-stuck-on-Indexing-forever-loop-of-death-on/td-p/575798",
        "text": "Ok so I've used Dropbox for almost as long as its existed and recently due to frustration with the never finishing indexing bug I was forced to find out why this kept happening so I could prevent it.\n\nBear with me on this long post but trust me its worth it, what I found was mind blowing and game changing.\n\nSo our business Dropbox is more than 9 million files strong, I've noticed REALISTICALLY any machine handling over 2 million will just enter an indexing loop at some point from which it will never recover, after its happened 5 times in the last week I was pissed enough to that I decided I was going to find out why this is happening, I know I'm pushing the limits but we've had machines with 2.5m files running fine for years, why some work fine and some don't was a mystery, one I was determined to find out.\n\nWhen you add stuff to your Dropbox, Dropbox has to index it so it can know what to do with it.\n\nIf you add \"too much stuff\" (copying 200,000 files of small size in one go, coders know what I'm talking about)\n\nor\n\ndo it \"too fast\" (changing access permissions on 1.5 million files located within Dropbox in one go in less than 5 minutes)\n\non a computer with too many files (1-2+m)\n\nthis causes Dropbox to start indexing them all at once causing the system to slow to a crawl\n\nhowever if you don't let Dropbox finish before doing something else (like adding more files or using the computer for other tasks)\n\nor\n\nsomeone else adds a bunch of files on another machine\n\nits almost for sure going to cause Dropbox to crash and restart during this process (it happens quite frequently),\n\nthis crashing and restarting triggers a full reindexing of the ENTIRE database, ALL files, and since the machine is already trying to download or upload some of the new files while trying to reindex the current millions of files, doing both at once overtaxes it, which causes it to crash, and were back to square one with the infinite indexing crash loop.\n\nThis kept happening to us all the time, the only solution was to unlink and relink the Dropbox account so all pending changes were lost, we got a bunch of conflicted copies and spent days sorting out the mess.\n\nSo I figured I needed to see what was going on with Dropbox, what it was doing when it was \"indexing\" to find out what was causing the crashes.\n\nSo after looking for a while I found using Microsoft's sysinternals process monitor (https://docs.microsoft.com/en-us/sysinternals/downloads/procmon) configured in a certain way allowed me to look at EXACTLY what dropbox was doing and I found out all I just told you and another very important piece of info.\n\n(if you want to see how awesome it looks in action check out THIS video:)\n\nWhen you click PAUSE FILE SYNCING you would think Dropbox pauses and ceases all operations, but you are wrong!, it pauses all incoming and outgoing transfers but any INDEXING tasks keep going!\n\nThis is an absolute game changer! now if I see a machine that says \"Indexing\" for a long time, I turn on the process monitor, hit pause on the file syncing and watch as the machine does the indexing at super high speed (5-10 times faster than doing it while downloading), it usually finishes doing the full file reindexing in a couple of minutes once its done I can hit back resume and keep going, I've never had the app crash while doing this \"offline\" or \"paused\" indexing, thus avoiding the inevitable crash, and reindex loop.\n\nI have been successful in recovering 4 machines from the indexing loop of death using this method, where before I was screwed and had to eat the duplicate files and cleanup for a week and a TON of annoyed users in the office.\n\nBasically if your machine is taking too long indexing or is stuck indexing after a crash just hit \"pause for 1 hour\" and forget about it, it will still be working on the indexing in the background, and when it restarts it should have finished the re-index avoiding a crash when trying to download/upload the new files.\n\nId wish Dropbox would have told us this, I never expected it to keep indexing while paused, I assumed pause was PAUSE, as in, cease all operations, it would have saved me so many headaches.\n\nAll they need to do now is let us have a \"log viewer\" or something so we can tell when its done doing its thing and we can hit resume, also show us, even when in pause, when its indexing and when its not, so when its done we know we can restart it safely, or the better yet, set it to where if Dropbox has to index a large volume of files (say over 100), it will automatically pause all other disk operations until the indexing is complete, then restart the downloads, trying to do both does not work, i know you want it to but it just doesn't, and just causes the whole thing to explode non stop in a loop of death, maybe enable this on a setting somewhere? or auto enable it on machines with over 500k files? something has to be able to be done.\n\nTLDR:\n\nIf your Dropbox is stuck indexing, hit pause 30 mins, and let it do its thing until its done, it will keep on doing it even when paused, you wont know if its doing anything or working unless you use procmon, but its working, and try avoid using the hard drive or the machine until its done, (usually less than 30 mins), and your indexing/crashing problem will be fixed.\n\nMessage to Dropbox:\n\nDear Dropbox, Please give us a way to view this info without having to resort to third party programs, this way we can help auto troubleshoot our Dropbox issues and take a lot of load off your customer service guys.\n\nSomething like: Enabling a setting somewhere saying \"activate/enable troubleshoot/server mode\" or something that allows us to turn on an always shown (ALWAYS, NOT ONLY WHEN MOUSE OVER, BUT ALWAYS!!!) 3 tab little window, containing:\n\nIndexing files. (with a current list of the exact files being indexed and their speed (x files per sec)/paths)\n\nDownloading Files.(with a current list of the exact files being downloaded and their speed/paths)\n\nUploading Files (with a current list of the exact files being uploaded and their speed/paths)\n\nThere's another issue with slow uploads due to Dropbox connections stuck in a \"stagnant state\" (force closing the TCP socket connection using netmon restarts the download/upload and speed goes back up again) but that's another problem for another time.\n\nI hope this was helpful to some other sysadmin and sorry for the long message but it needed explaining."
    }
}