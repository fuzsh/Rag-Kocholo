{
    "id": "dbpedia_7395_2",
    "rank": 51,
    "data": {
        "url": "https://www.deyda.net/index.php/en/2019/11/05/fslogix-container-office-profile-in-citrix-environments/",
        "read_more_link": "",
        "language": "en",
        "title": "Profile) in Citrix Environments – Deyda.net",
        "top_image": "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/09/2019-10-29-14_37_23-Window.png?fit=1307%2C442&ssl=1",
        "meta_img": "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/09/2019-10-29-14_37_23-Window.png?fit=1307%2C442&ssl=1",
        "images": [
            "https://www.deyda.net/wp-content/uploads/2020/11/deyda-header.png",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/09/2019-10-29-14_37_23-Window.png?fit=1200%2C406&ssl=1",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/10/fslogix_vhda23.png?resize=594%2C418",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/10/2019-10-29-14_39_42-Window.png?resize=218%2C300",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/10/2019-10-29-14_39_16-Window.png?resize=217%2C300",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/10/2019-10-29-14_41_05-Window.png?resize=300%2C275",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/10/2019-10-29-14_41_17-Window.png?resize=300%2C256",
            "https://i1.wp.com/deyda.net/wp-content/uploads/2019/10/2019-10-29-14_41_40-Window.png?fit=840%2C473",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/09/2019-10-29-14_37_23-Window.png?resize=840%2C284",
            "https://i2.wp.com/deyda.net/wp-content/uploads/2019/11/2019-11-03-21_46_21-Winkel-Azure-deyda.westeurope.cloudapp.azure_.com-Remotedesktopverbindung.png?fit=840%2C627",
            "https://i1.wp.com/deyda.net/wp-content/uploads/2019/11/2019-11-02-00_03_35-Winkel-Azure-deyda.westeurope.cloudapp.azure_.com-Remotedesktopverbindung.png?fit=840%2C583",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/11/2020-04-29_12h26_02.png?resize=840%2C540",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/11/2019-11-02-00_25_31-Winkel-Azure-deyda.westeurope.cloudapp.azure_.com-Remotedesktopverbindung.png?resize=240%2C300",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/10/2019-10-29-18_05_10-Window.png?resize=622%2C307",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/10/2019-10-29-18_32_15-Window.png?resize=395%2C165",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/10/2019-10-29-18_32_50-Window.png?resize=492%2C314",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/10/2019-10-29-18_33_03-Window.png?resize=490%2C316",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/10/2019-10-29-18_33_16-Window.png?resize=492%2C314",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/10/2019-10-29-18_37_14-Window.png?resize=443%2C46",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/11/2020-04-29_13h33_24.png?resize=691%2C85",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/11/2020-04-29_13h33_59.png?resize=395%2C452",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/11/2020-04-29_13h33_44.png?resize=395%2C449",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/10/2019-10-30-15_52_41-Window.png?resize=512%2C124",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/10/2019-10-29-18_39_41-Window.png?resize=537%2C135",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/10/2019-10-30-16_19_19-Window.png?resize=254%2C68",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/10/2019-10-29-18_41_02-Window.png?resize=812%2C287",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/11/2019-10-30-17_30_20-Winkel-Azure-deyda.westeurope.cloudapp.azure_.com-Remotedesktopverbindung.png?resize=396%2C202",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/11/2019-10-30-17_27_28-Winkel-Azure-deyda.westeurope.cloudapp.azure_.com-Remotedesktopverbindung.png?resize=756%2C511",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/11/2019-10-30-17_30_31-Winkel-Azure-deyda.westeurope.cloudapp.azure_.com-Remotedesktopverbindung.png?resize=330%2C235",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/11/2020-10-22_23h30_35.png?resize=399%2C376",
            "https://i1.wp.com/deyda.net/wp-content/uploads/2019/11/2019-11-02-00_03_35-Winkel-Azure-deyda.westeurope.cloudapp.azure_.com-Remotedesktopverbindung.png?fit=840%2C583",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2020/04/2020-04-29_12h26_02.png?resize=840%2C540",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/11/2019-11-02-00_25_31-Winkel-Azure-deyda.westeurope.cloudapp.azure_.com-Remotedesktopverbindung.png?resize=240%2C300",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/10/2019-10-29-18_05_10-Window.png?resize=622%2C307",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/10/2019-10-29-18_32_15-Window.png?resize=395%2C165",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/10/2019-10-29-18_32_50-Window.png?resize=492%2C314",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/10/2019-10-29-18_33_03-Window.png?resize=490%2C316",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/10/2019-10-29-18_33_16-Window.png?resize=492%2C314",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/10/2019-10-29-18_37_14-Window.png?resize=443%2C46",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/11/2020-04-29_13h33_24.png?resize=691%2C85",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/11/2020-04-29_13h33_59.png?resize=395%2C452",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/11/2020-04-29_13h33_44.png?resize=395%2C449",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/10/2019-10-30-15_52_41-Window.png?resize=512%2C124",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/10/2019-10-29-18_39_41-Window.png?resize=537%2C135",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/10/2019-10-30-16_19_19-Window.png?resize=254%2C68",
            "https://i2.wp.com/deyda.net/wp-content/uploads/2019/11/2019-11-02-22_22_39-Winkel-Azure-deyda.westeurope.cloudapp.azure_.com-Remotedesktopverbindung.png?fit=840%2C527",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2020/10/2020-10-22_23h19_31.png?resize=561%2C255",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2020/10/2020-10-22_23h21_24.png?resize=330%2C88",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/11/2020-12-11_16h37_17.png?resize=246%2C87",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/11/2019-10-30-17_30_20-Winkel-Azure-deyda.westeurope.cloudapp.azure_.com-Remotedesktopverbindung.png?resize=396%2C202",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/11/2019-11-05-10_14_03-W2K16-Desktop-O365-vGPU-Desktop-Viewer-1.png?resize=452%2C20",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/11/2019-10-30-17_30_31-Winkel-Azure-deyda.westeurope.cloudapp.azure_.com-Remotedesktopverbindung-1.png?resize=266%2C232",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/11/2019-11-05-10_13_52-W2K16-Desktop-O365-vGPU-Desktop-Viewer.png?resize=414%2C98",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/11/2019-11-05-10_14_39-W2K16-Desktop-O365-vGPU-Desktop-Viewer.png?resize=612%2C264",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/12/2019-12-06-14_49_02-Winkel-Azure-deyda.westeurope.cloudapp.azure_.com-Remotedesktopverbindung.png?resize=529%2C395",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/12/2019-12-06-14_10_54-Winkel-Azure-deyda.westeurope.cloudapp.azure_.com-Remotedesktopverbindung.png?resize=801%2C160",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/12/2019-12-06-14_11_08-Winkel-Azure-deyda.westeurope.cloudapp.azure_.com-Remotedesktopverbindung.png?resize=494%2C316",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/12/2019-12-06-14_11_25-Winkel-Azure-deyda.westeurope.cloudapp.azure_.com-Remotedesktopverbindung.png?resize=492%2C315",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/10/2019-10-29-18_32_50-Window.png?resize=492%2C314",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/11/2019-11-05-11_20_01-W2K16-Desktop-O365-vGPU-Desktop-Viewer.png?resize=543%2C371",
            "https://i2.wp.com/deyda.net/wp-content/uploads/2019/11/2019-11-05-11_27_07-W2K16-Desktop-O365-vGPU-Desktop-Viewer-1.png?fit=840%2C499",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/11/2020-04-29_16h14_49.png?resize=591%2C632",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/11/2020-04-29_16h13_41.png?resize=840%2C165",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/11/2020-04-29_16h13_58.png?resize=840%2C479",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/11/2020-04-29_16h14_12.png?resize=840%2C480",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/11/2020-04-29_16h09_01.png?resize=840%2C782",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/11/2020-11-27_11h57_43.png?resize=585%2C124",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2019/11/2020-11-27_11h58_26.png?resize=840%2C78",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2020/02/2020-02-26-13_20_37-Winkel-Azure-40.113.118.171-Remotedesktopverbindung.png?resize=840%2C185",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2020/02/2020-02-26-13_20_56-Winkel-Azure-40.113.118.171-Remotedesktopverbindung-1.png?resize=341%2C117",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/2020/10/image.jpg?resize=758%2C618",
            "https://secure.gravatar.com/avatar/3bfb3df1ca74675b419914e2b54b99ae?s=49&d=mm&r=pg",
            "https://i0.wp.com/www.deyda.net/wp-content/uploads/ctp-digital-badge-color-2x.png?fit=457%2C247&ssl=1",
            "https://pbs.twimg.com/profile_images/1192017141249298432/kYrSOFGA_normal.jpg",
            "https://pbs.twimg.com/profile_images/583379903657070592/MzTG5OLQ_normal.jpg",
            "https://pbs.twimg.com/profile_images/583379903657070592/MzTG5OLQ_normal.jpg",
            "https://pbs.twimg.com/profile_images/1632751777996046338/3-Mtup6A_normal.png"
        ],
        "movies": [
            "https://www.deyda.net/index.php/en/2020/05/18/fslogix-app-masking-in-citrix-environments/embed/#?secret=HST8VDQR4w#?secret=mtzU50tTBG",
            "https://www.deyda.net/index.php/en/2020/06/16/msix-app-attach-with-windows-10-version-2004-in-citrix-environments/embed/#?secret=NzC4t50tlU#?secret=rjVGDfqqbP",
            "https://www.deyda.net/index.php/en/2018/10/12/office365-installation-on-terminal-server/embed/#?secret=dEAZyxShYO#?secret=XaXHMMjaJp"
        ],
        "keywords": [],
        "meta_keywords": [
            ""
        ],
        "tags": null,
        "authors": [
            "Manuel Winkel",
            "Author Manuel Winkel",
            "www.facebook.com"
        ],
        "publish_date": "2019-11-05T00:00:00",
        "summary": "",
        "meta_description": "FSLogix Container (Office/Profile) in Citrix Environments FSLogix Deyda.net",
        "meta_lang": "en",
        "meta_favicon": "https://i0.wp.com/www.deyda.net/wp-content/uploads/2020/03/cropped-Logo_DEYDA_no_cta.png?fit=32%2C32&ssl=1",
        "meta_site_name": "Deyda.net",
        "canonical_link": "https://www.deyda.net/index.php/en/2019/11/05/fslogix-container-office-profile-in-citrix-environments/",
        "text": "Recently, I have been involved more and more in projects where Office365 is to be fully implemented in Citrix environments. This means that the customer not only needs the standard Office applications Outlook, Excel and Word, but also wants to use teams and OneDrive.\n\nBut this is exactly where we, without additional software, have big problems in non-persistent desktop environments. For example with our profiles (Team Installer stores its data in the profile) or so that the data is downloaded from the Internet every time (excluding OneDrive Sync data in the profile).\n\nHowever, we have recently been in the fortunate position of being able to use FSLogix “free of charge” for this purpose, if we meet the following requirements:\n\nMicrosoft 365 E3/E5\n\nMicrosoft 365 A3/A5/ Student Use Benefits\n\nMicrosoft 365 F1/F3\n\nMicrosoft 365 Business\n\nWindows 10 Enterprise E3/E5\n\nWindows 10 Education A3/A5\n\nWindows 10 VDA per user\n\nRemote Desktop Services (RDS) Client Access License (CAL)\n\nRemote Desktop Services (RDS) Subscriber Access License (SAL)\n\nFSLogix Technologies\n\nA short list of the individual FSLogix components.\n\nProfile Container\n\nProfile Container basically moves all profile files and folders into a VHD / VHDX file in the network and then mounts it as a container in the target system when logging on. This will replace the existing profile solutions where the files are copied over the network to the target system, like Roaming Profile or Universal Profile Management.\n\nOffice Container\n\nOffice Container redirects only the part of the profile that contains Office data. This allows FSLogix to be used parallel to already implemented profile solutions. This functionality is useful for the Outlook OST file, Team Installer or OneDrive Offline files.\n\nApplication Masking\n\nApplication Masking manages access to applications, fonts, printers, etc. Access can be controlled by user, IP address range and other criteria. This significantly reduces the number and complexity of Golden Master Images.\n\nJava Version Control\n\nJava Version Control allows all applications & websites to work with the Java version they need. The selected Java version must be installed on the client computer. Multiple versions of Java can be installed side by side. All within the same client system.\n\nMSIX App Attach\n\nMSIX App Attach assigns applications stored at a central location in MSIX format to the operating system. After it is attached, the applications look locally installed to both the user and the operating system. Based on application groups, applications can be deployed immediately without the need to deploy a new Golden Image.\n\nBy combining FSLogix Profile Container and MSIX App Attach, the operating system remains completely clean and data, profiles, and applications are completely separated.\n\nSetup of FSLogix Container\n\nIn this blog I don’t look at the complete FSLogix technology palette in detail, but first I’ll only discuss the features Profile & Office Container.\n\nImportant !\n\nSince FSLogix do not perform any housekeeping, the use of e.g. Microsoft Teams can cause the containers to bloat dramatically. Furthermore FSLogix does not shrink the container even if data is deleted from it.\n\nTo avoid this problem, you should run the Shrink Script at regular intervals (e.g. as a Scheduled Task) to prevent the container from inflating.\n\nArchitecture\n\nNormally in non-persistent environments, the profiles are file-based and copied to the target server when logging in and back to the file server when logging off (Roaming Profile, UPM, etc.). Due to the latest requirements (e.g. Microsoft Teams or OneDrive) for user profiles, these profiles have become very large and therefore the logon and logoff times are often unacceptable. With the FSLogix Container architecture, the user profiles are placed in VHD(X) files and stored at a network location. At session runtime, the user profile is mounted and thus the waiting time for the profile is eliminated.\n\nPrerequisites\n\nI assume the following things and do not go into them in detail:\n\nInstalled and licensed Citrix environment (StoreFront, DDC etc.)\n\nEstablished profile solution (here UPM) for Office365 Container Feature\n\nInstalled Office365 for Office365 Container Feature\n\nProfile Container\n\nIn order to use the Profile Container feature, the required package must be installed on the Golden Master Image and activated via GPO.\n\nIf another profile method (roaming, UPM, etc.) is to be already used and be replaced, this must be deactivated before activating Profile Container (here UPM via WEM).\n\nMigration Methods\n\nTo migrate from existing Profile solutions to FSLogix Profile Containers, there are various existing instructions.\n\nUPM nach Profile Container\n\nLocal Profile nach Profile Container\n\nUPD nach Profile Container\n\nFile Server\n\nImportant !\n\nFor optimal performance, the file server and the target server should be in the same data center location.\n\nExclude VHD(X) files from antivirus scanning to avoid performance bottlenecks.\n\nFor network bandwidth, it is recommended to schedule between 5 and 30 MBps per user, depending on the type of usage.\n\nRessourcen Requirement\n\nRuntime 10 IOPS per user\n\nLogin / Logout 50 IOPS per user\n\nCreate a folder on your file server for the Profile Container of the users.\n\nSet the following permissions.\n\nActivate the share and set the share permissions for the Authenticated Users to Change and Read.\n\nGolden Master Image\n\nDownload the FSLogix package and extract it\n\nAfter some tests I can not recommend every version, the following versions are tested and did not cause any errors with my customers\n\nVersion FSLogix_Apps_2.9.6964.52690 -> Old & Stable\n\nVersion FSLogix_Apps_2.9.7349.30108 -> New & Stable\n\nLaunch the installer FSLogixAppsSetup\n\nClick in the following window on “I agree to the license terms and conditions“\n\nVia the button Options you can adjust the path of the installation\n\nClick Install to start the installation.\n\nAfter the installation you can check the Services menu, that the FSLogix services are installed and running.\n\nFSLogix Apps Service\n\nService name: frxsvc\n\nDescription: FSLogix Apps Service Component.\n\nPath to executable: “C:\\Program Files\\FSLogix\\Apps\\frxsvc.exe”\n\nStartup type: Automatic\n\nFSLogix Cloud Caching Service\n\nService name: frxccds\n\nDescription: FSLogix Apps Cloud Caching Service Component.\n\nPath to executable: “C:\\Program Files\\FSLogix\\Apps\\frxccds.exe”\n\nStartup type: Automatic\n\nTo control the execution of the agent on the worker, the following groups have been created locally in the worker\n\nThese groups can be used to define (White/Blacklistening) who can use the container solution\n\nFSLogix ODFC –> Office Container\n\nFSLogix Profile –> Profile Container\n\nBy default, the user Everyone is member of the include groups\n\nIt is recommended that you create and store an AD group for each of the required include and exclude lists.\n\nThese groups can be stored locally in the Golden Master or centrally via Group Policy Preferences\n\nActive Directory Server\n\nCopy the ADMX & ADML file from the extracted FSLogix folder\n\nPaste these files into your PolicyDefinitions folder\n\nOpen the Group Policy Management Console\n\nCreate a GPO in the OU of your Worker Machines\n\nNow configure the settings you need for Profile Container\n\nThe folowing are the most important settings from the FSLogix ADMX file.\n\n/ Computer Configuration / Policies / Administrative Template / FSLogix / Profile Container\n\nEnabled (Must be configured)\n\nThis point activates the complete Profile Container feature.\n\nVHD location ( Must be configured )\n\nA list of file system locations to search for the user’s profile VHD(X) file. If one isn’t found, one will be created in the first listed location. If the VHD(X) path does not exist, it will be created before verification.\n\nThese values can contain variables that will be resolved. Supported variables are %username%, %userdomain%, %sid%, %osmajor%, %osminor%, %osbuild%, %osservicepack%, %profileversion%, and any environment variable.\n\nSize in MBs\n\nDefines the size of the newly created VHD(X) file in MB. Depending on the type of usage, it is recommended to plan between 5 and 15 GB per user. The originally defined 30 GB should remain defined, since this is only the maximum size of the container and not the directly used size on the disk, if Dynamic VHD(X) allocation is enabled.\n\nA change of this setting only affects newly created containers. Existing containers must be extended by script.\n\nExpand Container\n\nDynamic VHD(X) allocation\n\nIf Dynamic VHD(X) allocation is enabled, the VHD(X) files are assigned dynamically. This means that the file size of the VHD(X) file only grows when data is added to the Profile Container.\n\nIf this option is not enabled, automatically created VHD(X) files will be directly allocated to the full data storage space.\n\nPROFILE TYPE (MUST BE CONFIGURED)\n\nNormal direct-access profile\n\nThe client tries to mount the VHD(X) file directly when logging in (1 to 1 connection). No Difference Disks are used. If simultaneous further access is attempted, it fails with a share violation (error 20). When logging off, the VHD(X) file is unmounted again.\n\nRead-write profile\n\nThe client performs the following logon steps:\n\nThe Difference Disk RW.VHD(X) is tried to open with read/write access. If successful, the Difference disk will be merged with the parent Profile disk. When the merge is complete, the RW.VHD(X) file is deleted.\n\nA new RW.VHD(X) Difference Disk is created.\n\nThe new RW.VHD(X) file is mounted as a profile disk.\n\nThe following steps are performed during logoff:\n\nDetaches the RW.VHD(X) difference disk (the user’s Profile VHD/X)\n\nAttempts to open the RW.VHD(X) difference disk with Read/Write access. If it is successful, it merges the difference disk to the parent. If it completes the merge, the RW.VHD(X) file is deleted\n\nThe RW Difference Disk is stored in the network directly next to the Profile Disk.\n\nRead-only profile\n\nThe client performs the following logon steps:\n\nClient attempts to delete the previous RO difference disk (if it exists)\n\nA new RO-Difference disk will be created\n\nThe new RO difference disk are attached as the user’s Profile VHD\n\nThe following steps are executed during logoff:\n\nClient detaches the RO difference disk\n\nThe RO-Difference Disk will be erased\n\nThe RO Difference Disks are stored in the local Temp directory of the client and are called %usersid%_RO.VHD(X).\n\nTry for read-write profile and fallback to read-only\n\nClient checks to see if a RW.VHD(X) file exists. If no file exists, it performs the same steps as for Read-write profile. If the file RW.VHD(X) exists, the client assumes the role Read-only profile and performs these steps.\n\nImportant !\n\nNote the following limitations when configuring multiple accesses to a container (Non Normal direct-access Profile) if no Office Container is used in parallel:\n\nMicrosoft OneDrive does not support multiple connections, this can lead to data loss.\n\nMicrosoft Outlook (OST files) offers limited support for multiple connections.\n\nStore search database in profile container\n\nWindows Search Service must be started and set to automatic for this feature. Delayed start should not be enabled. The Citrix Provisioning Server Optimization tool disables the Windows Search Service and should therefore be reactivated via GPO.\n\nThis option should not be used on Windows Server 2019 operating systems, as this can lead to errors.\n\nIn Windows Server 2019, please use the following article by James Kindon to implement this.\n\nWindows Search in Server 2019 and Multi-Session Windows 10\n\nMulti-user search\n\nMulti-user search extracts the user part of the search index and saves it in the Profile Container. The user-specific part of the .edb file, which takes over the Outlook search, is extracted and integrated into the Profile Container. The user-specific part of the .edb file and the files necessary to support the search are stored in the folder \\WSearch in the VHD(X).\n\nThis feature allows you to roam a user’s Outlook search information across multiple systems.\n\nSingle-user search\n\nSingle-user search saves the entire search database in the profile container of the user. The .edb file from the ProgramData folder is then included in the user’s Profile Container. The redirected .edb file and the files required to support the search are stored in the \\WSearch folder on the VHD(X).\n\nBy redirecting the Windows search database, the Windows search is available immediately after logon and no re-indexing is required.\n\nSet Outlook cached mode on successful container attach\n\nIf this feature is enabled and the Profile container is successfully attached, the Outlook setting that enables cache mode is temporarily set for the current session until the container is removed. This ensures that the cache mode is only used when the container is attached.\n\nDelete local profile when FSLogix Profile should apply\n\nIf this is enabled, the user’s local profile is permanently deleted if Container is enabled for this profile. The user is then logged on with the FSLogix profile.\n\nAllow concurrent user sessions\n\nThis setting should be used when the target system is multi-session and allows simultaneous logins for the same Windows account on the same server.\n\n/ Computer Configuration / Policies / Administrative Template / FSLogix / Profile Container / Advanced\n\nProvide RedirXML file to customize redirections\n\nThe file redirections.xml is stored here to define which files and folders should not be saved in the Profile Container.\n\nWhen you log on, the FSLogix agent copies the redirections.xml file from the specified location to <profile>\\AppData\\Local\\FSLogix (inside the VHD(x)) and processes it immediately. The user must have read permission for the file.\n\nTypically this location might be in the root or a sub-directory of the location where profiles are stored: \\\\<FileServer>\\\\Container$\\Redirection\\ (the redirections.xml would be placed in the Redirection folder).\n\nThe basic structure of the redirections.xml file is as follows:\n\nWhat is Included / Excluded is only considered when logging in. If changes are made then a logoff / logon sequence must be done to sync to files.\n\nYou can specify any numbers of items inside the Includes and Excludes tags. Folders are relative to the user profile only (That’s why AppData is shown in this example).\n\nExclude folders are redirected to base (meaning the \\Users\\local_%username% folder FSLogix creates) and Include folders are used when certain folders should remain on virtual profile. Include are normally used when a complete folder is redirected and only some subfolders should not be excluded.\n\n<OPTIONAL> should be replaced by one of the following values:\n\nIf the ExcludeCommonFolders attribute is specified, folders specified by the bitmask value are excluded, so redirected to base.\n\n1 = Contacts folder\n\n2 = Desktop folder\n\n4 = Documents folder\n\n8 = Downloads folder\n\n16 = Links folder\n\n32 = Music and Podcasts folders\n\n64 = Pictures and Videos folders\n\n128 = Folders like AppData\\LocalLow\n\nTo Example if you want to exclude Contacts & Links Folder, set the Value 17 (1+16).\n\nIf you want to avoid copy to / from base in some common folder, you can add an Exclude item to override. Exclude items have priority over common folders exclusions.\n\nIf the same folder is specified as Exclude and as Include item, the Exclude will have priority.\n\n<VALUE> should be replaced by one of the following values:\n\n0 = No files are copied in or out. Only the folders are created in the directory local_<user_name> .\n\n1 = Files are copied to the local profile. Any existing file in an excluded folder is copied to the local profile.\n\n2 = Files are copied back into the virtual profile. Each modified file in the local profile is copied back into the Profile Container when the user logs off.\n\n3 = Files are copied from & to the local profile. Combination of Value 1 and 2.\n\nImportant !\n\nRedirections should only be used minimally, as this has an immense negative effect on the required iOPS. The size of the container has no negative influence on the login speed.\n\nThis function should not be used to crop the profile heavily, as for example with UPM, or to create space-saving profiles. If less space per profile is needed, file based profile solutions such as UPM should be used.\n\nImportant !\n\nThe following path should not be excluded:\n\nAppData\\Local\\GroupPolicy\n\n/ Computer Configuration / Policies / Administrative Template / FSLogix / Profile Container / Container and Directory Naming\n\nVirtual disk type\n\nDefines the type of the automatically created Profile Container file (VHDX or VHD). Configure VHDX here.\n\nSwap directory name components\n\nIf it is enabled, new directories are named with the user name first, followed by the SID.\n\nThe default setting is %SID%_%USERNAME% and therefore annoying when searching for a specific user. If you change this setting afterwards existing containers will not be touched and therefore recreated. With the following script this can be renamed in advance and the containers can be moved.\n\nMigrate from SID_Username to Username_SID\n\nResult\n\nAfter successful setup, the result can be viewed as follows.\n\nRun compmgmt.msc from cmd or Run\n\nUnder Disk Management you can now see the attached Profile Container (here Profile-manuel)\n\nClick with the right mouse button on the profile disc and assign a drive letter to it.\n\nNow you can access the drive and check the data\n\nOffice365 Container\n\nThe Office Container is a subtype of the Profile Container. Although all the advantages of the Office Container are also available in the Profile Container, it can sometimes be advantageous to combine them.\n\nDifferent data class (backup of Profile Container and no backup for Office Container)\n\nOffice Container requires higher IOPS\n\nIn order to use the Office365 Container feature, the corresponding package must be installed on the Golden Master Image and activated via GPO.\n\nOffice365 Container can be used parallel to existing profile methods (Roaming, UPM etc.).\n\nFile Server\n\nCreate a folder on your file server for the profile containers of the users\n\nSet the following permissions.\n\nActivate the share and set the share permission for the Authenticated Users to Change and Read.\n\nGolden Master Image\n\nDownload the FSLogix package and extract it\n\nAfter some tests I can not recommend every version, the following versions are tested and did not cause any errors with my customers\n\nVersion FSLogix_Apps_2.9.6964.52690 -> Old & Stable\n\nVersion FSLogix_Apps_2.9.7349.30108 -> New & Stable\n\nVersion FSLogix_Apps_2.9.7621.30127 (Version 2009) -> New Version\n\nLaunch the installer FSLogixAppsSetup\n\nClick in the following window on “I agree to the license terms and conditions“\n\nVia the button Options you can adjust the path of the installation\n\nClick Install to start the installation\n\nAfter the installation you can check the Services menu, that the FSLogix services are installed and running\n\nFSLogix Apps Service\n\nService name: frxsvc\n\nDescription: FSLogix Apps Service Component.\n\nPath to executable: “C:\\Program Files\\FSLogix\\Apps\\frxsvc.exe”\n\nStartup type: Automatic\n\nFSLogix Cloud Caching Service\n\nService name: frxccds\n\nDescription: FSLogix Apps Cloud Caching Service Component.\n\nPath to executable: “C:\\Program Files\\FSLogix\\Apps\\frxccds.exe”\n\nStartup type: Automatic\n\nTo control the execution of the agent on the worker, the following groups have been created locally in the worker\n\nThese groups can be used to define (White/Blacklistening) who can use the container solution\n\nFSLogix ODFC –> Office Container\n\nFSLogix Profile –> Profile Container\n\nBy default, the user Everyone is member of the include groups\n\nIt is recommended that you create and store an AD group for each of the required include and exclude lists.\n\nThese groups can be stored locally in the Golden Master or centrally via Group Policy Preferences\n\nActive Directory Server\n\nCopy the ADMX & ADML file from the extracted FSLogix folder\n\nPaste these files into your PolicyDefinitions folder\n\nOpen the Group Policy Management Console\n\nCreate a GPO in the OU of your Worker Machines\n\nNow configure the settings you need for Office365 Container\n\nThe folowing are the most important settings from the FSLogix ADMX file for Office365 Container.\n\n/ Computer Configuration / Policies / Administrative Template / FSLogix / Office 365 Container\n\nEnabled (Must be configured)\n\nThis item activates the Office365 Container feature.\n\nVHD location (Must be configured)\n\nA list of file system locations to search for the Office365 Container VHD(X) file. If one isn’t found, one will be created in the first listed location. If the VHD(X) path does not exist, it will be created before verification.\n\nThese values can contain variables that will be resolved. Supported variables are %username%, %userdomain%, %sid%, %osmajor%, %osminor%, %osbuild%, %osservicepack%, %profileversion%, and any environment variable.\n\nSize in MBs\n\nSet the size of the newly created VHD(X) file in MB. Depending on the type of use, it is recommended to plan between 2 and 5 GB per user. The originally defined 30 GB should remain defined because this is only the maximum size of the container and not the directly used size on the disk if Dynamic VHD(X) allocation is enabled.\n\nChanging this setting only has an effect on newly created containers. Existing containers must be extended by script.\n\nExpand Container\n\nDynamic VHD(X) allocation\n\nIf Dynamic VHD(X) allocation is enabled, the VHD(X) files are assigned dynamically. This means that the file size of the VHD(X) file only grows when data is added to the Office365 Container. If this option is not enabled, automatically created VHD(X) files will be directly allocated to the full data storage space.\n\nVirtual disk type\n\nSpecifies the type of automatically created container file (VHDX or VHD). VHDX should be configured here.\n\nVHD access type\n\nDifference disk stored on local machine\n\nThe following steps are performed during logon:\n\nThe Client attempt to remove a previous Difference Disk (%usersid%_ODFC.VHD(X)) for this user from the temporary folder.\n\nA new Difference Disk named %usersid%_ODFC.VHD(X) is created. This Difference disk will be created in the Temp directory.\n\nThe client mount the Difference Disk as O365 VHD.\n\nThe following steps are executed during logoff:\n\nClient detaches the difference disk.\n\nThe system tries to merge the Difference Disks. The merge can only be successful if the user’s last session has ended.\n\nClient deletes the difference disk.\n\nDifference disk stored on network\n\nAt the logon:\n\nAn attempt is made to open the Difference Disk merge.vhd(x) with read/write access. If successful, it merges the Difference disk with the original Office 365 container. When the merge is complete, the Difference disk is deleted.\n\nAll previous Difference Disks for the logged on system (%Computername%_ODFC.VHD(X)) will be deleted.\n\nA new Difference disk named %computername%_ODFC.VHD(X) is created. This difference disk is created on the network share next to the parent VHD(X) file.\n\nThe Difference disk is attached as O365 VHD.\n\nWhen you log off:\n\nThe Difference Disk is unmounted.\n\nThe Difference Disk will be renamed to merge.vhd(x). If this renaming is successful, an attempt is made to merge the difference discs. The merge can only be successful if the user’s last session has ended.\n\nThe Difference Disk is deleted.\n\nDirect access\n\nWhen logging in, the system tries to attach the VHD(X) file directly. No Difference Disks are used (This is a 1 to 1 connection). If simultaneous access is attempted, it fails with a share violation (error 20).\n\nWhen logging out, the VHD(X) is unmounted.\n\nImportant !\n\nPlease note the following limitations when configuring multiple accesses to a container (not for Direct Access or Unique Disk per Session):\n\nMicrosoft OneDrive does not support multiple connections, this can lead to data loss\n\nMicrosoft Outlook (OST files) offers limited support for multiple connections\n\nUnique disk per session\n\nWith this method, no parent disk is created and each container is initially created empty. The data from the Session Containers is also not merged centrally and can therefore be different, but that is why this mode is also supported with OneDrive and for OST files.\n\nThe VHD(X) files are named ODFC-%username%-SESSION-<sessionnumber>.VHD(X), where sessionnumber is an integer from 0 – 9.\n\nThe maximum number of VHD(X) files per session is 10.\n\nWhen you log on, the following steps are performed:\n\nIt searches for a VHD(X) file for the session that is not currently in use.\n\nIf one is found, it is mounted and used directly.\n\nIf none free is found, a new one is created and used.\n\nIf a new VHD is created and so the number of VHDs per session is greater than the specified number under Number of per-Session VHDs to persist, this VHD(X) will be marked for deletion and deleted when logging off.\n\nWhen you log off:\n\nThe VHD(X) file is unmounted.\n\nWhen the VHD(X) is marked for deletion, it is deleted.\n\nImportant !\n\nPlease note the following limitations when configuring multiple accesses to a container (not for Direct Access or Unique Disk per Session):\n\nMicrosoft OneDrive does not support multiple connections, this can lead to data loss.\n\nMicrosoft Outlook (OST files) offers limited support for multiple connections.\n\nExisting Difference Disk containers can be migrated to Unique Disk per session, so that the content does not have to be completely downloaded from the cloud again. With the following script you can create one or more session containers (the existing container can be deleted or will not be touched)\n\nScript for migration\n\nImportant !\n\nDo not copy these new Unique Disk per Session containers into the same folder as the existing Difference Disk containers.\n\nIf both methods access the same path, the method that is used first will win. The other method can no longer use a container.\n\nIf there are no more Difference Disk Containers in the directory, and a computer tries to use this method, the Unique Disk per Session Container, if not already in use, will be used for this. The session container is taken as parent disk for the newly created difference disk.\n\nNumber of per-Session VHDs to persist\n\nThis setting is used when the VHD access type is set to Unique disk per session. This controls the number of session VHDs that are persistent.\n\nFor example, if this is set to ‘2’ and the user creates a third session, a new session VHD is created and used, but is deleted when the third session ends.\n\nSync OST to VHD\n\nHow to deal with existing local OST files.\n\nCopy OST to VHD\n\nExisting local OST file (if existing) are synchronized into the Office365 Container VHD(X) file.\n\nDo not mirror OST to VHD\n\nExisting local OST file are not moved to the Office365 container.\n\nMove OST to VHD\n\nExisting local OST file (if existing) are initially moved to the Office365 Container VHD(X) file.\n\nStore search database in Office 365 container\n\nWindows Search Service must be started and set to automatic for this feature. Delayed start should not be enabled. The Citrix Provisioning Server Optimization tool disables the Windows Search Service and should therefore be reactivated via GPO.\n\nThis option should not be used on Windows Server 2019 operating systems, as this can lead to errors.\n\nMulti-user search\n\nMulti-user search extracts the user part of the search index and saves it in the Office365 Container. The user-specific part of the .edb file, which takes over the Outlook search, is extracted and integrated into the Office365 Container. The user-specific part of the .edb file and the files necessary to support the search are stored in the folder \\WSearch in the VHD(X).\n\nThis feature allows you to roam a user’s Outlook search information across multiple systems.\n\nSingle-user search\n\nSingle-user search saves the entire search database in the Office365 Container of the user. The .edb file from the ProgramData folder is then included in the user’s Office365 Container. The redirected .edb file and the files required to support the search are stored in the \\WSearch folder on the VHD(X).\n\nBy redirecting the Windows search database, the Windows search is available immediately after logon and no re-indexing is required.\n\nSet Outlook cached mode on successful container attach\n\nIf this feature is enabled and the Office365 Container is successfully attached, the Outlook setting that enables cache mode is temporarily set for the current session until the container is removed. This ensures that the cache mode is only used when the container is attached.\n\nAllow concurrent user sessions\n\nThis setting should be used when the target system is multi-session and allows simultaneous logins for the same Windows account on the same server.\n\nInclude Office activation data in container\n\nIf this is enabled, the activation data of the Office license is stored in the Office365 Container.\n\nInclude Outlook data in container\n\nActivated, the Outlook data files are included in the Office365 container.\n\nInclude OneDrive data in container\n\nActivate the OneDrive cache to be included in the Office365 container.\n\nImportant !\n\nStarting with FSLogix version 2009, FSLogix supports the processing of multiple business OneDrive accounts and Personal OneDrive accounts. Before version 2009, only one business account was supported.\n\nInclude Teams data in container\n\nWhen Enabled, the Teams files are included in the Office365 Container.\n\n/ Computer Configuration / Policies / Administrative Template / FSLogix / Office 365 Container / Container and Directory Naming\n\nSwap directory name components\n\nIf it is enabled, new directories will be named with the user name first, followed by the SID.\n\nThe default setting is %SID%_%USERNAME% and therefore annoying when searching for a specific user. If you change this setting afterwards existing containers will not be touched and therefore recreated. With the following script this can be renamed in advance and the containers can be moved.\n\nMigrate from SID_Username to Username_SID\n\nExisting Profile Solution\n\nYou should exclude the following paths in your existing profile solution so that Office365 Container work smoothly.\n\nOneDrive\n\n%USERPROFILE%\\AppData\\Local\\Microsoft\\OneDrive\n\n%USERPROFILE%\\OneDrive – <TenantName>\n\nOutlook\n\n%USERPROFILE%\\AppData\\Local\\Microsoft\\Outlook\n\nResult\n\nAfter successful configuration, the result can be viewed as follows.\n\nLaunch compmgmt.msc from cmd or Run\n\nUnder Disk Management you can now see the attached Office365 container (here O365-mwinkel)\n\nClick with the right mouse button on the Office365 Disk and assign a drive letter to it.\n\nNow you can access the drive and check the data\n\nSince I didn’t have good experiences with Inplace Upgrades with several versions of FSLogix, here’s my recommendation for the update process.\n\nReplace FSLogix ADMX files\n\nDeinstallation of the existing FSLogix components\n\nRestart the machine\n\nInstallation of the new FSLogix version\n\nTroubleshooting\n\nSome notes on troubleshooting about FSLogix.\n\nLog Location\n\nThe log files are stored under the following path in the target system. The GPO can be used to define which logs are created.\n\nC:\\ProgramData\\FSLogix\\\n\nUnder the following path there are two more useful tools.\n\nC:\\Program Files\\FSLogix\\Apps\n\nFSLogix Profile Status\n\nHidden behind the frxtray.exe is the FSLogix Profile Status Tool. In the Basic View it only shows the usage of a profile container. The screenshots are from an environment with Office Container only, hence the yellow traffic light and no display of memory usage.\n\nThis display can be further extended by clicking on Advanced View. In the Advanced View we see all FSLogix related entries in the local Event Viewer under Events.\n\nUnder Logs the above mentioned log files are read out. The Office Container is located behind ODFC.\n\nFSLogix Profiles Configuration Tool\n\nBehind the ConfigurationTool.exe the FSLogix Profiles Configuration Tool is hidden. This tool was used in the past to configure Profile Containers.\n\nI personally only use it nowadays to create redirection.xml. For this you have to load an existing container and then you can create the entries.\n\nAnti-Virus Exceptions\n\nTarget System (Worker)\n\nExclude files & folders\n\n%Program Files%\\FSLogix\\Apps\\frxdrv.sys\n\n%Program Files%\\FSLogix\\Apps\\frxdrvvt.sys\n\n%Program Files%\\FSLogix\\Apps\\frxccd.sys\n\n%TEMP%\\*.VHD\n\n%TEMP%\\*.VHDX\n\n%Windir%\\TEMP\\*.VHD\n\n%Windir%\\TEMP\\*.VHDX\n\n\\\\server\\share\\*\\*.VHD\n\n\\\\server\\share\\*\\*.VHDX\n\nExclude Processes\n\n%Program Files%\\FSLogix\\Apps\\frxsvc.exe\n\n%Program Files%\\FSLogix\\Apps\\frxccd.exe\n\n%Program Files%\\FSLogix\\Apps\\frxccds.exe\n\nFile Server\n\nVHD(X) Directory, including subdirectory\n\nRegistry\n\nIn the registry you can check which settings are currently being used. These can be found under the following registry path.\n\nProfile Container\n\nHKLM\\SOFTWARE\\FSLogix\\Profiles\n\nRegistry Reference\n\nOffice Container\n\nHKLM\\SOFTWARE\\Policies\\FSLogix\\ODFC\n\nRegistry Reference\n\nCloud Cache\n\nHKLM\\SYSTEM\\CurrentControlSet\\Services\\frxccd\\Parameters\n\nHKLM\\SYSTEM\\CurrentControlSet\\Services\\frxccds\\Parameters\n\nRegistry Reference\n\nContainer Size\n\nHere a script (Thx to Jim Moyle) to shrink existing containers, for example after deleting some of the content.\n\nShrink Script\n\nConfigure this on the respective file server or an admin server.\n\nShown here is the Shrink Script as a Scheduled Task addressed several times a day.\n\nAnd a script (Thx to Kasper Johansen) to enlarge the containers if they were too small at the beginning.\n\nExpand Script\n\nMissing start menu at second login"
    }
}