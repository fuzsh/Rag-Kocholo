{
    "id": "dbpedia_2370_2",
    "rank": 28,
    "data": {
        "url": "https://forum.image.sc/t/help-with-ilastik-pixel-training/54300",
        "read_more_link": "",
        "language": "en",
        "title": "Help with ilastik Pixel training",
        "top_image": "https://global.discourse-cdn.com/business4/uploads/imagej/original/2X/4/4904e8fe196486eabdbe0d9d185e94dfcab74e10.png",
        "meta_img": "https://global.discourse-cdn.com/business4/uploads/imagej/original/2X/4/4904e8fe196486eabdbe0d9d185e94dfcab74e10.png",
        "images": [
            "https://global.discourse-cdn.com/business4/uploads/imagej/optimized/3X/5/7/57e09c8cc6475f5b99105ece56985bf2eb1e1e34_2_690x500.jpeg",
            "https://global.discourse-cdn.com/business4/uploads/imagej/optimized/3X/c/6/c63dcbd538bdcad2568f9d00bb37459a1ecc37d1_2_690x388.png",
            "https://avatars.discourse-cdn.com/v4/letter/m/58956e/48.png",
            "https://avatars.discourse-cdn.com/v4/letter/m/58956e/48.png",
            "https://emoji.discourse-cdn.com/twitter/smiley.png?v=12",
            "https://avatars.discourse-cdn.com/v4/letter/m/58956e/48.png",
            "https://avatars.discourse-cdn.com/v4/letter/m/58956e/48.png",
            "https://emoji.discourse-cdn.com/twitter/crossed_fingers.png?v=12",
            "https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=12",
            "https://global.discourse-cdn.com/business4/uploads/imagej/optimized/3X/9/c/9c629ce868c15763092760cf06e95539cf8822b0_2_690x388.png",
            "https://avatars.discourse-cdn.com/v4/letter/m/58956e/48.png",
            "https://avatars.discourse-cdn.com/v4/letter/m/58956e/48.png",
            "https://global.discourse-cdn.com/business4/uploads/imagej/original/3X/c/a/ca9c7151b9c387ca51e32d9346ade8765554e67d.png"
        ],
        "movies": [],
        "keywords": [],
        "meta_keywords": [
            "ilastik"
        ],
        "tags": null,
        "authors": [
            "mfitzsimons (MaryLynn FitzSimons)",
            "k-dominik"
        ],
        "publish_date": "2021-06-23T13:38:20+00:00",
        "summary": "",
        "meta_description": "I have some very basic questions about training images for Pixel Classification in ilastik and then applying this training to larger datasets. \nI am analyzing phase contrast images from six time-lapse experiments of 145 &hellip;",
        "meta_lang": "en",
        "meta_favicon": "https://global.discourse-cdn.com/business4/uploads/imagej/optimized/2X/4/4b3d366e9bd1c4abfb68ca23f7596edd29cb2f4a_2_32x32.png",
        "meta_site_name": "Image.sc Forum",
        "canonical_link": "https://forum.image.sc/t/help-with-ilastik-pixel-training/54300",
        "text": "I have some very basic questions about training images for Pixel Classification in ilastik and then applying this training to larger datasets.\n\nI am analyzing phase contrast images from six time-lapse experiments of 145 images each.\n\nCurrently, my input files consist of two smaller .hdf5 files with 35 representative images, as well as a .tif file with all 145 images from a single experiment.\n\nI’ve done some training with the more inclusive .tif file. After adding the .tif file to the input data, the time required for live updates has increased from about 10 minutes to more than 40 minutes. My computer is a new Dell with 32 gb RAM and 10th generation i7 processor, so I should have the power I need.\n\nIf I remove the larger tif file from the input data, it appears that I also lose all the training I did with this dataset, so now it seems that I must choose between dealing with the long live updates or removing the .tif file and all the work that I have done with it. Is this correct? What is my best option to remedy this issue?\n\nI am also having problems trying to get the Batch Processing to work. Can I directly read in .tif files and should they be in a particular format? I initially attempted to convert my time series to .hdf5 files, however the conversion mixed up the time-series sequences….\n\nThanks so much!\n\nugh, yeah the performance hit with tif files is quite large. Recently we had a user reporting something similar on Github. There are some solutions to the slowness there, but first it would be important to find out whether it is really the file type that is slowing you down, or if you simply have to many labels (maybe reading this comment could be interesting for you).\n\nAs for your question, whether you lose all training data associated with that particular image when you remove it from the project file, the answer is yes. We only keep training data for images included in the project. Otherwise it would be impossible to “see” all training data, which would be lead to weird situations, where you can’t tell what you have trained on.\n\nFor the batch processing questions: Do you have the tif files as individual time points in individual files? I mean in any case you should be able to just add them in batch processing. Have you tried that? Did you get some sort of error? You will get a single file per tif file then as output.\n\nWhat version of ilastik are you using, by the way?\n\nHi Dominik,\n\nAgain, thank you so much for your help! I am on a tight deadline for this project, and my inexperience with image processing has been a real challenge.\n\nI found the earlier post that you referenced quite interesting. I had been advised that more training and annotation was better. Perhaps this is not necessarily the case…. At least to my eye, I’ve observed what almost seems to be a deterioration in the quality of segmentation after adding many hundreds of annotations relative to the initial maps based on fewer annotations. Is this possible?\n\nI’ve attached images to give you a better understanding of the data and my latest attempt at pixel classification. The first image shows a sheet of cells after scratching to produce an artificial “wound” and the second shows cells that have migrated into the gap 24 hours later. Cell junctions are frequently defined by the white outlines, although this is not true in all cases and is not necessarily consistent through the entire time-course. I used a huge brush for the “wound”, generally a 3 or 5 brush for the cell bodies, and a size 1 brush to define the cell junctions. I’ve done similar workups for a total of eight images. For reference, the individual images are 1920x1216; the version of ilastik I’m using 1.3.3post3.\n\nRight now, I’m fairly satisfied with the resulting segmentation and wonder if investing more time with the pixel classification would benefit the end result. Please let me know what you think.\n\nAbout the batch processing issue, I think that’s solved for now. I moved the files a shared umbrella folder with my .ilp file, and for some reason, ilastik seems to find them more easily. Right now, it’s processing the first 145 image sequence, so I’ve got my fingers crossed that the training has been enough.\n\nThank you again!\n\nMaryLynn\n\nHello @mfitzsimons,\n\nThis can be possible. One of the reasons might be, that, using many annotations, they could get less accurate. For the random forest to work properly - “wrong” examples are something you’d want to avoid. And I think it’s easier to introduce such examples with more annotations. Also training time gets to long, which goes against the concept of “instant” (more or less) feedback and correction.\n\nwooow, your images look so cool There does not seem to be any “leftover” visible after them growing back (to my totally un-trained and non-biologist eye). But yah, I’d say there are way to many annotations for background. This does not make the classifier more accurate (most likely) because those pixels in the background are very similar anyway. But it will increase the training time significantly.\n\nYou can always try the autocontex if you feel you want to improve your pixel classification result - but be warned, it consumes a lot of memory (and is sort of in general slower, as there are 2 cascaded pixel classification steps). With 2D images of the size you have there, you should still be fine.\n\nCheers\n\nDominik\n\nHi Dominik,\n\nYeah, the images are very cool, and you are right, the “wound” is completely “healed” in less than 24 hours. Watching the process evolve as a “movie” is addicting – for me at least!\n\nLast night I set the 145 image original .tif file up for batch processing. I neglected to input the export settings in “Prediction Export”, so the Probabilities were exported as an .hdf5 file. It is huge (by my standards) – 8.24 GB. It took more than an hour to generate.\n\nI tried to open the resulting .hdf5 with the Fiji plugin but got an error massage:\n\n“/exported_data: rank 4 of type float32 not supported (yet)\n\nIf it is of any help, the log reads: /exported_data (145x1216x1920x5 float32)\n\nSo then I tried batch processing the same file again, only this time, I modified the Export Image Settings in “Prediction Export”. I switched the Output file format to “tif sequence” and specified the Directory. The Description reads: 10 YXC images (Stacked across T) – which appears to refer to my training data file – but I moved forward anyway.\n\nIn Batch processing – I selected the same Raw Data file and hoped to see my target directory fill with a cascade of .tif files. Instead – I found two 8 byte .tif files (nickname _000 and nickname_002) that were generated within about 10 seconds of one another before the process appeared to stall. Obviously, there is nothing there when I attempted to open them in Fiji. I tried again to process a smaller file and got similar results. So – what am I missing here???\n\nFinally, a more conceptual question. Do I understand correctly that the optimal strategy for pixel classification is to make several annotations, check the effects with “Live Update”, correct ilastik’s “mistakes”, and iteratively repeat until there is not a perceivable improvement on the Prediction and Segmentation maps? I’ve attached an image of the Segmentation output for the first image in my time sequence. Is this this a decent result? There are definitely areas that need refining – but is this result reasonable? If I am more persistent – can I rise surmount this performance plateau to achieve a more optimal model? Or would it be better work with the Prediction maps in the current state with Fiji? I’m trying to get a better grasp on what I can and can’t realistically expect from ilastik.\n\nI’m also going to try the Autocontext, as you suggested. I think this cound be a game changer.\n\nAgain, many thanks for all your help!"
    }
}