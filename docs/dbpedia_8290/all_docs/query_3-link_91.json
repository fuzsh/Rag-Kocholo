{
    "id": "dbpedia_8290_3",
    "rank": 91,
    "data": {
        "url": "https://www.datavail.com/blog/perconas-clustercheck-script-for-mysql-galera/",
        "read_more_link": "",
        "language": "en",
        "title": "Percona’s Clustercheck Script for MySQL Galera",
        "top_image": "https://www.datavail.com/favicon-32x32.png",
        "meta_img": "https://www.datavail.com/favicon-32x32.png",
        "images": [
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/search.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/social/linkedin.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/social/twitter.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/social/facebook.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/social/youtube.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/datavail-logo.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/search.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/search.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/close.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/close.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/search.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/search.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/close.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/close.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/search.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/search.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/close.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/close.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/search.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/search.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/close.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/close.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/search.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/search.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/close.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/close.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/search.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/search.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/arrow-right.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/close.svg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/close.svg",
            "https://www.datavail.com/wp-content/uploads/2016/07/wes_lifford-4.jpg",
            "https://www.datavail.com/wp-content/uploads/2016/07/wes_lifford-4.jpg",
            "https://www.datavail.com/wp-content/themes/datavail/images/search-form/search.svg"
        ],
        "movies": [],
        "keywords": [],
        "meta_keywords": [
            ""
        ],
        "tags": null,
        "authors": [
            "Wesley Lifford"
        ],
        "publish_date": "2016-08-24T14:00:57+00:00",
        "summary": "",
        "meta_description": "Learn how to set up and use Percona's clustercheck script in a MySQL Galera Cluster.",
        "meta_lang": "en",
        "meta_favicon": "/apple-touch-icon.png",
        "meta_site_name": "",
        "canonical_link": "https://www.datavail.com/blog/perconas-clustercheck-script-for-mysql-galera/",
        "text": "Percona clustercheck script is a script distributed as part of the Percona XtraDB Cluster. It creates HAProxy to monitor Galera Cluster nodes and perform health checks on backend servers. The clustercheck shell script accepts HTTP requests and checks MySQL on incoming connections. If the Galera Cluster node is okay, it will give HTTP code 200 OK response; otherwise it gives 503 response implying that the service is unavailable, i.e. the node should not receive MySQL traffic.\n\nMost recently, Datavail released a whitepaper, Why Choose Galera-Based Clustering Solution for MySQL, which outlines the Galera Cluster’s initial configuration and default communication ports and discusses the relevance of Percona’s clustercheck script. This blog post goes into the nitty-gritty details of how to set up and use Percona’s clustercheck script in a MySQL Galera Cluster. (Percona clustercheck script can be downloaded from GitHub.)\n\nApplications of clustercheck script\n\nHAProxy configuration\n\nClustercheck script is configured with HAProxy to check for MySQL connectivity via HTTP on port 9200. This is the port number that’s commonly used but you are free to change it by editing the mysqlchk service script (explained further in the section “How to set up clustercheck script”).\n\nDisable node for maintenance\n\nYou can manually disable a node during maintenance when clustercheck is used in conjunction with a proxy server or load balancer, by using /var/tmp/clustercheck.disabled to force clustercheck to return a 503 error.\n\nHow to set up clustercheck script\n\nSetup with xinetd\n\nThe clustercheck script is set to listen on port 9200 using xinetd and report status of the nodes in the Galera Cluster. Here are the steps of the setup process:\n\nDownload the Percona script from GitHub, copy it to the/usr/local/bin or /usr/bin/ directory and make it executable by using the following commands:\n\n$ git clone https://github.com/olafz/percona-clustercheck $ cp percona-clustercheck/clustercheck /usr/bin $ chmod a+x /usr/bin/clustercheck\n\nDaemonize the script using xinetd as follows:\n\n(If not installed, install xinetd.)\n\nFor Centos\n\n# yum install –y xinetd\n\nFor Ubuntu\n\n# apt-get install xinetd\n\nCreate the following configuration file in /etc/xinet.d/ to configure the mysqlchk service:\n\n# vi /etc/xinet.d/mysqlchk\n\nEnter the text below:\n\n# default: on # description: mysqlchk service mysqlchk { disable = no flags = REUSE socket_type = stream port = 9200 wait = no user = nobody server = /usr/bin/clustercheck log_on_failure += USERID only_from = 0.0.0.0/0 per_source = UNLIMITED }\n\nAdd the mysqlchk service to /etc/services file as follows:\n\nxinetd 9098/tcp # ... mysqlchk 9200/tcp # MySQL check <--- Add this line git 9418/tcp # Git Version Control System\n\nNote: Ensure the ports 9200, 9098, 9418, and 3306 are open for clustercheck script, xinetd and mysqlchk service communication with nodes in the cluster.\n\nRestart xinetd:\n\n# service xinetd restart\n\nNow clustercheck script will listen on port 9200 and HAProxy is ready to check MySQL via HTTP. You can test this by running the command:\n\n$ telnet localhost 9200\n\nTrying 127.0.0.1…\n\nConnected to localhost.\n\nEscape character is ‘^]’.\n\nHTTP/1.1 200 OK\n\nContent-Type: text/plain\n\nConnection: close\n\nContent-Length: 40\n\nGalera Cluster Node is synced.\n\nConnection closed by\n\nThis means that the cluster is synced and the instance is ready to handle traffic.\n\nIn one of the nodes, create clustercheckuser that will be doing the checks\n\nLog into Galera Cluster:\n\n$ mysql –u username –p\n\nEnter the password in the prompt, then enter:\n\nmysql> GRANT PROCESS ON *.* TO 'clustercheckuser'@'localhost' IDENTIFIED BY 'clustercheckpassword!' mysql> FLUSH PRIVILEGES;\n\nThe MySQL Galera Cluster will replicate the statement to the other nodes.\n\nMake sure to change the clustercheckuser username and password in the clustercheck script to be the same as the ones created in the DDL statements above.\n\nSetup with Shell Return Values\n\nA different option from setting up with xinetd is executing clustercheck on commandline and checking the return value.\n\nDownload the Percona script from GitHub, copy it to the/usr/local/bin or /usr/bin/ directory and make it executable. Then create clustercheckuser which will be doing the checks.\n\nAfter that, run the clustercheck script as follows:\n\n# /usr/bin/clustercheck > /dev/null # echo $?\n\nFor a syncd node, the output will be “0” and for an un-synced node the output will be “1”. This return value can be used with server and network-monitoring tools like Zabbix.\n\nThis clustercheck script comes in handy when monitoring the health status of the nodes within MySQL Galera Cluster and setting up proxy load balancer configuration. It also helps when disabling a node for maintenance purpose.\n\nDatavail Script: Terms & Conditions\n\nBy using this software script (“Script”), you are agreeing to the following terms and condition, as a legally enforceable contract, with Datavail Corporation (“Datavail”). If you do not agree with these terms, do not download or otherwise use the Script. You (which includes any entity whom you represent or for whom you use the Script) and Datavail agree as follows:\n\n1. CONSIDERATION. As you are aware, you did not pay a fee to Datavail for the license to the Script. Consequently, your consideration for use of the Script is your agreement to these terms, including the various waivers, releases and limitations of your rights and Datavail’s liabilities, as setforth herein.\n\n2. LICENSE. Subject to the terms herein, the Script is provided to you as a non-exclusive, revocable license to use internally and not to transfer, sub-license, copy, or create derivative works from the Script, not to use the Script in a service bureau and not to disclose the Script to any third parties. No title or other ownership of the Script (or intellectual property rights therein) is assigned to you.\n\n3. USE AT YOUR OWN RISK; DISCLAIMER OF WARRANTIES. You agree that your use of the Script and any impacts on your software, databases, systems, networks or other property or services are solely and exclusively at your own risk. Datavail does not make any warranties, and hereby expressly disclaims any and all warranties, implied or express, including without limitation, the following: (1) performance of or results from the Script, (2) compatibility with any other software or hardware, (3) non-infringement or violation of third party’s intellectual property or other property rights, (4) fitness for a particular purpose, or (5) merchantability.\n\n4. LIMITATION ON LIABILITY; RELEASE. DATAVAIL SHALL HAVE NO, AND YOU WAIVE ANY, LIABILITY OR DAMAGES UNDER THIS AGREEMENT.\n\nYou hereby release Datavail from any claims, causes of action, losses, damages, costs and expenses resulting from your downloading or other use of the Script.\n\n5. AGREEMENT. These terms and conditions constitute your complete and exclusive legal agreement between you and Datavail."
    }
}