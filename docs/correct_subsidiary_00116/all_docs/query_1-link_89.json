{
    "id": "correct_subsidiary_00116_1",
    "rank": 89,
    "data": {
        "url": "https://community.cisco.com/t5/data-center-switches/air-gaped-nexus-9k-as-time-source/td-p/4135577",
        "read_more_link": "",
        "language": "en",
        "title": "Air-gaped Nexus 9k as time source",
        "top_image": "https://community.cisco.com/html/assets/ciscooglogo.png",
        "meta_img": "https://community.cisco.com/html/assets/ciscooglogo.png",
        "images": [
            "https://community.cisco.com/t5/image/serverpage/avatar-name/default_icon/avatar-theme/candy/avatar-collection/Cisco_Default/avatar-display-size/profile/version/2?xdesc=1.0",
            "https://community.cisco.com/html/@E1D9E5099E7D8FD73DECA4D3FF50F455/rank_icons/rank-1.png",
            "https://community.cisco.com/t5/image/serverpage/image-id/123738i4B920E11107CF585/image-dimensions/150x150/image-coordinates/19%2C0%2C427%2C408/constrain-image/false?v=v2",
            "https://community.cisco.com/html/@D17C385B8A505F8125C5E271F02ACC75/rank_icons/ciscologo-square_16x16.png",
            "https://community.cisco.com/t5/image/serverpage/avatar-name/default_icon/avatar-theme/candy/avatar-collection/Cisco_Default/avatar-display-size/profile/version/2?xdesc=1.0",
            "https://community.cisco.com/html/@E1D9E5099E7D8FD73DECA4D3FF50F455/rank_icons/rank-1.png",
            "https://community.cisco.com/t5/image/serverpage/image-id/123738i4B920E11107CF585/image-dimensions/150x150/image-coordinates/19%2C0%2C427%2C408/constrain-image/false?v=v2",
            "https://community.cisco.com/html/@D17C385B8A505F8125C5E271F02ACC75/rank_icons/ciscologo-square_16x16.png",
            "https://community.cisco.com/t5/image/serverpage/avatar-name/default_icon/avatar-theme/candy/avatar-collection/Cisco_Default/avatar-display-size/profile/version/2?xdesc=1.0",
            "https://community.cisco.com/html/@E1D9E5099E7D8FD73DECA4D3FF50F455/rank_icons/rank-1.png",
            "https://community.cisco.com/t5/image/serverpage/avatar-name/default_icon/avatar-theme/candy/avatar-collection/Cisco_Default/avatar-display-size/profile/version/2?xdesc=1.0",
            "https://community.cisco.com/html/@E1D9E5099E7D8FD73DECA4D3FF50F455/rank_icons/rank-1.png",
            "https://community.cisco.com/t5/image/serverpage/image-id/123738i4B920E11107CF585/image-dimensions/150x150/image-coordinates/19%2C0%2C427%2C408/constrain-image/false?v=v2",
            "https://community.cisco.com/html/@D17C385B8A505F8125C5E271F02ACC75/rank_icons/ciscologo-square_16x16.png",
            "https://community.cisco.com/t5/image/serverpage/avatar-name/default_icon/avatar-theme/candy/avatar-collection/Cisco_Default/avatar-display-size/profile/version/2?xdesc=1.0",
            "https://community.cisco.com/html/@E1D9E5099E7D8FD73DECA4D3FF50F455/rank_icons/rank-1.png",
            "https://community.cisco.com/t5/image/serverpage/image-id/123738i4B920E11107CF585/image-dimensions/150x150/image-coordinates/19%2C0%2C427%2C408/constrain-image/false?v=v2",
            "https://community.cisco.com/html/@D17C385B8A505F8125C5E271F02ACC75/rank_icons/ciscologo-square_16x16.png",
            "https://community.cisco.com/t5/image/serverpage/avatar-name/default_icon/avatar-theme/candy/avatar-collection/Cisco_Default/avatar-display-size/profile/version/2?xdesc=1.0",
            "https://community.cisco.com/html/@E1D9E5099E7D8FD73DECA4D3FF50F455/rank_icons/rank-1.png",
            "https://community.cisco.com/skins/images/3B1AF1ACA23DFBBEC6E3B30D9AAFE2B6/responsive_peak/images/icon_anonymous_message.png",
            "https://community.cisco.com/t5/image/serverpage/image-id/167294iA320F236232BD251/image-size/large?v=v2&px=999"
        ],
        "movies": [],
        "keywords": [],
        "meta_keywords": [
            ""
        ],
        "tags": null,
        "authors": [
            "community.cisco.com",
            "user-id"
        ],
        "publish_date": "2020-08-13T20:04:26.849000+00:00",
        "summary": "",
        "meta_description": "need some help understanding the configurations i need to make in an air gaped environment where we cannot have an external time source and must use our core switches. Currently core switch 1 and core switch 2 have been designated as ntp master 1.",
        "meta_lang": "en",
        "meta_favicon": "https://community.cisco.com/html/@D17C385B8A505F8125C5E271F02ACC75/rank_icons/ciscologo-square_16x16.png",
        "meta_site_name": "",
        "canonical_link": "https://community.cisco.com/t5/data-center-switches/air-gaped-nexus-9k-as-time-source/td-p/4135577",
        "text": "need some help understanding the configurations i need to make in an air gaped environment where we cannot have an external time source and must use our core switches. Currently core switch 1 and core switch 2 have been designated as ntp master 1. The access switches then reference core switch 1 and 2, which are set to ntp master 2.\n\nI have a few additional core switches and access switches remote site that point to the core switch 1 and core switch 2.\n\nbut two things have come up:\n\n1. I see falsetickers when doing show ntp association\n\n2. the time on the local switches where the access switch resides do not sync up with time there. It shows 15:28:00 instead.\n\nNot savvy with Nexus commands so this is currently what I have configured:\n\nCurrently my configuration on the nexus' are:\n\nntp server x.x.x.4 use-vrf default\n\nntp server x.x.x.3 use-vrf default\n\nntp source-interface VLAN10\n\nntp master 1\n\naccess switches:\n\nntp logging\n\nno ntp allow mode control 0\n\nntp master 2\n\nntp server x.x.x.4\n\nntp server x.x.x.3\n\nDo I need to change up my commands on both?\n\nHello!\n\nJust to clarify, Core-1 is x.x.x.3 and Core-2 is x.x.x.4 - correct? The configuration you provided uses x.x.x.3 and x.x.x.4, not x.x.x.4 and x.x.x.5. Just want to make sure we're both on the same page!\n\nI'm curious to see the output of show ntp peer-status from the Nexus core switches. It may be worth configuring them both to point to each other with ntp peer configuration as opposed to defining each other as servers. ntp peer configuration generally works better when you need to synchronize time between two clocks at the same stratum level.\n\nOnce we manage to get time correctly synchronized between both core switches, we can verify whether NTP associations on the access switches stabilize.\n\nThank you!\n\n-Christopher\n\nHello!\n\nThis output looks good to me. This indicates that each core switch is synchronizing with its local clock (which has an internal IP address of 127.127.1.0) and acting as an NTP master.\n\nAs I said before, you may want to consider swapping out the ntp server configuration on both core switches with ntp peer configuration instead. For example, let's say Core 1 owns x.x.x.4, and Core 2 owns x.x.x.5. I recommend changing your configuration to be as follows:\n\nCore-1# show running-config ntp\n\n<snip>\n\nntp peer x.x.x.5\n\nntp master 1\n\nCore-2# show running-config ntp\n\n<snip>\n\nntp peer x.x.x.4\n\nntp master 1\n\nOnce that's done, allow a bit of time for both core switches to synchronize time between themselves (you can usually expedite this process by manually setting the clock of both switches to be the same time at the exact same time through a terminal emulator [SecureCRT, PuTTY, etc.] that allows synchronous input to multiple devices). Then, see if your downstream Catalyst devices (which should be NTP stratum 2 clients of both core switches) successfully synchronize with one of the two core switches.\n\nNote that your downstream clients will only synchronize with one of the two core switches. That is expected behavior. However, I would not expect any of the clients to declare one of the core switches to be a falseticker - that indicates that some other significant source of time drift is being introduced between the two core switches.\n\nIf you see any odd NTP behavior after 1-2 days on your downstream Catalyst devices, please do share the output of show ntp associations from the relevant Catalyst devices.\n\nI hope this helps - thank you!\n\n-Christopher\n\nThank you for verifying.\n\nBut on the nexus there is a feature NTP. should that be turned on also? so that pretty much wraps up the stratum 1 devices.\n\nAnd in trying to setup the downstream..i'm a bit thrown off by the access switches output when I do a show ntp association it shows both ntp servers as x~x.x.x.4 and x~x.x.x.5. X being falseticker.\n\nDont know what that entails ?\n\naddress ref clock\n\nx~x.x.x.4 127.127.1.0\n\nx~x.x.x.5 127.127.1.0\n\nis that right? or something else to dive into?\n\nHello! Apologies for the delay in response.\n\nNX-OS does have a feature ntp command - however, it is enabled by default. There is no need to explicitly enable the NTP feature on Nexus switches - see output below from my lab demonstrating this.\n\nN9K# show running-config ntp !Command: show running-config ntp !Running configuration last done at: Fri Sep 4 18:02:25 2020 !Time: Mon Sep 7 13:29:43 2020 version 9.3(5) Bios:version 05.42 ntp server 192.0.2.20 use-vrf management ntp server 192.0.2.21 use-vrf management N9K# show running-config all | include feature.ntp feature ntp N9K#\n\nSince it has been a few weeks since your last post, can you confirm that the access switches still report both core switches as falsetickers? If so, can you confirm that the two core switches have a clock that is close to identical with each other by executing the show clock command on both switches at the same time and comparing timestamps?\n\nThank you!\n\n-Christopher"
    }
}