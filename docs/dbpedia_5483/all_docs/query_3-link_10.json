{
    "id": "dbpedia_5483_3",
    "rank": 10,
    "data": {
        "url": "https://groups.google.com/g/bareos-users/c/rTHbgntjVng",
        "read_more_link": "",
        "language": "en",
        "title": "Scratch pool and multiple catalogs. How can I deal with this",
        "top_image": "https://www.gstatic.com/images/branding/product/1x/groups_32dp.png",
        "meta_img": "https://www.gstatic.com/images/branding/product/1x/groups_32dp.png",
        "images": [
            "https://fonts.gstatic.com/s/i/productlogos/groups/v9/web-48dp/logo_groups_color_1x_web_48dp.png",
            "https://lh3.googleusercontent.com/a-/ALV-UjXy8TDbfCdmiJcFAYvg8hOco6gszn5uitKxrKAu8HW8sNNCu4zz=s40-c",
            "https://lh3.googleusercontent.com/a-/ALV-UjXy8TDbfCdmiJcFAYvg8hOco6gszn5uitKxrKAu8HW8sNNCu4zz=s40-c"
        ],
        "movies": [],
        "keywords": [],
        "meta_keywords": [
            ""
        ],
        "tags": null,
        "authors": [],
        "publish_date": null,
        "summary": "",
        "meta_description": "",
        "meta_lang": "en",
        "meta_favicon": "//www.gstatic.com/images/branding/product/1x/groups_32dp.png",
        "meta_site_name": "",
        "canonical_link": "https://groups.google.com/g/bareos-users/c/rTHbgntjVng",
        "text": "Hello.\n\nI have a doubt about the BareOS Scratch pool.\n\nAccording to manual, \"when Bareos needs a new Volume for writing and it cannot find one, it will look in the Scratch pool, and if it finds an available Volume, it will move it out of the Scratch pool into the Pool currently being used by the job\".\n\nSo far so good. I've tried it and it works perfectly for me.\n\nBut due to the large size that the catalog is taking (and the need to maintain the file list for many, many years), I decided to try a new configuration, in which I contain multiple catalogs instead of just one.\n\nThen, after a clean installation, and already configured about six different catalogs, with a few blank tapes in the autochanger, my first problem starts with the label barcode command.\n\nBareOS no longer only asks for the pool to send the new tapes to, but in addition to that, it requires you to indicate which catalog to use.\n\nI would have thought that since the Scratch pool is present in all the catalogs, BareOS would have some capacity to \"share\" that particular pool with all the catalogs. But then I see that this is not the case. Only one Scratch pool of a single catalog contains all the new volumes / tapes, and therefore, I can only use those tapes in that particular catalog.\n\nSo, how can I do to have all the tapes available, regardless of the catalog I'm using? It should be managed \"manually\", deciding which ones manually send tapes which Scratch pool which catalog?\n\nAnd since we are, how can I \"move\" a tape from a pool Scratch from one catalog to the Scratch pool from another catalog? (apparently, label and relabel are not useful for this purpose once they have been used with a particular catalog).\n\nIf anyone could help me with this, I would appreciate it a lot.\n\nRegards!\n\nReturning to this after a while, I answer to myself about how I solved this, and it remains as a reference for those who have been presented with the same concern.\n\nThe problem is how to handle this when you have multiple catalogs. Since you can not define a single Scratch pool for multiple catalogs (if you do not specify which catalog to use in the Scratch Pool definition, Bareos assigns one automatically). What I did was define a Scratch Pool for each catalog, and indicate explicitly, for each pool defined, which Scratch Pool should use.\n\nFor example; Assume that I have three catalogs defined: Catalog-A, Catalog-B and Catalog-C, as follows:\n\n============================================\n\n\"/etc/bareos/bareos-dir.d/catalog/Catalog-A\"\n\n============================================\n\nCatalog {\n\nName = \"Catalog-A\"\n\nDescription = \"First catalog: Catalog A\"\n\nDB Driver = postgresql\n\nDB Name = bareos_Catalog-A\n\nDB User = bareos\n\n# echo bareospassword | sha224sum\n\nDB Password = 1a58321bf4ec7a4da07e6e87d3b011149a61b9d7b6bf7d2434769bf1\n\n}\n\n============================================\n\n\"/etc/bareos/bareos-dir.d/catalog/Catalog-B\"\n\n============================================\n\nCatalog {\n\nName = \"Catalog-B\"\n\nDescription = \"Second catalog: Catalog B\"\n\nDB Driver = postgresql\n\nDB Name = bareos_Catalog-B\n\nDB User = bareos\n\n# echo bareospassword | sha224sum\n\nDB Password = 1a58321bf4ec7a4da07e6e87d3b011149a61b9d7b6bf7d2434769bf1\n\n}\n\n============================================\n\n\"/etc/bareos/bareos-dir.d/catalog/Catalog-C\"\n\n============================================\n\nCatalog {\n\nName = \"Catalog-C\"\n\nDescription = \"Third catalog: Catalog C\"\n\nDB Driver = postgresql\n\nDB Name = bareos_Catalog-C\n\nDB User = bareos\n\n# echo bareospassword | sha224sum\n\nDB Password = 1a58321bf4ec7a4da07e6e87d3b011149a61b9d7b6bf7d2434769bf1\n\n}\n\nThen, first define the Scratch Pool for each catalog, as follows:\n\n==========================================================\n\n\"/etc/bareos/bareos-dir.d/pool/Scratch for Catalog-A.conf\"\n\n==========================================================\n\nPool {\n\nName = \"Scratch for Catalog-A\"\n\nCatalog = Catalog-A\n\nPool Type = Scratch\n\n# I am using IBM cleaning cartridges, which come\n\n# with the barcode printed with the prefix CL\n\nCleaning Prefix = CL\n\n}\n\n==========================================================\n\n\"/etc/bareos/bareos-dir.d/pool/Scratch for Catalog-B.conf\"\n\n==========================================================\n\nPool {\n\nName = \"Scratch for Catalog-B\"\n\nCatalog = Catalog-B\n\nPool Type = Scratch\n\n# I am using IBM cleaning cartridges, which come\n\n# with the barcode printed with the prefix CL\n\nCleaning Prefix = CL\n\n}\n\n==========================================================\n\n\"/etc/bareos/bareos-dir.d/pool/Scratch for Catalog-C.conf\"\n\n==========================================================\n\nPool {\n\nName = \"Scratch for Catalog-C\"\n\nCatalog = Catalog-C\n\nPool Type = Scratch\n\n# I am using IBM cleaning cartridges, which come\n\n# with the barcode printed with the prefix CL\n\nCleaning Prefix = CL\n\n}\n\nSo now, with the Scratch Pools already defined, it only remains to specify what the Scratch Pool will be for each pool, as follows:\n\n===========================================================\n\n\"/etc/bareos/bareos-dir.d/pool/Some pool of Catalog-A.conf\"\n\n===========================================================\n\nPool {\n\nName = \"Some pool of Catalog-A\"\n\nDescription = \"A pool of tapes, using Catalog-A\"\n\nCatalog = Catalog-A\n\nPool Type = Backup\n\nStorage = Tape\n\nCleaning Prefix = CL\n\nMaximum Block Size = 524288\n\nCatalog Files = yes\n\nRecycle = yes\n\nScratch Pool = \"Scratch for Catalog-A\"\n\nRecycle Pool = \"Scratch for Catalog-A\"\n\nVolume Use Duration = 1 week\n\nVolume Retention = 1 week\n\nJob Retention = 1 week\n\nFile Retention = 1 week\n\n}\n\n==============================================================\n\n\"/etc/bareos/bareos-dir.d/pool/File pool using Catalog-B.conf\"\n\n==============================================================\n\nPool {\n\nName = \"File pool using Catalog-B\"\n\nDescription = \"A pool of backups on files, using Catalog-B\"\n\nCatalog = Catalog-B\n\nPool Type = Backup\n\nStorage = File\n\nCatalog Files = yes\n\nVolume Use Duration = 1 week 3 days\n\nVolume Retention = 1 week 3 days\n\nJob Retention = 1 week 3 days\n\nFile Retention = 1 week 3 days\n\nRecycle = yes\n\nScratch Pool = \"Scratch for Catalog-B\"\n\nRecycle Pool = \"Scratch for Catalog-B\"\n\n}\n\n====================================================================\n\n\"/etc/bareos/bareos-dir.d/pool/WORM-Like Tapes using Catalog-C.conf\"\n\n====================================================================\n\nPool {\n\nName = \"WORM-Like Tapes using Catalog-C\"\n\nDescription = \"Unique tape backups, forever, using Catalog-C\"\n\nCatalog = Catalog-C\n\nPool Type = Backup\n\nStorage = Tape\n\nCleaning Prefix = CL\n\nMaximum Block Size = 524288\n\nCatalog Files = yes\n\nVolume Use Duration = 100 years\n\nVolume Retention = 100 years\n\nJob Retention = 100 years\n\nFile Retention = 100 years\n\nMaximum Volume Jobs = 1\n\n# Here, the first thing that one would think about,\n\n# is that it does not make much sense to have a Scratch Pool\n\n# for a backup that will last 100 years, however, it\n\n# is convenient to send the newly pre-labeled tapes to the\n\n# Scratch Pool, so that when a job that will use this pool,\n\n# Bareos has where to look for the new tapes.\n\nScratch Pool = \"Scratch for Catalog-C\"\n\n#Recycle = yes\n\n#Recycle Pool = \"Scratch for Catalog-C\"\n\n}\n\nNow, for the tapes, from bconsole, you can label a series of tapes by sending them to the corresponding Scratch Pool for each catalog; for example:\n\nroot@bareos-test:~# bconsole\n\nConnecting to Director localhost:9101\n\n1000 OK: bareos-dir Version: 18.2.4rc1 (25 Sep 2018)\n\nSecure connection with cipher ECDHE-PSK-CHACHA20-POLY1305\n\nEnter a period to cancel a command.\n\n*label storage=Tape pool=\"Scratch of Catalog-A\" slots=1-6 barcodes\n\n*label storage=Tape pool=\"Scratch of Catalog-C\" slots=7-10,21 barcodes\n\n*q\n\nWith this I managed to solve my problem. Bareos searches for tapes in the Scratch Pool, and since a Scratch Pool was defined for each catalog, and it was made explicit for each pool of each catalog, which Scratch Pool corresponded, the problem was solved.\n\nRegards!"
    }
}