{
    "id": "dbpedia_8307_2",
    "rank": 90,
    "data": {
        "url": "https://learn.microsoft.com/en-us/azure/defender-for-cloud/quickstart-onboard-gcp",
        "read_more_link": "",
        "language": "en",
        "title": "Connect your GCP project - Microsoft Defender for Cloud",
        "top_image": "https://learn.microsoft.com/en-us/media/open-graph-image.png",
        "meta_img": "https://learn.microsoft.com/en-us/media/open-graph-image.png",
        "images": [
            "https://learn.microsoft.com/en-us/azure/defender-for-cloud/media/quickstart-onboard-gcp/gcp-account-in-overview.png",
            "https://learn.microsoft.com/en-us/azure/defender-for-cloud/media/quickstart-onboard-gcp/authentication-process.png",
            "https://learn.microsoft.com/en-us/azure/defender-for-cloud/media/quickstart-onboard-gcp/single-project-details.png",
            "https://learn.microsoft.com/en-us/azure/defender-for-cloud/media/quickstart-onboard-gcp/select-plans-gcp-project.png",
            "https://learn.microsoft.com/en-us/azure/defender-for-cloud/media/quickstart-onboard-gcp/add-gcp-project-configure-access.png",
            "https://learn.microsoft.com/en-us/azure/defender-for-cloud/media/quickstart-onboard-gcp/review-and-generate.png",
            "https://learn.microsoft.com/en-us/azure/defender-for-cloud/media/quickstart-onboard-gcp/organization-details.png",
            "https://learn.microsoft.com/en-us/azure/defender-for-cloud/media/quickstart-onboard-gcp/select-plans-gcp-project.png",
            "https://learn.microsoft.com/en-us/azure/defender-for-cloud/media/quickstart-onboard-gcp/configure-access-organization.png",
            "https://learn.microsoft.com/en-us/azure/defender-for-cloud/media/quickstart-onboard-gcp/review-and-generate-organization.png",
            "https://learn.microsoft.com/en-us/azure/defender-for-cloud/media/quickstart-onboard-gcp/toggle-plans-to-on.png",
            "https://learn.microsoft.com/en-us/azure/defender-for-cloud/media/quickstart-onboard-gcp/view-configuration.png",
            "https://learn.microsoft.com/en-us/azure/defender-for-cloud/media/quickstart-onboard-gcp/auto-provision-screen.png",
            "https://learn.microsoft.com/en-us/azure/defender-for-cloud/media/quickstart-onboard-gcp/auto-provision-databases-screen.png",
            "https://learn.microsoft.com/en-us/azure/defender-for-cloud/media/tutorial-enable-containers-gcp/containers-settings-gcp.png",
            "https://learn.microsoft.com/en-us/azure/defender-for-cloud/media/quickstart-onboard-gcp/view-configuration.png",
            "https://learn.microsoft.com/en-us/azure/defender-for-cloud/media/quickstart-onboard-gcp/cspm-configuration.png",
            "https://learn.microsoft.com/en-us/azure/defender-for-cloud/media/quickstart-onboard-gcp/gcp-resource-types-in-inventory.png"
        ],
        "movies": [],
        "keywords": [],
        "meta_keywords": [
            ""
        ],
        "tags": null,
        "authors": [],
        "publish_date": "2024-08-07T16:44:00+00:00",
        "summary": "",
        "meta_description": "Defend your GCP resources by using Microsoft Defender for Cloud. Protect your workloads and enhance your cloud security with our comprehensive solution.",
        "meta_lang": "en",
        "meta_favicon": "",
        "meta_site_name": "",
        "canonical_link": "https://learn.microsoft.com/en-us/azure/defender-for-cloud/quickstart-onboard-gcp",
        "text": "Connect your GCP project to Microsoft Defender for Cloud\n\nWorkloads commonly span multiple cloud platforms. Cloud security services must do the same. Microsoft Defender for Cloud helps protect workloads in Google Cloud Platform (GCP), but you need to set up the connection between them and Defender for Cloud.\n\nThis screenshot shows GCP accounts displayed in the Defender for Cloud overview dashboard.\n\nGCP authorization design\n\nThe authentication process between Microsoft Defender for Cloud and GCP is a federated authentication process.\n\nWhen you onboard to Defender for Cloud, the GCloud template is used to create the following resources as part of the authentication process:\n\nWorkload identity pool and providers\n\nService accounts and policy bindings\n\nThe authentication process works as follows:\n\nMicrosoft Defender for Cloud's CSPM service acquires a Microsoft Entra token. The token is signed by Microsoft Entra ID using the RS256 algorithm and is valid for 1 hour.\n\nThe Microsoft Entra token is exchanged with Google's STS token.\n\nGoogle STS validates the token with the workload identity provider. The Microsoft Entra token is sent to Google's STS that validates the token with the workload identity provider. Audience validation then occurs and the token is signed. A Google STS token is then returned to Defender for Cloud's CSPM service.\n\nDefender for Cloud's CSPM service uses the Google STS token to impersonate the service account. Defender for Cloud's CSPM receives service account credentials that are used to scan the project.\n\nPrerequisites\n\nTo complete the procedures in this article, you need:\n\nA Microsoft Azure subscription. If you don't have an Azure subscription, you can sign up for a free one.\n\nMicrosoft Defender for Cloud set up on your Azure subscription.\n\nAccess to a GCP project.\n\nContributor level permission for the relevant Azure subscription.\n\nYou can learn more about Defender for Cloud pricing on the pricing page.\n\nWhen you're connecting GCP projects to specific Azure subscriptions, consider the Google Cloud resource hierarchy and these guidelines:\n\nYou can connect your GCP projects to Microsoft Defender for Cloud at the project level.\n\nYou can connect multiple projects to one Azure subscription.\n\nYou can connect multiple projects to multiple Azure subscriptions.\n\nConnect your GCP project\n\nThere are four parts to the onboarding process that take place when you create the security connection between your GCP project and Microsoft Defender for Cloud.\n\nProject details\n\nIn the first section, you need to add the basic properties of the connection between your GCP project and Defender for Cloud.\n\nHere you name your connector, select a subscription and resource group, which is used to create an ARM template resource that is called security connector. The security connector represents a configuration resource that holds the projects settings.\n\nYou also select a location and add the organization ID for your project.\n\nYou can also set a scan interval between 1 to 24 hours.\n\nSome data collectors run with fixed scan intervals and are not affected by custom interval configurations. The following table shows the fixed scan intervals for each excluded data collector:\n\nData collector name Scan interval ComputeInstance\n\nArtifactRegistryRepositoryPolicy\n\nArtifactRegistryImage\n\nContainerCluster\n\nComputeInstanceGroup\n\nComputeZonalInstanceGroupInstance\n\nComputeRegionalInstanceGroupManager\n\nComputeZonalInstanceGroupManager\n\nComputeGlobalInstanceTemplate 1 hour\n\nWhen you onboard an organization, you can also choose to exclude project numbers and folder IDs.\n\nSelect plans for your project\n\nAfter entering your organization's details, you'll then be able to select which plans to enable.\n\nFrom here, you can decide which resources you want to protect based on the security value you want to receive.\n\nConfigure access for your project\n\nOnce you selected the plans, you want to enable and the resources you want to protect you have to configure access between Defender for Cloud and your GCP project.\n\nIn this step, you can find the GCloud script that needs to be run on the GCP project that is going to onboarded. The GCloud script is generated based on the plans you selected to onboard.\n\nThe GCloud script creates all of the required resources on your GCP environment so that Defender for Cloud can operate and provide the following security values:\n\nWorkload identity pool\n\nWorkload identity provider (per plan)\n\nService accounts\n\nProject level policy bindings (service account has access only to the specific project)\n\nReview and generate the connector for your project\n\nThe final step for onboarding is to review all of your selections and to create the connector.\n\nAfter you create the connector, a scan starts on your GCP environment. New recommendations appear in Defender for Cloud after up to 6 hours. If you enabled autoprovisioning, Azure Arc and any enabled extensions are installed automatically for each newly detected resource.\n\nConnect your GCP organization\n\nSimilar to onboarding a single project, When onboarding a GCP organization, Defender for Cloud creates a security connector for each project under the organization (unless specific projects were excluded).\n\nOrganization details\n\nIn the first section, you need to add the basic properties of the connection between your GCP organization and Defender for Cloud.\n\nHere you name your connector, select a subscription and resource group that is used to create an ARM template resource that is called security connector. The security connector represents a configuration resource that holds the projects settings.\n\nYou also select a location and add the organization ID for your project.\n\nWhen you onboard an organization, you can also choose to exclude project numbers and folder IDs.\n\nSelect plans for your organization\n\nAfter entering your organization's details, you'll then be able to select which plans to enable.\n\nFrom here, you can decide which resources you want to protect based on the security value you want to receive.\n\nConfigure access for your organization\n\nOnce you selected the plans, you want to enable and the resources you want to protect you have to configure access between Defender for Cloud and your GCP organization.\n\nWhen you onboard an organization, there's a section that includes management project details. Similar to other GCP projects, the organization is also considered a project and is utilized by Defender for Cloud to create all of the required resources needed to connect the organization to Defender for Cloud.\n\nIn the management project details section, you have the choice of:\n\nDedicating a management project for Defender for Cloud to include in the GCloud script.\n\nProvide the details of an already existing project to be used as the management project with Defender for Cloud.\n\nYou need to decide what is your best option for your organization's architecture. We recommend creating a dedicated project for Defender for Cloud.\n\nThe GCloud script is generated based on the plans you selected to onboard. The script creates all of the required resources on your GCP environment so that Defender for Cloud can operate and provide the following security benefits:\n\nWorkload identity pool\n\nWorkload identity provider for each plan\n\nCustom role to grant Defender for Cloud access to discover and get the project under the onboarded organization\n\nA service account for each plan\n\nA service account for the autoprovisioning service\n\nOrganization level policy bindings for each service account\n\nAPI enablements at the management project level\n\nSome of the APIs aren't in direct use with the management project. Instead the APIs authenticate through this project and use one of the APIs from another project. The API must be enabled on the management project.\n\nReview and generate the connector for your organization\n\nThe final step for onboarding is to review all of your selections and to create the connector.\n\nAfter you create the connector, a scan starts on your GCP environment. New recommendations appear in Defender for Cloud after up to 6 hours. If you enabled autoprovisioning, Azure Arc and any enabled extensions are installed automatically for each newly detected resource.\n\nOptional: Configure selected plans\n\nBy default, all plans are On. You can turn off plans that you don't need.\n\nConfigure the Defender for Servers plan\n\nMicrosoft Defender for Servers brings threat detection and advanced defenses to your GCP virtual machine (VM) instances. To have full visibility into Microsoft Defender for Servers security content, connect your GCP VM instances to Azure Arc. If you choose the Microsoft Defender for Servers plan, you need:\n\nMicrosoft Defender for Servers enabled on your subscription. Learn how to enable plans in Enable enhanced security features.\n\nAzure Arc for servers installed on your VM instances.\n\nWe recommend that you use the autoprovisioning process to install Azure Arc on your VM instances. Autoprovisioning is enabled by default in the onboarding process and requires Owner permissions on the subscription. The Azure Arc autoprovisioning process uses the OS Config agent on the GCP end. Learn more about the availability of the OS Config agent on GCP machines.\n\nThe Azure Arc autoprovisioning process uses the VM manager on GCP to enforce policies on your VMs through the OS Config agent. A VM that has an active OS Config agent incurs a cost according to GCP. To see how this cost might affect your account, refer to the GCP technical documentation.\n\nMicrosoft Defender for Servers doesn't install the OS Config agent to a VM that doesn't have it installed. However, Microsoft Defender for Servers enables communication between the OS Config agent and the OS Config service if the agent is already installed but not communicating with the service. This communication can change the OS Config agent from inactive to active and lead to more costs.\n\nAlternatively, you can manually connect your VM instances to Azure Arc for servers. Instances in projects with the Defender for Servers plan enabled that aren't connected to Azure Arc are surfaced by the recommendation GCP VM instances should be connected to Azure Arc. Select the Fix option in the recommendation to install Azure Arc on the selected machines.\n\nThe respective Azure Arc servers for GCP virtual machines that no longer exist (and the respective Azure Arc servers with a status of Disconnected or Expired) are removed after seven days. This process removes irrelevant Azure Arc entities to ensure that only Azure Arc servers related to existing instances are displayed.\n\nEnsure that you fulfill the network requirements for Azure Arc.\n\nEnable these other extensions on the Azure Arc-connected machines:\n\nMicrosoft Defender for Endpoint\n\nA vulnerability assessment solution (Microsoft Defender Vulnerability Management or Qualys)\n\nDefender for Servers assigns tags to your Azure Arc GCP resources to manage the autoprovisioning process. You must have these tags properly assigned to your resources so that Defender for Servers can manage your resources: Cloud, InstanceName, MDFCSecurityConnector, MachineId, ProjectId, and ProjectNumber.\n\nTo configure the Defender for Servers plan:\n\nFollow the steps to connect your GCP project.\n\nOn the Select plans tab, select Configure.\n\nOn the Auto-provisioning configuration pane, turn the toggles to On or Off, depending on your need.\n\nIf Azure Arc agent is Off, you need to follow the manual installation process mentioned earlier.\n\nSelect Save.\n\nContinue from step 8 of the Connect your GCP project instructions.\n\nConfigure the Defender for Databases plan\n\nTo have full visibility into Microsoft Defender for Databases security content, connect your GCP VM instances to Azure Arc.\n\nTo configure the Defender for Databases plan:\n\nFollow the steps to connect your GCP project.\n\nOn the Select plans tab, in Databases, select Settings.\n\nOn the Plan configuration pane, turn the toggles to On or Off, depending on your need.\n\nIf the toggle for Azure Arc is Off, you need to follow the manual installation process mentioned earlier.\n\nSelect Save.\n\nContinue from step 8 of the Connect your GCP project instructions.\n\nConfigure the Defender for Containers plan\n\nMicrosoft Defender for Containers brings threat detection and advanced defenses to your GCP Google Kubernetes Engine (GKE) Standard clusters. To get the full security value out of Defender for Containers and to fully protect GCP clusters, ensure that you meet the following requirements.\n\nKubernetes audit logs to Defender for Cloud: Enabled by default. This configuration is available at the GCP project level only. It provides agentless collection of the audit log data through GCP Cloud Logging to the Microsoft Defender for Cloud back end for further analysis. Defender for Containers requires control plane audit logs to provide runtime threat protection. To send Kubernetes audit logs to Microsoft Defender, toggle the setting to On.\n\nNote\n\nIf you disable this configuration, then the Threat detection (control plane) feature will be disabled. Learn more about features availability.\n\nAuto provision Defender's sensor for Azure Arc and Auto provision Azure Policy extension for Azure Arc: Enabled by default. You can install Azure Arc-enabled Kubernetes and its extensions on your GKE clusters in three ways:\n\nEnable Defender for Containers autoprovisioning at the project level, as explained in the instructions in this section. We recommend this method.\n\nUse Defender for Cloud recommendations for per-cluster installation. They appear on the Microsoft Defender for Cloud recommendations page. Learn how to deploy the solution to specific clusters.\n\nManually install Arc-enabled Kubernetes and extensions.\n\nAgentless discovery for Kubernetes provides API-based discovery of your Kubernetes clusters. To enable the Agentless discovery for Kubernetes feature, toggle the setting to On.\n\nThe Agentless Container Vulnerability Assessment provides vulnerability management for images stored in Google Container Registry (GCR) and Google Artifact Registry (GAR) and running images on your GKE clusters. To enable the Agentless Container Vulnerability Assessment feature, toggle the setting to On.\n\nTo configure the Defender for Containers plan:\n\nFollow the steps to connect your GCP project.\n\nOn the Select plans tab, select Configure. Then, on the Defender for Containers configuration pane, turn the toggles to On.\n\nSelect Save.\n\nContinue from step 8 of the Connect your GCP project instructions.\n\nConfigure the Defender CSPM plan\n\nIf you choose the Microsoft Defender CSPM plan, you need:\n\nA Microsoft Azure subscription. If you don't have an Azure subscription, you can sign up for a free subscription.\n\nYou must enable Microsoft Defender for Cloud on your Azure subscription.\n\nIn order to gain access to all of the features available from the CSPM plan, the plan must be enabled by the Subscription Owner.\n\nTo enable CIEM (Cloud Infrastructure Entitlement Management) capabilities, the Entra ID account used for the onboarding process must have either the Application Administrator or Cloud Application Administrator directory role for your tenant (or equivalent administrator rights to create app registrations). This requirement is only necessary during the onboarding process.\n\nLearn more about how to enable Defender CSPM.\n\nTo configure the Defender CSPM plan:\n\nFollow the steps to connect your GCP project.\n\nOn the Select plans tab, select Configure.\n\nOn the Plan configuration pane, turn the toggles to On or Off. To get the full value of Defender CSPM, we recommend that you turn all toggles to On.\n\nSelect Save.\n\nContinue from step 8 of the Connect your GCP project instructions.\n\nMonitor your GCP resources\n\nThe security recommendations page in Defender for Cloud displays your GCP resources together with your Azure and AWS resources for a true multicloud view.\n\nTo view all the active recommendations for your resources by resource type, use the asset inventory page in Defender for Cloud and filter to the GCP resource type that you're interested in.\n\nIntegrate with Microsoft Defender XDR\n\nWhen you enable Defender for Cloud, Defender for Cloud alerts are automatically integrated into the Microsoft Defender Portal. No further steps are needed.\n\nThe integration between Microsoft Defender for Cloud and Microsoft Defender XDR brings your cloud environments into Microsoft Defender XDR. With Defender for Cloud's alerts and cloud correlations integrated into Microsoft Defender XDR, SOC teams can now access all security information from a single interface.\n\nLearn more about Defender for Cloud's alerts in Microsoft Defender XDR.\n\nNext steps\n\nConnecting your GCP project is part of the multicloud experience available in Microsoft Defender for Cloud:"
    }
}