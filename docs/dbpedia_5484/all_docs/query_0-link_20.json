{
    "id": "dbpedia_5484_0",
    "rank": 20,
    "data": {
        "url": "https://veritas-bu.mailman.eng.auburn.narkive.com/RpHDfe32/moving-tapes-into-scratch-pool",
        "read_more_link": "",
        "language": "en",
        "title": "bu] Moving tapes into scratch pool",
        "top_image": "https://narkive.net/favicon.ico",
        "meta_img": "https://narkive.net/favicon.ico",
        "images": [],
        "movies": [],
        "keywords": [],
        "meta_keywords": [
            ""
        ],
        "tags": null,
        "authors": [],
        "publish_date": null,
        "summary": "",
        "meta_description": "",
        "meta_lang": "",
        "meta_favicon": "https://narkive.net/favicon.ico",
        "meta_site_name": "",
        "canonical_link": null,
        "text": "Donaldson, Mark\n\nVault is a good product but for light work you can do it yourself if you\n\nwant. I manage my offsite backups just through scripts. Here's a snip from\n\nan e-mail to somebody on this:\n\n1. Netbackup Vault - it's a product set that does just what you're talking\n\nabout. It's an add-on for v3.4 and included but disabled in v4.5. Pay $$\n\nto Veritas to make it work via a license key.\n\n2. Write it yourself. It turns out to be not to hard if you're a good\n\nscripter and if you think it out beforehand. I've written a couple of\n\nmodules:\n\na. Removable tape identification - which tapes to you want to remove?\n\nFor daily tape rotations (pulling full tapes & inserting blank tapes) I've\n\ngot a ruleset like this: 1-week since last written AND in library AND (full\n\nOR frozen OR suspended). It's written around vmquery output. The 1-week\n\nrule keeps the mostly-likely-to-be-requested tapes in the library so I don't\n\nhave to fetch removed ones too much. For offsites, I duplicate tapes to a\n\nspecific tape pool then simply eject all tapes in that pool.\n\nb. Injectable tape identificiation - which tapes are empty and available\n\nto be inserted into the library. My rules are: not-cleaning-tape AND\n\nout-of-library AND onsite (volume group) AND non-asssigned AND data-tape\n\n(status=0, ie: not catalog & not HSM). This one is also built around\n\nvmquery output.\n\nc. Define different volume groups for in-library, out-of-library, &\n\noffsite to help with these identificiations.\n\nd. Offsite processing - scripts which I run to track tapes that leave the\n\nbuilding to our offsite storage. There's a check-in/-out pair of scripts\n\nthat alter the entries in the volume database that actually track this\n\nstuff. Look at vmchange -new_v, -offsent, -offreturn, & -offloc (these are\n\ndifferent flags for v4.5 but analogous).\n\ne. If you're storing tapes out of the library, it's possible that there\n\nwill be a restore request that wants a tape not in the library. Unless you\n\nkeep the GUI up all the time, you'll not know. I have a cron-based script\n\nthat wakes up every 10 minutes and uses the \"vmoprcmd -d pr\" & \"vmoprcmd -d\n\nds\" command to watch for pending requests and pages when one comes in and\n\nalso pages when it's done with the tape.\n\nf. Rotation script - write a job for the ops staff, either cron or\n\nmanually run - that uses the ident removable & ident insertable routines\n\nabove to create a report. My version also auto-ejects the tapes to the\n\nmailslot for removal, then pages to have them swapped with injectable tapes.\n\nThere's another script that injects tapes from the mailslot back into the\n\nlibrary. vmchange can be used to eject tapes, vmupdate to inject them.\n\nI've marked a \"water-line\" of scratch tapes that I try to keep in the\n\nmachine. I never\n\nrotate out more tapes that what I need to keep enough spares.\n\n-----\n\nAs far as converting tapes back to the scratchpool, here's my script. It\n\nlooks up the scratchpool name & numbers so the only thing you should have to\n\ncustomize is the mail address:\n\n#!/bin/sh\n\n##auto_scratchpool\n\n## This script is used to identify all tapes which are available for\n\n## use (all expired images) but are not in the \"Scratch Pool\" and change\n\n## them to be in the Scratch pool. This should increase tape availability\n\n## for all Classes of backups.\n\n# Mark Donaldson - Nov 11, 1999 - Created\n\n# MDD 3/14/2001 - Remove need to have tape in robot to set back to\n\nScratchpool\n\n# Should be able to expire anywhere it is located. Will\n\ntrack\n\n# Offsite & Shelved stuff with Volume Groups.\n\n# MDD 8/27/2002 - Removed logging stuff and neatened the code a little\n\n# MDD 10/17/2002 - added logfile stuff\n\nPATH=$PATH:/usr/openv/volmgr/bin:/usr/openv/local\n\nexport PATH\n\nMAILADDR=\"***@YOURDOMAIN.COM\"\n\n# A little log file management\n\nLOG=/usr/openv/netbackup/logs/`basename $0`.log\n\n[ ! -f $LOG ] && touch $LOG\n\nKEEPLINES=1000\n\nif [ `wc -l $LOG | awk '{print $1}'` -gt `expr $KEEPLINES + 100` ]\n\nthen\n\ntail -n $KEEPLINES $LOG > $LOG.$$\n\nmv $LOG.$$ $LOG\n\nfi\n\n# Note: vmquery col 1 is tape number\n\n# col 3 is tape type\n\n# col 9 is slot number\n\n# col 12 is poolname\n\n# col 20 is \"assigned\" date\n\n# col 28 is status code (0=regular backups, 1=Catalog, 2=HSM)\n\n# Now lookup scratchpool pool number.\n\nSPname=`vmpool -listscratch | tail -1`\n\nSPnum=`vmpool -listall | \\\n\nawk -F: '$1==\"pool number\" {pn=$2}\n\n$1==\"pool name\" && $2~/^ *'$SPname'$/ {print pn}'`\n\n# Reset any empty but assigned tapes\n\necho \"Deassigning empty tapes\" >>$LOG\n\nbpexpdate -deassignempty -force >>$LOG 2>&1\n\ntapelist=`vmquery -a -w | awk '$3 !~ /CLN/ && \\\n\n$12 != \"'$SPname'\" && \\\n\n$20 ~ /^00\\/00\\/00/ && \\\n\n$28 == 0 {print $1}' `\n\necho \"\\n## Script run `date`.\" >>$LOG\n\nfor eachtape in $tapelist\n\ndo\n\n#Tape available for reassignment to scratchpool.\n\necho \"Changing $eachtape to pool $SPname\" >>$LOG\n\nvmchange -p $SPnum -m $eachtape >>$LOG 2>&1\n\ndone\n\nnumber=`vmquery -w -p $SPnum | awk 'BEGIN {sum=0} {if ( $9!~/-/ && NR>3)\n\n{sum++}} END {print sum}'`\n\necho \"There is $number scratch tapes in the library\" >>$LOG\n\nif [ $number -eq 0 ]\n\nthen\n\necho \"Warning, the library is out of scratch media. Please add more.\" | \\\n\nmailx -s \"Warning from `basename $0` on `hostname`\" $MAILADDR\n\nfi\n\nexit\n\n-----Original Message-----\n\nFrom: Timothy Arnold [mailto:***@becta.org.uk]\n\nSent: Friday, March 14, 2003 2:31 AM\n\nTo: veritas-***@mailman.eng.auburn.edu\n\nSubject: [Veritas-bu] Moving tapes into scratch pool\n\nHi,\n\n(Solaris 8, Netbackup 3.4.1.)\n\nI am working on creating scripts for our operators to move tapes in and out\n\nof the library. At present, when we reinventory the library, the tapes are\n\nput in to the pool they were taken from even though they have expired. How\n\ndo I automatically put them in the ScratchPool that I can defined? Is there\n\na vmupdate argument?\n\nAlso, what do people think of a) Netbackup 4.5 and b) BPVault. The new\n\nfinancial year is coming up and I propose that we upgrade to Netbackup V4.5\n\nand purchase BPVault for offsite duplication.\n\nThanks,\n\nTimothy.\n\n--\n\nTimothy Arnold, Systems Support Officer, Internet Services,\n\nBecta, Coventry, CV4 7JJ, UK Voice: +44 24 7684 7169\n\nemail: ***@becta.org.uk Fax: +44 24 7641 1418\n\n**********************************************************************\n\nThis email and any files transmitted with it are confidential and\n\nintended solely for the use of the individual or entity to whom they\n\nare addressed. If you have received this email in error please notify\n\nthe system manager.\n\nThis footnote also confirms that this email message has been swept by\n\nMIMEsweeper for the presence of computer viruses.\n\nwww.mimesweeper.com\n\n**********************************************************************\n\n_______________________________________________\n\nVeritas-bu maillist - Veritas-***@mailman.eng.auburn.edu\n\nhttp://mailman.eng.auburn.edu/mailman/listinfo/veritas-bu"
    }
}