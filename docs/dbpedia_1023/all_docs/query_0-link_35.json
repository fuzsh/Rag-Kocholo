{
    "id": "dbpedia_1023_0",
    "rank": 35,
    "data": {
        "url": "https://wiki.opensourceecology.org/wiki/Maltfield_Log/2018_Q3",
        "read_more_link": "",
        "language": "en",
        "title": "Maltfield Log/2018 Q3",
        "top_image": "",
        "meta_img": "",
        "images": [
            "https://mirrors.creativecommons.org/presskit/buttons/88x31/png/by-sa.png",
            "https://wiki.opensourceecology.org/resources/assets/poweredby_mediawiki_88x31.png"
        ],
        "movies": [],
        "keywords": [],
        "meta_keywords": [
            ""
        ],
        "tags": null,
        "authors": [],
        "publish_date": null,
        "summary": "",
        "meta_description": "",
        "meta_lang": "en",
        "meta_favicon": "/favicon.ico",
        "meta_site_name": "",
        "canonical_link": null,
        "text": "My work log from the year 2018 Quarter 3. I intentionally made this verbose to make future admin's work easier when troubleshooting. The more keywords, error messages, etc that are listed in this log, the more helpful it will be for the future OSE Sysadmin.\n\nSee Also\n\nMaltfield_Log\n\nUser:Maltfield\n\nSpecial:Contributions/Maltfield\n\nSat Sep 29, 2018\n\nXheni got back to me stating that they could not decrypt my message :( I sent back the message in plaintext, this time to xheni@phplist.com\n\nSam & Xheni commented on my bug to add links to an attribute name. I responded, asking where the escaping of the '<' is occurring, and if we could use the htmlentities() & html_entity_decode() functions https://mantis.phplist.org/view.php?id=19436\n\n...\n\nI spent some time reviewing our munin graphs. Looks good.\n\n...\n\nWhile it's still fresh on my mind, I created a wiki page on Discourse https://wiki.opensourceecology.org/wiki/Discourse\n\nConsidering my security concerns for Discourse, I was shocked to discover that whonix uses it as well. Looks like they switched from smfforum. The switch was first discussed in 2015 here https://forums.whonix.org/t/change-whonix-forum-software-to-discourse/1181/2\n\nI found some other users of Discourse https://www.discourse.org/customers\n\nubuntu https://discourse.ubuntu.com/\n\nI posted to the 3-year-old thread on the whonix forums, asking for their perspective on the security of self-hosting of Discourse https://forums.whonix.org/t/change-whonix-forum-software-to-discourse/1181/12\n\nI sent an email to Alex (cc'd Marcin) with a link to the article, asking him to add anything I may have missed.\n\n...\n\n# I added Extension:CookieWarning to the list of proposed extenisons to add to mediawiki https://wiki.opensourceecology.org/wiki/Mediawiki#Proposed\n\nI added \"Cookie Notice for GDPR\" to a new list of proposed wordpress plugins https://wiki.opensourceecology.org/wiki/Wordpress#Wordpress_Plugins\n\n...\n\nI logged into backblaze to see the status there\n\nIt _should_ have a subset of our backups (just /etc as we're still on the free version) demonstrating the retention policy = keeping a few day's back + the first of every month.\n\nTo my great dismay, there were no files in our bucket!\n\nThe logs reveal that the sudo (to de-escalate the backblaze upload binary `b2`) failed due to no tty being attached\n\n================================================================================ Beginning Backup Run on 20180928_072001 ... ================================================================================ Beginning Backup Run on 20180928_091810 /bin/tar: Removing leading `/' from member names real 0m0.926s user 0m0.915s sys 0m0.066s /bin/tar: Removing leading `/' from member names /root/backups/sync/daily_hetzner2_20180928_091810/etc/ /root/backups/sync/daily_hetzner2_20180928_091810/etc/etc.20180928_091810.tar.gz real 0m0.010s user 0m0.001s sys 0m0.009s real 0m0.496s user 0m0.483s sys 0m0.012s sudo: sorry, you must have a tty to run sudo real 0m0.006s user 0m0.000s sys 0m0.003s ================================================================================\n\nit looks like there's no benefit to configuring suo with requiretty. In fact, rhel claimed to have removed this in 2017 https://bugzilla.redhat.com/show_bug.cgi?id=1020147#c9\n\nI commented-out the \"Defaults requiretty\" line from /etc/sudoers\n\nI manually ran the backup2.sh script for testing the upload of our encrypted tarball subset backup of /etc/ to backblaze. It completed successfully.\n\nI refreshed the backbalaze wui, and I confirmed that the 11.3 MB file 'daily_hetzner2_20180929_230326.tar.gpg' was present.\n\nso this is good news in that I confirmed that old backup files apparently do get deleted by our retention policy\n\nbut this is bad news in that I have to wait another couple months to confirm that the retention policy actually works.\n\nas a reminder, the whole reason for the move to backblaze is that we're totally in violation of dreamhost's \"unlimited\" policy by storing our backups there. Earlier this year, they nicely threatened to delete all our account's data unless we did so ourselves. Then began the scramble to move everything to glacier. This occurred when we stored ~ >500G on our account.\n\na quick check shows that we're currently using 172G (and climbing). We have 13G of backups hetzner1 + 156G of backups from hetzner2\n\nhancock% date Sat Sep 29 16:10:06 PDT 2018 hancock% pwd /home/marcin_ose hancock% du -sh 172G . hancock% du -sh hetzner1 13G hetzner1 hancock% du -sh hetzner2 156G hetzner2 hancock% du -sh hetzner1/* 12G hetzner1/20180501-052002 259M hetzner1/20180502-052001 464M hetzner1/20180602-052001 464M hetzner1/20180702-052001 hancock% du -sh hetzner2/* 15G hetzner2/20180501-072001 15G hetzner2/20180601_072001 15G hetzner2/20180701_072001 16G hetzner2/20180801_072001 17G hetzner2/20180901_072001 17G hetzner2/20180925_072001 17G hetzner2/20180926_072001 17G hetzner2/20180927_072001 17G hetzner2/20180928_072001 17G hetzner2/20180929_072001 hancock%\n\nso at least we _do_ still have current backups, but that could be taken away from us. Backups are an extremely high priority. Hopefully in a couple weeks we can finish the switch to backblaze.\n\nI also checked the billing section to see if Marcin added our info. Looks like he didn't..\n\nI sent an email to Marcin asking when he would be able to add our billing info to the backblaze account.\n\n...\n\nI began to look into the possibility of using the phplist REST api to create a \"subscribe to our newsletter\" form on distinct websites, rather than sending users from, for example, www.opensourceecology.org to phplist.opensourceecology.org https://resources.phplist.com/plugin/restapi\n\nI am a bit concerned that the security review of the rest api applies only to the phplist4 version, and not the plugin linked above for the stable version of phplist = phplist 3 https://www.phplist.org/phplist-rest-api-security/\n\nFri Sep 28, 2018\n\nCatching up to some emails\n\nCatarina had an issue installing a plugin for the new microfactory site\n\nWe intentionally prevent wordpress from modifying any files that can execute as code (ie: dirs where php files live, which excludes only the 'wp-content/uploads' dir) via file permissions lacking \"write\" for the apache server's user--thereby rendering a large number of attacks futile\n\nI installed the \"duplicate page\" plugin for the microfactory site for Catarina\n\nI also included basic instructions on how to do it herself using filezilla or ssh as she has all necessary permissions to do so, including links to relevant documentation pages\n\nhttps://wiki.opensourceecology.org/wiki/Wordpress#Why.3F\n\nhttps://wiki.opensourceecology.org/wiki/Wordpress#Step_2:_Make_Vhost-specific_backups\n\nhttps://codex.wordpress.org/Managing_Plugins#Manual_Plugin_Installation\n\nhttps://wiki.opensourceecology.org/wiki/Wordpress#Proper_File.2FDirectory_Ownership_.26_Permissions\n\nMoreover, I offered to provide a training session on how to install a wp plugin\n\nMarcin asked if we should remove our billing info from hetzner just to prevent them from charging us the additional 53 days after we told them to cancel hetzner1. I reiterated that we probably want to just pay it & let it be, as the cost would be greater to have to migrate our production site (hetnzer2) off hetzner entirely--especially in the long run. Hetzner, for all their faults, is still our best option imo\n\nCatarina had an issue accessing a URL on the wiki, getting \"This site can't be reached\" in Chrome 67 and \"Secure Connection Failed\" in Firefox\n\nThe issue was when trying to access http://opensourceecology.org/wiki/File:OSE_identity_guidelines_-_logo_color_applications_v1-1.svg#\n\nThe above link *should* redirect to https://wiki.opensourceecology.org/wiki/File:OSE_identity_guidelines_-_logo_color_applications_v1-1.svg\n\nI confirmed that the redirect worked in my firefox browser and in curl\n\nI responded that I couldn't reproduce, but I went ahead and fixed the wiki in question, making external links to files on the wiki relative links using the actual file syntax https://wiki.opensourceecology.org/index.php?title=Jean-Baptiste_Log_-_2014&type=revision&diff=178519&oldid=149888\n\nMarcin asked about Discourse as a possible forum platform\n\nInterestingly, I had just looked into Discourse last week, as it was what phplist uses\n\nI told Marcin my $0.02 about how I really, really liked DIscourse from a user perspective, but the big negatives are:\n\nThey run on Ruby, and can only be installed via docker containers--they openly admit to how hard it would be to install otherwise\n\nThey intentionally don't support older devices. for example, they only support IE 11+, which means that some fabricator with an old windows xp desktop in their machine shop wouldn't be able to access the discussions. I generally don't like that, and we should seriously consider if that's how we want to align..\n\nMarcin encountered a 403 when attempting to embed an eventzilla html snippet\n\nURL & content is\n\nhttps://wiki.opensourceecology.org/index.php?title=Atchison_Public_Library_Flyer&action=submit\n\n<html><div id=\"eventzilla-iframe\"></div><script type='text/javascript'>window.onload = function() {var iframe = document.createElement('iframe');iframe.id=\"ifeventzilla\";iframe.style.width = \"100%\";iframe.style.height = \"100%\";iframe.frameBorder=\"0\";iframe.src = \"https://www.eventzilla.net/web/event_embedd.aspx?eventid=2138715782\";var evntzilladiv=document.getElementById('eventzilla-iframe');evntzilladiv.appendChild(iframe);};</script></html>\n\nI whitelisted 958413, XSS\n\nMarcin got back to me about the privacy policy. He said he's in favor of a single/monolithic PP for all our sites. Therefore, I'll begin to add newsletter-specific stuff to our wiki PP for phplist. Then I'll just link to our wiki PP from phplist.\n\nunfortunately, it looks like I _can't_ put a link in the checkbox where the user accepts our PP/ToS. I asked about this last week, but still got no response https://discuss.phplist.org/t/link-to-tos-in-attribute/4428\n\nI created a bug report on phplist's mantis. I marked it as urgent since gdpr _is_ urgent--and I can't imagine it would fly to ask people to consent to a document that we don't even provide to them! https://mantis.phplist.org/view.php?id=19436\n\n...\n\nSam Tuke got back to me about my request to edit the phplist maual\n\nHe asked for clairification, noting that I could register for the wiki here: https://resources.phplist.com/start?do=register\n\nAnd that the manual is a static site in a private Git repo.\n\nI asked him for access to the private git repo, and I registered for the wiki.\n\nYes, I would greatly appreciate access to the private Git repo so I can contribute to the manual. Specifically, I’d like to add a section to the “Troubleshooting Techniques” page describing the error_reporting() function. * https://discuss.phplist.org/t/troubleshooting-techniques-manual-chapter-feedback-and-discussion/234 Thank you!\n\nso this is complicated. it appears that there's 3x places for documentation of the phplist project:\n\ndeveloper documentation https://www.phplist.org/development/\n\nwiki documentation https://resources.phplist.com/documentation/start\n\nin the wiki, I found a great list of all the possible config file variables https://resources.phplist.com/system/config/all\n\nalso, it looks like there's a method to attach a logo file, rather than linking it (so that mail clients blocking hyperlinked images still see the logo) https://resources.phplist.com/system/logo\n\nfound a short doc describing how to setup the cli (may be useful to process the queue in a cron) https://resources.phplist.com/system/commandline\n\ninterestingly, I found a guide to block access to the phplist admin pages using an apache rewrite rule. There's no info on how to bypass it for the _real_ admin, though https://resources.phplist.com/admin_pages_access_control\n\nand the manual https://www.phplist.org/manual/\n\n...\n\nI began to sketch a draft guide to hardening a phplist install\n\nI also sent an email to Xheni (a sec-focused dev at phplist) asking if she has any input on what the guide should include, specifically any of the numerous config.php options https://resources.phplist.com/system/config/all\n\nTue Sep 18, 2018\n\nSam Tuke asked me to sign their Contributor License Agreement for my contribution to the phplist project https://github.com/phpList/phplist3/pull/403#issuecomment-422599653\n\nI reviewed the CLI. It says that I waive my copyrights so that the project can copyleft them under the AGPL. Sounds good to me. I \"signed it\" via the link, requiring a read-only oauth link to my github.com account https://phplist.com/cla\n\nI checked again on the statistics of my test campaign. It now shows 2x unique opens from michael@opensourceecology.org & phplist@opensourceecology.org. Indeed, I opened it from both of those. Interesting, it also shows a timestamp for each time it was opened. I have like 20 opens for my personal account, and phplist opened it once.\n\nOur phplist install's attributes are empty. There are some silly default attributes. I clicked on the \"predefined defaults\" button. The one mentioned on the GDPR page of the manual is probably the one labeled \"Terms of Service\". I enabled that attribute. https://www.phplist.org/manual/ch048_gdpr.xhtml\n\nthat added a required checkbox stating \"I agree to the terms of service of phplist.opensourceecology.org\" to the subscriber page https://phplist.opensourceecology.org/lists/?p=subscribe\n\nfound a meta ticket in phplist's manits for gdpr changes https://mantis.phplist.org/view.php?id=19032\n\nI tested an attempt to subscribe without checking the box. In my browser, I got what looked like a JS alert() stating \"The following field is required: I agree to the therms of service of phplist.opensourceecology.org\"\n\nI also tested it in links (text-only cli browser) to ensure it didn't require JS. Indeed, submitting failed. The page re-loaded with the same error message at the top of the form.\n\nwhen I checked the box, it went through.\n\nI went to check the subscribers list, and I found the attribute titled \"I agree to the terms of service of phplist.opensourceecology.org\". Unfortunately, the value for this attribute was just a (checked) checkbox. According to GDPR, it should be a timestamp.\n\nugh, I tried to make the text actually link to our Privacy Policy, but apparently attributes can't include html? It just strips it out\n\nI started a thread on discuss.phplist.org about this issue and the suggested workaround https://discuss.phplist.org/t/link-to-tos-in-attribute/4428/2\n\nsomehwhat unrelated, but the forum/mailing list/longform chat solution that phplist uses at discuss.phplist.org runs on discourse. It's pretty nice, except that it's a ruby app. Anyway, as we're currently forum-less, I added a link to it as an alternative to our Vanilla Forums install https://wiki.opensourceecology.org/wiki/OSE_Forum\n\nuy, it only installs via docker too. And is not very backwards-compatible. Probably requires JS too. Hard sell. https://github.com/discourse/discourse/blob/master/docs/INSTALL.md\n\nbad, bad bad install instruction!!!! https://github.com/discourse/discourse/blob/master/docs/INSTALL-cloud.md\n\nwget -qO- https://get.docker.com/ | sh\n\nI found a couple more guides on how to integrate the subscriber page into your site:\n\nhttps://www.phplist.com/knowledgebase/website-integration/\n\nhttps://wharfedalefestival.co.uk/dr/index.php/phplist-menu/124-phplist-how-to-include-a-custom-subscribe-form\n\nso it looks like we have 2x options. We could extract some header & footer html content from our sites, import them into phplist, and just redirect people to there for subscribing. Or we could just drop the forms pointed to the subscription page on phplist. I see faults & maintenance issues in both. Hmm.\n\nMon Sep 17, 2018\n\nour statuscake monthly report came in. We have 100% uptime for 2 months in-a-row. I don't think we've ever hit that before. Most downtimes were caused by hetzner, and they've been less of an issue since we migrated to hetnzer2\n\nSam Tuke accepted my changes for better error handling of the random_compat error into the master branch of phplist :) https://github.com/phpList/phplist3/commit/779b90cd0c9fd4d6d12531eeec7b1b1d45e36ee1\n\nI moved our phplist config from port 4443 to port 443 by changing the nginx & varnish configs.\n\nI updated the phplist campaign template, removing the \":4443\" from the images\n\nI sent the campaign test again, and the images showed up fine in gmail this time!\n\nnow I test the old email, and the images load on there now as well. I guess the facebook just ignores ports in their image proxy thing. Anyway, I guess we'll just have to use 443 here. I _really_ want 2FA, though.\n\nthe default phplist footer is basically illegible due to the font on the background color.\n\nI checked that our \"unsubscribe\" link and the footer's \"opt-out completely\" link are identical\n\nI checked that our \"Update preferences\" and \"Edit your subscription\" links match the footer's \"preferences page\" link\n\nI checked that our \"Forward\" link and the footer's \"forward page\" links match. They didn't!\n\nthe footer uses [FORWARDURL]\n\n-- <div class=\"footer\" style=\"text-align:left; font-size: 75%;\"> <p>This message was sent to [EMAIL] by [FROMEMAIL]</p> <p>To forward this message, please do not use the forward button of your email application, because this message was made specifically for you only. Instead use the <a href=\"[FORWARDURL]\">forward page</a> in our newsletter system.<br/> To change your details and to choose which lists to be subscribed to, visit your personal <a href=\"[PREFERENCESURL]\">preferences page</a><br/> Or you can <a href=\"[UNSUBSCRIBEURL]\">opt-out completely</a> from all future mailings.</p> </div>\n\nI confirmed that my template also uses \"[FORWARDURL]\". Hmm.\n\nah, interesting, there's a link on the image and a link on the text. I have to update both to be \"[FORWARDURL]\".\n\nalso interesting, the proper link sends me to a 404. on our site anyway https://phplist.opensourceecology.org/lists/?p=forward&mid=4&uid=43d035a41d2d893d21255158de6f9831\n\nfurther digging found that the forward link will 404 when sending a test email rather than actually sending out the campaign https://discuss.phplist.org/t/forward-and-profile-links-stopped-working/1323\n\nI decided to leave the footer as a nice plaintext paragraph with all the essential info for users without html.\n\nI modified it a bit; first I changed the color to be white\n\nto make changes to the footer, I had to whitelist modsec false-positives:\n\n960915, protocol violation\n\n200003, Multipart parser detected a possible unmatched boundary.\n\nI went through the Config -> Settings configs (in the DB), and made some changes as needed\n\nchanged \"Person in charge of this system (one email address)\" from phplist@opensourceecology.org to \"privacy@opensourceecology.org\"\n\nit looks like the entry for 4443 isn't there anymore since I reinitialized the db last week\n\nI went to add marcin & Catarina as subscribers to our test list, but I got a 403 after clicking \"Subscribers\" -> \"Add a new subscriber\"\n\nwhitelisted 981172, sqli\n\nI noticed that our subscriber list has no attributes. For example, we don't have a field to store the first name, last name, \"how you found out about us?\", interests, etc. We didn't have name info before, so I'll leave it at just the email for now. We should decide if we want to collect this or not later,\n\nI manually changed the \"Is this subscriber confirmed (1/0)\" from 0 to 1 for Marcin & Catarina.\n\nI sent a test campaign to the 'test' list, which is myself, Catarina, and Marcin.\n\nI'm not getting forwarded the emails from phplist@opensourceecology.org\n\nI confirmed that Marcin & I are both in the drop-down menu, but \"disable forwarding\" is selected in the gmail for phplist@opensourceecology.org\n\nI added the filters to forward mail for size > 0 to both myself & Marcin (2x rules)\n\nI pulled up the statistics. It still shows 0 opens, even though I opened it. hmm. I guess that's being blocked by the gmail proxy?\n\nI verified that the forward link works now\n\ninterestingly, I discovered that phplist.com straight-up 403 Forbids requests to _their_ admin section https://www.phplist.com/lists/admin/\n\nI'm getting closer and closer to the need to write a GDPR-compliant Privacy Policy for phplist\n\nthere's still some technical changes I need to make to phplist, but I may as well keep the ball rolling on this\n\nI responded to an old email Marcin sent me about my first attempt to prepare a Privacy Policy = the one for our wiki https://wiki.opensourceecology.org/wiki/Open_Source_Ecology:Privacy_policy\n\nMarcin had asked me why we mention storing anonymous editor's IP addresses when we don't permit anonymous edits. I told him I left it in intentionally as it's the default functionality of mediawiki, and I wanted to cover all bases. Indeed, when we migrated the site earlier this year, we discovered after some time that anonymous edits were enabled by accident. Better to have it in the policy IMO.\n\nMarcin asked if we could add some section stating that OSE would not automatically send our users' info to a 3rd party State upon subpoena without first investigating the legitimacy of the request and resisting if at all possible. WMF's current policy had a great wording with this intent, so I added a section on it here https://wiki.opensourceecology.org/wiki/Open_Source_Ecology:Privacy_policy#For_Legal_Reasons\n\nMoreover, I asked Marcin if we intended to have (a) a single monolithic PP for all our sites or if we wanted to maintain distinct, site-specific PPs. I voted for a single PP. If he says a single PP, then I guess the next step is to try to hack at the above wiki PP and make it apply to phplist newsletters. It already has the GDPR user information request/rectify/removal/etc bits, so we'd just have to add a section about \"by agreeing to this privacy policy, you are consenting for us to send you information that we believe you have a legitimate interest in receiving\" etc\n\n...\n\nI'm still pretty concerned about the overall sec of phplist. Simply gaining access to Marcin's email (or anyone who's an admin on phplist) would permit them to change their password on phplist, login, and steal our DB containing PII on our subscribers. The fix is to use 2FA, but phplist doesn't support it yet\n\nI logged into the g suite admin to check the \"password strength\" bar and length of Marcin's password. His \"password strength\" bar is at its max, and the length is reasonably long. That's good, at least.\n\n..\n\nI was clicking around the phplist interface to see what/how we can make it \"fit\" in with our OSE sites. Sadly, I discovered some intentional information leakage of the phplist version in connect.php https://github.com/phpList/phplist3/blob/e1c88d6dd2834c878a392f091f9444ee99f1cc65/public_html/lists/admin/connect.php#L283-L288\n\nI created an issue on the phplist manits about this https://mantis.phplist.org/view.php?id=19419\n\nhopefully they respond positively, and I'll just submit a PR with the version removed from the bottom.\n\nSat Sep 15, 2018\n\nsamtuke (ceo at phplist) asked me to create a pull request for better error handling to catch the random_compat issue I documented on my blog https://discuss.phplist.org/t/common-installation-errors-manual-chapter-feedback-and-discussion/217/3\n\nI did so https://github.com/phpList/phplist3/pull/403\n\nI sent a distinct message to samtuke asking what would be required to gain write permissions to their documentation so I could contribute. For example, adding a hardening guide.\n\nI added my email address to the 'test' subscriber list\n\nI went to setup the campaign template based on my superficial html hacks of the old template from earlier via \"Campaigns\" > \"Manage campaign templates\"\n\nI simply edited the existing html file, adding the [CONTENT] place-holder so phplist knows where to put the body of the message that the editor of the campaign types\n\nI sent a test campaign, but I had to fix a few modsecurity false-positives:\n\n950911, general attack\n\n981231, sqli\n\n981248, sqli\n\n981245, sqli\n\n973338, xss\n\n973304, xss\n\n973306, xss\n\n973333, xss\n\n973344, xss\n\nit went out, but the template was absent! wtf?\n\nI went back to teh \"Manage campaign templates\" page and made the one I uploaded earlier the \"CAMPAIGN DEFAULT\".\n\nI went to send another campaign. This time on the second step (tab 2 = Format) I noticed a \"Use template\" drop-down menu. Now the \"ose_201809\" template is selected by default.\n\nFinally, this one came in. It looks like shit in thunderbird w/ plaintext of course, but I can at least see the outline of the images by their alt texts.\n\nI opened it in google. This looks better-ish. The background colors are all there, but the images are all broken.\n\nlooks like the ose logo points to 'http://./osemail.20180910b_files/logo-splash.145356.145846.png' that's not going to work.\n\nso now we have the choice of attaching these images to the email (expensive & \"good\") vs linking them to our website. Linking them means tracking & analytics.\n\nI did some searches on the ethics of tracking pixels. These are ubiquitously used by spammers, white & black hat hackers, and hopefully-good-intentioned email newsletter authors to collect data on their subscribers. I'm torn.\n\nhttps://www.cyberscoop.com/pixel-tracking-hacking-check-point/\n\ngoogle has a guide to tracking users with an image over email https://developers.google.com/analytics/devguides/collection/protocol/v1/email\n\nspeaking of tracking, I need to fucking remove all these facebook & twitter beacons from the template\n\nto properly upload images, I need to figure out these ideal permissions\n\naccording to config_extended.php, UPLOADIMAGES_DIR is '/uploadimages/'\n\n[root@hetzner2 phplist.opensourceecology.org]# grep -ir 'UPLOADIMAGES_DIR' * public_html/lists/config/config_extended.php:define('UPLOADIMAGES_DIR', 'uploadimages'); public_html/lists/config/config_extended.php://define(\"UPLOADIMAGES_DIR\",\"images/newsletter/uploaded\"); public_html/lists/admin/fckphplist.php: $imgdir = $_SERVER['DOCUMENT_ROOT'].'/'.UPLOADIMAGES_DIR.'/'; public_html/lists/admin/fckphplist.php: if (defined('UPLOADIMAGES_DIR')) { public_html/lists/admin/fckphplist.php: $imgdir = $_SERVER['DOCUMENT_ROOT'].'/'.UPLOADIMAGES_DIR.'/'; public_html/lists/admin/fckphplist.php: +'<?php echo $GLOBALS['pageroot'].'/'.UPLOADIMAGES_DIR.'/' ?>' public_html/lists/admin/init.php:if (!defined('UPLOADIMAGES_DIR')) { public_html/lists/admin/init.php: define('UPLOADIMAGES_DIR', 'images'); public_html/lists/admin/plugins/fckphplist/config.php: if (defined('UPLOADIMAGES_DIR')) { public_html/lists/admin/plugins/fckphplist/config.php: $imgdir = $_SERVER['DOCUMENT_ROOT'].'/'.UPLOADIMAGES_DIR.'/'; public_html/lists/admin/plugins/fckphplist/config.php:FCKConfig.ImagePath = document.location.protocol + '//' + document.location.host +'<?php echo $GLOBALS[\"pageroot\"].'/'.UPLOADIMAGES_DIR.'/'?>' public_html/lists/admin/plugins/fckphplist/fckeditor/editor/filemanager/connectors/phplist/config.php:if (!defined('FCKIMAGES_DIR') && !defined('UPLOADIMAGES_DIR')) { public_html/lists/admin/plugins/fckphplist/fckeditor/editor/filemanager/connectors/phplist/config.php:} elseif (defined('UPLOADIMAGES_DIR')) { public_html/lists/admin/plugins/fckphplist/fckeditor/editor/filemanager/connectors/phplist/config.php: $imgdir = $_SERVER['DOCUMENT_ROOT'].'/'.UPLOADIMAGES_DIR.'/'; public_html/lists/admin/plugins/fckphplist/fckeditor/editor/filemanager/connectors/phplist/config.php: $Config['UserFilesPath'] = '/'.UPLOADIMAGES_DIR.'/' ; public_html/lists/admin/plugins/CKEditorPlugin.php: 'uploadURL' => sprintf('%s://%s/%s', $public_scheme, $website, ltrim(UPLOADIMAGES_DIR, '/')), public_html/lists/admin/plugins/CKEditorPlugin.php: $kcUploadDir = rtrim($_SERVER['DOCUMENT_ROOT'], '/') . '/' . trim(UPLOADIMAGES_DIR, '/'); public_html/lists/admin/plugins/CKEditorPlugin.php: $this->kcEnabled = defined('UPLOADIMAGES_DIR') && UPLOADIMAGES_DIR !== false; public_html/lists/admin/sendemaillib.php: if (defined('UPLOADIMAGES_DIR') && UPLOADIMAGES_DIR) { public_html/lists/admin/sendemaillib.php: $dir = str_replace('/', '\\/', UPLOADIMAGES_DIR); public_html/lists/admin/sendemaillib.php: '<img\\\\1src=\"'.$GLOBALS['public_scheme'].'://'.$baseurl.'/'.UPLOADIMAGES_DIR.'\\\\2>', public_html/lists/admin/class.phplistmailer.php: if (defined('UPLOADIMAGES_DIR')) { public_html/lists/admin/class.phplistmailer.php: is_file($_SERVER['DOCUMENT_ROOT'].'/'.UPLOADIMAGES_DIR.'/image/'.$localfile) public_html/lists/admin/class.phplistmailer.php: || is_file($_SERVER['DOCUMENT_ROOT'].'/'.UPLOADIMAGES_DIR.'/'.$localfile) public_html/lists/admin/class.phplistmailer.php: if (defined('UPLOADIMAGES_DIR')) { public_html/lists/admin/class.phplistmailer.php: } elseif (is_file($_SERVER['DOCUMENT_ROOT'].'/'.UPLOADIMAGES_DIR.'/image/'.$localfile)) { public_html/lists/admin/class.phplistmailer.php: SaveConfig('uploadimageroot', $_SERVER['DOCUMENT_ROOT'].'/'.UPLOADIMAGES_DIR.'/image/', 0, 1); public_html/lists/admin/class.phplistmailer.php: return base64_encode(file_get_contents($_SERVER['DOCUMENT_ROOT'].'/'.UPLOADIMAGES_DIR.'/image/'.$localfile)); public_html/lists/admin/class.phplistmailer.php: } elseif (is_file($_SERVER['DOCUMENT_ROOT'].'/'.UPLOADIMAGES_DIR.'/'.$localfile)) { public_html/lists/admin/class.phplistmailer.php: SaveConfig('uploadimageroot', $_SERVER['DOCUMENT_ROOT'].'/'.UPLOADIMAGES_DIR.'/', 0, 1); public_html/lists/admin/class.phplistmailer.php: return base64_encode(file_get_contents($_SERVER['DOCUMENT_ROOT'].'/'.UPLOADIMAGES_DIR.'/'.$localfile)); [root@hetzner2 phplist.opensourceecology.org]#\n\nbut when I was uploading the template, I got an error for a different image directory\n\nImage browsing is not available because directory \"/var/www/html/phplist.opensourceecology.org/public_html/images\" does not exist or is not writeable. How to resolve this problem.\n\nI went ahead and explicitly set the image directory to be \"public_html/images\"\n\nI determined the following hardened permissions to be ideal & documented it on the wiki https://wiki.opensourceecology.org/wiki/Phplist#Proper_File.2FDirectory_Ownership_.26_Permissions\n\nvhostDir=\"/var/www/html/phplist.opensourceecology.org\" chown -R not-apache:apache \"${vhostDir}\" find \"${vhostDir}\" -type d -exec chmod 0050 {} \\; find \"${vhostDir}\" -type f -exec chmod 0040 {} \\; chown not-apache:apache-admins \"${vhostDir}/config.php\" chmod 0040 \"${vhostDir}/config.php\" [ -d \"${vhostDir}/public_html/uploadimages\" ] || mkdir \"${vhostDir}/public_html/uploadimages\" chown -R apache:apache \"${vhostDir}/public_html/uploadimages\" find \"${vhostDir}/public_html/uploadimages\" -exec chmod 0660 {} \\; chmod 0770 \"${vhostDir}/public_html/uploadimages\"\n\nI uploaded the 'logo-splash.145356.145846.png' to /var/www/html/phplist.opensourceecology.org/public_html/uploadimages/osemail_header_logo_2002.png' https://phplist.opensourceecology.org:4443/uploadimages/osemail_header_logo_2012.png\n\nI changed the \"Edit your subscription\" link in the template to be the proper phplist placeholder = [PREFERENCESURL] https://www.phplist.org/manual/ch023_advanced-templating.xhtml\n\nI also did this for the unsubscribe link using [UNSUBSCRIBEURL]\n\nI removed the jquery script include. It's bad enough that this shit is html, but I do support the idea of showing pictures of our latest tractor, extreme build, etc. There's no fucking reason for JS in an email.\n\nI went through and removed all the external links, replacing them with the text 'url_scrubbed'\n\nI replaced the URL for the \"Web Version\" to \"TODO\" we'll need to test the plugin for this purpose & test it also should discuss with Marcin about this whole concept. It would enable \"liking\" the newsletter, but maybe we should just write a blog post corresponding with every newsletter and use _that_ instead? It's more complicated for the newsletter author, but it makes much more sense. Anyway, marking as TODO.\n\nI replaced the links for \"like\" & \"tweet\" with TODO as well\n\nI uploaded the twitter icon to our uploadimages dir https://phplist.opensourceecology.org:4443/uploadimages/tweet-glyph.png\n\nI uploaded the fb \"like\" icon to our uploadimages dir https://phplist.opensourceecology.org:4443/uploadimages/like-glyph.png\n\nI uploaded the \"forward to a friend\" icon to our uploadimages dir https://phplist.opensourceecology.org:4443/uploadimages/forward-glyph.png\n\nI re-uploaded the template\n\nI whitelisted a modsec rule = 981257, sqli\n\n981240, sqli\n\n981243, sqli\n\n973336, xss\n\n958057, xss\n\n958006, xss\n\n958049, xss\n\n958051, xss\n\n958056, xss\n\n958011, xss\n\n958039, xss\n\n973301, xss\n\n973302, xss\n\n973308, xss\n\n973314, xss\n\n973331, xss\n\n973315, xss\n\n973330, xss\n\n973327, xss\n\n973322, xss\n\n973348, xss\n\n973321, xss\n\n973335, xss\n\n973334, xss\n\n973347, xss\n\n973332, xss\n\n973316, xss\n\n200004, ??\n\nI sent a new campaign from the updated template.\n\nIn gmail the images still didn't load! I confirmed that the link is correct\n\nI went into thunderbird, enabled images to be displayed, and it looked fine. wtf is wrong with gmail?\n\nfor some reason, the only image that came through was the phplist logo in the footer. hmm..\n\nso gmail doesn't link directly to the image, they do this weird proxy thing:\n\nhttps://ci5.googleusercontent.com/proxy/8FAbvJAr13AzwPxJEDR-C_risW8WqPu7HeTBehW-NCln6Q3T7ekiEaXGs4plOPY-GA5scZUuZTmr9UtjfeH3nrjcLqa5lKme6xbtiTOFnl3irYSLCdEpOL47Xjg=s0-d-e1-ft#https://phplist.opensourceecology.org:4443/uploadimages/like-glyph.png\n\nhttps://gm1.ggpht.com/glxzSZgoelvUDXXjs6QRjgij8TlMu5IxKnVTlRi9BYKiqG5sxEdv0XN0JDWvWWmYakbfetcYvO-qCJL0Ezs6z-5d_lqPBl-DZFScrNDYGNznQu6V6UufGvLJmYt_M8OCGTQ6Tr96c3jB6fb0qrO9m2Xwsw7TaoZhy17M4tBnA4mtpplttr_VnyHcBLn69v02dK9fjlm7sRBYvluvZ9iMIBu7UoGECpeB316AObRBj_RPq4es5ymtxYZIumcCMCfJXwMCaxKHh-5osXoMSPtvCXMe0_r7OP6k8p_Ww6MxB9rDYdUMIVoJI-Tl7aur4mplEiCa_dmvuv0m4pSpd8FFezSlNGvpS1KMOCJ8pW8KWRY_hHaHt4XjQcIjtwORU9Gq0KM2Dquw4adqLol52kwX6vYViavMHa86pf2jAvBnGUKtlpk-Zt_6d2zMn3A-Uq22uRmTX-q2UEC34M-QvRfB46_OTJyKSZ5u3J02mvaA_1WP75z-GQwxIm3NMgbuCCQv5OCijZg15V09H5FTL98bzOF86KjmC972e61T8-o7zHIQZgZuE7FB7EkiMWSNYOFUWvjHdvf08MoAreqRNduQO91aWwRr4V6BF0bTzAkXm89jygL4EITSmvWxbd-kpGSDmje6IQdxGobcLXC5-wJOViUuArD62fYyWoo5f1LykmKrTFoq63QFnxzbxTknv_0bh9QOZQndgxK8IYRI=s0-l75-ft-l75-ft\n\nit's possible that the proxy thing just doesn't work with the 4443 port. I may just have to change back to 443. I wish none of this had to be public. Another option is to put the images in a distinct domain? I should probably just use 443.\n\nUpdated the osemail newsletter html template stored on the wiki https://wiki.opensourceecology.org/wiki/File:OSEmail_phplist.tar.gz\n\nThr Sep 13, 2018\n\nI logged into the phpadmin site for the first time in a while. I used the username 'admin'.\n\nI don't think there's a max password length per my paranoia earlier this week. Actually. I think the issue was that I was trying to login with the email address (michael@opensourceecology.org), but I should have used the \"Login Name\" = 'admin'\n\nI started poking around at the settings in the phplist wui, and I found that there's now a *lot* of email addresses set to \"michael@opensourceecology.org\". I should probably change all of this to 'phplist@opensourceecology.org' to forward to me and marcin\n\nI checked out the plugins section. True, the default install was shipped with a few plugins, but they're not all enabled by default. Per default:\n\ncaptcha plugin is installed, but disabled\n\nCKEeditor plugin is installed & enabled\n\nCommonPlugin is installed, but disabled\n\nfckphplist is installed, but disabled\n\ninviteplugin is installed, but disabled\n\nSegmentPlugin is installed, but disabled\n\nsubjectLinePlaceholdersPlugin is installed, but disabled\n\nI really want to do a fresh install to change the admin to user = phplist@opensourceecology.org, but I found a button under \"System\" -> \"Initialize the database\" -> \"Force Initialization (will erase all data!)\".\n\nI pressed this button. It brought up a blank page. Concerning..\n\nI cliked around on the UI, but was told that I've been logged out. I just went to \"/lists/admin/\", and I was prompted with a form to \"Initialize the Database\".\n\nThis time, I entered both \"my name\" and the \"organization name\" as 'Open Source Ecology'. I used the email address 'phplist@opensourceecology.org'\n\nI created\n\nMon Sep 12, 2018\n\nreading through the \"security\" section of the extended config file, I found that--by default--anyone can update another users's info by re-subscribing with the existing email address. Not sure if this is an issue for GDPR or not, but there is a setting to disable this \"functionality\" https://mantis.phplist.org/view.php?id=15557\n\nso I think the actual password verification occurs in public_html/lists/admin/phpListAdminAuthentication.php\n\nSun Sep 11, 2018\n\nI couldn't login to phplist using my password stored in keepass. I reset it, but I still couldn't login. This probably means that the password I'm storing in keepass is too long because phplist is cutting it off at some max length.\n\nyikes, I just discovered that phplist was storing the admin password in plaintext in 2012. They claimed to have \"fixed it\" by storing an md5() of the password in 2.11.7, despite outcrys that they should be using ShA or bcrypt https://forums.phplist.com/viewtopic.php?t=38265\n\nI searched through all the documentation to find how they store the password, but it's not mentioned anywhere.\n\nI found this stub of a README on their security in their code base https://github.com/phpList/phplist3/blob/master/doc/README.security\n\nI found this bug, which claims it was fixed in 2.11.0, but it doesn't mention how it was fixed. I don't think we'd consider md5 hashes of the admin password to gain access to all our subscriber's PII sufficiently secure https://mantis.phplist.org/view.php?id=12822\n\nit looks like 2.11.0 was released on 2005-03-08 https://mantis.phplist.org/changelog_page.php\n\nunfortunately the changelogs only go back to 2011-11 https://mantis.phplist.org/plugin.php?page=Source/list&id=29&offset=109\n\nI began digging throught the sourcecode, and I discovered that many plugins are already installed. I guess they just get packaged with phplist's main release\n\n[root@hetzner2 phplist.opensourceecology.org]# ls -lah public_html/lists/admin/plugins total 136K d---r-x--- 8 not-apache apache 4.0K May 15 21:41 . d---r-x--- 16 not-apache apache 4.0K Aug 23 01:54 .. d---r-x--- 2 not-apache apache 4.0K May 15 21:40 CaptchaPlugin ----r----- 1 not-apache apache 8.0K May 15 21:40 CaptchaPlugin.php d---r-x--- 3 not-apache apache 4.0K May 15 21:41 CKEditorPlugin ----r----- 1 not-apache apache 15K May 15 21:41 CKEditorPlugin.php d---r-x--- 3 not-apache apache 4.0K May 15 21:40 Common d---r-x--- 7 not-apache apache 4.0K May 15 21:40 CommonPlugin ----r----- 1 not-apache apache 3.8K May 15 21:40 CommonPlugin.php ----r----- 1 not-apache apache 35K May 15 21:41 COPYING.txt d---r-x--- 3 not-apache apache 4.0K May 15 21:40 fckphplist ----r----- 1 not-apache apache 2.8K May 15 21:40 fckphplist.php ----r----- 1 not-apache apache 462 May 15 21:40 .htaccess ----r----- 1 not-apache apache 3.9K May 15 21:41 inviteplugin.php d---r-x--- 3 not-apache apache 4.0K May 15 21:41 SegmentPlugin ----r----- 1 not-apache apache 19K May 15 21:41 SegmentPlugin.php ----r----- 1 not-apache apache 5.3K May 15 21:41 subjectLinePlaceholdersPlugin.php [root@hetzner2 phplist.opensourceecology.org]#\n\nlooks like the default is still md5\n\n[root@hetzner2 phplist.opensourceecology.org]# grep -C 5 'ENCRYPTION_ALGO' public_html/lists/admin/init.php if (ASKFORPASSWORD && defined('ENCRYPTPASSWORD') && ENCRYPTPASSWORD) { #https:mantis.phplist.com/view.php?id=16787 // passwords are encrypted, so we need to stick to md5 to keep working //# we also need some \"update\" mechanism to handle an algo change if (!defined('ENCRYPTION_ALGO')) { define('ENCRYPTION_ALGO', 'md5'); } } if (ASKFORPASSWORD && !defined('ENCRYPTPASSWORD')) { //# we now always encrypt define('ENCRYPTPASSWORD', 1); } if (!defined('ENCRYPTPASSWORD')) { //# old method to encrypt, used to be with md5, keep like this for backward compat. if (!defined('ENCRYPTION_ALGO')) { define('ENCRYPTION_ALGO', 'md5'); } // define(\"ENCRYPTPASSWORD\",0); } if (!defined('ENCRYPTION_ALGO')) { if (function_exists('hash_algos') && in_array('sha256', hash_algos())) { define('ENCRYPTION_ALGO', 'sha256'); } else { define('ENCRYPTION_ALGO', 'md5'); } } if (!defined('HASH_ALGO')) { // keep previous hashalg. @@TODO force an update of hash method, many may still be on md5. if (defined('ENCRYPTION_ALGO')) { define('HASH_ALGO', ENCRYPTION_ALGO); } elseif (function_exists('hash_algos') && in_array('sha256', hash_algos())) { define('HASH_ALGO', 'sha256'); } else { define('HASH_ALGO', 'md5'); } [root@hetzner2 phplist.opensourceecology.org]#\n\nLooks like we already set the hash algo to sha256 for passwords in config.php\n\n[root@hetzner2 phplist.opensourceecology.org]# grep -C3 'HASH_ALGO' config.php // choose the hash method for password // check the extended config for more info // in most cases, it is fine to leave this as it is define('HASH_ALGO', 'sha256'); [root@hetzner2 phplist.opensourceecology.org]#\n\nI also found a command that showed all possible hash algorithms\n\n[root@hetzner2 phplist.opensourceecology.org]# grep -B10 'HASH_ALGO' public_html/lists/config/config_extended.php // if you use passwords, they will be stored hashed // set this one to the algorythm to use. You can find out which ones are // supported by your system with the command // $ php -r \"var_dump(hash_algos());\"; // \"sha256\" is fairly common on the latest systems, but if your system is very old (not a good idea) // you may want to set it to \"sha1\" or \"md5\" // if you use encrypted passwords, users can only request you as an administrator to // reset the password. They will not be able to request the password from // the system // if you change this, you may have to use the \"Forgot password\" system to get back in your installation define('HASH_ALGO', 'sha256'); [root@hetzner2 phplist.opensourceecology.org]#\n\nAnd here's our options\n\n[maltfield@hetzner2 ~]$ php -r \"var_dump(hash_algos());\"; Command line code:1: array(46) { [0] => string(3) \"md2\" [1] => string(3) \"md4\" [2] => string(3) \"md5\" [3] => string(4) \"sha1\" [4] => string(6) \"sha224\" [5] => string(6) \"sha256\" [6] => string(6) \"sha384\" [7] => string(6) \"sha512\" [8] => string(9) \"ripemd128\" [9] => string(9) \"ripemd160\" [10] => string(9) \"ripemd256\" [11] => string(9) \"ripemd320\" [12] => string(9) \"whirlpool\" [13] => string(10) \"tiger128,3\" [14] => string(10) \"tiger160,3\" [15] => string(10) \"tiger192,3\" [16] => string(10) \"tiger128,4\" [17] => string(10) \"tiger160,4\" [18] => string(10) \"tiger192,4\" [19] => string(6) \"snefru\" [20] => string(9) \"snefru256\" [21] => string(4) \"gost\" [22] => string(11) \"gost-crypto\" [23] => string(7) \"adler32\" [24] => string(5) \"crc32\" [25] => string(6) \"crc32b\" [26] => string(6) \"fnv132\" [27] => string(7) \"fnv1a32\" [28] => string(6) \"fnv164\" [29] => string(7) \"fnv1a64\" [30] => string(5) \"joaat\" [31] => string(10) \"haval128,3\" [32] => string(10) \"haval160,3\" [33] => string(10) \"haval192,3\" [34] => string(10) \"haval224,3\" [35] => string(10) \"haval256,3\" [36] => string(10) \"haval128,4\" [37] => string(10) \"haval160,4\" [38] => string(10) \"haval192,4\" [39] => string(10) \"haval224,4\" [40] => string(10) \"haval256,4\" [41] => string(10) \"haval128,5\" [42] => string(10) \"haval160,5\" [43] => string(10) \"haval192,5\" [44] => string(10) \"haval224,5\" [45] => string(10) \"haval256,5\" } [maltfield@hetzner2 ~]$\n\nOn the positive, they do have a CHECK_SESSIONIP that makes sure the IP address doesn't change mid-session. That's generally good for stealing a session cookie, though I certainly change IPs mid-session a lot due to VPN.\n\n// to increase security the session of a user is checked for the IP address // this needs to be the same for every request. This may not work with // network situations where you connect via multiple proxies, so you can // switch off the checking by setting this to 0 define('CHECK_SESSIONIP', 1);\n\nSat Sep 10, 2018\n\nI didn't hear back from Marcin from my email asking him if reducing the 2-column OSEmail template down to 1-column.\n\nI began tweaking the html of this file. I uploaded the old & current versions to the wiki. Note that the wiki prevents uploading html files (for good reason), so I first compressed them into a .tar.gz for the upload. It's just a 1-file tar \"bomb\" to mask the mime type & contents.\n\nI uploaded the original here https://wiki.opensourceecology.org/wiki/File:OSEmail_5.0.tar.gz\n\nI uploaded the new template here https://wiki.opensourceecology.org/wiki/File:OSEmail_phplist.tar.gz\n\nso the existing osemail template includes a facebook \"like\" button, which doesn't really make sense unless we make the html content of the message publicly hosted somewhere\n\nwe could link to 'https://www.facebook.com/plugins/like.php?href=http://www.facebook.com/yourpagename' as a general \"like our page\" link https://stackoverflow.com/questions/9111354/how-to-add-a-facebook-like-button-to-email\n\nI guess we could do the same thing for the twitter\n\nso the way mailchimp does this is by creating a browser-based archive copy of the campaign, which is then likeable https://mailchimp.com/help/add-a-like-button-to-a-link-in-a-campaign/\n\nok, it looks like what we want is this \"view in browser\" plugin for phplist https://resources.phplist.com/plugin/viewinbrowser\n\nSat Sep 08, 2018\n\nI reproduced the error that Catarina got when attempting to update the microfactory site using the tatsu editor in the wordpress dashboard\n\nthe error came from apache. nginx accepted it and varnish passed it to apache. Then apache, finally, rejected the call to 'wp-adnin/admin-ajax.php' with a 413 error because the file data length exceeded 131072.\n\n==> microfactory.opensourceecology.org/error_log <== [Sat Sep 08 17:51:47.093354 2018] [:error] [pid 18400] [client 127.0.0.1] ModSecurity: Request body no files data length is larger than the configured limit (131072).. Deny with code (413) [hostname \"microfactory.opensourceecology.org\"] [uri \"/wp-admin/admin-ajax.php\"] [unique_id \"W5QMM@d1Eam-vw5aGKHpRQAAAAE\"] ==> microfactory.opensourceecology.org/access_log <== 127.0.0.1 - - [08/Sep/2018:17:51:47 +0000] \"POST /wp-admin/admin-ajax.php HTTP/1.0\" 413 352 \"https://microfactory.opensourceecology.org/wp-admin/admin-ajax.php\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.82 Safari/537.36 OPR/39.0.2256.43\"\n\nthe source of this error is /etc/httpd/mod_security.conf\n\n[root@hetzner2 httpd]# grep -irl '131072' * conf.d/mod_security.conf logs/microfactory.opensourceecology.org/error_log logs/microfactory.opensourceecology.org/error_log-20180907 logs/modsec_audit.log [root@hetzner2 httpd]#\n\nthe relevant section from that config file is:\n\n<IfModule mod_security2.c> # ModSecurity Core Rules Set configuration IncludeOptional modsecurity.d/*.conf IncludeOptional modsecurity.d/activated_rules/*.conf # Default recommended configuration SecRuleEngine On SecRequestBodyAccess On SecRule REQUEST_HEADERS:Content-Type \"text/xml\" \\ \"id:'200000',phase:1,t:none,t:lowercase,pass,nolog,ctl:requestBodyProcessor=XML\" SecRequestBodyLimit 13107200 SecRequestBodyNoFilesLimit 131072 SecRequestBodyInMemoryLimit 131072 SecRequestBodyLimitAction Reject ...\n\nI also checked the mosecurity log, and found this\n\n[root@hetzner2 httpd]# tail -f /var/log/httpd/modsec_audit.log --e0cf6203-A-- [08/Sep/2018:18:00:19 +0000] W5QOM4DjLizX-0PH1C4iSQAAAAw 127.0.0.1 58464 127.0.0.1 8000 --e0cf6203-B-- POST /wp-admin/admin-ajax.php HTTP/1.0 X-Real-IP: 155.254.31.28 X-Forwarded-Proto: https X-Forwarded-Port: 443 Host: microfactory.opensourceecology.org Content-Length: 169317 User-Agent: Mozilla/5.0 (X11; FreeBSD amd64; rv:48.0) Gecko/20100101 Firefox/48.0 Accept: */* Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate, br Content-Type: application/x-www-form-urlencoded; charset=UTF-8 X-WP-Nonce: 6019e82b06 X-Requested-With: XMLHttpRequest Referer: https://microfactory.opensourceecology.org/wp-admin/admin-ajax.php Cookie: wordpress_sec_8983be88aab2a9bb71a8df7c9f7251b6=maltfield%7C1536598694%7CSPF6aXvZhhNnPXcg6tp828xXUxc3tE2CeLCalwJ1JO8%7Cbd0bf9738572e47267dc4158ad07c0ba8ac788a2e5bf784b1dd028 623a7f15cc; wordpress_test_cookie=WP+Cookie+check; wordpress_logged_in_8983be88aab2a9bb71a8df7c9f7251b6=maltfield%7C1536598694%7CSPF6aXvZhhNnPXcg6tp828xXUxc3tE2CeLCalwJ1JO8%7C8a406 513c27482d06d46c366f0b3cb0545359b3fd049c50a9cb481a464dd307f; 1; OSESESSION=rj1k8q34mo0q6ih903ahhcu3mg08jegduvhmmeb6ss5tm478mpucfauft24bkojt8vtqla9ivlnj6qcn0q8lko52rsvv8dvbko0l0l0; wp-settings-time-1=1536428183 DNT: 1 X-Forwarded-For: 155.254.31.28, 127.0.0.1, 127.0.0.1 X-VC-Cacheable: NO:Request method:POST hash: #microfactory.opensourceecology.org X-Varnish: 33304491 --e0cf6203-F-- HTTP/1.1 413 Request Entity Too Large Content-Length: 352 Connection: close Content-Type: text/html; charset=iso-8859-1 --e0cf6203-E-- --e0cf6203-H-- Message: Request body no files data length is larger than the configured limit (131072).. Deny with code (413) Apache-Handler: php5-script Stopwatch: 1536429619993525 5932 (- - -) Stopwatch2: 1536429619993525 5932; combined=173, p1=104, p2=0, p3=0, p4=37, p5=31, sr=21, sw=1, l=0, gc=0 Response-Body-Transformed: Dechunked Producer: ModSecurity for Apache/2.7.3 (http://www.modsecurity.org/); OWASP_CRS/2.2.9. Server: Apache Engine-Mode: \"ENABLED\" --e0cf6203-Z-- [root@hetzner2 httpd]#\n\nso there's clearly different max size settings for whether or not the request contains files or not. As we see above, this request that's being denied is one that doesn't include files. The default settings here have that SecRequestBodyNoFilesLimit set to '131072' = 128 KB. The same default config sets requests _with_ files = 'SecRequestBodyLimit' = '13107200' = 12.5 MB.\n\nfrom DOS perspective, it does make sense to limit the size of the requests, but I'm not sure if it makes sense to have distinct limits for requests that have or don't have files. If someone wants to do harm, they would just add a fat file to the request. Therefore, I think there's basically no harm in increasing SecRequestBodyNoFilesLimit to the current setting of SecRequestBodyLimit. Moreover, nginx should really be our DOS protector.\n\nso I went ahead and changed SecRequestBodyLimit from '131072' to '13107200'\n\nupon retrying to save, the 413 error changed to a 403 error\n\nI went to check the modsec log and, damn, yeah--that's a fucking huge request! Here's it with only the first line of the request body\n\n[root@hetzner2 httpd]# tail -f /var/log/httpd/modsec_audit.log ... --4cc3de17-A-- [08/Sep/2018:18:15:26 +0000] W5QRvjhQN4@9LalMESgKRQAAAAQ 127.0.0.1 34488 127.0.0.1 8000 --4cc3de17-B-- POST /wp-admin/admin-ajax.php HTTP/1.0 X-Real-IP: 155.254.31.28 X-Forwarded-Proto: https X-Forwarded-Port: 443 Host: microfactory.opensourceecology.org Content-Length: 169317 User-Agent: Mozilla/5.0 (X11; FreeBSD amd64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.106 Safari/537.36 Accept: */* Accept-Language: en-US,en;q=0.8 Accept-Encoding: gzip, deflate, br Content-Type: application/x-www-form-urlencoded; charset=UTF-8 X-WP-Nonce: 6019e82b06 X-Requested-With: XMLHttpRequest Referer: https://microfactory.opensourceecology.org/wp-admin/admin-ajax.php Cookie: wordpress_sec_8983be88aab2a9bb71a8df7c9f7251b6=maltfield%7C1536598694%7CSPF6aXvZhhNnPXcg6tp828xXUxc3tE2CeLCalwJ1JO8%7Cbd0bf9738572e47267dc4158ad07c0ba8ac788a2e5bf784b1dd028623a7f15cc; wordpress_test_cookie=WP+Cookie+check; wordpress_logged_in_8983be88aab2a9bb71a8df7c9f7251b6=maltfield%7C1536598694%7CSPF6aXvZhhNnPXcg6tp828xXUxc3tE2CeLCalwJ1JO8%7C8a406513c27482d06d46c366f0b3cb0545359b3fd049c50a9cb481a464dd307f; 1; OSESESSION=rj1k8q34mo0q6ih903ahhcu3mg08jegduvhmmeb6ss5tm478mpucfauft24bkojt8vtqla9ivlnj6qcn0q8lko52rsvv8dvbko0l0l0; wp-settings-time-1=1536428183 DNT: 1 X-Forwarded-For: 155.254.31.28, 127.0.0.1, 127.0.0.1 X-VC-Cacheable: NO:Request method:POST hash: #microfactory.opensourceecology.org X-Varnish: 33183543 --4cc3de17-C-- action=tatsu_save_store&post_id=85&page_content=%5B%7B%22name%22%3A%22tatsu_section%22%2C%22id%22%3A%22Bk-5JP9-RG%22%2C%22atts%22%3A%7B%22bg_color%22%3A%22rgba(255%2C250%2C246%2C1)%22%2C%22bg_image%22%3A ... --4cc3de17-F-- HTTP/1.1 403 Forbidden Content-Length: 225 Connection: close Content-Type: text/html; charset=iso-8859-1 --4cc3de17-E-- --4cc3de17-H-- Message: Access denied with code 403 (phase 2). Pattern match \"(?i:(?:\\\\sexec\\\\s+xp_cmdshell)|(?:[\\\"'`\\xc2\\xb4\\xe2\\x80\\x99\\xe2\\x80\\x98]\\\\s*?!\\\\s*?[\\\"'`\\xc2\\xb4\\xe2\\x80\\x99\\xe2\\x80\\x98\\\\w])|(?:from\\\\W+information_schema\\\\W)|(?:(?:(?:current_)?user|database|schema|connection_id)\\\\s*?\\\\([^\\\\)]*?)|(?:[\\\"'`\\xc2\\xb4\\xe2 ...\" at ARGS:page_content. [file \"/etc/httpd/modsecurity.d/activated_rules/modsecurity_crs_41_sql_injection_attacks.conf\"] [line \"207\"] [id \"981255\"] [msg \"Detects MSSQL code execution and information gathering attempts\"] [data \"Matched Data: \\x22selecte found within ARGS:page_content: [{\\x22name\\x22:\\x22tatsu_section\\x22,\\x22id\\x22:\\x22Bk-5JP9-RG\\x22,\\x22atts\\x22:{\\x22bg_color\\x22:\\x22rgba(255,250,246,1)\\x22,\\x22bg_image\\x22:\\x22\\x22,\\x22bg_repeat\\x22:\\x22no-repeat\\x22,\\x22bg_attachment\\x22:\\x22scroll\\x22,\\x22bg_position\\x22:\\x22top left\\x22,\\x22bg_size\\x22:\\x22cover\\x22,\\x22bg_animation\\x22:\\x22none\\x22,\\x22padding\\x22:{\\x22d\\x22:\\x22120px 0px 120px 0px \\x22,\\x22l\\x22:\\x220px 0px 60px 0px \\x22,\\x22t\\x22:\\ Action: Intercepted (phase 2) Apache-Handler: php5-script Stopwatch: 1536430526571778 46012 (- - -) Stopwatch2: 1536430526571778 46012; combined=39101, p1=135, p2=38938, p3=0, p4=0, p5=28, sr=20, sw=0, l=0, gc=0 Response-Body-Transformed: Dechunked Producer: ModSecurity for Apache/2.7.3 (http://www.modsecurity.org/); OWASP_CRS/2.2.9. Server: Apache Engine-Mode: \"ENABLED\" --4cc3de17-Z--\n\nadded '981255' (sqli) to the wordpress whitelist\n\nthat worked! I was able to change some content, and the admin-ajax.php request got a 200 back. I cleared the vanish cache, reloaded in another browser, and it showed the new content.\n\nI sent an email to Catarina asking her to retry.\n\nCatarina confirmed that it's now working\n\n...\n\nI went to add the confirmation code permitting privacy@opensourceecology.org to marcin@opensourceecology.org that Marcin forwarded to me, but I couldn't login. The password in keepass appeared to only be 20 characters. I just went ahead and generated a new 100-character password, stored to keepass, updated in the admin.google.com (g-suite) console, and logged-in. Then it asked me to create a new password _again_, so I generated a new 100-character password in keepass & stored it.\n\nFinally, I added the confirmation code for forwarding emails to Marcin\n\nnote that the obvious place for forwarding mail only allows you to forward to 1x address at time. To achieve a forward to 2x addresses, I created a filter that would trigger when the message was \"> 0 bytes\" (ie: always trigger on all mail). I created 2x filters, one for each address per https://webapps.stackexchange.com/questions/50372/auto-forwarding-emails-to-2-email-addresses\n\nFri Sep 07, 2018\n\nCatarina said she's having issues uploading some content to the new microfactory wordpress site. She's getting a 413. I asked if he images were reasonably sized\n\nThe CEO of phplist (user samtuke) just awarded my user account on discuss.phplist.org the \"New User of the Month\" badge for my recent 3x posts suggesting improvements to their documentation (which hasn't yet been done) https://discuss.phplist.org/u/maltfield/badges\n\nI came across a couple more posts on the phplsist discussion board about GDPR\n\nhttps://discuss.phplist.org/t/gdpr-re-permission-campaigns-invite-plugin/4086/4\n\nhttps://discuss.phplist.org/t/using-phplist-for-compliance-with-the-gdpr-manual-chapter-feedback-and-discussion/3985/4\n\nWed Sep 05, 2018\n\nMarcin got back to me about the phplist template. He said the template was built by Tristan Copley-Smith, but he said that was for Mailchimp.\n\nI sent an email to Tristan asking if they built the template and, if so, how. And, if not, do they know who did?\n\nIt looks like Tristan's user account was deleted by Tom Griffing on 2015-06 https://wiki.opensourceecology.org/wiki/User:Tristan\n\nTristan responded almost immediately via mobile indicating that they used a service called Campaign Monitor\n\nIndeed, we have an article on them https://wiki.opensourceecology.org/wiki/Campaign_Monitor\n\nso I don't know how Campaign Manager works, but I don't think this template is going to translate well to phplist. For example, there's no auto-gen for a table of contents https://www.phplist.org/manual/ch023_advanced-templating.xhtml\n\nI don't think we're going to be able to do 2x columns without making the email writer learn a whole lotta html. Or copying & pasting between other programs. I think the best option is to just simplify it to one column.\n\nI started poking through the phplist plugins to see if there was anything for templating. There's only 40x plugins plublished. https://resources.phplist.com/plugins/start\n\nthere's some interesting plugins to automatically send campagins to subscribers in intervals after they've initially subscribed. So, like, if we were selling things, we could try to keep people's interest 30 days after their subscription by sending them a 50% off coupon. I guess that's what it's for.\n\nthere's some plugins for putting CAPTCHAs on the subscribe field. Would bots really want to have us send _them_ spam?\n\nthat's all that's up-to-date. Most of these plugins haven't been updated in over 3 years.\n\nah, nice, I found what I was looking for: the \"Content Areas\" plugins allows us to create distinct field and incorporate them into different areas of the template. It also includes generating a TOC https://resources.phplist.com/plugin/contentareas\n\nunfortunately, it hasn't been updated since 2015-10.\n\nhere's the sourcecode https://github.com/bramley/phplist-plugin-contentareas\n\nthe Display in Browser plugin is probably useful https://resources.phplist.com/plugin/viewinbrowser\n\nI wonder how many of these plugins are no longer developed because their functionality has just be incorporated into the main phplist program\n\nthere's a plugin for campaign stats, but I think that's already incorporated into phplist.. https://resources.phplist.com/plugin/campaignstatistics\n\nthere's some stuff for WYSIWYG, for example using FCKeditor https://resources.phplist.com/plugin/fckphplist\n\nor tinymce https://resources.phplist.com/plugin/tinymce\n\ninteresting, there's a plugin to ban subscribers using disposable email accounts, like mailinator https://resources.phplist.com/plugin/preventdisposable\n\nI guess this is for people who make it required to submit your email in order to download something or get a freebie. We wouldn't do that slimy shit, anyway. Not to mention that I think it violates GDPR\n\nI also found a list of example templates for phplist here https://resources.phplist.com/templates\n\nbut the above doesn't have any previews. here's some more in github https://github.com/phpList/phplist-templates\n\nMarcin reiterated that we should just copy alephobjects, and he linked me to their Operations Manual http://devel.alephobjects.com/ao/documentation/AOOM/AOOM.pdf\n\nlooks like this is the url for their phplist site https://phplist.alephobjects.com\n\nnote that the root of this phplist vhost for lulzbot = alephobjects just does a html meta redirect to the '/lists' dir\n\nuser@personal:~$ curl -i https://phplist.alephobjects.com HTTP/1.1 200 OK Date: Wed, 05 Sep 2018 20:41:53 GMT Server: Apache/2.4.10 (Debian) Last-Modified: Mon, 22 Feb 2016 22:52:18 GMT ETag: \"264-52c63af4d0c80\" Accept-Ranges: bytes Content-Length: 612 Vary: Accept-Encoding Content-Type: text/html <!DOCTYPE HTML PUBLIC \"-W3CDTD HTML 4.01 Transitional//EN\"> <html> <head> <html><head> <meta http-equiv=\"Content-Type\" content=\"text/html; charset=ISO-8859-1\"> <meta http-equiv=\"Refresh\" content=\"2;url=http://phplist.alephobjects.com/lists\"> <title>phplist.alephobjects.com</title> </head> <body bgcolor=#FFFFFF> <div align=\"center\"> <p> You are being redirected to a sign up list for email newsletters maintained by Aleph Objects, Inc., makers of the LulzBot desktop 3D printers. </p><br/><br/> <a href=\"http://www.phplist.com\"><img src=\"lists/images/power-phplist.png\" border=0></a> </div> </body> </html> user@personal:~$\n\nI emailed Claudio at alphalabs to let them know about the 404, and ask how they approached GDPR\n\nTue Sep 04, 2018\n\nMarcin sent me the google doc of our OSEmail subscribers\n\nwow, there's 1,155 rows on here (most are subscribe, a few are unsubscribe..hmm)\n\nwe have 4 fields: timestamp, email address, what would you like to do (subscribe, unsubscribe), how did you find about us?\n\nMarcin sent me an email about some users being blocked, but he didn't specify what they were being blocked from or why. I asked for clarification.\n\nI dug through the non-mediawiki interwiki sites to find their privacy policies, hoping to find something simple yet similar to ours needs as it's specific to mediawiki, and already open sourced https://wiki.opensourceecology.org/wiki/Special:Log/interwiki\n\nhttp://www.appropedia.org/Appropedia:Privacy_policy\n\nthis is decent, non-generic, and covers another site outside the wiki. It's clearly not GDPR compliant, though.\n\nhttp://akvopedia.org/wiki/Akvopedia:Privacy_policy\n\nthis is also pretty good. Like the above, it was derived from mediawiki's privacy policy. Maybe we can cherry-pick from both?\n\nhttps://blog.p2pfoundation.net/privacy-policy\n\nthis is pretty generic, nothing specific about mediawiki here. not sure we want that.\n\nhttp://wiki.fablab.is/wiki/Fab_Lab_Wiki_-_by_NM%C3%8D_Kvikan:Privacy_policy\n\nempty page x_x\n\nI created a new email 'privacy@opensourceecology.org' and stored the creds in keepass. I logged-in & set it up to forward to me & Marcin's email addresses. I confirmed for me, but I need Marcin to send me his confirmation # in order to get it setup to forward to him. I emailed him asking for this confirmation number.\n\nI added actual content to our privacy policy page https://wiki.opensourceecology.org/wiki/Open_Source_Ecology:Privacy_policy\n\nI started with a dump of the Apropedia wiki's privacy policy. Rather than edit it locally, I made incremental changes on the wiki so it would be visible all the changes that I made from the Apropedia base\n\nI did a diff of our new page's source and Akvopedia's Privacy Policy source so I could see what Apropedia had changed. I made a few changes\n\nI updated the security section, copying from the current mediawiki Privacy Policy. Note that under GDPR we _do_ have a responsibility to maintain the security of the server (which we are doing), and that should be specified in the Privacy Policy\n\nI added some sections about our requirements for data retrieval/rectification/deletion/etc to the User Data section.\n\nso far it looks pretty good. The only changes I can think of would be to list _what_ data we store. That may or may not be necessary.\n\nI sent an email to Marcin & Catarina about the new Privacy Policy\n\nMon Sep 03, 2018\n\ndid some reading up on the Wikipedia Privacy policy. It's very non-trivial. https://foundation.wikimedia.org/wiki/Privacy_policy\n\nit was approved and went into effect in May, just before GDPR. There's no explicit reference to GDPR, but there is a FAQ with info on how to contact wikimedia for requesting to retrieve or delete PII.\n\nunfortunately, this article links to a dozen other articles on polices & procedures that we would have to create & maintain on our wiki. One does not simply adopt mediawiki's ToS, unfortunately.\n\nmaybe I could just take their document, and replace all the links for \"click hear to learn how to..\" with \"email us at here to make this request\". User self-service would be nicer, but the number of info requests should be low enough to be manageable, and probably require human admin intervention anyway.\n\nwow, I'm not even sure if this is GDPR-compliant:\n\n\"The anonymization process cannot ensure complete or comprehensive anonymization of all of the content or information posted on Wikimedia Sites related to your prior username. If your request is granted, the name change will only occur in automatically generated logs (such as page histories) in association with content that you posted. The name change will not delete mentions of your prior username by third parties. For example, if you changed your username from MichaelPaul to Owlwatcher345, the content you contributed will be attributed to Owlwatcher345, but if another user has mentioned you by the name MichaelPaul in a discussion page, MichaelPaul will continue to appear rather than Owlwatcher345.\" https://foundation.wikimedia.org/wiki/Privacy_policy/FAQ#Can_I_delete_and/or_anonymize_any_content_I_post_on_any_Wikimedia_Site,_if_I_don%27t_want_to_be_personally_identified?_If_so,_how?\n\nthis was explicitly called-out in the discussion. Even though the new Privacy Policy came out the same month that GDPR went into effect, it's recognized to *not* be GDPR compliant. Especially to Article 13 of GDPR. https://meta.wikimedia.org/wiki/Talk:Privacy_policy?rdfrom=%2F%2Ffoundation.wikimedia.org%2Fw%2Findex.php%3Ftitle%3DTalk%3APrivacy_policy%26redirect% 3Dno#GDPR\n\nhere is the article 13 https://ec.europa.eu/info/law/law-topic/data-protection/reform/rules-business-and-organisations/principles-gdpr/what-information-must-be-given-individuals-whose-data-collected_en\n\nugh, note that mediawiki has a distinct privacy policy for donors https://foundation.wikimedia.org/wiki/Donor_privacy_policy/en\n\nwe probably want to take a much simpler privacy policy. For example, lulzbot's is pretty straight-forward\n\nhttps://www.lulzbot.com/content/privacy-policy\n\nI stumbled upon wikimedia's green Sustainability Initiative https://meta.wikimedia.org/wiki/Sustainability_Initiative\n\nthey mentioned Greenpeace USA's \"Click Clean Scorecard\" https://meta.wikimedia.org/wiki/Sustainability_Initiative\n\nI sent them an email at greeninternet@greenpeace.org asking wif they're interested in adding nonprofits to the list or if it's just for\n\nSun Sep 02, 2018\n\ncontinued through the phplist manual https://www.phplist.org/manual/ch005_logging-in.xhtml\n\nthere were a few tips on how to run the \"first campaign\" doc that may be good to remember https://www.phplist.org/manual/ch007_sending-your-first-campaign.xhtml\n\nkeep subject line <50 chars\n\nWe may want to set the \"from\" field as 'OSE', but I'm thinking saying 'Marcin Jakubowski\"\n\nInterestingly, phplist will replace URLs inserted with their WYSIWYG editor with an interstitial page for tracking statistics. Not sure if like.\n\nthis is not done when the anchor text (withing '<a...>' & '</a>' tags) is a url itself, to prevent bing red-flagged\n\nsent an email to marcin asking general info about the html in the latest OSEmail = OSEmail 5.0, and if he wanted me to just import that into phplist or change it? I also asked who built it and how? https://opensourceecology.createsend1.com/t/ViewEmail/j/15C76874EE2BF993/076FCCA596DF178A9A8E73400EDACAB4\n\nsent an email to Claudio asking if they had any phplist plugins or settings that they recommend using..\n\nphplist does indeed have email templates https://www.phplist.org/manual/ch008_your-first-campaign.xhtml\n\nimportant: if your \"lists\" (of subscribers) in phplist have the same email address in many lists, and you choose to send a given campaign to multiple lists (so the total set then contains the email address more than once), phplist will only send that given subscriber a single message; it accounts for this.\n\nthis document mentioned something about having to leave the window open while processing a campaign in the queue. Hopefully that's not strictly necessary..\n\nthis chapter has useful info about understanding phplist's stats https://www.phplist.org/manual/ch009_basic-campaign-statistics.xhtml\n\nthis has more detailed info on stats https://www.phplist.org/manual/ch026_advanced-campaign-statistics.xhtml\n\nthis page has an interesting list of column names for data that phplist will automatically understand. For example: email, password, optedin, htmlemail, etc https://www.phplist.org/manual/ch013_adding-subscribers-to-lists.xhtml\n\nthis page has info on creating a subscription page, which I'll need to do shortly https://www.phplist.org/manual/ch014_creating-a-subscribe-page.xhtml\n\nit suggests making the firstName & lastName fields optional. This is a good idea.\n\nthis page says that, after we make a subscription page, we can use it in a special Admin mode so that we can manually enter subscriber info, ie: after a workshop we add emails from a physical pen-and-paper-on-clipboard signup sheet. Note that there's an added box that we can use to make the user still opt-in following our entry. This is a good idea for the GDPR requirements (\"Send this subscriber a request for confirmation email\")\n\n# this page describes how to make changes to the subscription page https://www.phplist.org/manual/ch025_subscribe-page-design-and-configuration.xhtml\n\ninfo page on how to use categories https://www.phplist.org/manual/ch015_setting-up-your-list-categories.xhtml\n\ncool, their example includes the 'veganism' category. do like <3\n\nthere's a section on attributes https://www.phplist.org/manual/ch016_user-attributes.xhtml\n\nsome attributes that I can think of that may be useful\n\nhow did you hear about us (we already have this)?\n\ninterests (ie: permaculture, earthen construction, plastics)\n\nskills (ie; electrical, mechanical, software development, documentation, cad)\n\nfinally, a page on placeholders arises. this is like variables. apparently in phplist, the syntax is to surround the attribute with square brackets, ie: \"Hi [FIRSTNAME],\" https://www.phplist.org/manual/ch017_using-placeholders.xhtml\n\nthere's also built-in placeholders (variables) such as [UNSUBSCRIBE] or [WEBSITE] (from the config)\n\nwe can also have a fall-back (by appending a double-percent-sign) for the placeholder when the subscriber entry doesn't have the info we need. For example, \"Dear [FIRSTNAME%%Friends]\".\n\nit is recommended that our tests include users with missing attributes so that we can test for both cases\n\nthis guide describes how to segment lists. it mentions how it can be used for a/b testing, but I assumed this was a more guided process. perhaps ab tests are just manually done by firing-off two distinct campaigns with list segmentation? hmm https://www.phplist.org/manual/ch018_targeting-your-campaigns.xhtml\n\nthere's some great info on how to create a template here https://www.phplist.org/manual/ch022_creating-a-template.xhtml\n\nso first I need to hear back from Marcin about his intentions to keep/diverge from the OSEmail 5.0 template. I should be able to mostly adopt it by copying & pasting the html, testing, and making changes as needed.\n\nthis also lists all the built-in placeholders/variables we can use in the templates https://www.phplist.org/manual/ch023_advanced-templating.xhtml\n\nFri Aug 31, 2018\n\nCatarina sent a link about GDPR and how it applies to bloggers\n\nhttps://www.nomipalony.com/gdpr-for-bloggers/\n\n\"Consent must specifically cover the controller’s name, the purposes of the processing and the types of processing activity.\"\n\n^ we need to make sure that the \"I consent\" checkbox (which should be unchecked by default) includes this information. It would also be good if the DB includes whether or not the person did it on our webiste (what URL/what time?) or signed a paper sheet which Marcin later inputted (where, what time?).\n\nI need to find a GDPR-aware, ToS generator. Ideally, one with options so we can choose \"mention that we have the right to send you emails,\" \"mention that we will not be sharing your info with third-parities\", etc.\n\nI found one https://gdprprivacypolicy.net/\n\nthe mediawiki article from yesterday also recommends this, but it's only in german https://datenschutz-generator.de/\n\nwe may want to remove the 'email address' field from comments. instead, could we just use a captcha?\n\nthis is a good spreadsheet that the ICO recommends we use to keep our ducks in a row https://ico.org.uk/media/for-organisations/documents/2172937/gdpr-documentation-controller-template.xlsx\n\nthe mediawiki guide makes note of the fact that mediawiki--by design--doesn't allow for deletion of users or that user's actions https://www.mediawiki.org/wiki/GDPR_(General_Data_Protection_Regulation)_and_MediaWiki_software\n\nprobably the best option is to create a user called \"Deleted User\", then use Extension:UserMerge to merge the user-to-be-\"deleted\" with the deleted user as described here https://wiki.opensourceecology.org/wiki/Mediawiki#Deleting_Users_by_Request\n\nInteresting, what if someone maliciously dumped a user or set of user's PII to our wiki? We could delete it, but we couldn't eradicate it from the history of the page unless we used something like https://www.mediawiki.org/wiki/Help:RevisionDelete\n\nwe can also use Extension:UserAgreement to force people to accept our (new) ToS https://www.mediawiki.org/wiki/Extension:UserAgreement\n\n\"\"A checkbox on the sign-up form to accept the privacy policy (registration is rejected if the check is not ticked). The value of this checkbox should be recorded in database.\n\nimportant: we shouldn't just make code checking for this check-box be the blocker; it must also be recorded in the db when the checkbox was ticked!\n\nshit, that article also mentions disqus. What are our gdpr responsibilities for using disqus? https://www.mediawiki.org/wiki/Topic:Uddcz0ah9i70au4o\n\nin general, I hate discus and would prefer a self-hosted JS-free option like Extension:Comments https://www.mediawiki.org/wiki/Extension:Comments\n\ndisqus posted about this in early May, so I don't see why using them would be an issue.. https://blog.disqus.com/update-on-privacy-and-gdpr-compliance\n\nso discques mentions that if we implemented SSO with discus, then we may have responsibilities. otherwise, they're the data controller--not us.\n\nfuck, disqus mentions that they collect your browser's plugin types & versions. That sounds like fingerprinting for cross-site tracking :\\ https://help.disqus.com/terms-and-policies/disqus-privacy-policy\n\n\"We do not collect any Special Categories of Personal Data about you (this includes details about your race or ethnicity, religious or philosophical beliefs, sex life, sexual orientation, political opinions, trade union membership, information about your health and genetic and biometric data). Nor do we collect any information about criminal convictions and offences.\"\n\nthat's a good list of stuff we don't want to collect. But why not trade union membership :(\n\nI ran across an article about \"cold emailing,\" which suggests it's not outlawed. In our case, we'll be just doing an initial email asking people if they want to opt-in to the OSEmail newsletter. We'll only be using email addresses we already have from our wiki users, so it's not entirely cold. It's a very reasonable assumption that they will find the content useful.\n\nThr Aug 30, 2018\n\nreading though https://www.mediawiki.org/wiki/GDPR_(General_Data_Protection_Regulation)_and_MediaWiki_software\n\nwe may want to use these extensions\n\nhttps://www.mediawiki.org/wiki/Extension:CookieWarning\n\nGoogle webmaster tools yelled at us for having so many 404s in our sitemap that mediawiki produced. No issue here, those 187 URLs it complained about don't exist (probably they used to, and mediawiki doesn't like to delete stuff from its db).\n\nCatarina was concerned, and I told her not to put much stock on these google webmaster tools alerts. Instead, we should pay more attention to StatusCake, which reported on 2018-08-18 that we had 100% uptime for all our 6 websites last month. Woohoo!\n\nI decided to revisit the idea of mining cryptocurrency (ie: coinhive) on our wiki. Today is the last day of the month of August Checking awstats, I see that we got 66,118 visits so far this month with an average time on the site of 215 seconds. Then our site was open for roughly 66118×215 = 14215370 seconds in our client's browsers this month.\n\ncoinhive says 30 hashes/sec is reasonable. https://coinhive.com/info/faq\n\nCoinhive pays out in 0.000064 XMR per 1 million hashes. We'll be generating 14215370 seconds/month * 30 hashes/s = 426,461,100 hashes per month. 426461100÷1000000 = 426.4611 * 0.000064 xmr = 0.02729351 xmr / month.\n\nat current exchange rates, that's $2.77/mo. Better than the $0.10/mo that I calculated back in 2015-05-26, but still not reasonable.\n\nfurther digging into our awstats suggests that we have much room for improvement for google searches leading to our site. It might be a good idea to add meta tags with some generic seo mediawiki extension...\n\nWed Aug 29, 2018\n\nfell into a hole researching GDPR. We do have many users in the EU. This just went live 3 months ago, and we're about to put together a newsletter for phplist, so it's time to ramp-up.\n\nSent an email to Marcin & Catarina asking if they're familiar with GDPR and if we need to make any changes that they know of\n\nhttps://en.wikipedia.org/wiki/General_Data_Protection_Regulation\n\nhttps://ico.org.uk/for-organisations/guide-to-the-general-data-protection-regulation-gdpr/\n\nTue Aug 28, 2018\n\nbegan reading the phplist manual https://www.phplist.org/manual/ch001_system-overview.xhtml\n\nsent an email to marcin & catarina asking for a list of users who are currently on our mailing list\n\nlooks like one of our first tasks is to integrate a form for signing up to the mailing list on our website\n\nwe should also think about which attributes to store about each subscriber, other than first name, last name, and email address.\n\nwe probably want to union the set of emails that marcin is currently sending to with the list of emails of users on the wiki. Then I'll send a first-ever phplist email campaign notifying users that we've setup phplist to better keep them informed with the progress of OSE, including a link to unsubscribe.\n\nMon Aug 27, 2018\n\nhetzner responded saying that october 15th is the earliest possible cancellation period due to the \"cancellation period\"\n\nDear Mr Altfield Thank you for your e-mail. Unfortunately it is not possible to cancel the server with immediate effect. So the cancellation date shown in your KonsoleH account is the earliest possible cancellation date due to the cancellation period. Thank you for your understanding. Kind regards Magdalena Grimm Hetzner Online GmbH Industriestr. 25 91710 Gunzenhausen / Germany Tel: +49 9831 505-0 Fax: +49 9831 505-3 www.hetzner.com Registergericht Ansbach, HRB 6089 Geschäftsführer: Martin Hetzner\n\nThe hetzner policy does state that the contract can be terminated \"at any time during a period of 30 days to the end of the month\" I don't know what the fuck that means, but it does say 30 days https://www.hetzner.com/rechtliches/agb\n\n9.2 The contract is cancellable without giving reasons by both parties at any time during a period of 30 days to the end of the month, but at the earliest on expiry of the minimum contract period stipulated in the contract. A cancellation can be done in writing by letter, fax, email or via the secure online administrations interface, provided this option is available.\n\nI went ahead and initiated the contract cancellation on knosoleh per their instructions. The earliest cancellation date was 2018-10-15, which I selected. This was the response:\n\nYou cancellation has been recorded in our system under the number K18100432 and is now in place. You will soon receive a confirmation and a summary of your cancellation information via e-mail. Should you decide to change the cancellation data in any way, or you decide to reverse the cancellation, simply let us know at any time by writing us a support request via konsoleH.\n\nI sent an email to Marcin about this, informing him that Hetzner is making us pay for an additional 53 days after the time we initiated the cancellation request via email.\n\nI created the microfactory site\n\nI updated the cert to include microfactory\n\n[root@hetzner2 htdocs]# certbot -nv --expand --cert-name opensourceecology.org certonly -v --webroot -w /var/www/html/www.opensourceecology.org/htdocs/ -d opensourceecology.org -w /var/www/html/www.opensourceecology.org/htdocs -d www.opensourceecology.org -w /var/www/html/fef.opensourceecology.org/htdocs/ -d fef.opensourceecology.org -w /var/www/html/staging.opensourceecology.org/htdocs -d staging.opensourceecology.org -w /var/www/html/oswh.opensourceecology.org/htdocs/ -d oswh.opensourceecology.org -w /var/www/html/forum.opensourceecology.org/htdocs -d forum.opensourceecology.org -w /var/www/html/wiki.opensourceecology.org/htdocs -d wiki.opensourceecology.org -w /var/www/html/d3d.opensourceecology.org/htdocs/ -d d3d.opensourceecology.org -w /var/www/html/3dp.opensourceecology.org/htdocs/ -d 3dp.opensourceecology.org -w /var/www/html/microfactory.opensourceecology.org/htdocs/ -d microfactory.opensourceecology.org -w /var/www/html/certbot/htdocs -d awstats.opensourceecology.org -d munin.opensourceecology.org -d phplist.opensourceecology.org ... IMPORTANT NOTES: - Congratulations! Your certificate and chain have been saved at: /etc/letsencrypt/live/opensourceecology.org/fullchain.pem Your key file has been saved at: /etc/letsencrypt/live/opensourceecology.org/privkey.pem Your cert will expire on 2018-11-25. To obtain a new or tweaked version of this certificate in the future, simply run certbot again. To non-interactively renew *all* of your certificates, run \"certbot renew\" - If you like Certbot, please consider supporting our work by: Donating to ISRG / Let's Encrypt: https://letsencrypt.org/donate Donating to EFF: https://eff.org/donate-le [root@hetzner2 htdocs]#\n\nI added the oshine theme + all the dependent plugins\n\nI added users for marcin & cmota as admins\n\nI sent an email to Marcin & Catarina that the microfactory site is up\n\n...\n\nI'm still fighting with getting nginx to redirect http traffic to be https when running a server on a non-standard port (4443) for phplist\n\nI found that one solution is to catch error code 497 & redirect the \"error page\" to just use the \"https\" schema. 497 is specifically defined as \"HTTP Request Sent to HTTPS Port\" in nginx https://en.wikipedia.org/wiki/List_of_HTTP_status_codes#4xx_Client_Error\n\nI used \"error_page 497 301 =301 https://$subdomain.$domain$request_uri;\", and it worked https://stackoverflow.com/questions/8768946/dealing-with-nginx-400-the-plain-http-request-was-sent-to-https-port-error\n\nnow if only I could figure out why phplist is going to the awstats vhost. next step: add debug lines https://easyengine.io/tutorials/nginx/debugging/\n\nSat Aug 25, 2018\n\nhetzner responded telling us to do the cancellation of hetzner1 via konsoleh. Apparently we don't want to \"delete our account\" but we want to \"cancel our contract\". The difference in the konsoleh wui is the navigation via \"Contract -> Cancel Account\"\n\nugh, I went to cancel the contract, but the drop-down menu of when it's to become effective only allows us to choose a date for 15th of every month, starting in October. It's currently only August. I'm not submitting a form stating that we affirm that we want our server shut down then! We want it shut down now. And we don't want to pay for what we don't need. The server has already been offline for one month, anyway.\n\nI sent Magdalina at hetzner a response asking again for them to cancel our contract, effective the day that I submitted the initial request on 2018-08-23.\n\nMagdalena, Please cancel our contract for this \"MS 5000\" effective 2018-08-23, when I initiated this request. The method you described via konsoleh only gives us the earliest cancellation date of 2018-10-15. We do not wish to pay for our service through October 15th. Indeed, our server has been offline for over a month, and we notified you over a month ago that our cancellation was imminent. On 2018-08-23, we gave you notice that we wanted our account terminated immediately. Again, please cancel our shared hosting contract (Client number: C0704628411). Note that we have a distinct contract for a dedicated host (EX41S-SSD #542193 138.201.84.223), and that we do not want to cancel that contract! The EX41S-SSD server is a live production server while the dedi978.your-server.de server is currently offline per this request last month. Please cancel only our shared hosting contract on server = dedi978.your-server.de. Thank you, Michael Altfield Senior System Administrator PGP Fingerprint: 8A4B 0AF8 162F 3B6A 79B7 70D2 AA3E DF71 60E2 D97B Open Source Ecology www.opensourceecology.org\n\nI spent some time documenting the phplist install issues with random_compat needing libsodium installed\n\nhttps://tech.michaelaltfield.net/2018/08/25/fix-phplist-500-error-due-to-random_compat/\n\nhttps://wiki.opensourceecology.org/wiki/Phplist#libsodium\n\nhttps://discuss.phplist.org/t/common-installation-errors-manual-chapter-feedback-and-discussion/217/2\n\nhttps://serverfault.com/questions/927998/why-is-phplist-responding-with-500-internal-server-error\n\nhttps://github.com/paragonie/random_compat/issues/99\n\nThr Aug 23, 2018\n\nMarcin got the email from phplist, but when he attempted to load, it he got an error back from the server that he was trying to speak http on an https port. The link he was sent was this: http://phplist.opensourceecology.org:4443/lists/admin/?page=login&token=someLongHexTokenHere\n\nuser@ose:~$ curl -i \"http://phplist.opensourceecology.org:4443/lists/admin/?page=login&token=someLongHexTokenHere\" HTTP/1.1 400 Bad Request Server: nginx Date: Thu, 23 Aug 2018 18:36:43 GMT Content-Type: text/html Content-Length: 264 Connection: close <html> <head><title>400 The plain HTTP request was sent to HTTPS port</title></head> <body bgcolor=\"white\"> <center><h1>400 Bad Request</h1></center> <center>The plain HTTP request was sent to HTTPS port</center> <hr><center>nginx</center> </body> </html> user@ose:~$\n\nso we already redirect most http calls to or server to https, but we do that by listening on port 80. All requests sent to port 80 are 301 redirected to https with this block in /etc/nginx/nginx.conf\n\n# redirect all port 80 requests to use https server { include conf.d/secure.include; listen 138.201.84.243:80; listen 138.201.84.223:80; listen [::]:80; # force all traffic to use https server_name ~^(?<subdomain>[^\\.]+)\\.(?<domain>.+)$; return 301 https://$subdomain.$domain$request_uri; }\n\nof course, the above block won't do anything if the URL itself specifies a non-port-80 port. How are we supposed to redirect then? It's hard to google, since most of the \"how to redirect http to https\" solutions follow the best practice employed above = listen on 80 & redirect to https. I found some other downvoted options that use an if check for $schema (which is 'http' or 'https'). I tried this, but it _still_ wouldn't redirect! https://nginx.org/en/docs/http/ngx_http_core_module.html#variables\n\nso the access log for phplist vhost queries goes to /var/log/nginx/access_log, rather than the desired /var/log/nginx/phplist/access_log. In fact, the latter phplist-specific log dir is empty! That tells me that nginx is matching the wrong vhost, which is why it's not listening to my changes to the config file.\n\ndigging deeper at all the vhosts listening on port 4443 on the ose ip (excluding obi, which is a distinct ip), I found 3x = munin, awstats, and phplist\n\n[root@hetzner2 conf.d]# grep -ir '4443' * awstats.openbuildinginstitute.org.conf: listen 138.201.84.223:4443; awstats.opensourceecology.org.conf: listen 138.201.84.243:4443; munin.opensourceecology.org.conf: listen 138.201.84.243:4443; phplist.opensourceecology.org: listen 138.201.84.243:4443; [root@hetzner2 conf.d]#\n\nchecking those files, I found that awstats.opensourceecology.org.conf didn't specify a vhost-specific log file. I changed that, restarted it, and--lo and behold--I found the log entries for phplist going to /var/log/nginx/awstas.opensourceecology.org/access_log\n\n[root@hetzner2 nginx]# tail -f awstats.opensourceecology.org/* ==> awstats.opensourceecology.org/access.log <== 73.252.245.128 - - [23/Aug/2018:19:10:33 +0000] \"GET /lists/admin/?page=login&token=hexTokenHere HTTP/1.1\" 400 264 \"-\" \"curl/7.52.1\" \"-\"\n\nbut why is nginx sending this request to the wrong vhost? I'm not even speaking https, so it should be able to clearly see the Host field as phplist.opensourceecology.org. To be sure, I confirmed this with tcpdump. Yep, in the hex output you can see the host literally defining 'phplist.opensourceecology.org. Only one of our configs says that's the server_name. Why does it go to the awstats one?\n\n[root@hetzner2 ~]# tcpdump port 4443 -X tcpdump: verbose output suppressed, use -v or -vv for full protocol decode listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes 19:14:43.537569 IP c-73-252-245-128.hsd1.ca.comcast.net.35808 > opensourceecology.org.pharos: Flags [S], seq 547431718, win 29200, options [mss 1460,nop,nop,sackOK,nop,wscale 6], length 0 0x0000: 4500 0034 6e7a 4000 2706 c610 49fc f580 E..4nz@.'...I... 0x0010: 8ac9 54f3 8be0 115b 20a1 2526 0000 0000 ..T....[..%&.... 0x0020: 8002 7210 fac5 0000 0204 05b4 0101 0402 ..r............. 0x0030: 0103 0306 .... 19:14:43.537580 IP opensourceecology.org.pharos > c-73-252-245-128.hsd1.ca.comcast.net.35808: Flags [S.], seq 3742495441, ack 547431719, win 29200, options [mss 1460,nop,nop,sackOK,nop,wscale 7], length 0 0x0000: 4500 0034 0000 4000 4006 1b8b 8ac9 54f3 E..4..@.@.....T. 0x0010: 49fc f580 115b 8be0 df11 f2d1 20a1 2527 I....[........%' 0x0020: 8012 7210 1f60 0000 0204 05b4 0101 0402 ..r..`.......... 0x0030: 0103 0307 .... 19:14:43.723377 IP c-73-252-245-128.hsd1.ca.comcast.net.35808 > opensourceecology.org.pharos: Flags [.], ack 1, win 457, length 0 0x0000: 4500 0028 6e7b 4000 2706 c61b 49fc f580 E..(n{@.'...I... 0x0010: 8ac9 54f3 8be0 115b 20a1 2527 df11 f2d2 ..T....[..%'.... 0x0020: 5010 01c9 d9e9 0000 0000 7735 39af P.........w59. 19:14:43.723394 IP c-73-252-245-128.hsd1.ca.comcast.net.35808 > opensourceecology.org.pharos: Flags [P.], seq 1:161, ack 1, win 457, length 160 0x0000: 4500 00c8 6e7c 4000 2706 c57a 49fc f580 E...n|@.'..zI... 0x0010: 8ac9 54f3 8be0 115b 20a1 2527 df11 f2d2 ..T....[..%'.... 0x0020: 5018 01c9 9a8e 0000 4745 5420 2f6c 6973 P.......GET./lis 0x0030: 7473 2f61 646d 696e 2f3f 7061 6765 3d6c ts/admin/?page=l 0x0040: 6f67 696e 2674 6f6b 656e 3d38 6639 6330 ogin&token=8f9c0 0x0050: 6366 6239 3634 3634 6164 6362 3362 6433 cfb96464adcb3bd3 0x0060: 6437 6163 6634 3366 3633 3020 4854 5450 d7acf43f630.HTTP 0x0070: 2f31 2e31 0d0a 486f 7374 3a20 7068 706c /1.1..Host:.phpl 0x0080: 6973 742e 6f70 656e 736f 7572 6365 6563 ist.opensourceec 0x0090: 6f6c 6f67 792e 6f72 673a 3434 3433 0d0a ology.org:4443.. 0x00a0: 5573 6572 2d41 6765 6e74 3a20 6375 726c User-Agent:.curl 0x00b0: 2f37 2e35 322e 310d 0a41 6363 6570 743a /7.52.1..Accept: 0x00c0: 202a 2f2a 0d0a 0d0a .*/*.... 19:14:43.723398 IP opensourceecology.org.pharos > c-73-252-245-128.hsd1.ca.comcast.net.35808: Flags [.], ack 161, win 237, length 0\n\nI tried moving the 'server_name' definitions to be the first line of the server block in both the awstats & phplist nginx config files, but it made no difference.\n\nI'll have to tackle this next week. For now, I have to cancel our hetzner 1 contract!\n\n...\n\nI went to delete the account, but I got an error = \"We could not delete your account. You still have active products on this account. Please first cancel all products on this account.\"\n\nSo I went back to Domains -> Account Mangement -> Delete account. I was presented with a drop-down containing 10 accounts. I tried to delete the first one (blog.opensourceecology.org), but then it complained that the account had dependencies on the DB!\n\nSo I went to Domains -> Databases. I saw a list of 12 databases: oseblog, osecivi, osedrupal, oseforum, openswh, ose_fef, ose_website, osesurv, osewiki, microft_db2, microft_drupal1, microft_wiki\n\nI confirmed that we had all of these already backed-up https://wiki.opensourceecology.org/wiki/CHG-2018-07-06_hetzner1_deprecation#2018-07-16\n\nI went to delete the first database, and I got an error = \"The database could not be deleted. Please contact our support team.\"\n\nI give up; I responded to the email asking them to immediately cancel our contract.\n\nWed Aug 22, 2018\n\nI updated the Email List document to include phplist https://wiki.opensourceecology.org/wiki/Email_List#2018_Revisit\n\nMy question about hardening the phplist install was approved, but I have no response yet https://discuss.phplist.org/t/installing-phplist-manually-manual-chapter-feedback-and-discussion/212/31\n\nI'm still not sure why phplist merely dumps a 500 error back at us without any logs\n\nI started digging thorough the phplist code. Oh my, how awful! It's just a wall of code with very little structure or comments. Ick!\n\nI finally decided to install xdebug so I could see what the fuck is actually going on. I intend to disable it in php.ini, but enable it in the vhost config file only https://stackoverflow.com/questions/15423705/how-can-i-use-xdebug-to-debug-only-one-virtual-host\n\nthis will also allow us to use profiling, which I've always wanted\n\n[root@hetzner2 admin]# yum search xdebug Loaded plugins: fastestmirror, replace Loading mirror speeds from cached hostfile * base: mirror.wiuwiu.de * epel: mirror.wiuwiu.de * extras: mirror.wiuwiu.de * updates: mirror.wiuwiu.de * webtatic: uk.repo.webtatic.com N/S matched: xdebug php-composer-xdebug-handler.noarch : Restarts a process without xdebug php-pecl-xdebug.x86_64 : PECL package for debugging PHP scripts php55w-pecl-xdebug.x86_64 : PECL package for debugging PHP scripts php56w-pecl-xdebug.x86_64 : PECL package for debugging PHP scripts php70w-pecl-xdebug.x86_64 : PECL package for debugging PHP scripts php71w-pecl-xdebug.x86_64 : PECL package for debugging PHP scripts php72w-pecl-xdebug.x86_64 : PECL package for debugging PHP scripts Name and summary matches only, use \"search all\" for everything. [root@hetzner2 admin]# php -v PHP 5.6.33 (cli) (built: Jan 14 2018 08:07:11) Copyright (c) 1997-2016 The PHP Group Zend Engine v2.6.0, Copyright (c) 1998-2016 Zend Technologies with Xdebug v2.5.5, Copyright (c) 2002-2017, by Derick Rethans [root@hetzner2 admin]# yum install php56w-pecl-xdebug ... Installed: php56w-pecl-xdebug.x86_64 0:2.5.5-2.w7 Complete! [root@hetzner2 admin]#\n\nthere were no options for xdebug added to /etc/php.ini by the install, but there was a new file at /etc/php.d/xdebug.ini\n\n[root@hetzner2 admin]# grep -i 'xdebug' /etc/php.ini [root@hetzner2 admin]# cat /etc/php.d/xdebug.ini\n\nEnable xdebug extension module\n\nzend_extension=/usr/lib64/php/modules/xdebug.so [root@hetzner2 admin]# </pre>\n\nI added these lines to the new xdebug.ini file to disable it by default\n\n[root@hetzner2 admin]# cat /etc/php.d/xdebug.ini ; Enable xdebug extension module zend_extension=/usr/lib64/php/modules/xdebug.so xdebug.remote_enable off [root@hetzner2 admin]#\n\nI restarted apache, then temporarily allowed the phpinfo() function, and created a script in obi's site and in phplist's site that output phpinfo(). I found that the xdebug module was listed in both sites, but that the 'xdebug.remote_enable' arg was 'On' for the \"Local Value\" of phplist but 'Off' for the \"Local Value\" of obi. In both sites, the \"Master Value\" of 'xdebug.remote_enable' was \"Off\". I guess this is a non-invasive as we can get, according to the xdebug docs this should disable debugging of xdebug *shrug* https://xdebug.org/docs/remote\n\nI re-disabled the phpinfo() function & restarted apache\n\nI can't get xdebug to actually dump info! why is this so complicated? I just want it to dump a ton of info about the stack trace to some log file, not connect to an IDE (who uses IDEs anyway? I'm not some .NET developer..)\n\nlike, what files were executed before the 500? Which functions? Which lines?\n\ndigging further into the phplist.org docs, their first entry in the \"Common Installation Errors\" talks about the dreaded 500 errors https://www.phplist.org/manual/ch033_common-installation-errors.xhtml\n\nit blames .htaccess files. I know this isn't the case, because if I just put a \"<?php die('fail');\" at the top of the 'index.php' file, then I simply get a 200 message with \"fail\" back. So it's deeper than that. Which is why I wanted to know what files/functions/lines were being touched here..\n\nin any case, I renamed lists/admin/.htaccess to /lists/admin/.bak_htaccess and lists/.htaccess to lists/.bak_htaccess. No changes.\n\nI put in a ton of options to try to get xdebug to print _something_\n\nbut, alas, all it will tell me is\n\n[Wed Aug 22 22:31:33.375599 2018] [:error] [pid 16765] [client 127.0.0.1:56112] XDebug could not open the remote debug file '0'.\n\nI googled that, but got no results. Someone had a similar error of \"XDebug could not open the remote debug file \", but the bug was marked as \"can't reproduce\" *sigh*\n\n<VirtualHost 127.0.0.1:8000> ServerName phplist.opensourceecology.org ... # enable xdebug php_flag xdebug.remote_enable on php_flag xdebug.force_display_errors 1 php_flag xdebug.scream 1 php_flag xdebug.profiler_enable 1 php_flag xdebug.profiler_output_dir /tmp #php_flag xdebug.remote_log \"/var/log/httpd/phplist.opensourceecology.org/xdebug.log\" php_flag xdebug.remote_log /tmp/xdebug.log php_flag xdebug.remote_autostart 1 </VirtualHost>\n\nI've tried playing with the string passed to remote_log. With single quotes. Double Quotes. No Quotes. Nothing works.\n\nfuck this. I'll resort to the old way of dumping echo statements at various places and refreshing the page over-and-over.\n\nok, that worked. I dropped this line around. I just moved it lower & lower until the output 'test' didn't show up\n\necho 'test'; error_log( 'test1' );\n\nand this is the line that appears to be the issue. When I drop the above-listed line above this line, I see 'test' and a 200. When it's after, I get no output and a 500 error back from the server.\n\nrequire_once dirname(FILE).'/defaultconfig.php'\n\nok, then we dig into that file doing the same. fucking xdebug, why wouldn't you just do this for me?\n\nok, so the issue is with the declaration of the huge var $default_config. It's an array spanning 622 lines! If I put my debug line before that, it's fine. After, I get a 500 error.\n\nchecking modsec_audit.log, I see\n\n--c3d2f17b-A-- [22/Aug/2018:23:33:50 +0000] W33y3v-FNVpZ-a69v@KBQAAAAAA 127.0.0.1 44136 127.0.0.1 8000 --c3d2f17b-B-- GET /lists/admin/index.php HTTP/1.0 X-Real-IP: 205.154.244.238 X-Forwarded-Proto: https X-Forwarded-Port: 4443 Host: phplist.opensourceecology.org Cache-Control: max-age=0 Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.75 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8 Accept-Encoding: gzip, deflate, br Accept-Language: en-US,en;q=0.9 Cookie: OSESESSION=c8o2s8vu3bkufgagkb8skdnv9kupbds3r52eia6d4oke5sku8peode7qrq15thsd5mboinicn5lr01jqrg3u3d9k34ac4eq5essith3 X-Forwarded-For: 205.154.244.238, 127.0.0.1 X-Varnish: 25778614 --c3d2f17b-F-- HTTP/1.0 500 Internal Server Error Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0 Pragma: no-cache Expires: Thu, 19 Nov 1981 08:52:00 GMT X-XSS-Protection: 1; mode=block Content-Length: 5 Connection: close Content-Type: text/html; charset=UTF-8 --c3d2f17b-E-- --c3d2f17b-H-- Apache-Handler: php5-script Stopwatch: 1534980830384654 50920 (- - -) Stopwatch2: 1534980830384654 50920; combined=835, p1=82, p2=687, p3=1, p4=38, p5=27, sr=20, sw=0, l=0, gc=0 Response-Body-Transformed: Dechunked Producer: ModSecurity for Apache/2.7.3 (http://www.modsecurity.org/); OWASP_CRS/2.2.9. Server: Apache Engine-Mode: \"ENABLED\" --c3d2f17b-Z--\n\nI'm not sure that's helpful.\n\nI started playing craps with that 622-line var = $default_vars. I found some issues with this line\n\n# remote processing secret @TODO previous value generation was limited to 20"
    }
}