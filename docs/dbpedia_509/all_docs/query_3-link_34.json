{
    "id": "dbpedia_509_3",
    "rank": 34,
    "data": {
        "url": "https://www.nature.com/articles/s41586-023-06569-5",
        "read_more_link": "",
        "language": "en",
        "title": "Spatial atlas of the mouse central nervous system at molecular resolution",
        "top_image": "https://media.springernature.com/m685/springer-static/image/art%3A10.1038%2Fs41586-023-06569-5/MediaObjects/41586_2023_6569_Fig1_HTML.png",
        "meta_img": "https://media.springernature.com/m685/springer-static/image/art%3A10.1038%2Fs41586-023-06569-5/MediaObjects/41586_2023_6569_Fig1_HTML.png",
        "images": [
            "https://pubads.g.doubleclick.net/gampad/ad?iu=/285/nature.com/article&sz=728x90&c=-1931342906&t=pos%3Dtop%26type%3Darticle%26artid%3Ds41586-023-06569-5%26doi%3D10.1038/s41586-023-06569-5%26techmeta%3D107,13,139,14,19,32,38,39,44,45,60,64%26subjmeta%3D1514,1949,2019,212,2300,337,340,378,514,61,631%26kwrd%3DGenetic+vectors,Molecular+neuroscience,RNA+sequencing,Transcriptomics",
            "https://media.springernature.com/full/nature-cms/uploads/product/nature/header-86f1267ea01eccd46b530284be10585e.svg",
            "https://media.springernature.com/w215h120/springer-static/image/art%3A10.1038%2Fs41586-023-06812-z/MediaObjects/41586_2023_6812_Fig1_HTML.png",
            "https://media.springernature.com/w215h120/springer-static/image/art%3A10.1038%2Fs41586-023-06818-7/MediaObjects/41586_2023_6818_Fig1_HTML.png",
            "https://media.springernature.com/w215h120/springer-static/image/art%3A10.1038%2Fs41586-023-06808-9/MediaObjects/41586_2023_6808_Fig1_HTML.png",
            "https://media.springernature.com/lw685/springer-static/image/art%3A10.1038%2Fs41586-023-06569-5/MediaObjects/41586_2023_6569_Fig1_HTML.png",
            "https://media.springernature.com/lw685/springer-static/image/art%3A10.1038%2Fs41586-023-06569-5/MediaObjects/41586_2023_6569_Fig2_HTML.png",
            "https://media.springernature.com/lw685/springer-static/image/art%3A10.1038%2Fs41586-023-06569-5/MediaObjects/41586_2023_6569_Fig3_HTML.png",
            "https://media.springernature.com/lw685/springer-static/image/art%3A10.1038%2Fs41586-023-06569-5/MediaObjects/41586_2023_6569_Fig4_HTML.png",
            "https://media.springernature.com/lw685/springer-static/image/art%3A10.1038%2Fs41586-023-06569-5/MediaObjects/41586_2023_6569_Fig5_HTML.png",
            "https://pubads.g.doubleclick.net/gampad/ad?iu=/285/nature.com/article&sz=300x250&c=-40006330&t=pos%3Dright%26type%3Darticle%26artid%3Ds41586-023-06569-5%26doi%3D10.1038/s41586-023-06569-5%26techmeta%3D107,13,139,14,19,32,38,39,44,45,60,64%26subjmeta%3D1514,1949,2019,212,2300,337,340,378,514,61,631%26kwrd%3DGenetic+vectors,Molecular+neuroscience,RNA+sequencing,Transcriptomics",
            "https://www.nature.com/static/images/logos/sn-logo-white-ea63208b81.svg",
            "https://www.nature.com/static/images/logos/nature-briefing-logo-n150-white-d81c9da3ec.svg",
            "https://verify.nature.com/verify/nature.png",
            "https://www.nature.com/h2p37acn/article/s41586-023-06569-5"
        ],
        "movies": [],
        "keywords": [],
        "meta_keywords": [
            ""
        ],
        "tags": null,
        "authors": [
            "Ken Y",
            "Benjamin E"
        ],
        "publish_date": "2023-09-27T00:00:00",
        "summary": "",
        "meta_description": "Spatially charting molecular cell types at single-cell resolution across the 3D volume is critical for illustrating the molecular basis of brain anatomy and functions. Single-cell RNA sequencing has profiled molecular cell types in the mouse brain1,2, but cannot capture their spatial organization. Here we used an in situ sequencing method, STARmap PLUS3,4, to profile 1,022 genes in 3D at a voxel size of 194 × 194 × 345 nm3, mapping 1.09 million high-quality cells across the adult mouse brain and spinal cord. We developed computational pipelines to segment, cluster and annotate 230 molecular cell types by single-cell gene expression and 106 molecular tissue regions by spatial niche gene expression. Joint analysis of molecular cell types and molecular tissue regions enabled a systematic molecular spatial cell-type nomenclature and identification of tissue architectures that were undefined in established brain anatomy. To create a transcriptome-wide spatial atlas, we integrated STARmap PLUS measurements with a published single-cell RNA-sequencing atlas1, imputing single-cell expression profiles of 11,844 genes. Finally, we delineated viral tropisms of a brain-wide transgene delivery tool, AAV-PHP.eB5,6. Together, this annotated dataset provides a single-cell resource that integrates the molecular spatial atlas, brain anatomy and the accessibility to genetic manipulation of the mammalian central nervous system. In situ spatial transcriptomic analysis of more than 1 million cells are used to create a 200-nm-resolution spatial molecular atlas of the adult mouse central nervous system and identify previously unknown tissue architectures.",
        "meta_lang": "en",
        "meta_favicon": "/static/images/favicons/nature/apple-touch-icon-f39cb19454.png",
        "meta_site_name": "Nature",
        "canonical_link": "https://www.nature.com/articles/s41586-023-06569-5",
        "text": "Plasmids\n\nSequences encoding the circular RNA downstream of a U6 + 27 promoter (U6 + 27-pre-racRNA) were adopted from the Tornado system (Addgene plasmid #124362)15 and synthesized by GenScript. Specifically, the pre-racRNA was designed to contain a unique 25-nucleotide (nt) barcode region and a shared 25-nt common sequence to enable STARmap PLUS detection (Extended Data Fig. 1c,d). The U6 + 27-pre-racRNA sequence was inserted into the vector pAAV-hSyn-mCherry (Addgene plasmid #114472) between MluI and XbaI sites, resulting in plasmid pAAV-U6-racRNA (Addgene plasmids #200824 to #200827). AAV packaging plasmids (kiCAP-AAV-PHP.eB and pHelper) were provided by the laboratory of B.E.D.\n\nVirus production and purification\n\nAAV-PHP.eB expressing circular RNA barcodes were produced and purified as described5. In brief, pAAV-U6-racRNA and AAV packaging plasmids (kiCAP-AAV-PHP.eB and pHelper) were co-transfected into HEK 293T cells (ATCC CRL-3216) using polyethylenimine (Polysciences, 23966-1) at the ratio of 1:4:2 based on micrograms of DNA with 40 μg in total per 150-mm dish. 72 h after transfection, viral particles were collected from the medium and cells. The mixture of cells and medium was centrifuged to form cell pellets. The cell pellets were suspended in 500 mM NaCl, 40 mM Tris, 10 mM MgCl2, pH ~10 and 100 U ml−1 of salt-activated nuclease (SAN, 25 U μl−1, Arcticzymes, 70910-202) at 37 °C for 1 h. Viral particles from the supernatant were precipitated with 40% polyethylene glycol (Sigma, 89510-1KG-F) dissolved in 500 ml 2.5 M NaCl solution and combined with cell pellets for further incubation at 37 °C for another 30 min. Afterwards, the cell lysates were centrifuged at 2,000g, and the supernatant was loaded over iodixanol (Optiprep, Cosmo Bio USA, AXS-1114542) step gradients (15%, 25%, 40%, and 60%). Viruses were extracted from the 40/60% interface and the 40% layer of iodixanol gradients. Then viruses were filtered using Amicon filters (EMD, UFC910024) and formulated in sterile Dulbecco’s phosphate-buffered saline (Sigma-Aldrich, D8537). Virus titres were determined using quantitative PCR to measure the number of viral genomes (vg) after DNase I (Roche Diagnostics, 4716728001) treatment to remove the DNA not packaged and then proteinase K (Roche Diagnostics, 03115828001) treatment to digest the viral capsid and expose the viral genome. Quantified linearized plasmids of pAAV-U6-racRNA were used as a DNA standard to transform the Ct value to the amount of viral genome. The virus titre of AAV-PHP.eB.1 (barcode set 1) for coronal samples: 2 × 1013 vg ml−1; AAV-PHP.eB.2 (barcode set 2) for sagittal samples: 1.7 × 1013 vg ml−1.\n\nMice and tissue preparation\n\nThe following mice were used in this study: C57BL/6 (Charles River Laboratories, strain code: 475, female, 8–10 weeks old) and B6.Cg-Tg(Thy1-YFP)HJrs/J (Jackson Laboratory, 003782, male, 5 weeks old). Mice were housed 2–5 per cage and kept on a 12-h light–dark cycle with ad libitum food and water at the temperature of 65–75 °F (approximately 18–23 °C) with 40–60% humidity. For virus injection, mice were anaesthetized with isoflurane (3–5% induction, 1–2% maintaining). We sampled mouse CNS tissues at least four weeks post-injection, when viral responses were shown to return to the control level to minimize the side effect of AAV infection on cell typing44. Experimental procedures were approved by the Institutional Animal Care and Use Committee (IACUC) of the Broad Institute of MIT and Harvard under animal protocol no. 0255-08-19. Detailed information regarding mice and tissue sample slices was included in Supplementary Table 3.\n\nMouse brain and spinal cord coronal sections\n\nIntravenous administration of AAV-PHP.eB.1 at 2 × 1012 vg was performed by injection into the retro-orbital sinus of adult mice (C57BL/6, female, 8–10 weeks of age). One week after the first injection, a second injection was administered to enhance expression. Thirty days after the first injection, mice were anaesthetized with isoflurane (Extended Data Fig. 10a). The brain tissue was collected after rapid decapitation. The spinal cord was isolated using hydraulic extrusion to reduce handling time and the risk of damage to the tissue51. In brief, the large end of a 200-μl non-filter pipette tip was trimmed and fit firmly onto a 5-ml syringe. Next, the spinal column was cut on both sides past the pelvic bone through the rostral-caudal axis, straightening and trimming at both proximal- and distal-most ends until the spinal cord was visible. A 5-ml syringe filled with ice-cold PBS (Gibco, 10010049) was inserted at the distal-most end of the spinal column, and steady pressure was applied to extrude the spinal cord into a 100-mm Petri dish filled with sterile PBS on ice. The lumbar segments of the spinal cord tissue were collected. Tissues were placed in OCT (Fisher, 23-730-571), frozen in liquid nitrogen, and sliced into 20-μm sections using a cryostat (Leica CM1950) at −20 °C.\n\nMouse brain sagittal sections\n\nIntravenous administration of AAV-PHP.eB.2 at 1.7 × 1012 vg was performed by injection into the retro-orbital sinus of an adult Thy1-EYFP mouse (B6.Cg-Tg(Thy1-YFP)HJrs/J, male, five weeks of age). After five weeks of expression, mice were anaesthetized with isoflurane and transcardially perfused with 50 ml ice-cold DPBS (Sigma-Aldrich, D8537) (Extended Data Fig. 10a). The brain tissue was then removed, placed in OCT, frozen in liquid nitrogen, and sliced into 20-μm sagittal sections using a cryostat (Leica CM1950) at −20 °C.\n\n1,022-gene list selection and STARmap PLUS probe design\n\nCell-type marker genes and most differentially expressed genes were extracted from scRNA-seq studies that systematically surveyed the adult mouse CNS, which included multiple brain regions from the forebrain to the hindbrain and sampled the cells with minimum selection1,2. The list was further supplemented with the Allen Mouse Brain transcriptome database markers13. The list was curated to 1,022 genes to be uniquely encoded by 5-digit identifiers (Extended Data Fig. 1a and Supplementary Table 1).\n\nSTARmap PLUS probes for the 1,022 genes were designed as previously described with modifications to further improve the specificity of target transcript detection3,4. The backbone of padlock probes contains a 5-nt gene-specific identifier and a universal region where reading probes align (Extended Data Fig. 1b). In addition, a second 3-nt barcode was introduced to the DNA–DNA hybridization region between a pair of primer and padlock probes to reduce the possibility of false positives caused by intermolecular proximity where the primer for transcript identity A leads to circularization of the padlock hybridized to transcript identity B. For the SEDAL step, the homemade sequencing reagents included six reading probes (R1 to R6) and 16 two-base encoding fluorescent probes (2base_F1 to 2base_F16) labelled with Alexa 488, 546, 594, and 647 (Supplementary Table 2).\n\nTo detect RNA barcodes, a primer was designed to hybridize to the common 25-nt region while a pool of padlock probes was designed to hybridize to variable 25-nt barcode region, converting the barcode into a barcode-unique identifier (Extended Data Fig. 1d). This identifier was sequenced in one round of SEDAL by an orthogonal reading probe (R7 for coronal samples and R8 for sagittal samples) and four one-base encoding fluorescent probes (1base_F1 to 1base_F4) labelled with Alexa 488, 546, 594 and 647 (Supplementary Table 2).\n\nPublicly available data\n\nPublicly available data used in this study: Allen Mouse Brain Reference Atlas18,19,20 (ISH23, CCFv3 (ref. 20)); scRNA-seq datasets of adult mouse nervous system1 (available at Sequence Read Archive (https://www.ncbi.nlm.nih.gov/sra) under accession SRP135960), cerebellum25 (available at Gene Expression Omnibus (GEO) under accession number GSE165371), striatum10 (available at GEO under accession number GSE118020), and whole cortex and hippocampus26 (in the NeMO Archive for the BRAIN Initiative Cell Census Network: https://assets.nemoarchive.org/dat-jb2f34y); and processed AAV-PHP.eB transduction rate in cortical cell types (available at CaltechData: https://doi.org/10.22002/D1.2090, aavomics_cell_type_transduction_rates.csv)44.\n\nSoftware\n\nThe following packages and software50,52,53,54,55,56,57,58,59,60,61,62 were used in the data analysis: ClusterMap is implemented based on MATLAB R2019b and Python 3.6. The following packages and software were used in data analysis: UCSF ChimeraX 1.0, ImageJ 1.51, MATLAB R2019b, R 4.0.4, RStudio 1.4.1106, Jupyter Notebook 6.0.3, Anaconda 2-2-.02, h5py 3.1.0, hdbscan 0.8.36, hdf5 1.10.4, matplotlib 3.1.3, seaborn 0.11.0, scanpy 1.6.0, numpy 1.19.4, scipy 1.6.3, pandas 1.2.3, scikit-learn 0.22, umap-learn0.4.3, pip 21.0.1, numba 0.51.2, tifffile 2020.10.1, scikit-image 0.18.1, squidpy 1.1.2, anndata 0.8.0 and itertools 8.0.0.\n\nSTARmap PLUS\n\nThe STARmap PLUS procedure was performed as previously described3,4 with minor modifications.\n\nSample preparation\n\nGlass-bottom 6- or 12-well plates (MatTek, P06G-1.5-20-F and P12G-1.5-14-F) were treated with methacryloxypropyltrimethoxysilane (Bind-Silane, GE Healthcare, 17-1330-01), followed by a poly-d-lysine solution (Sigma A-003-E). No. 2 Micro cover glasses (12 mm or 18 mm, Electron Microscopy Sciences, 72226-01 or 72256-03) were pretreated with Gel Slick solution (Lonza, 50640) following the manufacturer’s instructions for later polymerization. 20-μm coronal and sagittal slices were mounted in the pretreated glass-bottom 12-well and 6-well plates, respectively. Tissue slices were fixed with 4% PFA (Electron Microscopy Sciences, 15710-S) in PBS at room temperature for 10 min, permeabilized with pre-chilled methanol (Sigma-Aldrich, 34860-1L-R) at −80 °C for 30 min, and re-hydrated with PBSTR/glycine/YtRNA (PBS with 0.1% Tween-20 (Teknova, 100216-360), 0.1 U µl−1 SUPERase-In (Invitrogen, AM2696), 100 mM glycine (VWR, M103-1KG), 0.1 mg ml−1 yeast tRNA (Invitrogen, AM7119)) at room temperature for 15 min before hybridization. For sagittal slices, the step of methanol treatment was skipped, and the sample was permeabilized with 1% Triton X-100 (Sigma-Aldrich, 93443) in PBS with 0.1 U µl−1 SUPERaseIn, 100 mM glycine, and 1% yeast tRNA at room temperature for 15 min.\n\nLibrary construction\n\nThe reaction volumes listed below were for 12-well plate wells. For 6-well plate wells, the reaction volume was doubled. Stock SNAIL probes were dissolved to 50 nM or 100 nM per probe in IDTE pH 7.5 buffer (IDT, 11-01-02-02). The final concentration per probe for hybridization was as follows: SNAIL probes for mouse 1,022 genes, 5 nM; primers for RNA barcodes, 100 nM; padlock probes for RNA barcodes, 10 nM for coronal samples, and 100 nM for sagittal samples. The brain slices were incubated in 300 µl hybridization buffer (2× SSC (Sigma-Aldrich, S6639), 10% formamide (Calbiochem, 344206), 1% Triton X-100, 20 mM ribonucleoside vanadyl complex (New England Biolabs, S1402S), 0.1 mg ml−1 yeast tRNA, 0.1 U µl−1 SUPERaseIn, and SNAIL probes) at 40 °C for 24–36 h with gentle shaking.\n\nThe samples were then washed at 37 °C for 20 min with 600 µl PBSTR (PBS, 0.1% Tween-20, 0.1 U µl−1 SUPERaseIn) twice, followed by one wash at 37 °C for 20 min with 600 µl high salt buffer (PBSTR, 4× SSC). After a brief rinse with PBSTR at room temperature, the samples were then incubated for 2 h with a 300 µl T4 DNA ligase mixture (0.1 U µl−1 T4 DNA ligase (Thermo Scientific, EL0011), 1× T4 ligase buffer, 0.2 mg ml−1 BSA (New England Biolabs, B9000S), 0.2 U µl−1 of SUPERase-In) at room temperature with gentle shaking, followed by 2 washes with 600 µl PBSTR. Then the sample was incubated with 300 µl rolling-circle amplification mixture (0.2 U µl−1 Phi29 DNA polymerase (Thermo Scientific, EP0094), 1× Phi29 reaction buffer, 250 µM dNTP mixture (New England Biolabs, N0447S), 0.2 mg ml−1 BSA, 0.2 U µl−1 of SUPERase-In and 20 µM 5-(3-aminoallyl)-dUTP (Invitrogen, AM8439)) at 4 °C for 30 min for equilibrium and then at 30 °C for 2 h for amplification.\n\nThe samples were next washed twice in 600 µl PBST (PBS, 0.1% Tween-20) and treated with 400 µl 20 mM acrylic acid NHS ester (Sigma-Aldrich, 730300) in 100 mM NaHCO3 (pH 8.0) for 1 h at room temperature. The samples were washed briefly with 600 µl PBST once, then incubated with 400 µl monomer buffer (4% acrylamide (Bio-Rad, 161-0140), 0.2% bis-acrylamide (Bio-Rad, 161-0142), 2× SSC) for 30 min at room temperature. The buffer was removed, and 25 µl of polymerization mixture (0.2% ammonium persulfate (Sigma-Aldrich, A3678), 0.2% tetramethylethylenediamine (Sigma-Aldrich, T9281) in monomer buffer) was added to the centre of the sample, which was immediately covered by Gel Slick coated coverslip and incubated for 1 h at room temperature under nitrogen gas atmosphere. The samples were then washed with 600 µl PBST twice for 5 min each. Except for sagittal brain slices, the tissue-gel hybrids were digested with Proteinase K (Invitrogen, 25530049, 0.2 mg ml−1 in 50 mM Tris-HCl 8.0, 100 mM NaCl, 1% SDS (Calbiochem, 7991)) at room temperature overnight, then washed with 600 µl 1 mM AEBSF (Sigma-Aldrich, 101500) in PBST once at room temperature for 5 min and another two washes with PBST. Samples were stored in PBST at 4 °C until imaging and sequencing.\n\nImaging and sequencing\n\nBefore SEDAL, the samples were washed twice with the stripping buffer (60% formamide and 0.1% Triton X-100 in water) and treated with the dephosphorylation mixture (0.25 U µl−1 Antarctic Phosphatase (New England Biolabs, M0289L), 1× reaction buffer, 0.2 mg ml−1 BSA) at 37 °C for 1 h. Each cycle of SEDAL began with two washes with the stripping buffer (10 min each) and three washes with PBST (5 min each). For the six-round of 1,022-gene SEDAL, the sample was incubated with the ‘sequencing by ligation’ mixture (0.2 U µl−1 T4 DNA ligase, 1× T4 DNA ligase buffer, 0.2 mg ml−1 BSA, 10 µM reading probe, and 300 nM of each of the 16 two-base encoding fluorescent probes) at room temperature for 3 h. For the round of RNA barcode SEDAL, the sample was incubated with (0.1 U µl−1 T4 DNA ligase, 1× T4 DNA ligase buffer, 0.2 mg ml−1 BSA, 5 µM reading probe, 100 nM of each of the 4 one-base fluorescent oligos) at room temperature for 1 h. After three washes with the wash and imaging buffer (10% formamide, 2× SSC in water, 10 min each) and DAPI staining (Invitrogen, D1306, 100 ng ml−1), the sample was imaged in the wash and imaging buffer.\n\nImages were acquired using Leica TCS SP8 or Stellaris 8 confocal microscope using LAS X software (SP8: version 3.5.5.19976; Stellaris 8: version 4.4.0.24861) with a 405 nm diode, a white light laser, and 40× oil immersion objective (NA 1.3) with a voxel size of 194 nm × 194 nm × 345 nm. DAPI was imaged at the first round of 1,022-gene SEDAL and the round of RNA barcode SEDAL to enable image registration (Extended Data Fig. 2a).\n\nSTARmap PLUS data processing\n\nPre-processing, deconvolution, registration and spot-calling\n\nImage deconvolution was achieved with Huygens Essential version 21.04 (Scientific Volume Imaging), using the classic maximum likelihood estimation method, with a signal to noise ratio of 10 and 10 iterations. Image registration, spot calling and barcode filtering were applied according to previous reports3,4.\n\nClusterMap cell segmentation\n\nWe applied ClusterMap12 method to segment cells by amplicons (mRNA spots) with quality control for gene spots and pre- and post-processing. First, a background identification process was used to filter input spots. Specifically, 10% of local low-density mRNA spots were considered as background noises and were removed before the downstream analysis. Second, an additional step of noise rejection was used after mRNA spot clustering as post-processing. Specifically, we removed cells that do not overlap with DAPI signals. These quality control steps for mRNA spots have been included in the analysis of all 20 coronal and sagittal datasets.\n\nQuality control for cells\n\nFirst, we excluded low-quality cells with standard preprocessing procedures in Scanpy63. Here we combined and analysed 20 coronal and sagittal datasets together. We set the minimum gene number per cell and minimum cell number per gene as 20, the minimum read count per cell as 30, and the maximum read count per cell as 1,300. After filtering, we obtained a data matrix of 1,099,408 cells by 1,022 genes. Then the matrix was normalized across each cell and logarithmically transformed. The effects of total read count per cell were regressed out and the data was finally scaled to unit variance.\n\nBatch effect evaluation and correction\n\nTo evaluate batch effects, we grouped adjacent tissue slices into batches. We checked batch effects across labelled batch samples A–J (Supplementary Table 3). We first observed and corrected the batch effect between coronal samples in groups C and D using Combat64. We also observed and corrected the batch effect between coronal and sagittal samples. The function scanpy.pp.combat was used for batch effect correction.\n\nCell-type annotations\n\nIntegration with scRNA-seq dataset\n\nWe first used Harmony16 to integrate STARmap PLUS datasets and a scRNA-seq dataset1 of the mouse nervous system. We used the overlapped 1,021 genes between the STARmap PLUS and the scRNA-seq datasets to compute adjusted principal components and performed joint clustering to transfer main-level cell-type labels in the scRNA-seq dataset1 to STARmap PLUS identified cells. The function scanpy.external.pp.harmony_integrate was used to perform the integration. The function scanpy.tl.leiden was used with a resolution equal to 1 to perform joint clustering.\n\nMain cluster and subcluster cell-type annotation\n\nThe main-level clustering and annotation of STARmap PLUS identified cells were decided based on integration of STARmap PLUS datasets with the public scRNA-seq dataset1.\n\nFirst, as discussed above, we integrated STARmap PLUS cells with cells in the scRNA-seq dataset. Second, we performed joint Leiden clustering on all integrated cells, recovering 53 joint clusters. Third, we transferred labels of cells in scRNA-seq datasets with principle described as follows. Within each joint cluster, we checked the cell-type labels of scRNA-seq cells. If the number of top-1 scRNA-seq cell-type labels within one joint cluster exceeded 80%, it indicated successful integration of multi-source single-cell datasets on this cell type. Therefore, we assigned this dominant top-1 scRNA-seq cell-type label to STARmap PLUS cells in that joint cluster with high confidence. Otherwise, we regarded integration as unsuccessful and temporarily labelled the joint cluster as ‘NA’. We annotated STARmap PLUS cells at four levels with this principle using rank 1 to rank 4 cell-type labels in the scRNA-seq dataset. A higher rank means more detailed annotation. Specifically, we annotated cells into 4 cell types at rank 1 level; 5 cell types at rank 2 level, 13 cell types at rank 3 level, and 22 cell types at rank 4 level. There existed a portion of cells as NA types in levels of rank 2 to rank 4. Finally, the rank 4 level annotation was defined as the main-level annotation (main cell types).\n\nWe then investigated individual main cell types and manually annotated detailed sublevel cell types (Supplementary Figs. 2 and 3). First, we extracted cells in each main-level cluster and performed Leiden clustering to determine subclusters. Specifically, we excluded genes with either a maximum read count per cell of less than 10 or with expression detected in fewer than 10 cells at a count threshold of 5, computed principal component analysis (PCA) and UMAP, and performed Leiden clustering on the kNN constructed on the principle component space. Functions scanpy.tl.pca, scanpy.pp.neighbors, scanpy.tl.umap and scanpy.tl.leiden were used.\n\nSecond, we manually annotated each subclusters based on marker genes and spatial cell distribution (Supplementary Table 4). Specifically, we first identified the top five marker genes for each subcluster using scanpy.tl.rank_genes_groups. In each subcluster, we checked the dot plot showing the fraction of cells expressing specific marker genes and the mean expression of specific marker genes. The marker genes highly expressed across multiple cell types are recognized as common markers. The markers with specific expressions in a particular subcluster are identified as cluster-specific markers. In addition, we examined and confirmed those marker genes in other scRNA-seq databases1,2,26. We refined the marker gene list as described above and annotated the subclusters with the most relevant cell types based on the remaining marker genes. Second, to narrow down to a unique annotation or distinguish subclusters with same annotations, we checked the spatial cell distribution of each subcluster. We observed that some subclusters were explicitly distributed in certain brain regions, allowing us to rule out irrelevant candidates. As for the remaining undetermined subclusters, we combined them with the most relevant annotated subclusters or split them further using Leiden clustering based on prior knowledge.\n\nThird, we analysed cells in the NA cluster, assigning these cells to valid cell types and combining them into rank 4 clusters when appropriate. Specifically, the following types were recovered from the rank 4 NA cells: HYPEN; non-glutamatergic neuroblasts (NGNBL); cerebellar Purkinje cells (CBPC, combined into rank 4 cerebellum neurons); Th+ OBINH (OBINH_7, combined into rank 4 OBINH neurons). Additionally, vascular-like cells in the NA cluster were combined with rank 4 vascular cells and re-clustered. Neuronal-like cells in the NA cluster were combined with rank 4 DE/MEINH and rank 4 hindbrain neurons and re-clustered (Supplementary Fig. 2k). There remain 12 unannotated subclusters (1.8% of total cells) due to lack of annotatable marker genes (Supplementary Fig. 2n), which may have resulted from the differences in sampling coverage between the scRNA-seq and STARmap PLUS datasets.\n\nIt is worth mentioning that the cell-typing results in this study were based on the consensus between the STARmap PLUS dataset and published scRNA-seq datasets, followed by manual annotation. The STARmap PLUS dataset mapped more cells than the previous scRNA-seq dataset1, potentiating more detailed cell typing and annotations in the future.\n\nA schematic summary of the cell typing workflow is shown in Extended Data Fig. 2c.\n\nNear-range cell–cell adjacency analysis\n\nWe quantified the number of edges between cells of each main cell type with cells of other main cell types as previously described12,65. In brief, we first constructed a mesh graph by Delaunay triangulation of cells in each sample using squidpy.gr.spatial_neighbors. Then we computed a near-range cell–cell adjacency matrix from spatial connectivity using squidpy.gr.interaction_matrix. We normalized the matrix along the row and column axes sequentially as shown in Extended Data Fig. 4g. A similar analysis was performed at the subcluster cell type level and reported in Supplementary Table 4.\n\nMolecular tissue region analysis\n\nMolecular tissue region clustering based on spatial niche gene expression\n\nFor a given sample, the smoothed expression vector of each cell was represented by concatenating that of its k nearest spatial neighbours, including itself66. The spatially smoothed-expression matrices for each sample were then stacked into a single dataset and passed into the PCA followed by Harmony16 for integration. Clustering was then performed in the principal component space using the Leiden algorithm followed by visualization using UMAP50.\n\nThe value k was set to 30 neighbours for the identification of broad anatomical regions (level 1), such as the neocortex. To identify subregions (level 2), such as individual neocortical layers, subclustering of each level 1 region was performed with varying k values depending on the morphology of expected subregions (Supplementary Table 5). For example, as meninges are inherently thin, we expected subregions of meninges to also be thin and thus require a smaller neighbourhood size k in order to avoid smoothing away their finer structure. A final level of clustering was then applied to a subset of level 2 regions to identify more subregions (level 3) that were expected based on manual inspection of level 2 gene markers.\n\nNote that, for a certain sample slice, when the number of cells in a cluster is smaller than the value k for smoothing, the concatenated spatial niche gene expression vector cannot be made. In this case, the cell is rejected from further subclustering. To take care of those rejected cells, we performed post-processing to transfer tissue region labels from their physical neighbouring cells (see below).\n\nA resolution parameter must also be specified for each instance of clustering. Resolutions for each level of clustering were manually tuned (Supplementary Table 5) to capture known anatomical features based on the Allen Institute Mouse Atlas as well as preliminary marker genes calculated using differentially expressed gene analysis via the rank_genes_groups function in Scanpy63.\n\nTo identify tissue region marker genes, we first calculated the average expression of each gene across all the cells of each region. Then for each gene, its percentage distribution across tissue regions was normalized to z-scores (Supplementary Table 5).\n\nFinally, we manually combined fragmented subclusters originating from different main clusters when appropriate. To guide manual curation of spatial clustering, non-negative matrix factorization67 was applied to the stacked and spatially smoothed expression matrix (that is, the matrix passed into PCA/Harmony above), identifying anatomical factors along with corresponding gene factor loadings.\n\nMolecular tissue region label post-processing\n\nWe first assigned tissue region labels for those cells missing annotation. Under level 1 tissue region labels, we performed the kNNs (here k = 5) classification to assign a level-1 tissue region label for those cells missing level 1 annotation. Similarly, under level 2 and level 3 tissue region labels, respectively, we performed the kNNs (here k = 5) classification to assign a level 2 or level 3 tissue region label for those cells missing level 2 or level 3 annotation.\n\nWe then performed smoothing based on level 3 tissue region labels (kNNs, here k = 50), and we manually adjusted some molecular tissue region labels as listed below. First, cells in the ‘meninges’ molecular tissue regions were excluded from the smoothing process to minimize the effect on the nearby tissue regions. Second, we observed that cell-sparse regions (for example, molecular layers) would be overwhelmed by a nearby cell-dense region (for example, granule cell regions) during this smoothing process. Therefore, we manually kept the molecular tissue region cluster labels unchanged for those cells (including OB_5-[OBopl] and CTX_HIP_3-[DGmo/po]).\n\nAllen Mouse Brain Common Coordinate Framework (CCFv3) registration, label transfer and molecular tissue region annotation\n\nWe performed registration of each STARmap PLUS tissue slice with Allen CCFv3 (ref. 20) according to public resources21,22. The molecular cell-type maps of STARmap PLUS slices were used to facilitate registration. Specifically, we first manually extracted one corresponding slice image from Allen CCFv3. Next, we manually clicked paired anchors in the STARmap PLUS slice and the corresponding Allen CCFv3 slice for registration. The package AP_histology21 provided the analysis above.\n\nAfter registration, we had a paired Allen CCFv3 slice for each of our STARmap PLUS tissue slices. We then applied an inverse transformation to the paired Allen CCFv3 slices and assigned labels of Allen CCF anatomical regions to cells in STARmap PLUS tissue slices to facilitate molecular tissue region annotation.\n\nRNA Hybridization Chain Reaction (HCR)\n\nWe performed smFISH–HCR (v3.0)24 on thin brain tissue slices (20 µm) using commercial HCR buffers and HCR amplifiers according to the manufacturer’s instructions (Molecular Instruments). C57BL/6 mice (Jackson Laboratory, 000664, male, 10–13 weeks old) were used in the smFISH–HCR validation experiments. In brief, tissue slices were fixed with 4% PFA in PBS on ice for 15 min, permeabilized with ice-cold methanol for 30 min, and washed with PBSTR (PBS, 0.1% Tween-20, 0.1 U µl−1 SUPERase-In) twice at room temperature for 10 min. The sample was then pre-incubated in the HCR probe hybridization buffer at 37 °C for 10 min and then incubated at 37 °C for 12–16 h with custom-designed three or four pairs of HCR probes (final concentration of 25–100 nM for each probe) in the HCR probe hybridization buffer supplemented with 0.1 mg ml−1 Yeast tRNA and 0.1 U µl−1 SUPERase-In. The day after, the sample was washed with the HCR probe wash buffer, and the signal was amplified with the HCR amplifier probes at room temperature for 8–16 h. The fluorescent amplification probe sets used included B1-Alexa647, B2-Alexa594, B3-Alexa546, and B5-Alexa488. Finally, the sample was washed with 5×SSCT (5×SSC, 0.1% Tween-20), stained with DAPI, and imaged in PBS with 10% SlowFade Gold Antifade Mountant with DAPI (Invitrogen, S36938) with Leica Stellaris 8 confocal microscope. Sequence information for HCR probes is available in Supplementary Table 2.\n\nImputation\n\nWe performed imputation of unmeasured genes after integrating the scRNA-seq dataset and STARmap PLUS dataset, following a similar imputation strategy as described39.\n\nFirst, we performed intermediate mapping. Specifically, for each of the 1,022 genes in the STARmap PLUS, we left one gene out and performed an intermediate mapping to align each STARmap PLUS cell with the most similar set of cells in the scRNA-seq dataset. The dimension reduction and batch effect correction methods were PCA, UMAP and Harmony (the same as the previous analysis). Here, the leave-one-(gene)-out mapping approach was used to assess the performance changes caused by varying the number of nearest neighbours in scRNA-seq data. We evaluated the performance score for each mapped gene. The performance score was calculated as the Pearson’s correlation r (across cells) between its imputed values and measured STARmap PLUS expression level. According to the result in Extended Data Fig. 9a, we chose the number of nearest neighbours to be 200.\n\nFinally, we performed a final imputation. We first generated imputation gene list based on the scRNA-seq data1: genes with average read <0.005 (that is, sum read <740 across 146,201 cells, 50th percentile of the data) were filtered; genes with maximum read ≤10 were filtered. This resulted in 11,844 genes after the filtration and we used those genes for imputation. To perform imputation for all genes, we aggregated across the intermediate mappings generated from each gene probed by STARmap PLUS. Specifically, for each STARmap PLUS cell, we considered the set of all scRNA-seq cells that were associated with it in any intermediate mapping. Subsequently, for every cell, we calculated each gene’s imputed expression level as the weighted average of the gene’s expression across the associated set of scRNA-seq cells, where weights were proportional to the number of times each scRNA-seq cell was present (Fig. 5a). Thus, the imputed expression profiles for all genes, including those in the overlapping gene set, are on the same scale as the scRNA-seq log count data. The output is a 1,091,280-cell by 11,844-gene matrix. We also evaluated the performance score for the imputed genes by comparing them to Allen ISH data23. Representative results are shown in Fig. 5b and Extended Data Fig. 9c.\n\nUsing the genes with STARmap PLUS measured ground-truth, we examined the following gene expression features for their association with the imputation performance in the leave-one-(gene)-out intermediate imputation (Extended Data Fig. 9b, Supplementary Discussion and Supplementary Fig. 4). (1) Gene expression level in STARmap PLUS. (2) Spatial expression heterogeneity in STARmap PLUS. For each gene, Moran’s I (a coefficient measuring overall spatial autocorrelation68) for the gene’s spatial expression was calculated for each of the 20 sample slices by a function squidpy.gr.spatial_autocorr65 and then averaged, to represent the degree of patterned spatial expression. Higher Moran’s I represents more patterned spatial gene expression. (3) Gene expression in scRNA-seq dataset1. (4) Single-cell expression heterogeneity in scRNA-seq dataset1. We quantified the degree of cell expression specificity of a gene by calculating Moran’s I of the scRNA-seq1 UMAP coloured by the gene’s expression.\n\nTrajectory analysis\n\nOLGs and OPCs were explored for their developmental trajectory. These cells have subcluster annotations as OLG_1, OLG_2, OLG_3, and OPC, following the analysis described in ‘Main cluster and subcluster cell-type annotation’.\n\nTo quantify developmental stages, we computed PCA, neighbours (kNN graph) and diffusion maps using functions scanpy.tl.pca, scanpy.pp.neighbors and scanpy.tl.diffmap. The Scanpy package was utilized for diffusion map63,69.\n\nCell-type cluster correspondence with brain subregion scRNA-seq datasets\n\nWe integrated our STARmap PLUS data of specific regions with existing regional scRNA-seq datasets to examine the cross-dataset nomenclature correspondence for cell types.\n\nWe first referred to a scRNA-seq dataset in the mouse brain cortex and hippocampus (https://portal.brain-map.org/atlases-and-data/rnaseq)26. We extracted STARmap PLUS cells labelled in top-level molecular tissue regions CTX_A, CTX_B, L1_HPFmo_MNG, CTX_HIP_CA, CTX_HIP_DG and ENTm. For integration of these STARmap PLUS cells and the scRNA-seq dataset, we performed similar analyses as described in ‘Cell-type annotations’. We first used Harmony16 to integrate all cells. Then we used the overlapped genes between STARmap PLUS and scRNA-seq experiments to compute adjusted principal components and performed joint clustering to transfer cell-type labels in the scRNA-seq dataset to STARmap PLUS cells. The transferred labels for STARmap PLUS cells were decided based on the integration of STARmap PLUS cells with the scRNA-seq dataset. Within each joint cluster, we checked the cell-type labels of those scRNA-seq cells. If the number of top-1 scRNA-seq cell-type labels within one joint cluster exceeded 60%, it indicated successful integration for multi-source single-cell datasets on this cell type. Therefore, we assigned this dominant top-1 scRNA-seq cell-type label to STARmap PLUS cells in that joint cluster with high confidence. Otherwise, we regarded integration as unsuccessful and did not transfer labels from the scRNA-seq dataset to STARmap PLUS cells. The function scanpy.external.pp.harmony_integrate was used to perform the integration.\n\nThen, similarly, we referred to a scRNA-seq dataset in mouse brain striatum10 and a scRNA-seq dataset in mouse cerebellum25 and performed the same analysis to generate correspondence for cell types. For the striatum, we extracted cells labelled as top-level molecular tissue region ‘STR’. For the cerebellum, we extracted cells labelled as top-level molecular tissue regions CBX_1 and CBX_2.\n\nRNA barcode analysis\n\nAssigning circular RNA barcode spots into cells\n\nWe first performed spot-calling of circular RNA barcode spots, according to the same process as that in ‘STARmap PLUS data processing’. Then, in each tile, we binarized the DAPI signal and used it as a mask to remove circular RNA barcode reads outside the cell nucleus. Then we stitched the spots in each tile together based on tile location information. We next assigned circular RNA barcode spots into cells identified by endogenous genes. Using sklearn.neighbors.NearestNeighbors (k = 1), we located the nearest mRNA spot to each circular RNA barcode spot. We then associated the cell identity of the mRNA spot with the circular RNA barcode amplicon. Finally, we counted the total number of circular RNA barcodes for each cell.\n\nCell-type-based statistics\n\nFor each main and subtype cell cluster, we computed summary statistics of the 2.5th, 25th, 50th, 75th and 97.5th percentiles using numpy.quantile to generate a box plot of circular RNA barcode expression by cell type in both coronal and sagittal samples (Supplementary Table 8).\n\nTissue region-based statistics\n\nWe similarly computed the 2.5th, 25th, 50th, 75th and 97.5th percentiles for each tissue region after grouping cells by the tissue regions as generated above (Supplementary Table 8).\n\nStatistical analysis\n\nSpearman’s r and its P values (two-tailed) in Supplementary Fig. 1 and Pearson’s r and its P values (two-tailed) in Supplementary Discussion were calculated with GraphPad Prism Version 9.3.1. P values in Supplementary Fig. 4 were calculated with two-sided Mann–Whitney–Wilcoxon tests by statannotations (version 0.4.4) using the function statannotations.Annotator.annotator.configure (test = ‘Mann-Whitney’, text_format = ‘star’, loc = ‘outside’). **P < 0.01, ***P < 0.001, ****P < 0.0001.\n\nReporting summary"
    }
}