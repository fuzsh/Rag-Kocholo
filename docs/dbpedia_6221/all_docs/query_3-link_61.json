{
    "id": "dbpedia_6221_3",
    "rank": 61,
    "data": {
        "url": "https://www.copetti.org/writings/consoles/playstation-portable/",
        "read_more_link": "",
        "language": "en",
        "title": "PlayStation Portable (PSP) Architecture",
        "top_image": "https://www.copetti.org/images/consoles/covers_top/playstation-portable_hu392d842986e74d77f2bc7c358e152a9e_354536_b9d740ce48f4ef2e049e707251a69877.c95cac4f49d14f9fc68859ed00e5e6f4.jpg",
        "meta_img": "https://www.copetti.org/images/consoles/covers_top/playstation-portable_hu392d842986e74d77f2bc7c358e152a9e_354536_b9d740ce48f4ef2e049e707251a69877.c95cac4f49d14f9fc68859ed00e5e6f4.jpg",
        "images": [
            "https://www.copetti.org/images/consoles/_covers/en/playstation-portable_hu5ec645718548044e73667c98bc4aa0c1_420770_330x0_resize_q90_box.jpg",
            "https://www.copetti.org/images/consoles/psp/original.0efafae987c144250fb7f70ee83151321c0e5e892344eb35ace9a74ad640c18e.png",
            "https://www.copetti.org/images/consoles/psp/slim.26eeff20144c4b7c986b8534d2c569603a3fbb856bd810b48a00336393de3ecf.png",
            "https://www.copetti.org/images/consoles/psp/slim-lite.48d6cb8d8d0c84d22eab394d67d9828adc6bcc643fc7643497370e10972540aa.png",
            "https://www.copetti.org/images/consoles/psp/go.fd34fa7142e993a5c698f1926e4795ab94622f48bc8b3ad09584b8da9fd79bbc.png",
            "https://www.copetti.org/images/consoles/psp/motherboard.9c27e8cfff6b863445796eeb3f2a38b29780bda5fe4aed9cf0c916bd145479ba.png",
            "https://www.copetti.org/images/consoles/psp/motherboard_marked.1424fb70adcd5cc9b3e3d12763f72fac6e9465a8a1acc1a096a99c9d268227a6.png",
            "https://www.copetti.org/images/consoles/psp/diagram.5c5bdefadf90855d9e1037c1ef6b7b93e5bacda56a87bf3b15d8aaf9bdb4acdf.png",
            "https://www.copetti.org/images/consoles/psp/tachyon.a7c25cb952548e37638dbaf3bf0dc7719c4e7824426d34c915caa5c5115a2677.jpg",
            "https://www.copetti.org/images/consoles/psp/cpu/mmu.e5cdee0832a40e85f14a3bc170d2f093a08e62feb6f82b33b8678c355237e841.png",
            "https://www.copetti.org/images/consoles/psp/cpu/memory.27073f53c8af244177ee6eb7c58eed28233dd9afc5f9cc89505293a64b7774f0.png",
            "https://www.copetti.org/images/consoles/psp/cpu/buses.ed8a50e6642081bd34e8dc4ed130f5d58296c957ff9b1d8e5602d172bbd76993.png",
            "https://www.copetti.org/images/consoles/psp/games/daxter.1cc7d9cf70d1b049affab4a0affcfbfebe71bbf9bb35f7e20a2adaf17b691d7e.jpg",
            "https://www.copetti.org/images/consoles/psp/games/kh.10599c6dfb79822922581db1ea8211778d23e64e6564fc887726861993264ee5.jpg",
            "https://www.copetti.org/images/consoles/psp/games/spider.cca57f790e5faa6a2bc8f30a87106c5c0a6f041d48f189b5f6209adf28de22cc.jpg",
            "https://www.copetti.org/images/consoles/psp/games/gta.f09af3e7d2ad1f33bc75758cde9008ed3b01a7582c0cc626e6ca8d895c40b9cf.jpg",
            "https://www.copetti.org/images/consoles/psp/games/sims2.3dccdf3ef409b5c664150290d16272585046aa5237d98cc639dbebb80e78e970.jpg",
            "https://www.copetti.org/images/consoles/psp/games/outrun.ecbec05951adb5f9bac3e5c0d7e9c4f094ad7dd8c9d486752b764e82f613ac01.jpg",
            "https://www.copetti.org/images/consoles/psp/games/loco.d60fff92ce9a2aa66fdaa77c519e0dcf8e5fa05d8c571174773e91de5e4760c4.jpg",
            "https://www.copetti.org/images/consoles/psp/ge_arch.d9ae6b910a003130dc76e95645eebe0ceb79d535c725ed0a2cff3bbf2b06c51e.png",
            "https://www.copetti.org/images/consoles/psp/pipeline.ca971391f74ee631cbeefdab6899188de743cba05b5e78913683fe2309948ea3.png",
            "https://www.copetti.org/images/consoles/psp/gpu/commands.259a3b03460369f3d78a973939a4df95fefe10e81884c8139f30be842c918e18.png",
            "https://www.copetti.org/images/consoles/psp/gpu/vector.090e07f45ad3edd24447344dfc8465db31af645caccd86ab70a70f304e972c1f.png",
            "https://www.copetti.org/images/consoles/psp/gpu/rasterizing.979949a4d57b1a700b2479640a23e6a23e8cb048bf5cbe97e9ae859257ff4475.png",
            "https://www.copetti.org/images/consoles/psp/gpu/textures.743f689f8725a54aa7bac11a407c3ae392365357f3a4b64fdf0be682fedc78b0.png",
            "https://www.copetti.org/images/consoles/psp/gpu/operation.8a7d49d0fdd7bcb8c506c292e7ee9dcf8216597e9bdb8b962d60462d984750df.png",
            "https://www.copetti.org/images/consoles/models/snake_psp.00979906c7a24be31de879b4b0afdd3c5362f693c93465209e48109dc00921d0.png",
            "https://www.copetti.org/images/consoles/models/daxter_psp.ea4d9b8af9d0a7ec7b14e383a802fec15043a9bed16efcce1c018dce8410cc81.png",
            "https://www.copetti.org/images/consoles/psp/io/bottom.f2a565a2ac74c97efc587423833b9ff3c35f4e648faaa767e90e18c1401e5440.jpg",
            "https://www.copetti.org/images/consoles/psp/io/top.fffc4aec2d9de21c44f0d8a48ad9fe4d0294a97f364faa56d72632ff85f21e46.jpg",
            "https://www.copetti.org/images/consoles/psp/xmb/main.3f3c9dada3bb82af2858c655906de0d1c2e5f4e3b21e4016c3b8455c23a084ae.jpg",
            "https://www.copetti.org/images/consoles/psp/xmb/photo.71b673d7abf01806b7a40a48969b90ae00b23c394e1b26a0018ffa33a061162d.jpg",
            "https://www.copetti.org/images/consoles/psp/xmb/game.9f6910595bdf09f76b9cfb6e176f78b584182f2d2431be5ee2f592db87413c1c.jpg",
            "https://www.copetti.org/images/consoles/psp/xmb/setting.56561abe4da2fee4c4358308259adadf2504c549e302a6e8cada9a8d6dee4c8f.jpg",
            "https://www.copetti.org/images/consoles/psp/xmb/keyboard.e06bc606c91eb0fb380270cb7176a7aa2f67116ca0c92216d4cc37ccd26d5dc0.jpg",
            "https://www.copetti.org/images/consoles/psp/xmb/update.b1f36c91dd0572e2399f7676c583a77a67a156a0aa155c42161c6a648b213f7c.jpg",
            "https://www.copetti.org/images/consoles/psp/retail.000ecee3e13ff9f121df011b11d37b2e5547229ef51b16b1c9848a21bead2920.jpg",
            "https://www.copetti.org/images/consoles/psp/io/memory_stick.81e9274f19c56fdfd4f866b3dfa14c2ed8c8967a8ec0afa7c21cac565ac75630.jpg",
            "https://www.copetti.org/images/consoles/psp/xmb/network.ea7492c1c4f5335644b55d7e7e5b5b665a730db8e18d9e454e136b8d59ffe68d.jpg",
            "https://www.copetti.org/images/consoles/psp/xmb/store.e85d52bda532a6e09340906be9acd6bd9f56dd8c5a32954c177a6d707c644f98.jpg",
            "https://www.copetti.org/images/consoles/psp/xmb/game_update.83dd1dbb7fa577a110653940e7a6d94a8012096db7d764ea171a39c3c486c85e.jpg",
            "https://www.copetti.org/images/consoles/psp/downgrader.18f42043d258300ea81d9e241ef8e9e5cca6f3d008e48cfb85c3b922832541a4.jpg",
            "https://www.copetti.org/images/consoles/psp/xmb/cfw.e2577cc421c2454a054827201847de465af53649a052ff9dbce9e7063aa78482.jpg",
            "https://www.copetti.org/images/consoles/psp/mypsp.38961ffb3900f95c8c02bac465e7794bd5c773cfe61a2e9acfc20fb21fb54f79.jpg",
            "https://www.copetti.org/images/paypal_donate.png",
            "https://www.copetti.org/images/patreon.png",
            "https://www.copetti.org/images/consoles/ebooks_banner.0d180c0136e4c9345bc0ab4f7a0224849a292326d2679d610ea945054383a996.jpg",
            "https://www.copetti.org/favicon/favicon.png"
        ],
        "movies": [],
        "keywords": [],
        "meta_keywords": [
            ""
        ],
        "tags": null,
        "authors": [
            "Rodrigo Copetti"
        ],
        "publish_date": "2021-04-21T00:00:00",
        "summary": "",
        "meta_description": "An in-depth analysis that explains how this console works internally",
        "meta_lang": "en",
        "meta_favicon": "/favicons/apple-touch-icon.png",
        "meta_site_name": "The Copetti site",
        "canonical_link": "https://www.copetti.org/writings/consoles/playstation-portable/",
        "text": "Supporting imagery\n\nModel\n\nMotherboard\n\nDiagram\n\nA quick introduction\n\nReleased just one month after the Nintendo DS, Sony’s PSP proved that ‘horizontal innovation’ is not the only way to succeed in the portable console market.\n\nThis article is dedicated to anyone who wants to understand, straight to the point, how the PSP operates. It’s not a short write-up, but I hope that at the end of the article, you will be able to grasp the building blocks of this console (its design rationale, choice of CPUs, GPU pipeline, security system and so forth).\n\nMain CPU\n\nSimilarly to Nintendo, Sony built an extremely packed System-on-Chip (SoC) that houses most of the components we are going to discuss throughout this article. This includes the main CPU in charge of executing games and other programs (unlike the other CPUs, which we’ll talk about in due time). The SoC is called Tachyon, a name chosen by Sony themselves (after watching some Star Trek?).\n\nThe main CPU is also an in-house design by Sony that keeps up with the tradition of using MIPS technology. Be as it may, it’s been four years since the release of the PlayStation 2, I wonder what’s the state of MIPS since then?\n\nMIPS after the turn of the century\n\nI’m afraid the golden years of MIPS have been kept in the 90s and there aren’t any indicators that these will repeat anytime soon. Its parent company, SGI, lost dominance against affordable x86 workstations and was running out of cash. So, in 1999 it sold its majority stake in MIPS [1]. With this, MIPS became an independent company once again, however, the competition was more fierce than it was in the early days.\n\nThe company’s first decision was to acknowledge that MIPS CPUs couldn’t compute in the high-performance arena anymore. So, they shifted their focus to low-power computing, running head-to-head against ARM and its unprecedented popularity.\n\nConsequently, MIPS revisited its fragmented CPU line and consolidated it with three instruction sets [2]:\n\nMIPS32: An update of MIPS II (the last 32-bit-only ISA) bringing functionality gathered from later architectures while keeping the 32-bit boundary.\n\nMIPS64: The continuation of MIPS V, a 64-bit ISA and the last one before the revamp. The MIPS V has been a superset of all previous ISAs, just like its predecessors.\n\nmicroMIPS: Available as ‘microMIPS32’ and ‘microMIPS64’, these are supersets of the MIPS32 and MIPS64, respectively, with an additional group of 16-bit instructions (à la Thumb). microMIPS is not binary compatible with the other ISAs, however. Thus, it would require re-compilation of legacy codebases to run on microMIPS.\n\nThe big difference was that these would now be developed in conjunction, as opposed to MIPS dropping the previous architecture as soon as the next one arrived. New revisions would be denoted with the ‘Release x’ suffix, such as ‘MIPS32 Release 6’ or ‘MIPS32R6’ (coincidentally, the last revision to date).\n\nAlong with the ISAs, MIPS also started selling a new line of IP cores. For instance, the MIPS32 4k design implemented the MIPS32 R2 ISA, it came in different variants and offered plenty of customisations.\n\nBack on topic, Sony presumably acquired a license of the MIPS32 4k and customised it by extending the ISA and bundling particular co-processors [3]. The result is called Allegrex and runs at a variable speed, from 33 MHz to 333 MHz.\n\nThe new portable CPU\n\nAllegrex is a complete 32-bit core offering [4] [5]:\n\nA custom MIPS ISA: mixes MIPS32R2 instructions with exclusive ones for arithmetic operations (multiplication, subtraction, min/max, bit-shifts) and interrupt control. These are called ‘Allegrex Extended Instructions’.\n\nA 32-bit address bus: this means that up to 4 GB of memory can be seen by this CPU.\n\n32 general-purpose registers: all of them store 32-bit numbers; and two (the zero register and link register) are reserved for special uses. By now, this should come as no surprise.\n\nA 7-stage pipeline (one more than its home sibling). Here is a previous explanation of CPU pipelining if you’d like to know more.\n\nA Memory Protection Unit or ‘MPU’ (not to be confused with an ‘MMU’): this is a dedicated unit that maps the physical hardware onto the CPU’s memory space with some special quirks in between. We’ll see more about it in a bit.\n\n32 KB of L1 Cache: of which 16 KB is for instructions and 16 KB for data.\n\nA cache write-back buffer: the CPU can write over cache believing it has updated physical memory as well. Then, the cache takes care of updating memory when the buffer is full.\n\nThis design speeds up memory stores, but doesn’t work right away with multi-processor systems like the PSP. So, developers will have to take care of evicting the buffer when other components require those new values in memory.\n\nIn conclusion: Allegrex is incredibly fast. However, we still don’t know what can you do with it. After all, you can imagine this CPU as the conductor of an orchestra, and we haven’t checked out the performers… yet.\n\nCoprocessors\n\nAs with any MIPS CPU, Allegrex has three coprocessor slots. Sony added two:\n\nA Floating Point Unit (FPU) as ‘CP1’: accelerates arithmetic operations with 32-bit decimal numbers (following the IEEE 754 standard). It has thirty-two 32-bit registers and an independent 8-stage pipeline, thereby adding more parallelism to the main CPU.\n\nA Vector Floating Point Unit (VFPU) as ‘CP2’: a coprocessor designed for vector operations, similar to a traditional SIMD processor. Compared to the FPU, it instead provides 128 registers and a special instruction set with variable pipeline stages.\n\nIts usefulness comes from its 128-bit data bus connected to the rest of the system, offloading the main CPU’s transit.\n\nFocused memory management\n\nLet me talk for a moment about the memory unit included in this system. Its modus operandi can be seen as a bit primitive at first, but we’ll see why it’s optimal for the needs of this console.\n\nA traditional Memory Management Unit or ‘MMU’ takes care of the CPU’s access to the components surrounding it. This implies that all the address lines of the CPU will be connected to the MMU; only the latter is connected to the rest of the system.\n\nThis is particularly advantageous for features like ‘virtual memory’ and ‘memory protection’. Well, to achieve virtual memory, an MMU must contain a component called ‘Translation Look-aside Buffer’ (TLB) to prevent performance degradation. Now, Allegrex’s MMU lacks a TLB, so it focuses on memory protection. This is why Allegrex’s MMU is instead called an MPU (Memory Protection Unit). An MPU is a cut-down version of an MMU without virtual memory. In any case, memory protection gives the system the power to decide which memory locations a program can access.\n\nThanks to this, Allegrex won’t have to deal with user-land programs (i.e. games) accessing restricted locations (i.e. encryption keys). To accomplish the restriction itself, memory addresses are grouped into five segments with different privilege levels. Furthermore, Allegrex’s MPU contains three modes of operation: User mode, Supervisor mode and Kernel mode.\n\nIf a normal process (operating in user mode) wants to access a memory address found in a privileged location, the MPU will ask the operating system (through the use of ‘exceptions’) whether to grant permission to the process.\n\nAll in all, this allows Sony, the developer of the operating system, to implement a security system enforced by hardware.\n\nMemory available\n\nSo far we’ve analysed the PSP’s main CPU and its accelerators. Now let’s see the physical memory available in this system.\n\nThe PSP comes with two memory blocks accessible from the CPU:\n\n16 KB of SRAM: this is what we called Scratchpad in previous articles. It’s small but very fast RAM. It’s up to developers to make proper use of it, although unofficial documents called it ‘useless’.\n\n32 MB of DDR SDRAM: it’s huge and many other components will make use of it, but since it’s not that close to the CPU, its access rate is slower. We’ll refer to it as ‘main memory’ across the article.\n\nThe ‘DDR’ initials mean ‘Double Data Rate’, which denotes an evolution from the traditional ‘SDRAM’, featuring a faster transfer protocol. The original Xbox used the same type.\n\nBus design\n\nYou’ll soon find that the PSP accommodates lots of components with unique functionality. So, to organise them without repeating previous mistakes, engineers interconnected them using dedicated buses. Thus, only small groups of components, with similar applications, will share the same bus. Those buses talk to each other using dedicated arbiters (in the form of ‘memory controllers’ or Direct Memory Access (DMA)).\n\nAll of the buses found in Tachyon implement a well-known design called Advanced High-performance Bus (AHB), a solution built by Arm to tackle congestion on their chips and SoCs. If you are curious, AHBs are also used in the Wii.\n\nUsing the principles above, the following buses were constructed for the PSP:\n\nThe System Bus: connects the CPU, scratchpad and GPU. It’s 128 bits wide.\n\nThe Media Engine bus: connects another group of components (explained in the next section). It has the same properties as the System Bus.\n\nThe Peripheral Bus: connects I/O, storage-related components. It’s 32-bits wide.\n\nAll three buses connect to the DDR controller, which is where the main RAM is found.\n\nTackling traffic congestion\n\nInside each bus, there will be multiple components working independently. They will store processed data in a shared space (such as the main RAM). Now, we don’t want the CPU to intervene whenever a module needs to read or write from memory. Traditionally, a DMA unit was placed in the bus to provide this facility, but a single DMA can only do so much. The PSP contains a significant number of components, and this will eventually lead to bottlenecks.\n\nThe solution is very simple: bus mastering. In a nutshell, each component will get its own DMA controller. This gives them the ability to become the ‘bus master’ and take control of the bus to access whatever location they want. To avoid contention (multiple ‘bus masters’ at the same time), the neighbouring components will acknowledge this event and wait until the operation completes.\n\nThe end of the line\n\nThe RISC revolution spawned countless CPUs throughout the 80s-90s but only a handful lasted after the turn of the century. Just like I concluded my analysis of the SuperH in the Dreamcast article, it’s time to say farewell to a historic leader in parallel computing: the MIPS CPU.\n\nAfter many turnarounds, what’s left of MIPS is now a company designing RISC-V CPUs. In all fairness, this is an interesting strategy that provides the company with greater leverage to compete against ARM. In any case, the PlayStation Portable will be my last article of this series carrying a MIPS CPU.\n\nLooking back at my analyses, however, it’s hard to comprehend how such a talented company could’ve lost its market share. Admittedly, in the workstation market, it became clear that Intel’s x86, no matter the amount of criticism, won by making equipment affordable (thanks to its Pentium line, along with the ‘clones’) and attractive due to its (Windows-only) compatible software. Finally, the P6 architecture provided Intel with the scalability initially only enjoyed by RISC designs.\n\nIn the case of low-power computing, it was more difficult for me to understand the retreat, as MIPS and ARM shared similar business models (IP licensing). Luckily, a previous interview from the Computer History Museum in 2011 also brought up the same question, resulting in this answer:\n\nWe made a mistake, we didn’t realise how important the cellphone market was. Early there was no money to be made (…) but ARM got it by investing in it. It was a very smart move and it turned out to be incredible leverage point. We just looked at the gross margin and said ‘that’s not a great return! we’d be better off putting our attention elsewhere’ but of course, it turned out cell phones became smartphones [and then] became a gigantic. [6]\n\n– John Hennessy, co-founder of MIPS Computer Systems\n\nNevertheless, when it comes to this topic, I believe that, while we won’t see a new MIPS CPU, we’ll see the result of its former engineers transmitting its distinctive technology into new projects.\n\nMultimedia CPU\n\nUp to this point, we’ve discussed the main CPU and the buses inside Tachyon, but there are still many features to be found in the SoC. In particular, there’s another block of modules designed for a specific application: multimedia. This group specialises in audio and image processing, including the combination of both (video processing), and it operates without consuming bandwidth from the main CPU group (the ‘system group’).\n\nThat being said, the new block is called Media Engine group and it’s composed of the following components:\n\nA second Allegrex CPU serving as the ‘controller’ of the Media Engine group. This is the same CPU found in the system group, but without the vector coprocessor [7]. The controller is responsible for receiving orders from the main CPU and managing the rest of the multimedia hardware that will work concurrently.\n\n2 MB of eDRAM: multimedia encoding and/or decoding consumes a considerable amount of bandwidth, so to avoid stalling the other components, the Media Engine contains dedicated memory to process the data ‘in-house’ and publish the results once it’s necessary to do so.\n\n‘eDRAM’ is the same as DRAM but manufactured inside another chip.\n\nAn MPEG-AVC decoder: a hardware decoder that does only one thing, and fast. That is, swallow H.264 video stream [8] and spit out data that the audio and graphics endpoint understand.\n\nA Virtual Mobile Engine or ‘VME’: this is some sort of programmable Digital Signal Processor (DSP). The controller programs it and then starts feeding in the data. Afterwards, like the AVC, the VME stores the processed chunk in local memory.\n\nThis is a very obscure component; only Sony seems to know the ins and outs of it (including how to program it). To this day, it’s still a mystery.\n\nFrom what it seems to be Sony’s leaked slides [9], the VME seems to have local memory and a DMA controller. It’s also known as the ‘Dynamic Reconfigurable Engine’.\n\nNeedless to say, the Media Engine is not directly operable from the developer’s side (Sony hides all of it through a thick API). The official Software Development Kit (SDK) includes libraries like ‘libmpeg’ or ‘libmp3’ which already implement complete applications optimised for this engine.\n\nGraphics\n\nTo begin with, let’s go over the physical screen of this console, which is where the user can appreciate everything that will be discussed in this section.\n\nDisplay\n\nThe PSP carries a 4.3” TFT LCD screen. It has a resolution of 480x272 pixels (for reference, that’s ~2.6 times the pixels of one screen of the Nintendo DS) and can display up to 16,777,216 colours. Thus, it’s got a 24-bit colour depth (the so-called ‘true color’ scale).\n\nThe aspect ratio is almost 16:9, a format which during that time was increasingly becoming standard on home TVs. Notice that a wider range of view is also an opportunity for game designers to improve the experience (especially in the first-person shooting genre).\n\nIntroducing the Graphics Engine\n\nNow it’s time to talk about the component in charge of producing pixels, the Graphics Engine (GE). The engine is found within the ‘system group’, so you may see it as a ‘group within a group’. Below you can see some of the results it achieved:\n\nThe GE draws 3D graphics (polygons) with many features applied (texture mapping, lighting and so much more), which you’ll see in a bit.\n\nArchitecture of the Graphics Engine\n\nThe GE subsystem has lots of interesting quirks to mention, so this will be a very complex section. But fear not! I’ll try to go step-by-step to avoid any confusion.\n\nFirst things first – the GE is made of three components:\n\nThe graphics core: where the actual graphics functionality happens.\n\nThe eDRAM controller: mediates access between eDRAM memory and the core.\n\nThe bus matrix: works as a ‘bus arbiter’ between the System Bus and the internals of the GE (remember the GE is found within the system group).\n\nIn reality, this component is a mesh of wires with some logic, but for the sake of explaining, it’s simpler to mask with a black box.\n\nThe reason for this design is that both main CPU and the graphics core can access those 2 MB of eDRAM. So, to prevent congestion, the traffic inside the GE goes through another Advanced High-performance Bus called local bus (‘local’ from the perspective of the GE). This allows the graphics core to perform its functions without depending on the System Bus to move data around (and consequently stalling the rest of the system).\n\nThe local bus is as wide as the System Bus (128 bits), but if that wasn’t enough, the graphics core has a direct line to eDRAM using a 512-bit bus (made of two unidirectional 256-bit buses). You’ll see why it will be needed in the following section.\n\nWhat about how the CPU and GE communicate with each other? As I said before, both CPU and graphics core can read from eDRAM. Additionally, the graphics core can access the System Bus to fetch data from any other component (including the main RAM). So, all of that just doesn’t happen magically.\n\nIn a nutshell, two bus matrix blocks re-wire the connection between the local bus and the System Bus. Whenever there’s a component that wants to access an ‘alien’ bus, the bus matrices configure the communication so that one unit becomes master of the two buses and no other overlaps, this persists until the designated unit finishes transferring memory.\n\nThis behaviour reminds me of the commonly known technique called bus mastering, where the leading component is the ‘bus master’ and has complete control of the bus, and the rest are ‘slaves’ waiting for commands. However, I’m not sure which protocol/standard Sony’s engineers were trying to replicate. Based on my understanding, I think it may be somewhat similar to I²C, a protocol used for serial communications (particularly useful with embedded systems) that also performs bus mastering.\n\nOrganising the content\n\nNow that we’ve seen what components we’ve got and how they interact with each other, let’s find out what information related to graphics we can place in memory.\n\nThere are three memory locations from which the GE will end up pulling from or filling:\n\n2 MB eDRAM: the aforementioned eDRAM. It’s used to store the frame-buffer, z-buffer and texture buffer. Its contents are directly written by the GE. This memory space is also called ‘local memory’.\n\nThe CPU can access this memory if needed, although its speed is not ideal.\n\n32 MB DDR SDRAM: this is the working area of the CPU for building display lists, vertex data, texture data and CLUTs (Colour lookup tables). In the context of graphics, this bloc is called ‘host memory’.\n\n16 KB SRAM: the scratchpad memory is also accessible by both CPU and GE.\n\nFunctionality\n\nLike its home sibling, the PSP’s graphics system focuses on rasterisation. However, the PSP’s VRAM is half the size of the PS2’s, and its bus is not as fast. To compensate, the PSP’s Graphics Engine features a vector processor!\n\nThe graphics pipeline is very similar to that of the PS2, with the addition of the vector processing stage. The graphics core is divided into two areas: the surface engine, which deals with vector processing, and the rendering engine which, as its name indicates, performs rasterisation and effects.\n\nAlthough its features have been explained in the past [10], the details of the graphics pipeline itself have not. The truth is, programmers don’t depend on that information to build their games. However, for the sake of this analysis, I’ve deduced a model myself.\n\nOn another note, I’ve decided to make it a bit more technical than previous articles. I thought this would be a good opportunity to learn new concepts and have a wider vision of computing graphics. Having said that, I strongly recommend reading about the PS1 and PS2 graphics systems before continuing.\n\nObservations\n\nAs evidenced, the PSP inherits various features from the PS2. The difference, however, is that functionality is now hardwired in the silicon, as opposed to offering many general-purpose programmable units (which require manual work to set them up). I presume this was done for two reasons: to use fewer transistors (so it fits in Tachyon and the board remains ‘portable’) and to facilitate porting PS2 codebases to the new console.\n\nInteractive models\n\nTo show how this system impacted model design and to help compare it to the PS2 and Nintendo DS, here are two examples of models designed for the PSP. Don’t forget the viewer is interactive!\n\nVideo out\n\nThe first model of this console (1000) has a proprietary video port called remote port at the bottom-left corner (next to the audio jack).\n\nIn later models (2000 and 3000), the remote port was expanded with an extra YCbCr pinout. Sony shipped three video cables (component, S-Video and composite) that rely on this interface to enable users to see the contents of the PSP screen on the TV.\n\nThe video cable will send a frame with a resolution of 720x480 pixels (in NTSC) or 720x576 pixels (in PAL), in progressive or interlaced mode (the latter option is only available on the 3000 model). As the PSP’s resolution is 480x272 pixels, games will show black bars to correct the aspect ratio. However, the bars won’t show when the console is running the ‘XMB’ visual shell, which natively supports adjusting its resolution according to the video cable.\n\nAudio\n\n(Please note that there isn’t space to define and explain every term used in this section. Where a term is uncommon, you can usually find a more comprehensive explanation in other articles from this series. I’ve put links where I can.)\n\nIn this section we tend to encounter a PSG, sequencer or a large mixer. This is because, at the end of the day, dedicated audio hardware is meant to offload audio operations from the CPU. Although if this hardware turns out to be ‘weak’, it degrades the sound capabilities of the console.\n\nNow, what we consider ‘sound hardware’ in the PSP is very bare-bones: only two PCM channels and a stereo mixer. The maximum sampling rate and resolution are 48 kHz and 16-bit, respectively.\n\nI don’t see any of the accelerators I mentioned in the first paragraph. So, does this imply that the sound will be as limited as other cases showed? No! Because the hardware of the PSP enables to compensate it with more software.\n\nYou see, while there isn’t a large amount of sound-related circuitry, Sony supplied a lot of general-purpose components. These can help with audio decoding, streaming and mixing. I’m talking about the Media Engine.\n\nThat block is very good at signal processing, but it needs to be programmed. So, Sony wrote the following software for the Media Engine to complement the two PCM channels (we’ll call these the ‘endpoint’) [15] [16]:\n\nSound driver: talks to the endpoint and performs memory transfers using DMA.\n\nSoftware audio synthesizer: as the name indicates, it generates the signals to be sent to the endpoint.\n\nThis synthesizer supports 32 channels, using the PCM, ADPCM or ATRAC3 formats [17].\n\nProvides digital reverb, pitch control and ADSR envelope.\n\nGames don’t have access to these modules directly. Instead, they call many libraries included in the official SDK. Some libraries are designed to operate raw signals while others are optimised for particular applications. Examples include:\n\nMP3 and AAC decoding.\n\nMIDI sequencing.\n\nVoIP audio decoding (G729 and u-law).\n\nThe operating system of the PSP bundled a variant of the ‘Skype’ app, if you wonder what uses VoIP could have here.\n\nAudio comparison\n\nLet’s put all this into practice by taking a look at how games reproduced their sound. I wrote this special player that allows you to swap between consoles (to enable side-by-side comparisons):\n\nIn the first example, the Nintendo DS game sequences its music on the fly, while the PSP one decodes ATRAC3. As you can hear, having no dedicated sound hardware per se doesn’t imply poor sound quality. In fact, one could argue the opposite, as the Media Engine provided more features than the sound chips of most previous portable consoles ever did.\n\nThe second example is much trickier to quantify. I placed a PS2 tune for comparison, but I had to boost the PS2 one a bit (I presume PSP soundtracks are louder to compensate for the smaller speaker and the proximity to the user). Also, bear in mind that the arrangements are slightly different between platforms. It’s possibly just a creative change since the PSP game was released five years after the PS2 one. Overall, the PSP doesn’t show deterioration (considering that the PS2’s SPU2 is very powerful and flexible).\n\nI/O\n\nThe PSP has plenty of connections and sensors. However, this section will be a good opportunity to introduce some chipsets that haven’t been mentioned yet. These play a big part in handling the circuitry that detects the player’s input.\n\nInternal interfaces\n\nMost of the I/O available is linked in the Peripheral Bus. It’s only 32 bits wide, which is enough to transfer simple information at a normal pace. It has access to the main RAM as well.\n\nThe D-pad, joystick and buttons are handled by a unique chip referred to as ‘System Control’ or SysCon. This is a common codename in Sony’s hardware and it deals with interfacing many internal components – in this case, only the physical buttons.\n\nExternal interfaces\n\nThe console features a good amount of connections [18]:\n\n802.11b WiFi: either connects to a hub or operates in ‘ad hoc’ mode to talk to nearby PSPs. This is similar to what the Nintendo DS offered.\n\nUSB 2.0: for accessories or to plug the console into a computer. In the case of the latter, the PSP is recognised as a mass storage device, providing access to the memory stick.\n\nIrDA: stands for ‘Infrared Data Association’, similar to what a TV remote uses to change the channel. Before the release of the PSP, the infrared protocol was popular for transferring multimedia between a camera/phone and the computer. As for the PSP, however, the IrDA port went bluntly ignored.\n\nAs tends to happen, Sony removed it with the second revision of the PSP (2000).\n\nCommercial accessories\n\nThe use of a standard port, USB, enabled other companies to design accessories for this console.\n\nExamples of commercialised accessories include:\n\nA microphone for audio chatting.\n\nA GPS antenna: apart from navigation, I don’t know what else can you do with it.\n\nA camera: a good addition for the microphone to achieve videoconferencing. This makes sense as Skype was even embedded in the system.\n\nThe funny thing is that these gadgets were also available for Pocket PCs and PDAs as well. It makes you wonder if Sony envisioned the PSP as a Pocket PC for youngsters.\n\nHome console connectivity\n\nAfter the release of the PlayStation 3, a new feature appeared on the PSP: Remote Play. Using a WiFi connection, the PS3 could be remotely controlled from the PSP.\n\nThis was many years before the Wii U launched, eh? Unfortunately, only a handful of PS3 games supported Remote Play, meaning users could only navigate through the menus, do some multimedia and play PlayStation 1 games.\n\nOperating System\n\nOver the years, the program in charge of controlling a given console before a game starts has become more and more convoluted – mainly due to the increasing need for security and services (updatable APIs, online multiplayer, multimedia, etc.). The PSP will try to fit all of that in very constrained hardware. Now, I don’t mean to say that the result will be mediocre, but many decisions are the result of balancing costs, performance and robustness.\n\nArchitecture and design\n\nFirst and foremost, the PSP contains a hidden, undocumented 4 KB ROM inside Tachyon where the boot-loader is. In other words, upon powering on, the CPU will start by looking for instructions in there. That ROM has many names, including ‘Bootrom’, ‘Pre-IPL’ and ‘Lib-PSP iplloader’. The latter is the internal codename used by Sony.\n\nThe rest of the system is installed on 32 MB of NAND Flash memory found in the motherboard. Here is where the majority of the PSP’s Operating System (OS) resides.\n\nThe OS is composed of the following components:\n\nBoot process\n\nNow that we’ve identified the main parts, let’s see how they organise to put the console into a ‘working state’ once we switch it on. Security is only briefly discussed here; the next section goes into more depth.\n\nThe complex boot process works as follows [21] [22]:\n\nThe main CPU’s reset vector is at 0x1FC00000, which points to the Pre-IPL ROM inside Tachyon.\n\nThe first half of the Pre-IPL tells the CPU to copy the other half to scratchpad memory and continue execution from there.\n\nThe Pre-IPL will now look for the next stage from either NAND or an external memory stick. When the latter is selected (never under normal use), the PSP enters a mode called factory service mode. For simplicity, we’ll focus on the normal mode (selecting NAND).\n\nThe Pre-IPL initialises the NAND controller and continues execution from NAND. The second part of the Pre-IPL runs the IPL, which is encrypted, so it will be decrypted (using ‘KIRK’, more details later) and copied to eDRAM (in the Graphics Engine) as a working area.\n\nOnce finished decrypting, it continues execution at eDRAM, where the decrypted IPL is.\n\nThe IPL’s execution process is divided into three stages.\n\nThe first stage, called the loader, resets the main CPU and hides the Pre-IPL ROM from the memory map. The loader also initialises minimal hardware and decompresses ‘Main.bin’, the next stage, on eDRAM.\n\nMain.bin focuses on initialising the rest of the hardware, including main memory. Once it finishes, it decrypts the third stage onto main memory and continues execution from there.\n\nThe final stage, referred to as payload, loads the kernel. The kernel is stored in the form of different binaries, modules and meta-data that, once loaded into main RAM, will give life to the system. Afterwards, the interactive shell is shown.\n\nVisual Shell\n\nThis console debuts (at least, internationally speaking) the famous XrossMediaBar or ‘XMB’. This is the feature-rich GUI that was shipped with the PSP.\n\nFrom a human-computer interaction standpoint, the XMB’s design reveals very interesting approaches for solving many interaction challenges (such as navigating around many depths of information, avoiding flooding the user with options and fitting all these solutions in a 4.3” screen). In essence, information is organised by ‘categories’ and ‘elements’; and the D-pad is the key to navigate through them. The left and right arrows switch between categories, and the up and down arrows select an element from within a category. It’s worth pointing out that all categories are found within the same hierarchy level. So, no entry is shown superimposed over the rest (impeding the insertion of attention-stealing advertisement and whatnot).\n\nOn another topic, the XMB provides customisation options, such as changing the background colour and re-arranging items. Moreover, it provides access to multimedia services and, of course, allows the user to load up the game (whether from a UMD or memory stick).\n\nThere’s also a file viewer embedded, which is used for both multimedia and save management.\n\nUpdatability\n\nAs we’ve seen before, everything except the Pre-IPL is stored in writable storage, and thus is ‘updatable’. Sony distributed firmware updates in the form of downloadable files. Users could either manually download them or use the ‘system update’ assistant from the XrossMediaBar to automatically download (using WiFi) and install them.\n\nSome updates strengthened the PSP’s security system by adding more layers of encryption to the boot process and integrity checks on kernel modules.\n\nFrom the developer’s standpoint, some updates enhanced the APIs by adding more functions and correcting existing ones. Games were therefore strongly tied to the system version they were developed for, and users would have to update to play newer games. However, new updates were always backwards compatible, so an old game should never break on an updated system (in theory).\n\nFrom the user’s perspective, some updates brought new services, like a web browser, RSS reader and so forth. After the release of the PlayStation 3, many online applications were ported to the PSP, such as the ‘PlayStation Store’ and ‘Remote Play’.\n\nGames\n\nFor the first time in this series, games developed for this console are not written for bare-metal: instead of relying on memory address and ports, they would have to call modules to perform operations on the hardware. The APIs found in the official SDK are modelled after this design.\n\nDevelopment ecosystem\n\nThe development toolkit provided by Sony to game studios was developed by SN Systems (the same author of the PS1 and PS2 kits). The software kit required a setup with either Windows XP and Cygwin or CentOS Linux.\n\nIn this kit we could find:\n\nAn SDK: contained C++ libraries that linked to a particular version of the firmware (as they depend on the modules installed).\n\nA choice of two compilers: a variant of the GCC compiler called ‘psp-gcc’, or one developed by SN Systems called ‘SVCPSP’ (‘SVC’ targeting the PSP).\n\nThe GDB debugger.\n\nSN System’s assembler, linker and archiver. The latter generates PSP executables.\n\nA plugin for Visual Studio 2005 and 2008, so developers could use Microsoft’s IDE for PSP development.\n\nInitially, Sony only provided an emulator to test PSP software. This was later replaced with the PSP Hardware Tool: a PC-like tower connected to a dummy PSP case (similar to the Nintendo DS kit). The devkit connected to the workstation using a piece of software called ProDG (only available on Windows).\n\nStorage medium\n\nThe PS1 and PS2 featured two types of storage: a read-only disc for loading games, and a re-writable ‘Memory Card’ for storing saves and executables. The PSP continued this tradition using different methods. Considering it was their first -mainstream- portable console, how did Sony manage to find the right medium for each job? Well, taking into account they were the creators of the BetaMax, MiniDisc and so forth, you can guess what they did this time… introduce even more formats.\n\nNetwork services\n\nEventually, Sony caught up with the competition and improved its online infrastructure. They even offered services not yet provided by Microsoft or Nintendo.\n\nAnti-Piracy and Homebrew\n\nJust because this is a portable console doesn’t mean it should have weaker security than the PS2. It’s quite the opposite in all senses – the security system implemented on the PSP is very diverse, with some parts still remaining a mystery to this day.\n\nNow, we all know by now that its implementation contained pitfalls that eventually lead to Homebrew and piracy, but considering it was released in 2004 and it’s a portable console, you may find that some algorithms bundled are state-of-the-art compared to the competition.\n\nPhysical security\n\nI’m going to describe the three main chips that compute security-related operations. The algorithms can be pretty complicated for first-timers, but I’ll try to give a quick overview. Don’t forget to check out the bibliography if you find it interesting, as this writing is primarily focused on the PSP itself.\n\nThroughout the explanations, keep in mind that none of this information was documented by Sony for security reasons, in addition to labelling security-related routines with silly names.\n\nFurthermore, I won’t be able to go over each cypher system, as it’s a tortuous topic and would divert the article from its main goal. Nonetheless, I invite you to learn about the logic behind each algorithm from other sources.\n\nSoftware security\n\nThe operating system will use the hardware provided to compose a security system. Overall, the software is protected using the following principles:\n\nChain of trust: The Pre-IPL, the first stage of the boot process, is a read-only piece of code written by Sony and embedded during manufacturing. Anything that the Pre-IPL approves is deemed trustworthy, and so are the subsequent programs executed.\n\nSigned executables: not only are executables encrypted, but they are also signed with keys that only Sony knows, ensuring that tampered data can’t be re-signed.\n\nObscure hardware: KIRK, SPOCK and Lepton are undocumented and obfuscated blocks of silicon that won’t expose which algorithms are applied and how.\n\nDeveloper-proof security: the MMU’s privilege modes will restrict access to sensible memory locations, even with the existence of user-level exploits on retail games (which lead to arbitrary code execution).\n\nDefeat\n\nDespite all the security, it seems that hackers never gave up on this console (maybe because the number of benefits made it very attractive for Homebrew development?). Please note that the amount of development in this area is outstanding, so I had to draw a line somewhere. Thus, only huge discoveries are mentioned here. In any case, playstationdev.wiki keeps a good archive of every single one.\n\nHomebrew encouragement\n\nNot only Homebrew development centred on breaking security mechanisms, but there were also communities committed to providing Homebrew developers with the necessary tools to build their software without legal repercussions. For instance, the pspdev group published an open-source SDK called PSPSDK that replicated many of the official interfaces and didn’t enforce previous restrictions imposed by Sony.\n\nPSPSDK also includes a toolkit to handle the compilation and packaging process, just like the official SDK but targeting a PSP running a CFW instead.\n\nThat’s all folks\n\nThere you go, you’ve just finished reading about the last portable console before smartphones and tablets took over! I think this gives us an idea of what services/features users were expecting from portable handhelds in the early noughties – and how this evolved during the next decade.\n\nNevertheless, I want to thank the PSP Homebrew Community discord for not only taking the time to proofread this endless article, but also to enlighten me with even more information. Various members of that group have dedicated great effort to develop free tools and Homebrew applications to expand the capabilities of this console. My acknowledgement is also directed to all the authors who produced the documents listed in the sources. It took me ~3 months to write this article, but it was possible thanks to the combined years of work that other people dedicated to reverse-engineer this console.\n\nAs for the next article, I’ll need to first take one month or two to focus on all the issues and requests submitted on the GitHub repo and do some maintenance work on the site, but rest assured I’m striving to make the next writing as complete as this one!"
    }
}